function runTest(e,t){function r(e,t){e.nextObject(function(s,o){s?console.log("nextObject",t,"error:",s):o?console.log("nextObject",t,"found:",o):console.log("nextObject",t,"no document"),callbacksCalled[t]&&(console.log("callback",t,"called twice"),console.log("dumping the cursor nextObject was called on:"),console.log(e),process.exit(1)),callbacksCalled[t]=!0,e.isClosed()?(console.log("cursor closed"),n+=10,i()):(n+=1,r(e,n))})}function i(){var e=t.find({},{tailable:!0,numberOfRetries:-1}).sort({$natural:1});r(e,n)}var n=0;i()}var mongodb=require("./lib/mongodb"),async=require("async"),ObjectId=mongodb.ObjectID,ReplicaSetManager=require("./test/tools/replica_set_manager").ReplicaSetManager,dbUrl="mongodb://127.0.0.1:30000/mydb?replicaSet=rs0",dbOptions={db:{w:1},server:{auto_reconnect:!0,poolSize:5}},callbacksCalled={};RS=new ReplicaSetManager({name:"rs0",retries:120,secondary_count:0,passive_count:0,arbiter_count:1}),RS.startSet(!0,function(e,t){if(e!=null)throw e;mongodb.Db.connect(dbUrl,dbOptions,function(e,t){e&&(console.log(e),process.exit(1)),console.log("database connected"),t.on("error",function(e){console.log("db.on('error'):",e)}),t.createCollection("testCapped",{capped:!0,w:1,size:1e5,max:20},function(e,n){e&&(console.log(e),process.exit(1)),console.log("collection created"),runTest(t,n)})})});