function Binary(e,t){if(!(this instanceof Binary))return new Binary(e,t);this._bsontype="Binary",e instanceof Number?(this.sub_type=e,this.position=0):(this.sub_type=t==null?BSON_BINARY_SUBTYPE_DEFAULT:t,this.position=0);if(e==null||e instanceof Number)typeof Buffer!="undefined"?this.buffer=new Buffer(Binary.BUFFER_SIZE):typeof Uint8Array!="undefined"?this.buffer=new Uint8Array(new ArrayBuffer(Binary.BUFFER_SIZE)):this.buffer=new Array(Binary.BUFFER_SIZE),this.position=0;else{if(typeof e=="string")if(typeof Buffer!="undefined")this.buffer=new Buffer(e);else{if(typeof Uint8Array=="undefined"&&Object.prototype.toString.call(e)!="[object Array]")throw new Error("only String, Buffer, Uint8Array or Array accepted");this.buffer=writeStringToArray(e)}else this.buffer=e;this.position=e.length}}if(typeof window=="undefined")var Buffer=require("buffer").Buffer;var BSON_BINARY_SUBTYPE_DEFAULT=0,writeStringToArray=function(e){var t=typeof Uint8Array!="undefined"?new Uint8Array(new ArrayBuffer(e.length)):new Array(e.length);for(var n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t},convertArraytoUtf8BinaryString=function(e,t,n){var r="";for(var i=t;i<n;i++)r+=String.fromCharCode(e[i]);return r};Binary.prototype.put=function(t){if(t["length"]!=null&&typeof t!="number"&&t.length!=1)throw new Error("only accepts single character String, Uint8Array or Array");if(typeof t!="number"&&t<0||t>255)throw new Error("only accepts number in a valid unsigned byte range 0-255");var n=null;typeof t=="string"?n=t.charCodeAt(0):t["length"]!=null?n=t[0]:n=t;if(this.buffer.length>this.position)this.buffer[this.position++]=n;else if(typeof Buffer!="undefined"&&Buffer.isBuffer(this.buffer)){var r=new Buffer(Binary.BUFFER_SIZE+this.buffer.length);this.buffer.copy(r,0,0,this.buffer.length),this.buffer=r,this.buffer[this.position++]=n}else{var r=null;Object.prototype.toString.call(this.buffer)=="[object Uint8Array]"?r=new Uint8Array(new ArrayBuffer(Binary.BUFFER_SIZE+this.buffer.length)):r=new Array(Binary.BUFFER_SIZE+this.buffer.length);for(var i=0;i<this.buffer.length;i++)r[i]=this.buffer[i];this.buffer=r,this.buffer[this.position++]=n}},Binary.prototype.write=function(t,n){n=typeof n=="number"?n:this.position;if(this.buffer.length<n+t.length){var r=null;if(typeof Buffer!="undefined"&&Buffer.isBuffer(this.buffer))r=new Buffer(this.buffer.length+t.length),this.buffer.copy(r,0,0,this.buffer.length);else if(Object.prototype.toString.call(this.buffer)=="[object Uint8Array]"){r=new Uint8Array(new ArrayBuffer(this.buffer.length+t.length));for(var i=0;i<this.position;i++)r[i]=this.buffer[i]}this.buffer=r}if(typeof Buffer!="undefined"&&Buffer.isBuffer(t)&&Buffer.isBuffer(this.buffer))t.copy(this.buffer,n,0,t.length),this.position=n+t.length>this.position?n+t.length:this.position;else if(typeof Buffer!="undefined"&&typeof t=="string"&&Buffer.isBuffer(this.buffer))this.buffer.write(t,"binary",n),this.position=n+t.length>this.position?n+t.length:this.position;else if(Object.prototype.toString.call(t)=="[object Uint8Array]"||Object.prototype.toString.call(t)=="[object Array]"&&typeof t!="string"){for(var i=0;i<t.length;i++)this.buffer[n++]=t[i];this.position=n>this.position?n:this.position}else if(typeof t=="string"){for(var i=0;i<t.length;i++)this.buffer[n++]=t.charCodeAt(i);this.position=n>this.position?n:this.position}},Binary.prototype.read=function(t,n){n=n&&n>0?n:this.position;if(this.buffer.slice)return this.buffer.slice(t,t+n);var r=typeof Uint8Array!="undefined"?new Uint8Array(new ArrayBuffer(n)):new Array(n);for(var i=0;i<n;i++)r[i]=this.buffer[t++];return r},Binary.prototype.value=function(t){t=t==null?!1:t;if(typeof Buffer!="undefined"&&Buffer.isBuffer(this.buffer))return t?this.buffer.slice(0,this.position):this.buffer.toString("binary",0,this.position);if(t){if(this.buffer["slice"]!=null)return this.buffer.slice(0,this.position);var n=Object.prototype.toString.call(this.buffer)=="[object Uint8Array]"?new Uint8Array(new ArrayBuffer(this.position)):new Array(this.position);for(var r=0;r<this.position;r++)n[r]=this.buffer[r];return n}return convertArraytoUtf8BinaryString(this.buffer,0,this.position)},Binary.prototype.length=function(){return this.position},Binary.prototype.toJSON=function(){return this.buffer!=null?this.buffer.toString("base64"):""},Binary.prototype.toString=function(e){return this.buffer!=null?this.buffer.slice(0,this.position).toString(e):""},Binary.BUFFER_SIZE=256,Binary.SUBTYPE_DEFAULT=0,Binary.SUBTYPE_FUNCTION=1,Binary.SUBTYPE_BYTE_ARRAY=2,Binary.SUBTYPE_UUID_OLD=3,Binary.SUBTYPE_UUID=4,Binary.SUBTYPE_MD5=5,Binary.SUBTYPE_USER_DEFINED=128,exports.Binary=Binary;