function BinaryParser(e,t){if(!(this instanceof BinaryParser))return new BinaryParser(e,t);this.bigEndian=e,this.allowExceptions=t}function BinaryParserBuffer(e,t){this.bigEndian=e||0,this.buffer=[],this.setBuffer(t)}var chr=String.fromCharCode,maxBits=[];for(var i=0;i<64;i++)maxBits[i]=Math.pow(2,i);BinaryParser.warn=function(t){if(this.allowExceptions)throw new Error(t);return 1},BinaryParser.decodeFloat=function(t,n,r){var i=new this.Buffer(this.bigEndian,t);i.checkBuffer(n+r+1);var s=maxBits[r-1]-1,o=i.readBits(n+r,1),u=i.readBits(n,r),a=0,f=2,l=i.buffer.length+(-n>>3)-1;do for(var c=i.buffer[++l],h=n%8||8,p=1<<h;p>>=1;c&p&&(a+=1/f),f*=2);while(n-=h);return u==(s<<1)+1?a?NaN:o?-Infinity:+Infinity:(1+o*-2)*(u||a?u?Math.pow(2,u-s)*(1+a):Math.pow(2,-s+1)*a:0)},BinaryParser.decodeInt=function(t,n,r,i){var s=new this.Buffer(this.bigEndian||i,t),o=s.readBits(0,n),u=maxBits[n];return r&&o>=u/2?o-u:o},BinaryParser.encodeFloat=function(t,n,i){var s=maxBits[i-1]-1,o=-s+1,u=s,a=o-n,f=parseFloat(t),l=isNaN(f)||f==-Infinity||f==+Infinity?f:0,c=0,h=2*s+1+n+3,p=new Array(h),d=(f=l!==0?0:f)<0,v=Math.floor(f=Math.abs(f)),m=f-v,g,y,b,w,E;for(w=h;w;p[--w]=0);for(w=s+2;v&&w;p[--w]=v%2,v=Math.floor(v/2));for(w=s+1;m>0&&w;(p[++w]=((m*=2)>=1)-0)&&--m);for(w=-1;++w<h&&!p[w];);if(p[(g=n-1+(w=(c=s+1-w)>=o&&c<=u?w+1:s+1-(c=o-1)))+1]){if(!(y=p[g]))for(E=g+2;!y&&E<h;y=p[E++]);for(E=g+1;y&&--E>=0;(p[E]=!p[E]-0)&&(y=0));}for(w=w-2<0?-1:w-3;++w<h&&!p[w];);(c=s+1-w)>=o&&c<=u?++w:c<o&&(c!=s+1-h&&c<a&&this.warn("encodeFloat::float underflow"),w=s+1-(c=o-1));if(v||l!==0)this.warn(v?"encodeFloat::float overflow":"encodeFloat::"+l),c=u+1,w=s+2,l==-Infinity?d=1:isNaN(l)&&(p[w]=1);for(f=Math.abs(c+s),E=i+1,b="";--E;b=f%2+b,f=f>>=1);for(f=0,E=0,w=(b=(d?"1":"0")+b+p.slice(w,w+n).join("")).length,r=[];w;E=(E+1)%8)f+=(1<<E)*b.charAt(--w),E==7&&(r[r.length]=String.fromCharCode(f),f=0);return r[r.length]=f?String.fromCharCode(f):"",(this.bigEndian?r.reverse():r).join("")},BinaryParser.encodeInt=function(t,n,r,i){var s=maxBits[n];if(t>=s||t<-(s/2))this.warn("encodeInt::overflow"),t=0;t<0&&(t+=s);for(var o=[];t;o[o.length]=String.fromCharCode(t%256),t=Math.floor(t/256));for(n=-(-n>>3)-o.length;n--;o[o.length]="\0");return(this.bigEndian||i?o.reverse():o).join("")},BinaryParser.toSmall=function(e){return this.decodeInt(e,8,!0)},BinaryParser.fromSmall=function(e){return this.encodeInt(e,8,!0)},BinaryParser.toByte=function(e){return this.decodeInt(e,8,!1)},BinaryParser.fromByte=function(e){return this.encodeInt(e,8,!1)},BinaryParser.toShort=function(e){return this.decodeInt(e,16,!0)},BinaryParser.fromShort=function(e){return this.encodeInt(e,16,!0)},BinaryParser.toWord=function(e){return this.decodeInt(e,16,!1)},BinaryParser.fromWord=function(e){return this.encodeInt(e,16,!1)},BinaryParser.toInt=function(e){return this.decodeInt(e,32,!0)},BinaryParser.fromInt=function(e){return this.encodeInt(e,32,!0)},BinaryParser.toLong=function(e){return this.decodeInt(e,64,!0)},BinaryParser.fromLong=function(e){return this.encodeInt(e,64,!0)},BinaryParser.toDWord=function(e){return this.decodeInt(e,32,!1)},BinaryParser.fromDWord=function(e){return this.encodeInt(e,32,!1)},BinaryParser.toQWord=function(e){return this.decodeInt(e,64,!0)},BinaryParser.fromQWord=function(e){return this.encodeInt(e,64,!0)},BinaryParser.toFloat=function(e){return this.decodeFloat(e,23,8)},BinaryParser.fromFloat=function(e){return this.encodeFloat(e,23,8)},BinaryParser.toDouble=function(e){return this.decodeFloat(e,52,11)},BinaryParser.fromDouble=function(e){return this.encodeFloat(e,52,11)},BinaryParser.encode_int32=function(t,n){var r,i,s,o,u;return u=t<0?t+4294967296:t,r=Math.floor(u/16777215),u&=16777215,i=Math.floor(u/65535),u&=65535,s=Math.floor(u/255),u&=255,o=Math.floor(u),n?[chr(r),chr(i),chr(s),chr(o)]:chr(r)+chr(i)+chr(s)+chr(o)},BinaryParser.encode_int64=function(t){var n,r,i,s,o,u,a,f,l;return l=t<0?t+0x10000000000000000:t,n=Math.floor(l/72057594037927940),l&=72057594037927940,r=Math.floor(l/0xffffffffffff),l&=0xffffffffffff,i=Math.floor(l/0xffffffffff),l&=0xffffffffff,s=Math.floor(l/4294967295),l&=4294967295,o=Math.floor(l/16777215),l&=16777215,u=Math.floor(l/65535),l&=65535,a=Math.floor(l/255),l&=255,f=Math.floor(l),chr(n)+chr(r)+chr(i)+chr(s)+chr(o)+chr(u)+chr(a)+chr(f)},BinaryParser.decode_utf8=function(t){var n=t.length,r="",i=0,s=0,o=0,u=0,a;while(i<n)s=t.charCodeAt(i),s<128?(r+=String.fromCharCode(s),i++):s>191&&s<224?(u=t.charCodeAt(i+1),r+=String.fromCharCode((s&31)<<6|u&63),i+=2):(u=t.charCodeAt(i+1),a=t.charCodeAt(i+2),r+=String.fromCharCode((s&15)<<12|(u&63)<<6|a&63),i+=3);return r},BinaryParser.encode_cstring=function(t){return unescape(encodeURIComponent(t))+BinaryParser.fromByte(0)},BinaryParser.encode_utf8=function(t){var n="",r;for(var i=0,s=t.length;i<s;i++)r=t.charCodeAt(i),r<128?n+=String.fromCharCode(r):r>127&&r<2048?(n+=String.fromCharCode(r>>6|192),n+=String.fromCharCode(r&63|128)):(n+=String.fromCharCode(r>>12|224),n+=String.fromCharCode(r>>6&63|128),n+=String.fromCharCode(r&63|128));return n},BinaryParser.hprint=function(t){var n;for(var r=0,i=t.length;r<i;r++)t.charCodeAt(r)<32?(n=t.charCodeAt(r)<=15?"0"+t.charCodeAt(r).toString(16):t.charCodeAt(r).toString(16),process.stdout.write(n+" ")):(n=t.charCodeAt(r)<=15?"0"+t.charCodeAt(r).toString(16):t.charCodeAt(r).toString(16),process.stdout.write(n+" "));process.stdout.write("\n\n")},BinaryParser.ilprint=function(t){var n;for(var r=0,i=t.length;r<i;r++)t.charCodeAt(r)<32?(n=t.charCodeAt(r)<=15?"0"+t.charCodeAt(r).toString(10):t.charCodeAt(r).toString(10),require("util").debug(n+" : ")):(n=t.charCodeAt(r)<=15?"0"+t.charCodeAt(r).toString(10):t.charCodeAt(r).toString(10),require("util").debug(n+" : "+t.charAt(r)))},BinaryParser.hlprint=function(t){var n;for(var r=0,i=t.length;r<i;r++)t.charCodeAt(r)<32?(n=t.charCodeAt(r)<=15?"0"+t.charCodeAt(r).toString(16):t.charCodeAt(r).toString(16),require("util").debug(n+" : ")):(n=t.charCodeAt(r)<=15?"0"+t.charCodeAt(r).toString(16):t.charCodeAt(r).toString(16),require("util").debug(n+" : "+t.charAt(r)))},BinaryParserBuffer.prototype.setBuffer=function(t){var n,r,i;if(t){r=n=t.length,i=this.buffer=new Array(n);for(;r;i[n-r]=t.charCodeAt(--r));this.bigEndian&&i.reverse()}},BinaryParserBuffer.prototype.hasNeededBits=function(t){return this.buffer.length>=-(-t>>3)},BinaryParserBuffer.prototype.checkBuffer=function(t){if(!this.hasNeededBits(t))throw new Error("checkBuffer::missing bytes")},BinaryParserBuffer.prototype.readBits=function(t,n){function r(e,t){for(;t--;e=((e%=2147483647+1)&1073741824)==1073741824?e*2:(e-1073741824)*2+2147483647+1);return e}if(t<0||n<=0)return 0;this.checkBuffer(t+n);var i,s=t%8,o=this.buffer.length-(t>>3)-1,u=this.buffer.length+(-(t+n)>>3),a=o-u,f=(this.buffer[o]>>s&(1<<(a?8-s:n))-1)+(a&&(i=(t+n)%8)?(this.buffer[u++]&(1<<i)-1)<<(a--<<3)-s:0);for(;a;f+=r(this.buffer[u++],(a--<<3)-s));return f},BinaryParser.Buffer=BinaryParserBuffer,exports.BinaryParser=BinaryParser;