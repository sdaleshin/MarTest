var BinaryParser=require("./binary_parser").BinaryParser,MACHINE_ID=parseInt(Math.random()*16777215,10),checkForHexRegExp=new RegExp("^[0-9a-fA-F]{24}$"),ObjectID=function e(t){if(!(this instanceof e))return new e(t);this._bsontype="ObjectID";var n=null;if(t!=null&&"number"!=typeof t&&t.length!=12&&t.length!=24)throw new Error("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters");if(t==null||typeof t=="number")this.id=this.generate(t);else{if(t==null||t.length!==12){if(checkForHexRegExp.test(t))return e.createFromHexString(t);throw new Error("Value passed in is not a valid 24 character hex string")}this.id=t}e.cacheHexString&&(this.__id=this.toHexString())},ObjectId=ObjectID;ObjectID.prototype.toHexString=function(){if(ObjectID.cacheHexString&&this.__id)return this.__id;var e="",t,n;for(var r=0,i=this.id.length;r<i;r++)n=BinaryParser.toByte(this.id[r]),t=n<=15?"0"+n.toString(16):n.toString(16),e+=t;return ObjectID.cacheHexString&&(this.__id=e),e},ObjectID.prototype.get_inc=function(){return ObjectID.index=(ObjectID.index+1)%16777215},ObjectID.prototype.getInc=function(){return this.get_inc()},ObjectID.prototype.generate=function(e){"number"!=typeof e&&(e=parseInt(Date.now()/1e3,10));var t=BinaryParser.encodeInt(e,32,!0,!0),n=BinaryParser.encodeInt(MACHINE_ID,24,!1),r=BinaryParser.fromShort(typeof process=="undefined"?Math.floor(Math.random()*1e5):process.pid),i=BinaryParser.encodeInt(this.get_inc(),24,!1,!0);return t+n+r+i},ObjectID.prototype.toString=function(){return this.toHexString()},ObjectID.prototype.inspect=ObjectID.prototype.toString,ObjectID.prototype.toJSON=function(){return this.toHexString()},ObjectID.prototype.equals=function(t){var n=t instanceof ObjectID||t.toHexString?t.id:ObjectID.createFromHexString(t).id;return this.id===n},ObjectID.prototype.getTimestamp=function(){var e=new Date;return e.setTime(Math.floor(BinaryParser.decodeInt(this.id.substring(0,4),32,!0,!0))*1e3),e},ObjectID.index=parseInt(Math.random()*16777215,10),ObjectID.createPk=function(){return new ObjectID},ObjectID.createFromTime=function(t){var n=BinaryParser.encodeInt(t,32,!0,!0)+BinaryParser.encodeInt(0,64,!0,!0);return new ObjectID(n)},ObjectID.createFromHexString=function(t){if(typeof t=="undefined"||t!=null&&t.length!=24)throw new Error("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters");var n=t.length;if(n>24)throw new Error("Id cannot be longer than 12 bytes");var r="",i,s;for(var o=0;o<n;o+=2)i=t.substr(o,2),s=parseInt(i,16),r+=BinaryParser.fromByte(s);return new ObjectID(r,t)},Object.defineProperty(ObjectID.prototype,"generationTime",{enumerable:!0,get:function(){return Math.floor(BinaryParser.decodeInt(this.id.substring(0,4),32,!0,!0))},set:function(e){var e=BinaryParser.encodeInt(e,32,!0,!0);this.id=e+this.id.substr(4),this.toHexString()}}),exports.ObjectID=ObjectID,exports.ObjectId=ObjectID;