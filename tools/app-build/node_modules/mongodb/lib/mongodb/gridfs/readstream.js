function ReadStream(e,t){if(!(this instanceof ReadStream))return new ReadStream(e,t);Stream.call(this),this.autoclose=!!e,this.gstore=t,this.finalLength=t.length-t.position,this.completedLength=0,this.currentChunkNumber=t.currentChunk.chunkNumber,this.paused=!1,this.readable=!0,this.pendingChunk=null,this.executing=!1,this.destroyed=!1,this.numberOfChunks=Math.ceil(t.length/t.chunkSize),this.seekStartPosition=t.position-this.currentChunkNumber*t.chunkSize;var n=this;processor(function(){n._execute()})}var Stream=require("stream").Stream,timers=require("timers"),util=require("util"),processor=require("../utils").processor();ReadStream.prototype.__proto__=Stream.prototype,ReadStream.prototype.readable,ReadStream.prototype.paused,ReadStream.prototype._execute=function(){if(this.paused===!0||this.readable===!1)return;var e=this.gstore,t=this;this.executing=!0;var n=!1,r=0;e.currentChunk.chunkNumber>=this.numberOfChunks-1&&(t.executing=!1,n=!0);var i=null;this.seekStartPosition>0&&e.currentChunk.length()-this.seekStartPosition>0?(i=e.currentChunk.readSlice(e.currentChunk.length()-this.seekStartPosition),this.seekStartPosition=0):i=e.currentChunk.readSlice(e.currentChunk.length()),i!=null&&e.currentChunk.chunkNumber==t.currentChunkNumber&&(t.currentChunkNumber=t.currentChunkNumber+1,t.completedLength+=i.length,t.pendingChunk=null,t.emit("data",i)),n===!0?(t.readable=!1,t.emit("end"),t.autoclose===!0&&(e.mode[0]=="w"?e.close(function(e,n){if(e){console.log("############################## 0"),t.emit("error",e);return}t.readable=!1,t.destroyed=!0,t.emit("close",n)}):(t.readable=!1,t.destroyed=!0,t.emit("close")))):e._nthChunk(e.currentChunk.chunkNumber+1,function(n,r){if(n){t.readable=!1,t.listeners("error").length>0&&t.emit("error",n),t.executing=!1;return}t.pendingChunk=r;if(t.paused===!0){t.executing=!1;return}e.currentChunk=t.pendingChunk,t._execute()})},ReadStream.prototype.pause=function(){this.executing||(this.paused=!0)},ReadStream.prototype.destroy=function(){if(this.destroyed)return;this.destroyed=!0,this.readable=!1,this.emit("close")},ReadStream.prototype.resume=function(){if(this.paused===!1||!this.readable)return;this.paused=!1;var e=this;processor(function(){e._execute()})},exports.ReadStream=ReadStream;