var Cursor2=require("./cursor").Cursor,Readable=require("stream").Readable,utils=require("./utils"),inherits=require("util").inherits,Cursor=function(t,n){this.toArray=function(e){return n.toArray(e)},this.each=function(e){return n.each(e)},this.next=function(e){this.nextObject(e)},this.nextObject=function(e){return n.nextObject(e)},this.setReadPreference=function(e,r){return t.readPreference={readPreference:e},n.setReadPreference(e,r),this},this.batchSize=function(e,r){return t.batchSize=e,n.batchSize(t.batchSize,r),this},this.count=function(e,t){return n.count(e,t)},this.stream=function(e){return n.stream(e)},this.close=function(e){return n.close(e)},this.explain=function(e){return n.explain(e)},this.isClosed=function(e){return n.isClosed()},this.rewind=function(){return n.rewind()},this.limit=function(e,r){return n.limit(e,r),t.limit=e,this},this.skip=function(e,r){return n.skip(e,r),t.skip=e,this},this.hint=function(e){return t.hint=e,n.hint=t.hint,this},this.maxTimeMS=function(e){return n.maxTimeMS(e),t.maxTimeMS=e,this},this.sort=function(e,r,i){return n.sort(e,r,i),t.sort=e,this},this.fields=function(e){return _fields=e,n.fields=_fields,this},Object.defineProperty(this,"timeout",{get:function(){return n.timeout}}),Object.defineProperty(this,"read",{get:function(){return n.read}}),Object.defineProperty(this,"items",{get:function(){return n.items}})},Scope=function(e,t,n,r){var i=this;r=r||{};var s=r.write_concern||null;r.readPreference||(r.readPreference={readPreference:"primary"});var o=new Cursor2(e.db,e,t,n,r),u={insert:function(t,n){var r=s||{};e.insert(t,r,n)},save:function(t,n){var r=s||{};e.save(t,r,function(e,r){return typeof r=="number"&&r==1?n(null,t):n(null,t)})},find:function(e){return t=e,u},update:function(n,i){var o=s||{};o.multi=r.multi?r.multi:!0,r.upsert&&(o.upsert=r.upsert),e.update(t,n,o,function(e,t,n){i(e,n)})}};this.withWriteConcern=function(e){return r.write_concern=e,s=e,u},this.find=function(e,n){return t=e,o.selector=e,new Cursor(r,o)}};exports.Scope=Scope;