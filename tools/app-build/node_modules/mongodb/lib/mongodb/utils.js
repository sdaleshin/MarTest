var timers=require("timers"),formatSortValue=exports.formatSortValue=function(e){var t=(""+e).toLowerCase();switch(t){case"ascending":case"asc":case"1":return 1;case"descending":case"desc":case"-1":return-1;default:throw new Error("Illegal sort clause, must be of the form [['field1', '(ascending|descending)'], ['field2', '(ascending|descending)']]")}},formattedOrderClause=exports.formattedOrderClause=function(e){var t={};if(Array.isArray(e))for(var n=0;n<e.length;n++)e[n].constructor==String?t[e[n]]=1:t[e[n][0]]=formatSortValue(e[n][1]);else if(Object.prototype.toString.call(e)==="[object Object]")t=e;else{if(e.constructor!=String)throw new Error("Illegal sort clause, must be of the form [['field1', '(ascending|descending)'], ['field2', '(ascending|descending)']]");t[e]=1}return t};exports.encodeInt=function(e){var t=new Buffer(4);return t[3]=e>>24&255,t[2]=e>>16&255,t[1]=e>>8&255,t[0]=e&255,t},exports.encodeIntInPlace=function(e,t,n){t[n+3]=e>>24&255,t[n+2]=e>>16&255,t[n+1]=e>>8&255,t[n]=e&255},exports.encodeCString=function(e){var t=new Buffer(e,"utf8");return[t,new Buffer([0])]},exports.decodeUInt32=function(e,t){return e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24},exports.decodeUInt8=function(e,t){return e[t]};var toString=Object.prototype.toString;exports.isObject=function(e){return"[object Object]"==toString.call(e)},exports.isArray=function(e){return Array.isArray(e)||"object"==typeof e&&"[object Array]"==toString.call(e)},exports.isDate=function(e){return"object"==typeof e&&"[object Date]"==toString.call(e)},exports.isRegExp=function(e){return"object"==typeof e&&"[object RegExp]"==toString.call(e)};var toError=function(e){if(e instanceof Error)return e;var t=e.err||e.errmsg||e.errMessage||e,n=new Error(t);n.name="MongoError";var r=typeof e=="object"?Object.keys(e):[];for(var i=0;i<r.length;i++)n[r[i]]=e[r[i]];return n};exports.toError=toError,exports.objectToArray=function(e){var t=[];for(var n in e)t.push(e[n]);return t},exports.handleSingleCommandResultReturn=function(e,t,n){return function(r,i,s){if(r&&typeof n=="function")return n(r,null);if(!i||!i.documents||i.documents.length==0)if(typeof n=="function")return n(toError("command failed to return results"),null);if(i&&i.documents[0].ok==1){if(e)return n(null,e);if(typeof n=="function")return n(null,i.documents[0])}if(typeof n=="function")return n(toError(i.documents[0]),t)}},exports.processor=function(){return process.maxTickDepth=Infinity,process.nextTick},exports.setSocketTimeoutProperty=function(e,t){Object.defineProperty(e,"socketTimeoutMS",{enumerable:!0,get:function(){return t.socketTimeoutMS},set:function(n){t.socketTimeoutMS=n;var r=e.allRawConnections();for(var i=0;i<r.length;i++)r[i].socketTimeoutMS=n}})},exports.hasWriteCommands=function(e){return e!=null&&e.serverCapabilities!=null&&e.serverCapabilities.hasWriteCommands};