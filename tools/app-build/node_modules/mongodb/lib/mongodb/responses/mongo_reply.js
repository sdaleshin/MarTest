var Long=require("bson").Long,timers=require("timers"),processor=require("../utils").processor(),MongoReply=exports.MongoReply=function(){this.documents=[],this.index=0};MongoReply.prototype.parseHeader=function(e,t){this.messageLength=e[this.index]|e[this.index+1]<<8|e[this.index+2]<<16|e[this.index+3]<<24,this.index=this.index+4,this.requestId=e[this.index]|e[this.index+1]<<8|e[this.index+2]<<16|e[this.index+3]<<24,this.index=this.index+4,this.responseTo=e[this.index]|e[this.index+1]<<8|e[this.index+2]<<16|e[this.index+3]<<24,this.index=this.index+4+4,this.responseFlag=e[this.index]|e[this.index+1]<<8|e[this.index+2]<<16|e[this.index+3]<<24,this.index=this.index+4;var n=e[this.index]|e[this.index+1]<<8|e[this.index+2]<<16|e[this.index+3]<<24;this.index=this.index+4;var r=e[this.index]|e[this.index+1]<<8|e[this.index+2]<<16|e[this.index+3]<<24;this.index=this.index+4,this.cursorId=new Long(n,r),this.startingFrom=e[this.index]|e[this.index+1]<<8|e[this.index+2]<<16|e[this.index+3]<<24,this.index=this.index+4,this.numberReturned=e[this.index]|e[this.index+1]<<8|e[this.index+2]<<16|e[this.index+3]<<24,this.index=this.index+4},MongoReply.prototype.parseBody=function(e,t,n,r){n=n==null?!1:n;try{for(var i=0;i<this.numberReturned;i++){var s={promoteLongs:t.promoteLongs},o=e[this.index]|e[this.index+1]<<8|e[this.index+2]<<16|e[this.index+3]<<24;n?this.documents.push(e.slice(this.index,this.index+o)):this.documents.push(t.deserialize(e.slice(this.index,this.index+o),s)),this.index=this.index+o}r(null)}catch(u){return r(u)}},MongoReply.prototype.is_error=function(){return this.documents.length==1?this.documents[0].ok==1?!1:!0:!1},MongoReply.prototype.error_message=function(){return this.documents.length==1&&this.documents[0].ok==1?"":this.documents[0].errmsg};