var shared=require("./shared"),utils=require("../utils"),DbCommand=require("../commands/db_command").DbCommand,stats=function(t,n){var r=Array.prototype.slice.call(arguments,0);n=r.pop(),t=r.length?r.shift()||{}:{};var i={collStats:this.collectionName};t["scale"]!=null&&(i.scale=t.scale),t.readPreference=shared._getReadConcern(this,t),this.db.command(i,t,n)},count=function(t,n,r){var i=Array.prototype.slice.call(arguments,0);r=i.pop(),t=i.length?i.shift()||{}:{},n=i.length?i.shift()||{}:{};var s=n.skip,o=n.limit,u=n.maxTimeMS,a={count:this.collectionName,query:t,fields:null};typeof s=="number"&&(a.skip=s),typeof o=="number"&&(a.limit=o),typeof u=="number"&&(a.$maxTimeMS=u);var f=shared._getReadConcern(this,n);this.db._executeQueryCommand(DbCommand.createDbSlaveOkCommand(this.db,a),{read:f},utils.handleSingleCommandResultReturn(null,null,function(e,t){if(e)return r(e,null);if(t==null)return r(new Error("no result returned for count"),null);r(null,t.n)}))},distinct=function(t,n,r,i){var s=Array.prototype.slice.call(arguments,1);i=s.pop(),n=s.length?s.shift()||{}:{},r=s.length?s.shift()||{}:{};var o={distinct:this.collectionName,query:n,key:t},u=r.readPreference?r.readPreference:!1,a=DbCommand.createDbSlaveOkCommand(this.db,o);this.db._executeQueryCommand(a,{read:u},function(e,t){if(e)return i(e);if(t.documents[0].ok!=1)return i(new Error(t.documents[0].errmsg));i(null,t.documents[0].values)})},rename=function(t,n,r){var i=this;typeof n=="function"&&(r=n,n={});var s=require("../collection").Collection;shared.checkCollectionName(t),i.db._executeQueryCommand(DbCommand.createRenameCollectionCommand(i.db,i.collectionName,t,n),utils.handleSingleCommandResultReturn(!0,!1,function(e,o){if(e)return r(e,null);try{if(n.new_collection)return r(null,new s(i.db,t,i.db.pkFactory));i.collectionName=t,r(null,i)}catch(e){r(e,null)}}))},options=function(t){this.db.collectionsInfo(this.collectionName,function(e,n){if(e)return t(e);n.nextObject(function(e,n){t(e,n&&n.options||null)})})},isCapped=function(t){this.options(function(e,n){e!=null?t(e):t(null,n&&n.capped)})};exports.stats=stats,exports.count=count,exports.distinct=distinct,exports.rename=rename,exports.options=options,exports.isCapped=isCapped;