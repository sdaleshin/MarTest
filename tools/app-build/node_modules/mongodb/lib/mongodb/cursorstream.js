function CursorStream(e,t){if(!(this instanceof CursorStream))return new CursorStream(e);t=t?t:{},Stream.call(this),this.readable=!0,this.paused=!1,this._cursor=e,this._destroyed=null,this.options=t;var n=this;process.nextTick(function(){n._init()})}var timers=require("timers"),processor=require("./utils").processor(),Stream=require("stream").Stream;CursorStream.prototype.__proto__=Stream.prototype,CursorStream.prototype.readable,CursorStream.prototype.paused,CursorStream.prototype._init=function(){if(this._destroyed)return;this._next()},CursorStream.prototype._next=function(){if(this.paused||this._destroyed)return;var e=this;processor(function(){if(e.paused||e._destroyed)return;e._cursor.nextObject(function(t,n){e._onNextObject(t,n)})})},CursorStream.prototype._onNextObject=function(e,t){if(e)return this.destroy(e);if(!t&&(this._cursor.state==1||this._cursor.state==2))return this.emit("end"),this.destroy();if(t){var n=typeof this.options.transform=="function"?this.options.transform(t):t;this.emit("data",n),this._next()}},CursorStream.prototype.pause=function(){this.paused=!0},CursorStream.prototype.resume=function(){var e=this;if(!this.paused)return;if(!this._cursor.state==3)return;process.nextTick(function(){e.paused=!1,e._next()})},CursorStream.prototype.destroy=function(e){if(this._destroyed)return;this._destroyed=!0,this.readable=!1,this._cursor.close(),e&&this.emit("error",e),this.emit("close")},module.exports=exports=CursorStream;