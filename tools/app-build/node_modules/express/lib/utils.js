function paramsEqual(e,t){return!Object.keys(e).some(function(n){return e[n]!=t[n]})}function acceptParams(e,t){var n=e.split(/ *; */),r={value:n[0],quality:1,params:{},originalIndex:t};for(var i=1;i<n.length;++i){var s=n[i].split(/ *= */);"q"==s[0]?r.quality=parseFloat(s[1]):r.params[s[0]]=s[1]}return r}var mime=require("connect").mime,crc32=require("buffer-crc32"),toString={}.toString;exports.etag=function(e){return'"'+crc32.signed(e)+'"'},exports.locals=function(){function e(t){for(var n in t)e[n]=t[n];return t}return e},exports.isAbsolute=function(e){if("/"==e[0])return!0;if(":"==e[1]&&"\\"==e[2])return!0;if("\\\\"==e.substring(0,2))return!0},exports.flatten=function(e,t){var t=t||[],n=e.length;for(var r=0;r<n;++r)Array.isArray(e[r])?exports.flatten(e[r],t):t.push(e[r]);return t},exports.normalizeType=function(e){return~e.indexOf("/")?acceptParams(e):{value:mime.lookup(e),params:{}}},exports.normalizeTypes=function(e){var t=[];for(var n=0;n<e.length;++n)t.push(exports.normalizeType(e[n]));return t},exports.acceptsArray=function(e,t){if(!t)return e[0];var n=exports.parseAccept(t),r=exports.normalizeTypes(e),i=n.length;for(var s=0;s<i;++s)for(var o=0,u=e.length;o<u;++o)if(exports.accept(r[o],n[s]))return e[o]},exports.accepts=function(e,t){return"string"==typeof e&&(e=e.split(/ *, */)),exports.acceptsArray(e,t)},exports.accept=function(e,t){var n=e.value.split("/");return(n[0]==t.type||"*"==t.type)&&(n[1]==t.subtype||"*"==t.subtype)&&paramsEqual(e.params,t.params)},exports.parseAccept=function(e){return exports.parseParams(e).map(function(e){var t=e.value.split("/");return e.type=t[0],e.subtype=t[1],e})},exports.parseParams=function(e){return e.split(/ *, */).map(acceptParams).filter(function(e){return e.quality}).sort(function(e,t){return e.quality===t.quality?e.originalIndex-t.originalIndex:t.quality-e.quality})},exports.escape=function(e){return String(e).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},exports.pathRegexp=function(e,t,n,r){return toString.call(e)=="[object RegExp]"?e:(Array.isArray(e)&&(e="("+e.join("|")+")"),e=e.concat(r?"":"/?").replace(/\/\(/g,"(?:/").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?(\*)?/g,function(e,n,r,i,s,o,u){return t.push({name:i,optional:!!o}),n=n||"",""+(o?"":n)+"(?:"+(o?n:"")+(r||"")+(s||r&&"([^/.]+?)"||"([^/]+?)")+")"+(o||"")+(u?"(/*)?":"")}).replace(/([\/.])/g,"\\$1").replace(/\*/g,"(.*)"),new RegExp("^"+e+"$",n?"":"i"))},exports.decode=function(e){try{return decodeURIComponent(e)}catch(t){return e}};