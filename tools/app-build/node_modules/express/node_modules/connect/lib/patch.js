/*!
 * Connect
 * Copyright(c) 2011 TJ Holowaychuk
 * MIT Licensed
 */

var http=require("http"),res=http.ServerResponse.prototype,setHeader=res.setHeader,_renderHeaders=res._renderHeaders,writeHead=res.writeHead;res._hasConnectPatch||(res.__defineGetter__("headerSent",function(){return this._header}),res.setHeader=function(e,t){var n=e.toLowerCase(),r;if(this._headers&&"set-cookie"==n){if(r=this.getHeader(e))Array.isArray(r)?t=r.concat(t):Array.isArray(t)?t=t.concat(r):t=[r,t]}else"content-type"==n&&this.charset&&(t+="; charset="+this.charset);return setHeader.call(this,e,t)},res._renderHeaders=function(){return this._emittedHeader||this.emit("header"),this._emittedHeader=!0,_renderHeaders.call(this)},res.writeHead=function(e,t,n){return typeof t=="object"&&(n=t),typeof n=="object"&&Object.keys(n).forEach(function(e){this.setHeader(e,n[e])},this),this._emittedHeader||this.emit("header"),this._emittedHeader=!0,writeHead.call(this,e,t)},res._hasConnectPatch=!0);