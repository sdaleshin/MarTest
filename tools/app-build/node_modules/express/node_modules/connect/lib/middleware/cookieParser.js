/*!
 * Connect - cookieParser
 * Copyright(c) 2010 Sencha Inc.
 * Copyright(c) 2011 TJ Holowaychuk
 * MIT Licensed
 */

var utils=require("./../utils"),cookie=require("cookie");module.exports=function(t,n){return function(r,i,s){if(r.cookies)return s();var o=r.headers.cookie;r.secret=t,r.cookies={},r.signedCookies={};if(o)try{r.cookies=cookie.parse(o,n),t&&(r.signedCookies=utils.parseSignedCookies(r.cookies,t),r.signedCookies=utils.parseJSONCookies(r.signedCookies)),r.cookies=utils.parseJSONCookies(r.cookies)}catch(u){return u.status=400,s(u)}s()}};