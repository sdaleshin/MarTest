/*!
 * Connect - session - MemoryStore
 * Copyright(c) 2010 Sencha Inc.
 * Copyright(c) 2011 TJ Holowaychuk
 * MIT Licensed
 */

var Store=require("./store"),MemoryStore=module.exports=function(){this.sessions={}};MemoryStore.prototype.__proto__=Store.prototype,MemoryStore.prototype.get=function(e,t){var n=this;process.nextTick(function(){var r,i=n.sessions[e];i?(i=JSON.parse(i),r="string"==typeof i.cookie.expires?new Date(i.cookie.expires):i.cookie.expires,!r||new Date<r?t(null,i):n.destroy(e,t)):t()})},MemoryStore.prototype.set=function(e,t,n){var r=this;process.nextTick(function(){r.sessions[e]=JSON.stringify(t),n&&n()})},MemoryStore.prototype.destroy=function(e,t){var n=this;process.nextTick(function(){delete n.sessions[e],t&&t()})},MemoryStore.prototype.all=function(e){var t=[],n=Object.keys(this.sessions);for(var r=0,i=n.length;r<i;++r)t.push(this.sessions[n[r]]);e(null,t)},MemoryStore.prototype.clear=function(e){this.sessions={},e&&e()},MemoryStore.prototype.length=function(e){e(null,Object.keys(this.sessions).length)};