/*!
 * Connect - basicAuth
 * Copyright(c) 2010 Sencha Inc.
 * Copyright(c) 2011 TJ Holowaychuk
 * MIT Licensed
 */

var utils=require("../utils"),unauthorized=utils.unauthorized;module.exports=function(t,n){var r,i;if("string"==typeof t){r=t,i=n;if("string"!=typeof i)throw new Error("password argument required");n=arguments[2],t=function(e,t){return e==r&&t==i}}return n=n||"Authorization Required",function(e,r,i){var s=e.headers.authorization;if(e.user)return i();if(!s)return unauthorized(r,n);var o=s.split(" ");if(o.length!==2)return i(utils.error(400));var u=o[0],a=(new Buffer(o[1],"base64")).toString(),f=a.indexOf(":");if("Basic"!=u||f<0)return i(utils.error(400));var l=a.slice(0,f),c=a.slice(f+1);if(t.length>=3){var h=utils.pause(e);t(l,c,function(t,s){if(t||!s)return unauthorized(r,n);e.user=e.remoteUser=s,i(),h.resume()})}else t(l,c)?(e.user=e.remoteUser=l,i()):unauthorized(r,n)}};