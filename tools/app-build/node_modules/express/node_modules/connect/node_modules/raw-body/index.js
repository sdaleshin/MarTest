function makeError(e,t){var n=new Error;return n.message=e,Object.defineProperty(n,"type",{value:t,enumerable:!0,writable:!0,configurable:!0}),n}function endStringDecoder(e){if(e.end)return e.end();var t="";if(e.charReceived){var n=e.charReceived,r=e.charBuffer,i=e.encoding;t+=r.slice(0,n).toString(i)}return t}var StringDecoder=require("string_decoder").StringDecoder,bytes=require("bytes");module.exports=function(e,t,n){function f(e){n=e}function l(t){o+=t.length,u?a+=u.write(t):a.push(t);if(r!==null&&o>r){typeof e.pause=="function"&&e.pause();var i=makeError("request entity too large","entity.too.large");i.status=i.statusCode=413,i.received=o,i.limit=r,n(i),h()}}function c(t){t?(typeof e.pause=="function"&&e.pause(),n(t)):i!==null&&o!==i?(t=makeError("request size did not match content length","request.size.invalid"),t.status=t.statusCode=400,t.received=o,t.length=t.expected=i,n(t)):n(null,u?a+endStringDecoder(u):Buffer.concat(a)),h()}function h(){o=a=null,e.removeListener("data",l),e.removeListener("end",c),e.removeListener("error",c),e.removeListener("close",h)}typeof t=="function"?(n=t,t={}):t||(t={});var r=null;typeof t.limit=="number"&&(r=t.limit),typeof t.limit=="string"&&(r=bytes(t.limit));var i=null;isNaN(t.length)||(i=parseInt(t.length,10));if(r!==null&&i!==null&&i>r)return typeof e.pause=="function"&&e.pause(),process.nextTick(function(){var e=makeError("request entity too large","entity.too.large");e.status=e.statusCode=413,e.length=e.expected=i,e.limit=r,n(e)}),f;var s=e._readableState;if(s&&s.encoding!=null)return typeof e.pause=="function"&&e.pause(),process.nextTick(function(){var e=makeError("stream encoding should not be set","stream.encoding.set");e.status=e.statusCode=500,n(e)}),f;var o=0,u=t.encoding?new StringDecoder(t.encoding===!0?"utf8":t.encoding):null,a=u?"":[];return e.on("data",l),e.once("end",c),e.once("error",c),e.once("close",h),f};