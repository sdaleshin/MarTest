function promote(e,t){if(e[t].length==0)return e[t]={};var n={};for(var r in e[t])hasOwnProperty.call(e[t],r)&&(n[r]=e[t][r]);return e[t]=n,n}function parse(e,t,n,r){var i=e.shift();if(Object.getOwnPropertyDescriptor(Object.prototype,n))return;if(!i)isArray(t[n])?t[n].push(r):"object"==typeof t[n]?t[n]=r:"undefined"==typeof t[n]?t[n]=r:t[n]=[t[n],r];else{var s=t[n]=t[n]||[];"]"==i?isArray(s)?""!=r&&s.push(r):"object"==typeof s?s[objectKeys(s).length]=r:s=t[n]=[t[n],r]:~indexOf(i,"]")?(i=i.substr(0,i.length-1),!isint.test(i)&&isArray(s)&&(s=promote(t,n)),parse(e,s,i,r)):(!isint.test(i)&&isArray(s)&&(s=promote(t,n)),parse(e,s,i,r))}}function merge(e,t,n){if(~indexOf(t,"]")){var r=t.split("["),i=r.length,s=i-1;parse(r,e,"base",n)}else{if(!isint.test(t)&&isArray(e.base)){var o={};for(var u in e.base)o[u]=e.base[u];e.base=o}set(e.base,t,n)}return e}function compact(e){if("object"!=typeof e)return e;if(isArray(e)){var t=[];for(var n in e)hasOwnProperty.call(e,n)&&t.push(e[n]);return t}for(var r in e)e[r]=compact(e[r]);return e}function parseObject(e){var t={base:{}};return forEach(objectKeys(e),function(n){merge(t,n,e[n])}),compact(t.base)}function parseString(e){var t=reduce(String(e).split("&"),function(e,t){var n=indexOf(t,"="),r=lastBraceInKey(t),i=t.substr(0,r||n),s=t.substr(r||n,t.length),s=s.substr(indexOf(s,"=")+1,s.length);return""==i&&(i=t,s=""),""==i?e:merge(e,decode(i),decode(s))},{base:{}}).base;return compact(t)}function stringifyString(e,t){if(!t)throw new TypeError("stringify expects an object");return t+"="+encodeURIComponent(e)}function stringifyArray(e,t){var n=[];if(!t)throw new TypeError("stringify expects an object");for(var r=0;r<e.length;r++)n.push(stringify(e[r],t+"["+r+"]"));return n.join("&")}function stringifyObject(e,t){var n=[],r=objectKeys(e),i;for(var s=0,o=r.length;s<o;++s){i=r[s];if(""==i)continue;null==e[i]?n.push(encodeURIComponent(i)+"="):n.push(stringify(e[i],t?t+"["+encodeURIComponent(i)+"]":encodeURIComponent(i)))}return n.join("&")}function set(e,t,n){var r=e[t];if(Object.getOwnPropertyDescriptor(Object.prototype,t))return;undefined===r?e[t]=n:isArray(r)?r.push(n):e[t]=[r,n]}function lastBraceInKey(e){var t=e.length,n,r;for(var i=0;i<t;++i){r=e[i],"]"==r&&(n=!1),"["==r&&(n=!0);if("="==r&&!n)return i}}function decode(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(t){return e}}var toString=Object.prototype.toString,hasOwnProperty=Object.prototype.hasOwnProperty,indexOf=typeof Array.prototype.indexOf=="function"?function(e,t){return e.indexOf(t)}:function(e,t){for(var n=0;n<e.length;n++)if(e[n]===t)return n;return-1},isArray=Array.isArray||function(e){return toString.call(e)=="[object Array]"},objectKeys=Object.keys||function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t},forEach=typeof Array.prototype.forEach=="function"?function(e,t){return e.forEach(t)}:function(e,t){for(var n=0;n<e.length;n++)t(e[n])},reduce=function(e,t,n){if(typeof e.reduce=="function")return e.reduce(t,n);var r=n;for(var i=0;i<e.length;i++)r=t(r,e[i]);return r},isint=/^[0-9]+$/;exports.parse=function(e){return null==e||""==e?{}:"object"==typeof e?parseObject(e):parseString(e)};var stringify=exports.stringify=function(e,t){return isArray(e)?stringifyArray(e,t):"[object Object]"==toString.call(e)?stringifyObject(e,t):"string"==typeof e?stringifyString(e,t):t+"="+encodeURIComponent(String(e))};