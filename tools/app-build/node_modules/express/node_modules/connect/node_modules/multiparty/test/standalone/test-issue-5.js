var assert=require("assert"),http=require("http"),net=require("net"),multiparty=require("../../"),client,attachmentCount=510,server=http.createServer(function(e,t){var n=new multiparty.Form({maxFields:1e4});n.parse(e,function(e,n,r,i,s){assert.strictEqual(e.code,"EMFILE"),t.end(),client.end(),server.close()})});server.listen(function(){client=net.connect(server.address().port);var e="------WebKitFormBoundaryvfUZhxgsZDO7FXLF\r\n",t=e+'Content-Disposition: form-data; name="upload"; filename="blah1.txt"\r\n'+"Content-Type: text/plain\r\n"+"\r\n"+"hi1\r\n"+"\r\n",n=t.length*attachmentCount+e.length;client.write("POST /upload HTTP/1.1\r\nContent-Length: "+n+"\r\n"+"Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryvfUZhxgsZDO7FXLF\r\n"+"\r\n");for(var r=0;r<attachmentCount;r+=1)client.write(t);client.write(e)});