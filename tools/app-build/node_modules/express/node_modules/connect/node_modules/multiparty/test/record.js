var http=require("http"),fs=require("fs"),connections=0,server=http.createServer(function(e,t){var n=e.socket;console.log("Request: %s %s -> %s",e.method,e.url,n.filename),e.on("end",function(){if(e.url!=="/"){t.end(JSON.stringify({method:e.method,url:e.url,filename:n.filename}));return}t.writeHead(200,{"content-type":"text/html"}),t.end('<form action="/upload" enctype="multipart/form-data" method="post"><input type="text" name="title"><br><input type="file" name="upload" multiple="multiple"><br><input type="submit" value="Upload"></form>')})});server.on("connection",function(e){connections++,e.id=connections,e.filename="connection-"+e.id+".http",e.file=fs.createWriteStream(e.filename),e.pipe(e.file),console.log("--> %s",e.filename),e.on("close",function(){console.log("<-- %s",e.filename)})});var port=process.env.PORT||8080;server.listen(port,function(){console.log("Recording connections on port %s",port)});