var assert=require("assert"),http=require("http"),net=require("net"),multiparty=require("../../"),client,server=http.createServer(function(e,t){var n=new multiparty.Form;n.parse(e,function(e,n,r,i,s){if(e){console.error(e.stack);return}assert.strictEqual(i.length,1),assert.strictEqual(i[0].name,"title"),assert.strictEqual(i[0].value,"foofoo"),assert.strictEqual(s.length,4),assert.strictEqual(s[0].fieldName,"upload"),assert.strictEqual(s[1].fieldName,"upload"),assert.strictEqual(s[2].fieldName,"upload"),assert.strictEqual(s[3].fieldName,"upload"),t.end(),client.end(),server.close()})});server.listen(function(){client=net.connect(server.address().port),client.write('POST /upload HTTP/1.1\r\nContent-Length: 728\r\nContent-Type: multipart/form-data; boundary=----WebKitFormBoundaryvfUZhxgsZDO7FXLF\r\n\r\n------WebKitFormBoundaryvfUZhxgsZDO7FXLF\r\nContent-Disposition: form-data; name="title"\r\n\r\nfoofoo\r\n------WebKitFormBoundaryvfUZhxgsZDO7FXLF\r\nContent-Disposition: form-data; name="upload"; filename="blah1.txt"\r\nContent-Type: text/plain\r\n\r\nhi1\r\n\r\n------WebKitFormBoundaryvfUZhxgsZDO7FXLF\r\nContent-Disposition: form-data; name="upload"; filename="blah2.txt"\r\nContent-Type: text/plain\r\n\r\nhi2\r\n\r\n------WebKitFormBoundaryvfUZhxgsZDO7FXLF\r\nContent-Disposition: form-data; name="upload"; filename="blah3.txt"\r\nContent-Type: text/plain\r\n\r\nhi3\r\n\r\n------WebKitFormBoundaryvfUZhxgsZDO7FXLF\r\nContent-Disposition: form-data; name="upload"; filename="blah4.txt"\r\nContent-Type: text/plain\r\n\r\nhi4\r\n\r\n------WebKitFormBoundaryvfUZhxgsZDO7FXLF--\r\n')});