var http=require("http"),multiparty=require("../../"),request=require("request"),assert=require("assert"),host="localhost",index=['<form action="/" method="post" enctype="multipart/form-data">','  <input type="text" name="foo" />','  <input type="submit" />',"</form>"].join("\n"),server=http.createServer(function(e,t){if(e.method==="GET"){t.writeHead(200,{"content-type":"text/html"}),t.end(index);return}var n=new multiparty.Form;n.parse(e,function(e,n,r){t.writeHead(200,{"content-type":"text/plain"}),t.write(JSON.stringify({err:e,fields:n,files:r})),t.end()})}).listen(0,host,function(){var e=this,t="http://"+host+":"+e.address().port,n=[{"Content-Disposition":'form-data; name="foo"',body:"bar"}],r=request({method:"POST",url:t,multipart:n},function(t,n,r){var i=JSON.parse(r);assert.equal("bar",i.fields.foo),e.close()})});