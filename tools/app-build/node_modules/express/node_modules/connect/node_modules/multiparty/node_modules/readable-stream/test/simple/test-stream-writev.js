// Copyright Joyent, Inc. and other Node contributors.
//
// Permission is hereby granted, free of charge, to any person obtaining a
// copy of this software and associated documentation files (the
// "Software"), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to permit
// persons to whom the Software is furnished to do so, subject to the
// following conditions:
//
// The above copyright notice and this permission notice shall be included
// in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
// USE OR OTHER DEALINGS IN THE SOFTWARE.

function run(){var e=queue.pop();e?test(e[0],e[1],e[2],run):console.log("ok")}function test(e,t,n,r){function o(e){s++;var t=s,n=!1;return function(e){if(e)throw e;n=!0,i++,assert.equal(i,t)}}console.log("# decode=%j uncork=%j multi=%j",e,t,n);var i=0,s=0,u=new stream.Writable({decodeStrings:e});u._write=function(e,t,n){assert(!1,"Should not call _write")};var a=e?[{encoding:"buffer",chunk:[104,101,108,108,111,44,32]},{encoding:"buffer",chunk:[119,111,114,108,100]},{encoding:"buffer",chunk:[33]},{encoding:"buffer",chunk:[10,97,110,100,32,116,104,101,110,46,46,46]},{encoding:"buffer",chunk:[250,206,190,167,222,173,190,239,222,202,251,173]}]:[{encoding:"ascii",chunk:"hello, "},{encoding:"utf8",chunk:"world"},{encoding:"buffer",chunk:[33]},{encoding:"binary",chunk:"\nand then..."},{encoding:"hex",chunk:"facebea7deadbeefdecafbad"}],f;u._writev=function(e,t){f=e.map(function(e){return{encoding:e.encoding,chunk:Buffer.isBuffer(e.chunk)?Array.prototype.slice.call(e.chunk):e.chunk}}),t()},u.cork(),u.write("hello, ","ascii",o("hello")),u.write("world","utf8",o("world")),n&&u.cork(),u.write(new Buffer("!"),"buffer",o("!")),u.write("\nand then...","binary",o("and then")),n&&u.uncork(),u.write("facebea7deadbeefdecafbad","hex",o("hex")),t&&u.uncork(),u.end(o("end")),u.on("finish",function(){o("finish")(),assert.deepEqual(a,f),r()})}var common=require("../common"),assert=require("assert"),stream=require("../../"),queue=[];for(var decode=0;decode<2;decode++)for(var uncork=0;uncork<2;uncork++)for(var multi=0;multi<2;multi++)queue.push([!!decode,!!uncork,!!multi]);run();