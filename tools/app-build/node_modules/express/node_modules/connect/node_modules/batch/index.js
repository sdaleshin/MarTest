function noop(){}function Batch(){if(!(this instanceof Batch))return new Batch;this.fns=[],this.concurrency(Infinity),this.throws(!0);for(var e=0,t=arguments.length;e<t;++e)this.push(arguments[e])}try{var EventEmitter=require("events").EventEmitter}catch(err){var Emitter=require("emitter")}module.exports=Batch,EventEmitter?Batch.prototype.__proto__=EventEmitter.prototype:Emitter(Batch.prototype),Batch.prototype.concurrency=function(e){return this.n=e,this},Batch.prototype.push=function(e){return this.fns.push(e),this},Batch.prototype.throws=function(e){return this.e=!!e,this},Batch.prototype.end=function(e){function c(){function v(o,f){if(l)return;if(o&&a)return l=!0,e(o);var h=n-r+1,d=new Date;i[u]=f,s[u]=o,t.emit("progress",{index:u,value:f,error:o,pending:r,total:n,complete:h,percent:h/n*100|0,start:p,end:d,duration:d-p}),--r?c():a?e(null,i):e(s,i)}var u=f++,h=o[u];if(!h)return;var p=new Date;try{h(v)}catch(d){v(d)}}var t=this,n=this.fns.length,r=n,i=[],s=[],e=e||noop,o=this.fns,u=this.n,a=this.e,f=0,l;if(!o.length)return e(null,i);for(var h=0;h<o.length;h++){if(h==u)break;c()}return this};