function parseAcceptLanguage(e){return e.split(",").map(function(e){return parseLanguage(e.trim())}).filter(function(e){return e&&e.q>0})}function parseLanguage(e){var t=e.match(/^\s*(\S+?)(?:-(\S+?))?\s*(?:;(.*))?$/);if(!t)return null;var n=t[1],r=t[2],i=n;r&&(i+="-"+r);var s=1;if(t[3]){var o=t[3].split(";");for(var u=0;u<o.length;u++){var a=o[u].split("=");a[0]==="q"&&(s=parseFloat(a[1]))}}return{prefix:n,suffix:r,q:s,full:i}}function getLanguagePriority(e,t){var n=getClosestMatch(e,t);return n?n.q:0}function getClosestMatch(e,t){var n=parseLanguage(e),r=t.filter(function(e){return e.full===n.full});return r.length?r[0]:(r=t.filter(function(e){return e.prefix===n.prefix&&!e.suffix}),r.length?r[0]:(r=t.filter(function(e){return e.prefix===n.prefix}),r.length?r[0]:(r=t.filter(function(e){return e.prefix==="*"}),r[0])))}function preferredLanguages(e,t){e=parseAcceptLanguage(e||"");if(t){var n=t.map(function(t){return[t,getLanguagePriority(t,e)]}).filter(function(e){return e[1]>0}).sort(function(e,t){return e[1]===t[1]?0:e[1]>t[1]?-1:1}).map(function(e){return e[0]});return n}return e.sort(function(e,t){return e.q<t.q?1:-1}).map(function(e){return e.full})}module.exports=preferredLanguages,preferredLanguages.preferredLanguages=preferredLanguages;