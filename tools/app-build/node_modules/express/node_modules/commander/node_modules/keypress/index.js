function keypress(e){function t(r){e.listeners("keypress").length>0?emitKey(e,r):(e.removeListener("data",t),e.on("newListener",n))}function n(r){r=="keypress"&&(e.on("data",t),e.removeListener("newListener",n))}if(isEmittingKeypress(e))return;e._emitKeypress=!0,e.listeners("keypress").length>0?e.on("data",t):e.on("newListener",n)}function isEmittingKeypress(e){var t=e._emitKeypress;return t||e.listeners("data").forEach(function(n){n.name=="onData"&&/emitKey/.test(n.toString())&&(t=!0,e._emitKeypress=!0)}),t||e.listeners("newListener").forEach(function(n){n.name=="onNewListener"&&/keypress/.test(n.toString())&&(t=!0,e._emitKeypress=!0)}),t}function emitKey(e,t){var n,r={name:undefined,ctrl:!1,meta:!1,shift:!1},i;Buffer.isBuffer(t)&&(t[0]>127&&t[1]===undefined?(t[0]-=128,t=""+t.toString(e.encoding||"utf-8")):t=t.toString(e.encoding||"utf-8")),r.sequence=t;if(t==="\r"||t==="\n")r.name="enter";else if(t==="	")r.name="tab";else if(t==="\b"||t===""||t===""||t==="\b")r.name="backspace",r.meta=t.charAt(0)==="";else if(t===""||t==="")r.name="escape",r.meta=t.length===2;else if(t===" "||t===" ")r.name="space",r.meta=t.length===2;else if(t<="")r.name=String.fromCharCode(t.charCodeAt(0)+"a".charCodeAt(0)-1),r.ctrl=!0;else if(t.length===1&&t>="a"&&t<="z")r.name=t;else if(t.length===1&&t>="A"&&t<="Z")r.name=t.toLowerCase(),r.shift=!0;else if(i=metaKeyCodeRe.exec(t))r.name=i[1].toLowerCase(),r.meta=!0,r.shift=/^[A-Z]$/.test(i[1]);else if(i=functionKeyCodeRe.exec(t)){var s=(i[1]||"")+(i[2]||"")+(i[4]||"")+(i[6]||""),o=(i[3]||i[5]||1)-1;r.ctrl=!!(o&4),r.meta=!!(o&10),r.shift=!!(o&1),r.code=s;switch(s){case"OP":r.name="f1";break;case"OQ":r.name="f2";break;case"OR":r.name="f3";break;case"OS":r.name="f4";break;case"[11~":r.name="f1";break;case"[12~":r.name="f2";break;case"[13~":r.name="f3";break;case"[14~":r.name="f4";break;case"[[A":r.name="f1";break;case"[[B":r.name="f2";break;case"[[C":r.name="f3";break;case"[[D":r.name="f4";break;case"[[E":r.name="f5";break;case"[15~":r.name="f5";break;case"[17~":r.name="f6";break;case"[18~":r.name="f7";break;case"[19~":r.name="f8";break;case"[20~":r.name="f9";break;case"[21~":r.name="f10";break;case"[23~":r.name="f11";break;case"[24~":r.name="f12";break;case"[A":r.name="up";break;case"[B":r.name="down";break;case"[C":r.name="right";break;case"[D":r.name="left";break;case"[E":r.name="clear";break;case"[F":r.name="end";break;case"[H":r.name="home";break;case"OA":r.name="up";break;case"OB":r.name="down";break;case"OC":r.name="right";break;case"OD":r.name="left";break;case"OE":r.name="clear";break;case"OF":r.name="end";break;case"OH":r.name="home";break;case"[1~":r.name="home";break;case"[2~":r.name="insert";break;case"[3~":r.name="delete";break;case"[4~":r.name="end";break;case"[5~":r.name="pageup";break;case"[6~":r.name="pagedown";break;case"[[5~":r.name="pageup";break;case"[[6~":r.name="pagedown";break;case"[7~":r.name="home";break;case"[8~":r.name="end";break;case"[a":r.name="up",r.shift=!0;break;case"[b":r.name="down",r.shift=!0;break;case"[c":r.name="right",r.shift=!0;break;case"[d":r.name="left",r.shift=!0;break;case"[e":r.name="clear",r.shift=!0;break;case"[2$":r.name="insert",r.shift=!0;break;case"[3$":r.name="delete",r.shift=!0;break;case"[5$":r.name="pageup",r.shift=!0;break;case"[6$":r.name="pagedown",r.shift=!0;break;case"[7$":r.name="home",r.shift=!0;break;case"[8$":r.name="end",r.shift=!0;break;case"Oa":r.name="up",r.ctrl=!0;break;case"Ob":r.name="down",r.ctrl=!0;break;case"Oc":r.name="right",r.ctrl=!0;break;case"Od":r.name="left",r.ctrl=!0;break;case"Oe":r.name="clear",r.ctrl=!0;break;case"[2^":r.name="insert",r.ctrl=!0;break;case"[3^":r.name="delete",r.ctrl=!0;break;case"[5^":r.name="pageup",r.ctrl=!0;break;case"[6^":r.name="pagedown",r.ctrl=!0;break;case"[7^":r.name="home",r.ctrl=!0;break;case"[8^":r.name="end",r.ctrl=!0;break;case"[Z":r.name="tab",r.shift=!0;break;default:r.name="undefined"}}else if(t.length>1&&t[0]!==""){Array.prototype.forEach.call(t,function(t){emitKey(e,t)});return}if(r.code=="[M"){r.name="mouse";var t=r.sequence,u=t.charCodeAt(3);r.x=t.charCodeAt(4)-32,r.y=t.charCodeAt(5)-32,r.scroll=0,r.ctrl=!!(16&u),r.meta=!!(8&u),r.shift=!!(4&u),r.release=(3&u)===3,64&u&&(r.scroll=1&u?1:-1),!r.release&&!r.scroll&&(r.button=u&3)}r.name===undefined&&(r=undefined),t.length===1&&(n=t),r&&r.name=="mouse"?e.emit("mousepress",r):(r||n)&&e.emit("keypress",n,r)}var exports=module.exports=keypress;exports.enableMouse=function(e){e.write("[?1000h")},exports.disableMouse=function(e){e.write("[?1000l")};var metaKeyCodeRe=/^(?:\x1b)([a-zA-Z0-9])$/,functionKeyCodeRe=/^(?:\x1b+)(O|N|\[|\[\[)(?:(\d+)(?:;(\d+))?([~^$])|(?:1;)?(\d+)?([a-zA-Z]))/;