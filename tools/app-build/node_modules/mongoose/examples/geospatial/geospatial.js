function cleanup(){Person.remove(function(){mongoose.disconnect()})}var async=require("async"),mongoose=require("../../lib");require("./person.js")();var Person=mongoose.model("Person"),data=[{name:"bill",age:25,birthday:(new Date).setFullYear((new Date).getFullYear()-25),gender:"Male",likes:["movies","games","dogs"],loc:[0,0]},{name:"mary",age:30,birthday:(new Date).setFullYear((new Date).getFullYear()-30),gender:"Female",likes:["movies","birds","cats"],loc:[1,1]},{name:"bob",age:21,birthday:(new Date).setFullYear((new Date).getFullYear()-21),gender:"Male",likes:["tv","games","rabbits"],loc:[3,3]},{name:"lilly",age:26,birthday:(new Date).setFullYear((new Date).getFullYear()-26),gender:"Female",likes:["books","cats","dogs"],loc:[6,6]},{name:"alucard",age:1e3,birthday:(new Date).setFullYear((new Date).getFullYear()-1e3),gender:"Male",likes:["glasses","wine","the night"],loc:[10,10]}];mongoose.connect("mongodb://localhost/persons",function(e){if(e)throw e;async.each(data,function(e,t){Person.create(e,t)},function(e){Person.find({name:"bob"},function(e,t){if(e)throw e;t[0].findClosest(function(e,n){if(e)throw e;console.log("%s is closest to %s",t[0].name,n);var r=[7,7];Person.find({loc:{$nearSphere:r}}).limit(1).exec(function(e,t){console.log("Closest to %s is %s",r,t),cleanup()})})})})});