function cleanup(){Location.remove(function(){mongoose.disconnect()})}var async=require("async"),mongoose=require("../../lib");require("./geoJSONSchema.js")();var Location=mongoose.model("Location"),data=[{loc:{type:"Point",coordinates:[-20,5]}},{loc:{type:"Point",coordinates:[6,10]}},{loc:{type:"Point",coordinates:[34,-50]}},{loc:{type:"Point",coordinates:[-100,70]}},{loc:{type:"Point",coordinates:[38,38]}}];mongoose.connect("mongodb://localhost/locations",function(e){if(e)throw e;Location.on("index",function(e){if(e)throw e;async.each(data,function(e,t){Location.create(e,t)},function(e){if(e)throw e;var t={type:"Point",coordinates:[-5,5]};Location.find({loc:{$near:t}}).limit(1).exec(function(e,n){if(e)throw e;console.log("Closest to %s is %s",JSON.stringify(t),n),cleanup()})})})});