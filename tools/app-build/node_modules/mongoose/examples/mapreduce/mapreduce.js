function cleanup(){Person.remove(function(){mongoose.disconnect()})}var async=require("async"),mongoose=require("../../lib");require("./person.js")();var Person=mongoose.model("Person"),data=[{name:"bill",age:25,birthday:(new Date).setFullYear((new Date).getFullYear()-25),gender:"Male"},{name:"mary",age:30,birthday:(new Date).setFullYear((new Date).getFullYear()-30),gender:"Female"},{name:"bob",age:21,birthday:(new Date).setFullYear((new Date).getFullYear()-21),gender:"Male"},{name:"lilly",age:26,birthday:(new Date).setFullYear((new Date).getFullYear()-26),gender:"Female"},{name:"alucard",age:1e3,birthday:(new Date).setFullYear((new Date).getFullYear()-1e3),gender:"Male"}];mongoose.connect("mongodb://localhost/persons",function(e){if(e)throw e;async.each(data,function(e,t){Person.create(e,t)},function(e){var t={};t.map=function(){emit(this.gender,this.age)},t.reduce=function(e,t){return Array.sum(t)},t.verbose=!0,Person.mapReduce(t,function(e,t,n){console.log("map reduce took %d ms",n.processtime),console.log(t),cleanup()})})});