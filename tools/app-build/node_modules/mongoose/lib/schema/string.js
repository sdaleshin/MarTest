/*!
 * Module dependencies.
 */

/*!
 * Inherits from SchemaType.
 */

/*!
 * ignore
 */

/*!
 * Module exports.
 */

function SchemaString(e,t){this.enumValues=[],this.regExp=null,SchemaType.call(this,e,t,"String")}function handleSingle(e){return this.castForQuery(e)}function handleArray(e){var t=this;return e.map(function(e){return t.castForQuery(e)})}var SchemaType=require("../schematype"),CastError=SchemaType.CastError,errorMessages=require("../error").messages,utils=require("../utils"),Document;SchemaString.prototype.__proto__=SchemaType.prototype,SchemaString.prototype.enum=function(){this.enumValidator&&(this.validators=this.validators.filter(function(e){return e[0]!=this.enumValidator},this),this.enumValidator=!1);if(undefined===arguments[0]||!1===arguments[0])return this;var e,t;utils.isObject(arguments[0])?(e=arguments[0].values,t=arguments[0].message):(e=arguments,t=errorMessages.String.enum);for(var n=0;n<e.length;n++)undefined!==e[n]&&this.enumValues.push(this.cast(e[n]));var r=this.enumValues;return this.enumValidator=function(e){return undefined===e||~r.indexOf(e)},this.validators.push([this.enumValidator,t,"enum"]),this},SchemaString.prototype.lowercase=function(){return this.set(function(e,t){return"string"!=typeof e&&(e=t.cast(e)),e?e.toLowerCase():e})},SchemaString.prototype.uppercase=function(){return this.set(function(e,t){return"string"!=typeof e&&(e=t.cast(e)),e?e.toUpperCase():e})},SchemaString.prototype.trim=function(){return this.set(function(e,t){return"string"!=typeof e&&(e=t.cast(e)),e?e.trim():e})},SchemaString.prototype.match=function(t,n){function i(e){return null!=e&&""!==e?t.test(e):!0}var r=n||errorMessages.String.match;return this.validators.push([i,r,"regexp"]),this},SchemaString.prototype.checkRequired=function(t,n){return SchemaType._isRef(this,t,n,!0)?null!=t:(t instanceof String||typeof t=="string")&&t.length},SchemaString.prototype.cast=function(e,t,n){if(SchemaType._isRef(this,e,t,n)){if(null==e)return e;Document||(Document=require("./../document"));if(e instanceof Document)return e.$__.wasPopulated=!0,e;if("string"==typeof e)return e;if(Buffer.isBuffer(e)||!utils.isObject(e))throw new CastError("string",e,this.path);var r=t.$__fullPath(this.path),i=t.ownerDocument?t.ownerDocument():t,s=i.populated(r,!0),o=new s.options.model(e);return o.$__.wasPopulated=!0,o}if(e===null)return e;if("undefined"!=typeof e){if(e._id&&"string"==typeof e._id)return e._id;if(e.toString)return e.toString()}throw new CastError("string",e,this.path)},SchemaString.prototype.$conditionalHandlers={$ne:handleSingle,$in:handleArray,$nin:handleArray,$gt:handleSingle,$lt:handleSingle,$gte:handleSingle,$lte:handleSingle,$all:handleArray,$regex:handleSingle,$options:handleSingle},SchemaString.prototype.castForQuery=function(e,t){var n;if(arguments.length===2){n=this.$conditionalHandlers[e];if(!n)throw new Error("Can't use "+e+" with String.");return n.call(this,t)}return t=e,t instanceof RegExp?t:this.cast(t)},module.exports=SchemaString;