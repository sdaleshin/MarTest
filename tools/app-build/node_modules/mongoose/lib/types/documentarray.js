/*!
 * Module dependencies.
 */

/*!
 * Inherits from MongooseArray
 */

/*!
 * Module exports.
 */

function MongooseDocumentArray(e,t,n){var r=[];return r.push.apply(r,e),r.__proto__=MongooseDocumentArray.prototype,r._atomics={},r.validators=[],r._path=t,n&&(r._parent=n,r._schema=n.schema.path(t),n.on("save",r.notify("save")),n.on("isNew",r.notify("isNew"))),r}var MongooseArray=require("./array"),driver=global.MONGOOSE_DRIVER_PATH||"../drivers/node-mongodb-native",ObjectId=require(driver+"/objectid"),ObjectIdSchema=require("../schema/objectid"),utils=require("../utils"),util=require("util"),Document=require("../document");MongooseDocumentArray.prototype.__proto__=MongooseArray.prototype,MongooseDocumentArray.prototype._cast=function(e){if(e instanceof this._schema.casterConstructor){if(!e.__parent||!e.__parentArray)e.__parent=this._parent,e.__parentArray=this;return e}if(Buffer.isBuffer(e)||e instanceof ObjectId||!utils.isObject(e))e={_id:e};return new this._schema.casterConstructor(e,this)},MongooseDocumentArray.prototype.id=function(e){var t,n,r;try{var i=ObjectIdSchema.prototype.cast.call({},e);i&&(t=String(i))}catch(s){t=null}for(var o=0,u=this.length;o<u;o++){r=this[o].get("_id");if(r instanceof Document){n||(n=String(e));if(n==r._id)return this[o]}else if(r instanceof ObjectId){if(t==r)return this[o]}else{n||(n=String(e));if(n==r)return this[o]}}return null},MongooseDocumentArray.prototype.toObject=function(e){return this.map(function(t){return t&&t.toObject(e)||null})},MongooseDocumentArray.prototype.inspect=function(){return"["+this.map(function(e){return e?e.inspect?e.inspect():util.inspect(e):"null"}).join("\n")+"]"},MongooseDocumentArray.prototype.create=function(e){return new this._schema.casterConstructor(e)},MongooseDocumentArray.prototype.notify=function(t){var n=this;return function(r){var i=n.length;while(i--){if(!n[i])continue;n[i].emit(t,r)}}},module.exports=MongooseDocumentArray;