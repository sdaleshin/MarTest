/*!
 * Module dependencies.
 */

/*!
 * Inherit from Document
 */

/*!
 * Registers remove event listeners for triggering
 * on subdocuments.
 *
 * @param {EmbeddedDocument} sub
 * @api private
 */

/*!
 * Module exports.
 */

function EmbeddedDocument(e,t,n,r){t?(this.__parentArray=t,this.__parent=t._parent):(this.__parentArray=undefined,this.__parent=undefined),Document.call(this,e,r,n);var i=this;this.on("isNew",function(e){i.isNew=e})}function registerRemoveListener(e){function n(){t.removeListener("save",n),t.removeListener("remove",n),e.emit("remove",e),t=e=n=null}var t=e.ownerDocument();t.on("save",n),t.on("remove",n)}var Document=require("../document"),inspect=require("util").inspect;EmbeddedDocument.prototype.__proto__=Document.prototype,EmbeddedDocument.prototype.markModified=function(e){if(!this.__parentArray)return;this.$__.activePaths.modify(e),this.isNew?this.__parentArray._markModified():this.__parentArray._markModified(this,e)},EmbeddedDocument.prototype.save=function(e){return e&&e(null),this},EmbeddedDocument.prototype.remove=function(e){if(!this.__parentArray)return this;var t;if(!this.willRemove){t=this._doc._id;if(!t)throw new Error("For your own good, Mongoose does not know how to remove an EmbeddedDocument that has no _id");this.__parentArray.pull({_id:t}),this.willRemove=!0,registerRemoveListener(this)}return e&&e(null),this},EmbeddedDocument.prototype.update=function(){throw new Error("The #update method is not available on EmbeddedDocuments")},EmbeddedDocument.prototype.inspect=function(){return inspect(this.toObject())},EmbeddedDocument.prototype.invalidate=function(e,t,n,r){if(!this.__parent){var i="Unable to invalidate a subdocument that has not been added to an array.";throw new Error(i)}var s=this.__parentArray.indexOf(this),o=this.__parentArray._path,u=[o,s,e].join(".");return 2<arguments.length?this.__parent.invalidate(u,t,n):this.__parent.invalidate(u,t),r&&(this.$__.validationError=this.ownerDocument().$__.validationError),!0},EmbeddedDocument.prototype.ownerDocument=function(){if(this.$__.ownerDocument)return this.$__.ownerDocument;var e=this.__parent;if(!e)return this;while(e.__parent)e=e.__parent;return this.$__.ownerDocument=e},EmbeddedDocument.prototype.$__fullPath=function(e){if(!this.$__.fullPath){var t=this;if(!t.__parent)return e;var n=[];while(t.__parent)n.unshift(t.__parentArray._path),t=t.__parent;this.$__.fullPath=n.join("."),this.$__.ownerDocument||(this.$__.ownerDocument=t)}return e?this.$__.fullPath+"."+e:this.$__.fullPath},EmbeddedDocument.prototype.parent=function(){return this.__parent},EmbeddedDocument.prototype.parentArray=function(){return this.__parentArray},module.exports=EmbeddedDocument;