// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//     http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.
//
// Copyright 2009 Google Inc. All Rights Reserved

function Timestamp(e,t){if(!(this instanceof Timestamp))return new Timestamp(e,t);this._bsontype="Timestamp",this.low_=e|0,this.high_=t|0}Timestamp.prototype.toInt=function(){return this.low_},Timestamp.prototype.toNumber=function(){return this.high_*Timestamp.TWO_PWR_32_DBL_+this.getLowBitsUnsigned()},Timestamp.prototype.toJSON=function(){return this.toString()},Timestamp.prototype.toString=function(e){var t=e||10;if(t<2||36<t)throw Error("radix out of range: "+t);if(this.isZero())return"0";if(this.isNegative()){if(this.equals(Timestamp.MIN_VALUE)){var n=Timestamp.fromNumber(t),r=this.div(n),i=r.multiply(n).subtract(this);return r.toString(t)+i.toInt().toString(t)}return"-"+this.negate().toString(t)}var s=Timestamp.fromNumber(Math.pow(t,6)),i=this,o="";for(;;){var u=i.div(s),a=i.subtract(u.multiply(s)).toInt(),f=a.toString(t);i=u;if(i.isZero())return f+o;while(f.length<6)f="0"+f;o=""+f+o}},Timestamp.prototype.getHighBits=function(){return this.high_},Timestamp.prototype.getLowBits=function(){return this.low_},Timestamp.prototype.getLowBitsUnsigned=function(){return this.low_>=0?this.low_:Timestamp.TWO_PWR_32_DBL_+this.low_},Timestamp.prototype.getNumBitsAbs=function(){if(this.isNegative())return this.equals(Timestamp.MIN_VALUE)?64:this.negate().getNumBitsAbs();var e=this.high_!=0?this.high_:this.low_;for(var t=31;t>0;t--)if((e&1<<t)!=0)break;return this.high_!=0?t+33:t+1},Timestamp.prototype.isZero=function(){return this.high_==0&&this.low_==0},Timestamp.prototype.isNegative=function(){return this.high_<0},Timestamp.prototype.isOdd=function(){return(this.low_&1)==1},Timestamp.prototype.equals=function(e){return this.high_==e.high_&&this.low_==e.low_},Timestamp.prototype.notEquals=function(e){return this.high_!=e.high_||this.low_!=e.low_},Timestamp.prototype.lessThan=function(e){return this.compare(e)<0},Timestamp.prototype.lessThanOrEqual=function(e){return this.compare(e)<=0},Timestamp.prototype.greaterThan=function(e){return this.compare(e)>0},Timestamp.prototype.greaterThanOrEqual=function(e){return this.compare(e)>=0},Timestamp.prototype.compare=function(e){if(this.equals(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.subtract(e).isNegative()?-1:1},Timestamp.prototype.negate=function(){return this.equals(Timestamp.MIN_VALUE)?Timestamp.MIN_VALUE:this.not().add(Timestamp.ONE)},Timestamp.prototype.add=function(e){var t=this.high_>>>16,n=this.high_&65535,r=this.low_>>>16,i=this.low_&65535,s=e.high_>>>16,o=e.high_&65535,u=e.low_>>>16,a=e.low_&65535,f=0,l=0,c=0,h=0;return h+=i+a,c+=h>>>16,h&=65535,c+=r+u,l+=c>>>16,c&=65535,l+=n+o,f+=l>>>16,l&=65535,f+=t+s,f&=65535,Timestamp.fromBits(c<<16|h,f<<16|l)},Timestamp.prototype.subtract=function(e){return this.add(e.negate())},Timestamp.prototype.multiply=function(e){if(this.isZero())return Timestamp.ZERO;if(e.isZero())return Timestamp.ZERO;if(this.equals(Timestamp.MIN_VALUE))return e.isOdd()?Timestamp.MIN_VALUE:Timestamp.ZERO;if(e.equals(Timestamp.MIN_VALUE))return this.isOdd()?Timestamp.MIN_VALUE:Timestamp.ZERO;if(this.isNegative())return e.isNegative()?this.negate().multiply(e.negate()):this.negate().multiply(e).negate();if(e.isNegative())return this.multiply(e.negate()).negate();if(this.lessThan(Timestamp.TWO_PWR_24_)&&e.lessThan(Timestamp.TWO_PWR_24_))return Timestamp.fromNumber(this.toNumber()*e.toNumber());var t=this.high_>>>16,n=this.high_&65535,r=this.low_>>>16,i=this.low_&65535,s=e.high_>>>16,o=e.high_&65535,u=e.low_>>>16,a=e.low_&65535,f=0,l=0,c=0,h=0;return h+=i*a,c+=h>>>16,h&=65535,c+=r*a,l+=c>>>16,c&=65535,c+=i*u,l+=c>>>16,c&=65535,l+=n*a,f+=l>>>16,l&=65535,l+=r*u,f+=l>>>16,l&=65535,l+=i*o,f+=l>>>16,l&=65535,f+=t*a+n*u+r*o+i*s,f&=65535,Timestamp.fromBits(c<<16|h,f<<16|l)},Timestamp.prototype.div=function(e){if(e.isZero())throw Error("division by zero");if(this.isZero())return Timestamp.ZERO;if(this.equals(Timestamp.MIN_VALUE)){if(e.equals(Timestamp.ONE)||e.equals(Timestamp.NEG_ONE))return Timestamp.MIN_VALUE;if(e.equals(Timestamp.MIN_VALUE))return Timestamp.ONE;var t=this.shiftRight(1),n=t.div(e).shiftLeft(1);if(n.equals(Timestamp.ZERO))return e.isNegative()?Timestamp.ONE:Timestamp.NEG_ONE;var r=this.subtract(e.multiply(n)),i=n.add(r.div(e));return i}if(e.equals(Timestamp.MIN_VALUE))return Timestamp.ZERO;if(this.isNegative())return e.isNegative()?this.negate().div(e.negate()):this.negate().div(e).negate();if(e.isNegative())return this.div(e.negate()).negate();var s=Timestamp.ZERO,r=this;while(r.greaterThanOrEqual(e)){var n=Math.max(1,Math.floor(r.toNumber()/e.toNumber())),o=Math.ceil(Math.log(n)/Math.LN2),u=o<=48?1:Math.pow(2,o-48),a=Timestamp.fromNumber(n),f=a.multiply(e);while(f.isNegative()||f.greaterThan(r))n-=u,a=Timestamp.fromNumber(n),f=a.multiply(e);a.isZero()&&(a=Timestamp.ONE),s=s.add(a),r=r.subtract(f)}return s},Timestamp.prototype.modulo=function(e){return this.subtract(this.div(e).multiply(e))},Timestamp.prototype.not=function(){return Timestamp.fromBits(~this.low_,~this.high_)},Timestamp.prototype.and=function(e){return Timestamp.fromBits(this.low_&e.low_,this.high_&e.high_)},Timestamp.prototype.or=function(e){return Timestamp.fromBits(this.low_|e.low_,this.high_|e.high_)},Timestamp.prototype.xor=function(e){return Timestamp.fromBits(this.low_^e.low_,this.high_^e.high_)},Timestamp.prototype.shiftLeft=function(e){e&=63;if(e==0)return this;var t=this.low_;if(e<32){var n=this.high_;return Timestamp.fromBits(t<<e,n<<e|t>>>32-e)}return Timestamp.fromBits(0,t<<e-32)},Timestamp.prototype.shiftRight=function(e){e&=63;if(e==0)return this;var t=this.high_;if(e<32){var n=this.low_;return Timestamp.fromBits(n>>>e|t<<32-e,t>>e)}return Timestamp.fromBits(t>>e-32,t>=0?0:-1)},Timestamp.prototype.shiftRightUnsigned=function(e){e&=63;if(e==0)return this;var t=this.high_;if(e<32){var n=this.low_;return Timestamp.fromBits(n>>>e|t<<32-e,t>>>e)}return e==32?Timestamp.fromBits(t,0):Timestamp.fromBits(t>>>e-32,0)},Timestamp.fromInt=function(e){if(-128<=e&&e<128){var t=Timestamp.INT_CACHE_[e];if(t)return t}var n=new Timestamp(e|0,e<0?-1:0);return-128<=e&&e<128&&(Timestamp.INT_CACHE_[e]=n),n},Timestamp.fromNumber=function(e){return isNaN(e)||!isFinite(e)?Timestamp.ZERO:e<=-Timestamp.TWO_PWR_63_DBL_?Timestamp.MIN_VALUE:e+1>=Timestamp.TWO_PWR_63_DBL_?Timestamp.MAX_VALUE:e<0?Timestamp.fromNumber(-e).negate():new Timestamp(e%Timestamp.TWO_PWR_32_DBL_|0,e/Timestamp.TWO_PWR_32_DBL_|0)},Timestamp.fromBits=function(e,t){return new Timestamp(e,t)},Timestamp.fromString=function(e,t){if(e.length==0)throw Error("number format error: empty string");var n=t||10;if(n<2||36<n)throw Error("radix out of range: "+n);if(e.charAt(0)=="-")return Timestamp.fromString(e.substring(1),n).negate();if(e.indexOf("-")>=0)throw Error('number format error: interior "-" character: '+e);var r=Timestamp.fromNumber(Math.pow(n,8)),i=Timestamp.ZERO;for(var s=0;s<e.length;s+=8){var o=Math.min(8,e.length-s),u=parseInt(e.substring(s,s+o),n);if(o<8){var a=Timestamp.fromNumber(Math.pow(n,o));i=i.multiply(a).add(Timestamp.fromNumber(u))}else i=i.multiply(r),i=i.add(Timestamp.fromNumber(u))}return i},Timestamp.INT_CACHE_={},Timestamp.TWO_PWR_16_DBL_=65536,Timestamp.TWO_PWR_24_DBL_=1<<24,Timestamp.TWO_PWR_32_DBL_=Timestamp.TWO_PWR_16_DBL_*Timestamp.TWO_PWR_16_DBL_,Timestamp.TWO_PWR_31_DBL_=Timestamp.TWO_PWR_32_DBL_/2,Timestamp.TWO_PWR_48_DBL_=Timestamp.TWO_PWR_32_DBL_*Timestamp.TWO_PWR_16_DBL_,Timestamp.TWO_PWR_64_DBL_=Timestamp.TWO_PWR_32_DBL_*Timestamp.TWO_PWR_32_DBL_,Timestamp.TWO_PWR_63_DBL_=Timestamp.TWO_PWR_64_DBL_/2,Timestamp.ZERO=Timestamp.fromInt(0),Timestamp.ONE=Timestamp.fromInt(1),Timestamp.NEG_ONE=Timestamp.fromInt(-1),Timestamp.MAX_VALUE=Timestamp.fromBits(-1,2147483647),Timestamp.MIN_VALUE=Timestamp.fromBits(0,-2147483648),Timestamp.TWO_PWR_24_=Timestamp.fromInt(1<<24),exports.Timestamp=Timestamp;