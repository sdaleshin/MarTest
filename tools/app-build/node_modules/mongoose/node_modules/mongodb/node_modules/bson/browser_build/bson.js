// Copyright (c) 2008, Fair Oaks Labs, Inc.
// All rights reserved.
// 
// Redistribution and use in source and binary forms, with or without
// modification, are permitted provided that the following conditions are met:
// 
//  * Redistributions of source code must retain the above copyright notice,
//    this list of conditions and the following disclaimer.
// 
//  * Redistributions in binary form must reproduce the above copyright notice,
//    this list of conditions and the following disclaimer in the documentation
//    and/or other materials provided with the distribution.
// 
//  * Neither the name of Fair Oaks Labs, Inc. nor the names of its contributors
//    may be used to endorse or promote products derived from this software
//    without specific prior written permission.
// 
// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
// AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
// IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
// ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE
// LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
// CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
// SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
// INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
// CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
// ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
// POSSIBILITY OF SUCH DAMAGE.
//
//
// Modifications to writeIEEE754 to support negative zeroes made by Brian White

// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//     http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.
//
// Copyright 2009 Google Inc. All Rights Reserved

var bson=function(){function u(){return s()}function a(){return f(Array.prototype.join.call(arguments,"/"))}function f(e){var t=[],n=e.split("/"),r,i,s=0,o=n.length-1;for(;s<=o;s++){r=n[s];if(r==="."&&i!==undefined)continue;r===".."&&t.length&&i!==".."&&i!=="."&&i!==undefined?(t.pop(),i=t.slice(-1)[0]):(i==="."&&t.pop(),t.push(r),i=r)}return t.join("/")}function l(e){return e&&e.substr(0,e.lastIndexOf("/"))||"."}function c(e,t){var n=a(l(e.id),/\.\/$/.test(t)?t+"index":t).replace(/\.js$/,""),r=a(n,"index"),i=e.pkg,s,o=i.modules.length,u;while(o-->0){u=i.modules[o].id;if(u==n||u==r){s=i.modules[o];break}}return s}function h(t){function r(s){var o,u;if(/^\./.test(s))o=c(t,s);else{if(i&&i.hasOwnProperty(s))return i[s];if(aliases&&aliases.hasOwnProperty(s))return r(aliases[s]);u=e[s];if(!u&&n){try{u=n(s)}catch(a){}if(u)return u}if(!u)throw new Error('Cannot find module "'+s+'" @[module: '+t.id+" package: "+t.pkg.name+"]");o=u.index}if(!o)throw new Error('Cannot find module "'+s+'" @[module: '+t.id+" package: "+t.pkg.name+"]");return o.parent=t,o.call()}return r}function p(e,n,r){var i={pkg:e,id:n,wrapper:r},o=!1;i.exports={},i.require=h(i),i.call=function(){return o?i.exports:(o=!0,t.require=i.require,i.wrapper(i,i.exports,t,t.require),i.exports)},e.mainModuleId==i.id&&(e.index=i,e.parents.length===0&&(s=i.call)),e.modules.push(i)}function d(){var t=arguments[arguments.length-1],n=Array.prototype.slice.call(arguments,0,arguments.length-1),r=t(n);return e[r.name]=r,arguments.length==1&&(e.main=r),function(e){var t;for(t in e)p(r,t,e[t])}}var e={},t={},n=typeof require!="undefined"&&require,r,i,s,o;return u.main=u,u.module=p,u.packages=e,u.pkg=d,u.require=function(n){return e.main.index.require(n)},i={},aliases={},u}(this);bson.pkg(function(e){return{name:"bson",mainModuleId:"bson",modules:[],parents:e}})({binary:function(e,t,n,r,i){function f(e,t){if(!(this instanceof f))return new f(e,t);this._bsontype="Binary",e instanceof Number?(this.sub_type=e,this.position=0):(this.sub_type=t==null?o:t,this.position=0);if(e==null||e instanceof Number)typeof s!="undefined"?this.buffer=new s(f.BUFFER_SIZE):typeof Uint8Array!="undefined"?this.buffer=new Uint8Array(new ArrayBuffer(f.BUFFER_SIZE)):this.buffer=new Array(f.BUFFER_SIZE),this.position=0;else{if(typeof e=="string")if(typeof s!="undefined")this.buffer=new s(e);else{if(typeof Uint8Array=="undefined"&&Object.prototype.toString.call(e)!="[object Array]")throw new Error("only String, Buffer, Uint8Array or Array accepted");this.buffer=u(e)}else this.buffer=e;this.position=e.length}}if(typeof window=="undefined")var s=r("buffer").Buffer;var o=0,u=function(e){var t=typeof Uint8Array!="undefined"?new Uint8Array(new ArrayBuffer(e.length)):new Array(e.length);for(var n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t},a=function(e,t,n){var r="";for(var i=t;i<n;i++)r+=String.fromCharCode(e[i]);return r};f.prototype.put=function(t){if(t["length"]!=null&&typeof t!="number"&&t.length!=1)throw new Error("only accepts single character String, Uint8Array or Array");if(typeof t!="number"&&t<0||t>255)throw new Error("only accepts number in a valid unsigned byte range 0-255");var n=null;typeof t=="string"?n=t.charCodeAt(0):t["length"]!=null?n=t[0]:n=t;if(this.buffer.length>this.position)this.buffer[this.position++]=n;else if(typeof s!="undefined"&&s.isBuffer(this.buffer)){var r=new s(f.BUFFER_SIZE+this.buffer.length);this.buffer.copy(r,0,0,this.buffer.length),this.buffer=r,this.buffer[this.position++]=n}else{var r=null;Object.prototype.toString.call(this.buffer)=="[object Uint8Array]"?r=new Uint8Array(new ArrayBuffer(f.BUFFER_SIZE+this.buffer.length)):r=new Array(f.BUFFER_SIZE+this.buffer.length);for(var i=0;i<this.buffer.length;i++)r[i]=this.buffer[i];this.buffer=r,this.buffer[this.position++]=n}},f.prototype.write=function(t,n){n=typeof n=="number"?n:this.position;if(this.buffer.length<n+t.length){var r=null;if(typeof s!="undefined"&&s.isBuffer(this.buffer))r=new s(this.buffer.length+t.length),this.buffer.copy(r,0,0,this.buffer.length);else if(Object.prototype.toString.call(this.buffer)=="[object Uint8Array]"){r=new Uint8Array(new ArrayBuffer(this.buffer.length+t.length));for(var i=0;i<this.position;i++)r[i]=this.buffer[i]}this.buffer=r}if(typeof s!="undefined"&&s.isBuffer(t)&&s.isBuffer(this.buffer))t.copy(this.buffer,n,0,t.length),this.position=n+t.length>this.position?n+t.length:this.position;else if(typeof s!="undefined"&&typeof t=="string"&&s.isBuffer(this.buffer))this.buffer.write(t,"binary",n),this.position=n+t.length>this.position?n+t.length:this.position;else if(Object.prototype.toString.call(t)=="[object Uint8Array]"||Object.prototype.toString.call(t)=="[object Array]"&&typeof t!="string"){for(var i=0;i<t.length;i++)this.buffer[n++]=t[i];this.position=n>this.position?n:this.position}else if(typeof t=="string"){for(var i=0;i<t.length;i++)this.buffer[n++]=t.charCodeAt(i);this.position=n>this.position?n:this.position}},f.prototype.read=function(t,n){n=n&&n>0?n:this.position;if(this.buffer.slice)return this.buffer.slice(t,t+n);var r=typeof Uint8Array!="undefined"?new Uint8Array(new ArrayBuffer(n)):new Array(n);for(var i=0;i<n;i++)r[i]=this.buffer[t++];return r},f.prototype.value=function(t){t=t==null?!1:t;if(typeof s!="undefined"&&s.isBuffer(this.buffer))return t?this.buffer.slice(0,this.position):this.buffer.toString("binary",0,this.position);if(t){if(this.buffer["slice"]!=null)return this.buffer.slice(0,this.position);var n=Object.prototype.toString.call(this.buffer)=="[object Uint8Array]"?new Uint8Array(new ArrayBuffer(this.position)):new Array(this.position);for(var r=0;r<this.position;r++)n[r]=this.buffer[r];return n}return a(this.buffer,0,this.position)},f.prototype.length=function(){return this.position},f.prototype.toJSON=function(){return this.buffer!=null?this.buffer.toString("base64"):""},f.prototype.toString=function(e){return this.buffer!=null?this.buffer.slice(0,this.position).toString(e):""},f.BUFFER_SIZE=256,f.SUBTYPE_DEFAULT=0,f.SUBTYPE_FUNCTION=1,f.SUBTYPE_BYTE_ARRAY=2,f.SUBTYPE_UUID_OLD=3,f.SUBTYPE_UUID=4,f.SUBTYPE_MD5=5,f.SUBTYPE_USER_DEFINED=128,t.Binary=f},binary_parser:function(e,t,n,i,s){function f(e,t){if(!(this instanceof f))return new f(e,t);this.bigEndian=e,this.allowExceptions=t}function l(e,t){this.bigEndian=e||0,this.buffer=[],this.setBuffer(t)}var o=String.fromCharCode,u=[];for(var a=0;a<64;a++)u[a]=Math.pow(2,a);f.warn=function(t){if(this.allowExceptions)throw new Error(t);return 1},f.decodeFloat=function(t,n,r){var i=new this.Buffer(this.bigEndian,t);i.checkBuffer(n+r+1);var s=u[r-1]-1,o=i.readBits(n+r,1),a=i.readBits(n,r),f=0,l=2,c=i.buffer.length+(-n>>3)-1;do for(var h=i.buffer[++c],p=n%8||8,d=1<<p;d>>=1;h&d&&(f+=1/l),l*=2);while(n-=p);return a==(s<<1)+1?f?NaN:o?-Infinity:+Infinity:(1+o*-2)*(a||f?a?Math.pow(2,a-s)*(1+f):Math.pow(2,-s+1)*f:0)},f.decodeInt=function(t,n,r,i){var s=new this.Buffer(this.bigEndian||i,t),o=s.readBits(0,n),a=u[n];return r&&o>=a/2?o-a:o},f.encodeFloat=function(t,n,i){var s=u[i-1]-1,o=-s+1,a=s,f=o-n,l=parseFloat(t),c=isNaN(l)||l==-Infinity||l==+Infinity?l:0,h=0,p=2*s+1+n+3,d=new Array(p),v=(l=c!==0?0:l)<0,m=Math.floor(l=Math.abs(l)),g=l-m,y,b,w,E,S;for(E=p;E;d[--E]=0);for(E=s+2;m&&E;d[--E]=m%2,m=Math.floor(m/2));for(E=s+1;g>0&&E;(d[++E]=((g*=2)>=1)-0)&&--g);for(E=-1;++E<p&&!d[E];);if(d[(y=n-1+(E=(h=s+1-E)>=o&&h<=a?E+1:s+1-(h=o-1)))+1]){if(!(b=d[y]))for(S=y+2;!b&&S<p;b=d[S++]);for(S=y+1;b&&--S>=0;(d[S]=!d[S]-0)&&(b=0));}for(E=E-2<0?-1:E-3;++E<p&&!d[E];);(h=s+1-E)>=o&&h<=a?++E:h<o&&(h!=s+1-p&&h<f&&this.warn("encodeFloat::float underflow"),E=s+1-(h=o-1));if(m||c!==0)this.warn(m?"encodeFloat::float overflow":"encodeFloat::"+c),h=a+1,E=s+2,c==-Infinity?v=1:isNaN(c)&&(d[E]=1);for(l=Math.abs(h+s),S=i+1,w="";--S;w=l%2+w,l=l>>=1);for(l=0,S=0,E=(w=(v?"1":"0")+w+d.slice(E,E+n).join("")).length,r=[];E;S=(S+1)%8)l+=(1<<S)*w.charAt(--E),S==7&&(r[r.length]=String.fromCharCode(l),l=0);return r[r.length]=l?String.fromCharCode(l):"",(this.bigEndian?r.reverse():r).join("")},f.encodeInt=function(t,n,r,i){var s=u[n];if(t>=s||t<-(s/2))this.warn("encodeInt::overflow"),t=0;t<0&&(t+=s);for(var o=[];t;o[o.length]=String.fromCharCode(t%256),t=Math.floor(t/256));for(n=-(-n>>3)-o.length;n--;o[o.length]="\0");return(this.bigEndian||i?o.reverse():o).join("")},f.toSmall=function(e){return this.decodeInt(e,8,!0)},f.fromSmall=function(e){return this.encodeInt(e,8,!0)},f.toByte=function(e){return this.decodeInt(e,8,!1)},f.fromByte=function(e){return this.encodeInt(e,8,!1)},f.toShort=function(e){return this.decodeInt(e,16,!0)},f.fromShort=function(e){return this.encodeInt(e,16,!0)},f.toWord=function(e){return this.decodeInt(e,16,!1)},f.fromWord=function(e){return this.encodeInt(e,16,!1)},f.toInt=function(e){return this.decodeInt(e,32,!0)},f.fromInt=function(e){return this.encodeInt(e,32,!0)},f.toLong=function(e){return this.decodeInt(e,64,!0)},f.fromLong=function(e){return this.encodeInt(e,64,!0)},f.toDWord=function(e){return this.decodeInt(e,32,!1)},f.fromDWord=function(e){return this.encodeInt(e,32,!1)},f.toQWord=function(e){return this.decodeInt(e,64,!0)},f.fromQWord=function(e){return this.encodeInt(e,64,!0)},f.toFloat=function(e){return this.decodeFloat(e,23,8)},f.fromFloat=function(e){return this.encodeFloat(e,23,8)},f.toDouble=function(e){return this.decodeFloat(e,52,11)},f.fromDouble=function(e){return this.encodeFloat(e,52,11)},f.encode_int32=function(t,n){var r,i,s,u,a;return a=t<0?t+4294967296:t,r=Math.floor(a/16777215),a&=16777215,i=Math.floor(a/65535),a&=65535,s=Math.floor(a/255),a&=255,u=Math.floor(a),n?[o(r),o(i),o(s),o(u)]:o(r)+o(i)+o(s)+o(u)},f.encode_int64=function(t){var n,r,i,s,u,a,f,l,c;return c=t<0?t+0x10000000000000000:t,n=Math.floor(c/72057594037927940),c&=72057594037927940,r=Math.floor(c/0xffffffffffff),c&=0xffffffffffff,i=Math.floor(c/0xffffffffff),c&=0xffffffffff,s=Math.floor(c/4294967295),c&=4294967295,u=Math.floor(c/16777215),c&=16777215,a=Math.floor(c/65535),c&=65535,f=Math.floor(c/255),c&=255,l=Math.floor(c),o(n)+o(r)+o(i)+o(s)+o(u)+o(a)+o(f)+o(l)},f.decode_utf8=function(t){var n=t.length,r="",i=0,s=0,o=0,u=0,a;while(i<n)s=t.charCodeAt(i),s<128?(r+=String.fromCharCode(s),i++):s>191&&s<224?(u=t.charCodeAt(i+1),r+=String.fromCharCode((s&31)<<6|u&63),i+=2):(u=t.charCodeAt(i+1),a=t.charCodeAt(i+2),r+=String.fromCharCode((s&15)<<12|(u&63)<<6|a&63),i+=3);return r},f.encode_cstring=function(t){return unescape(encodeURIComponent(t))+f.fromByte(0)},f.encode_utf8=function(t){var n="",r;for(var i=0,s=t.length;i<s;i++)r=t.charCodeAt(i),r<128?n+=String.fromCharCode(r):r>127&&r<2048?(n+=String.fromCharCode(r>>6|192),n+=String.fromCharCode(r&63|128)):(n+=String.fromCharCode(r>>12|224),n+=String.fromCharCode(r>>6&63|128),n+=String.fromCharCode(r&63|128));return n},f.hprint=function(t){var n;for(var r=0,i=t.length;r<i;r++)t.charCodeAt(r)<32?(n=t.charCodeAt(r)<=15?"0"+t.charCodeAt(r).toString(16):t.charCodeAt(r).toString(16),process.stdout.write(n+" ")):(n=t.charCodeAt(r)<=15?"0"+t.charCodeAt(r).toString(16):t.charCodeAt(r).toString(16),process.stdout.write(n+" "));process.stdout.write("\n\n")},f.ilprint=function(t){var n;for(var r=0,s=t.length;r<s;r++)t.charCodeAt(r)<32?(n=t.charCodeAt(r)<=15?"0"+t.charCodeAt(r).toString(10):t.charCodeAt(r).toString(10),i("util").debug(n+" : ")):(n=t.charCodeAt(r)<=15?"0"+t.charCodeAt(r).toString(10):t.charCodeAt(r).toString(10),i("util").debug(n+" : "+t.charAt(r)))},f.hlprint=function(t){var n;for(var r=0,s=t.length;r<s;r++)t.charCodeAt(r)<32?(n=t.charCodeAt(r)<=15?"0"+t.charCodeAt(r).toString(16):t.charCodeAt(r).toString(16),i("util").debug(n+" : ")):(n=t.charCodeAt(r)<=15?"0"+t.charCodeAt(r).toString(16):t.charCodeAt(r).toString(16),i("util").debug(n+" : "+t.charAt(r)))},l.prototype.setBuffer=function(t){var n,r,i;if(t){r=n=t.length,i=this.buffer=new Array(n);for(;r;i[n-r]=t.charCodeAt(--r));this.bigEndian&&i.reverse()}},l.prototype.hasNeededBits=function(t){return this.buffer.length>=-(-t>>3)},l.prototype.checkBuffer=function(t){if(!this.hasNeededBits(t))throw new Error("checkBuffer::missing bytes")},l.prototype.readBits=function(t,n){function r(e,t){for(;t--;e=((e%=2147483647+1)&1073741824)==1073741824?e*2:(e-1073741824)*2+2147483647+1);return e}if(t<0||n<=0)return 0;this.checkBuffer(t+n);var i,s=t%8,o=this.buffer.length-(t>>3)-1,u=this.buffer.length+(-(t+n)>>3),a=o-u,f=(this.buffer[o]>>s&(1<<(a?8-s:n))-1)+(a&&(i=(t+n)%8)?(this.buffer[u++]&(1<<i)-1)<<(a--<<3)-s:0);for(;a;f+=r(this.buffer[u++],(a--<<3)-s));return f},f.Buffer=l,t.BinaryParser=f},bson:function(module,exports,global,require,undefined){function BSON(){}function calculateElement(e,t,n){var r=typeof Buffer!="undefined";switch(typeof t){case"string":return 1+(r?Buffer.byteLength(e,"utf8"):numberOfBytes(e))+1+4+(r?Buffer.byteLength(t,"utf8"):numberOfBytes(t))+1;case"number":return Math.floor(t)===t&&t>=BSON.JS_INT_MIN&&t<=BSON.JS_INT_MAX?t>=BSON.BSON_INT32_MIN&&t<=BSON.BSON_INT32_MAX?(e!=null?(r?Buffer.byteLength(e,"utf8"):numberOfBytes(e))+1:0)+5:(e!=null?(r?Buffer.byteLength(e,"utf8"):numberOfBytes(e))+1:0)+9:(e!=null?(r?Buffer.byteLength(e,"utf8"):numberOfBytes(e))+1:0)+9;case"undefined":return(e!=null?(r?Buffer.byteLength(e,"utf8"):numberOfBytes(e))+1:0)+1;case"boolean":return(e!=null?(r?Buffer.byteLength(e,"utf8"):numberOfBytes(e))+1:0)+2;case"object":if(t==null||t instanceof MinKey||t instanceof MaxKey||t["_bsontype"]=="MinKey"||t["_bsontype"]=="MaxKey")return(e!=null?(r?Buffer.byteLength(e,"utf8"):numberOfBytes(e))+1:0)+1;if(t instanceof ObjectID||t["_bsontype"]=="ObjectID")return(e!=null?(r?Buffer.byteLength(e,"utf8"):numberOfBytes(e))+1:0)+13;if(t instanceof Date||isDate(t))return(e!=null?(r?Buffer.byteLength(e,"utf8"):numberOfBytes(e))+1:0)+9;if(typeof Buffer!="undefined"&&Buffer.isBuffer(t))return(e!=null?(r?Buffer.byteLength(e,"utf8"):numberOfBytes(e))+1:0)+6+t.length;if(t instanceof Long||t instanceof Double||t instanceof Timestamp||t["_bsontype"]=="Long"||t["_bsontype"]=="Double"||t["_bsontype"]=="Timestamp")return(e!=null?(r?Buffer.byteLength(e,"utf8"):numberOfBytes(e))+1:0)+9;if(t instanceof Code||t["_bsontype"]=="Code")return t.scope!=null&&Object.keys(t.scope).length>0?(e!=null?(r?Buffer.byteLength(e,"utf8"):numberOfBytes(e))+1:0)+1+4+4+(r?Buffer.byteLength(t.code.toString(),"utf8"):numberOfBytes(t.code.toString()))+1+BSON.calculateObjectSize(t.scope,n):(e!=null?(r?Buffer.byteLength(e,"utf8"):numberOfBytes(e))+1:0)+1+4+(r?Buffer.byteLength(t.code.toString(),"utf8"):numberOfBytes(t.code.toString()))+1;if(t instanceof Binary||t["_bsontype"]=="Binary")return t.sub_type==Binary.SUBTYPE_BYTE_ARRAY?(e!=null?(r?Buffer.byteLength(e,"utf8"):numberOfBytes(e))+1:0)+(t.position+1+4+1+4):(e!=null?(r?Buffer.byteLength(e,"utf8"):numberOfBytes(e))+1:0)+(t.position+1+4+1);if(t instanceof Symbol||t["_bsontype"]=="Symbol")return(e!=null?(r?Buffer.byteLength(e,"utf8"):numberOfBytes(e))+1:0)+((r?Buffer.byteLength(t.value,"utf8"):numberOfBytes(t.value))+4+1+1);if(t instanceof DBRef||t["_bsontype"]=="DBRef"){var i={$ref:t.namespace,$id:t.oid};return null!=t.db&&(i.$db=t.db),(e!=null?(r?Buffer.byteLength(e,"utf8"):numberOfBytes(e))+1:0)+1+BSON.calculateObjectSize(i,n)}return t instanceof RegExp||Object.prototype.toString.call(t)==="[object RegExp]"?(e!=null?(r?Buffer.byteLength(e,"utf8"):numberOfBytes(e))+1:0)+1+(r?Buffer.byteLength(t.source,"utf8"):numberOfBytes(t.source))+1+(t.global?1:0)+(t.ignoreCase?1:0)+(t.multiline?1:0)+1:(e!=null?(r?Buffer.byteLength(e,"utf8"):numberOfBytes(e))+1:0)+BSON.calculateObjectSize(t,n)+1;case"function":if(t instanceof RegExp||Object.prototype.toString.call(t)==="[object RegExp]"||String.call(t)=="[object RegExp]")return(e!=null?(r?Buffer.byteLength(e,"utf8"):numberOfBytes(e))+1:0)+1+(r?Buffer.byteLength(t.source,"utf8"):numberOfBytes(t.source))+1+(t.global?1:0)+(t.ignoreCase?1:0)+(t.multiline?1:0)+1;if(n&&t.scope!=null&&Object.keys(t.scope).length>0)return(e!=null?(r?Buffer.byteLength(e,"utf8"):numberOfBytes(e))+1:0)+1+4+4+(r?Buffer.byteLength(t.toString(),"utf8"):numberOfBytes(t.toString()))+1+BSON.calculateObjectSize(t.scope,n);if(n)return(e!=null?(r?Buffer.byteLength(e,"utf8"):numberOfBytes(e))+1:0)+1+4+(r?Buffer.byteLength(t.toString(),"utf8"):numberOfBytes(t.toString()))+1}return 0}var Long=require("./long").Long,Double=require("./double").Double,Timestamp=require("./timestamp").Timestamp,ObjectID=require("./objectid").ObjectID,Symbol=require("./symbol").Symbol,Code=require("./code").Code,MinKey=require("./min_key").MinKey,MaxKey=require("./max_key").MaxKey,DBRef=require("./db_ref").DBRef,Binary=require("./binary").Binary,BinaryParser=require("./binary_parser").BinaryParser,writeIEEE754=require("./float_parser").writeIEEE754,readIEEE754=require("./float_parser").readIEEE754,isDate=function(t){return typeof t=="object"&&Object.prototype.toString.call(t)==="[object Date]"};BSON.BSON_INT32_MAX=2147483647,BSON.BSON_INT32_MIN=-2147483648,BSON.BSON_INT64_MAX=Math.pow(2,63)-1,BSON.BSON_INT64_MIN=-Math.pow(2,63),BSON.JS_INT_MAX=9007199254740992,BSON.JS_INT_MIN=-9007199254740992;var JS_INT_MAX_LONG=Long.fromNumber(9007199254740992),JS_INT_MIN_LONG=Long.fromNumber(-9007199254740992);BSON.BSON_DATA_NUMBER=1,BSON.BSON_DATA_STRING=2,BSON.BSON_DATA_OBJECT=3,BSON.BSON_DATA_ARRAY=4,BSON.BSON_DATA_BINARY=5,BSON.BSON_DATA_OID=7,BSON.BSON_DATA_BOOLEAN=8,BSON.BSON_DATA_DATE=9,BSON.BSON_DATA_NULL=10,BSON.BSON_DATA_REGEXP=11,BSON.BSON_DATA_CODE=13,BSON.BSON_DATA_SYMBOL=14,BSON.BSON_DATA_CODE_W_SCOPE=15,BSON.BSON_DATA_INT=16,BSON.BSON_DATA_TIMESTAMP=17,BSON.BSON_DATA_LONG=18,BSON.BSON_DATA_MIN_KEY=255,BSON.BSON_DATA_MAX_KEY=127,BSON.BSON_BINARY_SUBTYPE_DEFAULT=0,BSON.BSON_BINARY_SUBTYPE_FUNCTION=1,BSON.BSON_BINARY_SUBTYPE_BYTE_ARRAY=2,BSON.BSON_BINARY_SUBTYPE_UUID=3,BSON.BSON_BINARY_SUBTYPE_MD5=4,BSON.BSON_BINARY_SUBTYPE_USER_DEFINED=128,BSON.calculateObjectSize=function(t,n){var r=5;if(Array.isArray(t))for(var i=0;i<t.length;i++)r+=calculateElement(i.toString(),t[i],n);else{t.toBSON&&(t=t.toBSON());for(var s in t)r+=calculateElement(s,t[s],n)}return r},BSON.serializeWithBufferAndIndex=function(t,n,r,i,s){s=s==null?!1:s;var o=r.length;return r[i++]=o&255,r[i++]=o>>8&255,r[i++]=o>>16&255,r[i++]=o>>24&255,serializeObject(t,n,r,i,s)-1};var serializeObject=function(e,t,n,r,i){if(Array.isArray(e))for(var s=0;s<e.length;s++)r=packElement(s.toString(),e[s],t,n,r,i);else{e.toBSON&&(e=e.toBSON());for(var o in e)o!="$db"&&o!="$ref"&&o!="$id"&&BSON.checkKey(o,!t),r=packElement(o,e[o],t,n,r,i)}return n[r++]=0,r},stringToBytes=function(e){var t,n,r=[];for(var i=0;i<e.length;i++){t=e.charCodeAt(i),n=[];do n.push(t&255),t>>=8;while(t);r=r.concat(n.reverse())}return r},numberOfBytes=function(e){var t,n,r=0;for(var i=0;i<e.length;i++){t=e.charCodeAt(i),n=[];do n.push(t&255),t>>=8;while(t);r+=n.length}return r},writeToTypedArray=function(e,t,n){var r=stringToBytes(t);for(var i=0;i<r.length;i++)e[n+i]=r[i];return r.length},supportsBuffer=typeof Buffer!="undefined",packElement=function(e,t,n,r,i,s){var o=i;switch(typeof t){case"string":r[i++]=BSON.BSON_DATA_STRING;var u=supportsBuffer?r.write(e,i,"utf8"):writeToTypedArray(r,e,i);i=i+u+1,r[i-1]=0;var a=supportsBuffer?Buffer.byteLength(t)+1:numberOfBytes(t)+1;return r[i+3]=a>>24&255,r[i+2]=a>>16&255,r[i+1]=a>>8&255,r[i]=a&255,i+=4,supportsBuffer?r.write(t,i,"utf8"):writeToTypedArray(r,t,i),i=i+a-1,r[i++]=0,i;case"number":if(Math.floor(t)===t&&t>=BSON.JS_INT_MIN&&t<=BSON.JS_INT_MAX)if(t>=BSON.BSON_INT32_MIN&&t<=BSON.BSON_INT32_MAX){r[i++]=BSON.BSON_DATA_INT;var u=supportsBuffer?r.write(e,i,"utf8"):writeToTypedArray(r,e,i);i=i+u+1,r[i-1]=0,r[i++]=t&255,r[i++]=t>>8&255,r[i++]=t>>16&255,r[i++]=t>>24&255}else if(t>=BSON.JS_INT_MIN&&t<=BSON.JS_INT_MAX){r[i++]=BSON.BSON_DATA_NUMBER;var u=supportsBuffer?r.write(e,i,"utf8"):writeToTypedArray(r,e,i);i=i+u+1,r[i-1]=0,writeIEEE754(r,t,i,"little",52,8),i+=8}else{r[i++]=BSON.BSON_DATA_LONG;var u=supportsBuffer?r.write(e,i,"utf8"):writeToTypedArray(r,e,i);i=i+u+1,r[i-1]=0;var f=Long.fromNumber(t),l=f.getLowBits(),c=f.getHighBits();r[i++]=l&255,r[i++]=l>>8&255,r[i++]=l>>16&255,r[i++]=l>>24&255,r[i++]=c&255,r[i++]=c>>8&255,r[i++]=c>>16&255,r[i++]=c>>24&255}else{r[i++]=BSON.BSON_DATA_NUMBER;var u=supportsBuffer?r.write(e,i,"utf8"):writeToTypedArray(r,e,i);i=i+u+1,r[i-1]=0,writeIEEE754(r,t,i,"little",52,8),i+=8}return i;case"undefined":r[i++]=BSON.BSON_DATA_NULL;var u=supportsBuffer?r.write(e,i,"utf8"):writeToTypedArray(r,e,i);return i=i+u+1,r[i-1]=0,i;case"boolean":r[i++]=BSON.BSON_DATA_BOOLEAN;var u=supportsBuffer?r.write(e,i,"utf8"):writeToTypedArray(r,e,i);return i=i+u+1,r[i-1]=0,r[i++]=t?1:0,i;case"object":if(t===null||t instanceof MinKey||t instanceof MaxKey||t["_bsontype"]=="MinKey"||t["_bsontype"]=="MaxKey"){t===null?r[i++]=BSON.BSON_DATA_NULL:t instanceof MinKey?r[i++]=BSON.BSON_DATA_MIN_KEY:r[i++]=BSON.BSON_DATA_MAX_KEY;var u=supportsBuffer?r.write(e,i,"utf8"):writeToTypedArray(r,e,i);return i=i+u+1,r[i-1]=0,i}if(t instanceof ObjectID||t["_bsontype"]=="ObjectID"){r[i++]=BSON.BSON_DATA_OID;var u=supportsBuffer?r.write(e,i,"utf8"):writeToTypedArray(r,e,i);return i=i+u+1,r[i-1]=0,supportsBuffer?r.write(t.id,i,"binary"):writeToTypedArray(r,t.id,i),i+=12,i}if(t instanceof Date||isDate(t)){r[i++]=BSON.BSON_DATA_DATE;var u=supportsBuffer?r.write(e,i,"utf8"):writeToTypedArray(r,e,i);i=i+u+1,r[i-1]=0;var h=Long.fromNumber(t.getTime()),l=h.getLowBits(),c=h.getHighBits();return r[i++]=l&255,r[i++]=l>>8&255,r[i++]=l>>16&255,r[i++]=l>>24&255,r[i++]=c&255,r[i++]=c>>8&255,r[i++]=c>>16&255,r[i++]=c>>24&255,i}if(typeof Buffer!="undefined"&&Buffer.isBuffer(t)){r[i++]=BSON.BSON_DATA_BINARY;var u=supportsBuffer?r.write(e,i,"utf8"):writeToTypedArray(r,e,i);i=i+u+1,r[i-1]=0;var a=t.length;return r[i++]=a&255,r[i++]=a>>8&255,r[i++]=a>>16&255,r[i++]=a>>24&255,r[i++]=BSON.BSON_BINARY_SUBTYPE_DEFAULT,t.copy(r,i,0,a),i+=a,i}if(t instanceof Long||t instanceof Timestamp||t["_bsontype"]=="Long"||t["_bsontype"]=="Timestamp"){r[i++]=t instanceof Long?BSON.BSON_DATA_LONG:BSON.BSON_DATA_TIMESTAMP;var u=supportsBuffer?r.write(e,i,"utf8"):writeToTypedArray(r,e,i);i=i+u+1,r[i-1]=0;var l=t.getLowBits(),c=t.getHighBits();return r[i++]=l&255,r[i++]=l>>8&255,r[i++]=l>>16&255,r[i++]=l>>24&255,r[i++]=c&255,r[i++]=c>>8&255,r[i++]=c>>16&255,r[i++]=c>>24&255,i}if(t instanceof Double||t["_bsontype"]=="Double"){r[i++]=BSON.BSON_DATA_NUMBER;var u=supportsBuffer?r.write(e,i,"utf8"):writeToTypedArray(r,e,i);return i=i+u+1,r[i-1]=0,writeIEEE754(r,t,i,"little",52,8),i+=8,i}if(t instanceof Code||t["_bsontype"]=="Code"){if(t.scope!=null&&Object.keys(t.scope).length>0){r[i++]=BSON.BSON_DATA_CODE_W_SCOPE;var u=supportsBuffer?r.write(e,i,"utf8"):writeToTypedArray(r,e,i);i=i+u+1,r[i-1]=0;var p=BSON.calculateObjectSize(t.scope,s),d=t.code.toString(),v=supportsBuffer?Buffer.byteLength(d)+1:numberOfBytes(d)+1,m=4+v+p+4;r[i++]=m&255,r[i++]=m>>8&255,r[i++]=m>>16&255,r[i++]=m>>24&255,r[i++]=v&255,r[i++]=v>>8&255,r[i++]=v>>16&255,r[i++]=v>>24&255,supportsBuffer?r.write(d,i,"utf8"):writeToTypedArray(r,d,i),i=i+v-1,r[i++]=0;var g=supportsBuffer?new Buffer(p):new Uint8Array(new ArrayBuffer(p));serializeObject(t.scope,n,g,0,s);var y=p;return r[i++]=y&255,r[i++]=y>>8&255,r[i++]=y>>16&255,r[i++]=y>>24&255,supportsBuffer?g.copy(r,i,0,p):r.set(g,i),i=i+y-5,r[i++]=0,i}r[i++]=BSON.BSON_DATA_CODE;var u=supportsBuffer?r.write(e,i,"utf8"):writeToTypedArray(r,e,i);i=i+u+1,r[i-1]=0;var d=t.code.toString(),a=supportsBuffer?Buffer.byteLength(d)+1:numberOfBytes(d)+1;return r[i++]=a&255,r[i++]=a>>8&255,r[i++]=a>>16&255,r[i++]=a>>24&255,supportsBuffer?r.write(d,i,"utf8"):writeToTypedArray(r,d,i),i=i+a-1,r[i++]=0,i}if(t instanceof Binary||t["_bsontype"]=="Binary"){r[i++]=BSON.BSON_DATA_BINARY;var u=supportsBuffer?r.write(e,i,"utf8"):writeToTypedArray(r,e,i);i=i+u+1,r[i-1]=0;var b=t.value(!0),a=t.position;return r[i++]=a&255,r[i++]=a>>8&255,r[i++]=a>>16&255,r[i++]=a>>24&255,r[i++]=t.sub_type,t.sub_type==Binary.SUBTYPE_BYTE_ARRAY&&(r[i++]=a&255,r[i++]=a>>8&255,r[i++]=a>>16&255,r[i++]=a>>24&255),supportsBuffer?b.copy(r,i,0,t.position):r.set(b,i),i+=t.position,i}if(t instanceof Symbol||t["_bsontype"]=="Symbol"){r[i++]=BSON.BSON_DATA_SYMBOL;var u=supportsBuffer?r.write(e,i,"utf8"):writeToTypedArray(r,e,i);i=i+u+1,r[i-1]=0;var a=supportsBuffer?Buffer.byteLength(t.value)+1:numberOfBytes(t.value)+1;return r[i++]=a&255,r[i++]=a>>8&255,r[i++]=a>>16&255,r[i++]=a>>24&255,r.write(t.value,i,"utf8"),i=i+a-1,r[i++]=0,i}if(t instanceof DBRef||t["_bsontype"]=="DBRef"){r[i++]=BSON.BSON_DATA_OBJECT;var u=supportsBuffer?r.write(e,i,"utf8"):writeToTypedArray(r,e,i);i=i+u+1,r[i-1]=0;var w={$ref:t.namespace,$id:t.oid};null!=t.db&&(w.$db=t.db);var a=BSON.calculateObjectSize(w,s),E=BSON.serializeWithBufferAndIndex(w,n,r,i,s);return r[i++]=a&255,r[i++]=a>>8&255,r[i++]=a>>16&255,r[i++]=a>>24&255,r[E++]=0,E}if(t instanceof RegExp||Object.prototype.toString.call(t)==="[object RegExp]"){r[i++]=BSON.BSON_DATA_REGEXP;var u=supportsBuffer?r.write(e,i,"utf8"):writeToTypedArray(r,e,i);return i=i+u+1,r[i-1]=0,supportsBuffer?r.write(t.source,i,"utf8"):writeToTypedArray(r,t.source,i),i+=supportsBuffer?Buffer.byteLength(t.source):numberOfBytes(t.source),r[i++]=0,t.global&&(r[i++]=115),t.ignoreCase&&(r[i++]=105),t.multiline&&(r[i++]=109),r[i++]=0,i}r[i++]=Array.isArray(t)?BSON.BSON_DATA_ARRAY:BSON.BSON_DATA_OBJECT;var u=supportsBuffer?r.write(e,i,"utf8"):writeToTypedArray(r,e,i);i=i+u+1,r[i-1]=0;var E=serializeObject(t,n,r,i+4,s),a=E-i;return r[i++]=a&255,r[i++]=a>>8&255,r[i++]=a>>16&255,r[i++]=a>>24&255,E;case"function":if(t instanceof RegExp||Object.prototype.toString.call(t)==="[object RegExp]"||String.call(t)=="[object RegExp]"){r[i++]=BSON.BSON_DATA_REGEXP;var u=supportsBuffer?r.write(e,i,"utf8"):writeToTypedArray(r,e,i);return i=i+u+1,r[i-1]=0,r.write(t.source,i,"utf8"),i+=supportsBuffer?Buffer.byteLength(t.source):numberOfBytes(t.source),r[i++]=0,t.global&&(r[i++]=115),t.ignoreCase&&(r[i++]=105),t.multiline&&(r[i++]=109),r[i++]=0,i}if(s&&t.scope!=null&&Object.keys(t.scope).length>0){r[i++]=BSON.BSON_DATA_CODE_W_SCOPE;var u=supportsBuffer?r.write(e,i,"utf8"):writeToTypedArray(r,e,i);i=i+u+1,r[i-1]=0;var p=BSON.calculateObjectSize(t.scope,s),d=t.toString(),v=supportsBuffer?Buffer.byteLength(d)+1:numberOfBytes(d)+1,m=4+v+p;r[i++]=m&255,r[i++]=m>>8&255,r[i++]=m>>16&255,r[i++]=m>>24&255,r[i++]=v&255,r[i++]=v>>8&255,r[i++]=v>>16&255,r[i++]=v>>24&255,supportsBuffer?r.write(d,i,"utf8"):writeToTypedArray(r,d,i),i=i+v-1,r[i++]=0;var g=new Buffer(p);serializeObject(t.scope,n,g,0,s);var y=p-4;return r[i++]=y&255,r[i++]=y>>8&255,r[i++]=y>>16&255,r[i++]=y>>24&255,g.copy(r,i,0,p),i=i+y-5,r[i++]=0,i}if(s){r[i++]=BSON.BSON_DATA_CODE;var u=supportsBuffer?r.write(e,i,"utf8"):writeToTypedArray(r,e,i);i=i+u+1,r[i-1]=0;var d=t.toString(),a=supportsBuffer?Buffer.byteLength(d)+1:numberOfBytes(d)+1;return r[i++]=a&255,r[i++]=a>>8&255,r[i++]=a>>16&255,r[i++]=a>>24&255,supportsBuffer?r.write(d,i,"utf8"):writeToTypedArray(r,d,i),i=i+a-1,r[i++]=0,i}}return i};BSON.serialize=function(e,t,n,r){if(e==null||typeof e!="object"||Array.isArray(e))throw new Error("Only javascript objects supported");var i=null,s=BSON.calculateObjectSize(e,r);return(i=typeof Buffer!="undefined")?(i=new Buffer(s),n=!0):typeof Uint8Array!="undefined"?i=new Uint8Array(new ArrayBuffer(s)):i=new Array(s),BSON.serializeWithBufferAndIndex(e,t,i,0,r),i};var functionCache=BSON.functionCache={},table=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],crc32=function(e,t,n){var r=0,i=0,s=0;r^=-1;for(var o=t,u=n;o<u;o++)s=(r^e[o])&255,i=table[s],r=r>>>8^i;return r^-1};BSON.deserializeStream=function(e,t,n,r,i,s){s=s!=null?s:{};var o=t;for(var u=0;u<n;u++){var a=e[o]|e[o+1]<<8|e[o+2]<<16|e[o+3]<<24;s.index=o,r[i+u]=BSON.deserialize(e,s),o+=a}return o};var isolateEvalWithHash=function(functionCache,hash,functionString,object){var value=null;return functionCache[hash]==null&&(eval("value = "+functionString),functionCache[hash]=value),functionCache[hash].bind(object)},isolateEval=function(functionString){var value=null;return eval("value = "+functionString),value},convertUint8ArrayToUtf8String=function(e,t,n){return BinaryParser.decode_utf8(convertArraytoUtf8BinaryString(e,t,n))},convertArraytoUtf8BinaryString=function(e,t,n){var r="";for(var i=t;i<n;i++)r+=String.fromCharCode(e[i]);return r};BSON.deserialize=function(e,t,n){t=t==null?{}:t;var r=t["evalFunctions"]==null?!1:t.evalFunctions,i=t["cacheFunctions"]==null?!1:t.cacheFunctions,s=t["cacheFunctionsCrc32"]==null?!1:t.cacheFunctionsCrc32,o=t.promoteLongs||!0;if(e.length<5)throw new Error("corrupt bson message < 5 bytes long");var u=typeof t["index"]=="number"?t.index:0,a=function(){var t=u;while(e[t]!==0)t++;var n=supportsBuffer&&Buffer.isBuffer(e)?e.toString("utf8",u,t):convertUint8ArrayToUtf8String(e,u,t);return u=t+1,n},f=n?[]:{},l=e[u++]|e[u++]<<8|e[u++]<<16|e[u++]<<24;if(l<5||l>e.length)throw new Error("corrupt bson message");for(;;){var c=e[u++];if(c==0)break;var h=a();switch(c){case BSON.BSON_DATA_OID:var p=supportsBuffer&&Buffer.isBuffer(e)?e.toString("binary",u,u+12):convertArraytoUtf8BinaryString(e,u,u+12);f[h]=new ObjectID(p),u+=12;break;case BSON.BSON_DATA_STRING:var d=e[u++]|e[u++]<<8|e[u++]<<16|e[u++]<<24;f[h]=supportsBuffer&&Buffer.isBuffer(e)?e.toString("utf8",u,u+d-1):convertUint8ArrayToUtf8String(e,u,u+d-1),u+=d;break;case BSON.BSON_DATA_INT:f[h]=e[u++]|e[u++]<<8|e[u++]<<16|e[u++]<<24;break;case BSON.BSON_DATA_NUMBER:f[h]=readIEEE754(e,u,"little",52,8),u+=8;break;case BSON.BSON_DATA_DATE:var v=e[u++]|e[u++]<<8|e[u++]<<16|e[u++]<<24,m=e[u++]|e[u++]<<8|e[u++]<<16|e[u++]<<24;f[h]=new Date((new Long(v,m)).toNumber());break;case BSON.BSON_DATA_BOOLEAN:f[h]=e[u++]==1;break;case BSON.BSON_DATA_NULL:f[h]=null;break;case BSON.BSON_DATA_BINARY:var g=e[u++]|e[u++]<<8|e[u++]<<16|e[u++]<<24,y=e[u++];if(e["slice"]!=null)y==Binary.SUBTYPE_BYTE_ARRAY&&(g=e[u++]|e[u++]<<8|e[u++]<<16|e[u++]<<24),f[h]=new Binary(e.slice(u,u+g),y);else{var b=typeof Uint8Array!="undefined"?new Uint8Array(new ArrayBuffer(g)):new Array(g);y==Binary.SUBTYPE_BYTE_ARRAY&&(g=e[u++]|e[u++]<<8|e[u++]<<16|e[u++]<<24);for(var w=0;w<g;w++)b[w]=e[u+w];f[h]=new Binary(b,y)}u+=g;break;case BSON.BSON_DATA_ARRAY:t.index=u;var E=e[u]|e[u+1]<<8|e[u+2]<<16|e[u+3]<<24;f[h]=BSON.deserialize(e,t,!0),u+=E;break;case BSON.BSON_DATA_OBJECT:t.index=u;var E=e[u]|e[u+1]<<8|e[u+2]<<16|e[u+3]<<24;f[h]=BSON.deserialize(e,t,!1),u+=E;break;case BSON.BSON_DATA_REGEXP:var S=a(),x=a(),T=new Array(x.length);for(var w=0;w<x.length;w++)switch(x[w]){case"m":T[w]="m";break;case"s":T[w]="g";break;case"i":T[w]="i"}f[h]=new RegExp(S,T.join(""));break;case BSON.BSON_DATA_LONG:var v=e[u++]|e[u++]<<8|e[u++]<<16|e[u++]<<24,m=e[u++]|e[u++]<<8|e[u++]<<16|e[u++]<<24,N=new Long(v,m);o?f[h]=N.lessThanOrEqual(JS_INT_MAX_LONG)&&N.greaterThanOrEqual(JS_INT_MIN_LONG)?N.toNumber():N:f[h]=N;break;case BSON.BSON_DATA_SYMBOL:var d=e[u++]|e[u++]<<8|e[u++]<<16|e[u++]<<24;f[h]=new Symbol(e.toString("utf8",u,u+d-1)),u+=d;break;case BSON.BSON_DATA_TIMESTAMP:var v=e[u++]|e[u++]<<8|e[u++]<<16|e[u++]<<24,m=e[u++]|e[u++]<<8|e[u++]<<16|e[u++]<<24;f[h]=new Timestamp(v,m);break;case BSON.BSON_DATA_MIN_KEY:f[h]=new MinKey;break;case BSON.BSON_DATA_MAX_KEY:f[h]=new MaxKey;break;case BSON.BSON_DATA_CODE:var d=e[u++]|e[u++]<<8|e[u++]<<16|e[u++]<<24,C=supportsBuffer&&Buffer.isBuffer(e)?e.toString("utf8",u,u+d-1):convertUint8ArrayToUtf8String(e,u,u+d-1);if(r){var k=null;if(i){var L=s?crc32(C):C;f[h]=isolateEvalWithHash(functionCache,L,C,f)}else f[h]=isolateEval(C)}else f[h]=new Code(C,{});u+=d;break;case BSON.BSON_DATA_CODE_W_SCOPE:var A=e[u++]|e[u++]<<8|e[u++]<<16|e[u++]<<24,d=e[u++]|e[u++]<<8|e[u++]<<16|e[u++]<<24,C=supportsBuffer&&Buffer.isBuffer(e)?e.toString("utf8",u,u+d-1):convertUint8ArrayToUtf8String(e,u,u+d-1);u+=d,t.index=u;var E=e[u]|e[u+1]<<8|e[u+2]<<16|e[u+3]<<24,O=BSON.deserialize(e,t,!1);u+=E;if(r){var k=null;if(i){var L=s?crc32(C):C;f[h]=isolateEvalWithHash(functionCache,L,C,f)}else f[h]=isolateEval(C);f[h].scope=O}else f[h]=new Code(C,O)}}return f["$id"]!=null&&(f=new DBRef(f.$ref,f.$id,f.$db)),f},BSON.checkKey=function(t,n){if(!t.length)return;if(!!~t.indexOf("\0"))throw Error("key "+t+" must not contain null bytes");if(!n){if("$"==t[0])throw Error("key "+t+" must not start with '$'");if(!!~t.indexOf("."))throw Error("key "+t+" must not contain '.'")}},BSON.prototype.deserialize=function(e,t){return BSON.deserialize(e,t)},BSON.prototype.deserializeStream=function(e,t,n,r,i,s){return BSON.deserializeStream(e,t,n,r,i,s)},BSON.prototype.serialize=function(e,t,n,r){return BSON.serialize(e,t,n,r)},BSON.prototype.calculateObjectSize=function(e,t){return BSON.calculateObjectSize(e,t)},BSON.prototype.serializeWithBufferAndIndex=function(e,t,n,r,i){return BSON.serializeWithBufferAndIndex(e,t,n,r,i)},exports.Code=Code,exports.Symbol=Symbol,exports.BSON=BSON,exports.DBRef=DBRef,exports.Binary=Binary,exports.ObjectID=ObjectID,exports.Long=Long,exports.Timestamp=Timestamp,exports.Double=Double,exports.MinKey=MinKey,exports.MaxKey=MaxKey},code:function(e,t,n,r,i){function s(e,t){if(!(this instanceof s))return new s(e,t);this._bsontype="Code",this.code=e,this.scope=t==null?{}:t}s.prototype.toJSON=function(){return{scope:this.scope,code:this.code}},t.Code=s},db_ref:function(e,t,n,r,i){function s(e,t,n){if(!(this instanceof s))return new s(e,t,n);this._bsontype="DBRef",this.namespace=e,this.oid=t,this.db=n}s.prototype.toJSON=function(){return{$ref:this.namespace,$id:this.oid,$db:this.db==null?"":this.db}},t.DBRef=s},"double":function(e,t,n,r,i){function s(e){if(!(this instanceof s))return new s(e);this._bsontype="Double",this.value=e}s.prototype.valueOf=function(){return this.value},s.prototype.toJSON=function(){return this.value},t.Double=s},float_parser:function(e,t,n,r,i){var s=function(e,t,n,r,i){var s,o,u=n==="big",a=i*8-r-1,f=(1<<a)-1,l=f>>1,c=-7,h=u?0:i-1,p=u?1:-1,d=e[t+h];h+=p,s=d&(1<<-c)-1,d>>=-c,c+=a;for(;c>0;s=s*256+e[t+h],h+=p,c-=8);o=s&(1<<-c)-1,s>>=-c,c+=r;for(;c>0;o=o*256+e[t+h],h+=p,c-=8);if(s===0)s=1-l;else{if(s===f)return o?NaN:(d?-1:1)*Infinity;o+=Math.pow(2,r),s-=l}return(d?-1:1)*o*Math.pow(2,s-r)},o=function(e,t,n,r,i,s){var o,u,a,f=r==="big",l=s*8-i-1,c=(1<<l)-1,h=c>>1,p=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,d=f?s-1:0,v=f?-1:1,m=t<0||t===0&&1/t<0?1:0;t=Math.abs(t),isNaN(t)||t===Infinity?(u=isNaN(t)?1:0,o=c):(o=Math.floor(Math.log(t)/Math.LN2),t*(a=Math.pow(2,-o))<1&&(o--,a*=2),o+h>=1?t+=p/a:t+=p*Math.pow(2,1-h),t*a>=2&&(o++,a/=2),o+h>=c?(u=0,o=c):o+h>=1?(u=(t*a-1)*Math.pow(2,i),o+=h):(u=t*Math.pow(2,h-1)*Math.pow(2,i),o=0));for(;i>=8;e[n+d]=u&255,d+=v,u/=256,i-=8);o=o<<i|u,l+=i;for(;l>0;e[n+d]=o&255,d+=v,o/=256,l-=8);e[n+d-v]|=m*128};t.readIEEE754=s,t.writeIEEE754=o},index:function(e,t,n,r,i){try{t.BSONPure=r("./bson"),t.BSONNative=r("../../ext")}catch(s){}["./binary_parser","./binary","./code","./db_ref","./double","./max_key","./min_key","./objectid","./symbol","./timestamp","./long"].forEach(function(e){var n=r("./"+e);for(var i in n)t[i]=n[i]}),t.native=function(){var e={};return["./binary_parser","./binary","./code","./db_ref","./double","./max_key","./min_key","./objectid","./symbol","./timestamp","./long","../../ext"].forEach(function(t){var n=r("./"+t);for(var i in n)e[i]=n[i]}),e},t.pure=function(){var e={};return["./binary_parser","./binary","./code","./db_ref","./double","./max_key","./min_key","./objectid","./symbol","./timestamp","./long","././bson"].forEach(function(t){var n=r("./"+t);for(var i in n)e[i]=n[i]}),e}},"long":function(e,t,n,r,i){function s(e,t){if(!(this instanceof s))return new s(e,t);this._bsontype="Long",this.low_=e|0,this.high_=t|0}s.prototype.toInt=function(){return this.low_},s.prototype.toNumber=function(){return this.high_*s.TWO_PWR_32_DBL_+this.getLowBitsUnsigned()},s.prototype.toJSON=function(){return this.toString()},s.prototype.toString=function(e){var t=e||10;if(t<2||36<t)throw Error("radix out of range: "+t);if(this.isZero())return"0";if(this.isNegative()){if(this.equals(s.MIN_VALUE)){var n=s.fromNumber(t),r=this.div(n),i=r.multiply(n).subtract(this);return r.toString(t)+i.toInt().toString(t)}return"-"+this.negate().toString(t)}var o=s.fromNumber(Math.pow(t,6)),i=this,u="";for(;;){var a=i.div(o),f=i.subtract(a.multiply(o)).toInt(),l=f.toString(t);i=a;if(i.isZero())return l+u;while(l.length<6)l="0"+l;u=""+l+u}},s.prototype.getHighBits=function(){return this.high_},s.prototype.getLowBits=function(){return this.low_},s.prototype.getLowBitsUnsigned=function(){return this.low_>=0?this.low_:s.TWO_PWR_32_DBL_+this.low_},s.prototype.getNumBitsAbs=function(){if(this.isNegative())return this.equals(s.MIN_VALUE)?64:this.negate().getNumBitsAbs();var e=this.high_!=0?this.high_:this.low_;for(var t=31;t>0;t--)if((e&1<<t)!=0)break;return this.high_!=0?t+33:t+1},s.prototype.isZero=function(){return this.high_==0&&this.low_==0},s.prototype.isNegative=function(){return this.high_<0},s.prototype.isOdd=function(){return(this.low_&1)==1},s.prototype.equals=function(e){return this.high_==e.high_&&this.low_==e.low_},s.prototype.notEquals=function(e){return this.high_!=e.high_||this.low_!=e.low_},s.prototype.lessThan=function(e){return this.compare(e)<0},s.prototype.lessThanOrEqual=function(e){return this.compare(e)<=0},s.prototype.greaterThan=function(e){return this.compare(e)>0},s.prototype.greaterThanOrEqual=function(e){return this.compare(e)>=0},s.prototype.compare=function(e){if(this.equals(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.subtract(e).isNegative()?-1:1},s.prototype.negate=function(){return this.equals(s.MIN_VALUE)?s.MIN_VALUE:this.not().add(s.ONE)},s.prototype.add=function(e){var t=this.high_>>>16,n=this.high_&65535,r=this.low_>>>16,i=this.low_&65535,o=e.high_>>>16,u=e.high_&65535,a=e.low_>>>16,f=e.low_&65535,l=0,c=0,h=0,p=0;return p+=i+f,h+=p>>>16,p&=65535,h+=r+a,c+=h>>>16,h&=65535,c+=n+u,l+=c>>>16,c&=65535,l+=t+o,l&=65535,s.fromBits(h<<16|p,l<<16|c)},s.prototype.subtract=function(e){return this.add(e.negate())},s.prototype.multiply=function(e){if(this.isZero())return s.ZERO;if(e.isZero())return s.ZERO;if(this.equals(s.MIN_VALUE))return e.isOdd()?s.MIN_VALUE:s.ZERO;if(e.equals(s.MIN_VALUE))return this.isOdd()?s.MIN_VALUE:s.ZERO;if(this.isNegative())return e.isNegative()?this.negate().multiply(e.negate()):this.negate().multiply(e).negate();if(e.isNegative())return this.multiply(e.negate()).negate();if(this.lessThan(s.TWO_PWR_24_)&&e.lessThan(s.TWO_PWR_24_))return s.fromNumber(this.toNumber()*e.toNumber());var t=this.high_>>>16,n=this.high_&65535,r=this.low_>>>16,i=this.low_&65535,o=e.high_>>>16,u=e.high_&65535,a=e.low_>>>16,f=e.low_&65535,l=0,c=0,h=0,p=0;return p+=i*f,h+=p>>>16,p&=65535,h+=r*f,c+=h>>>16,h&=65535,h+=i*a,c+=h>>>16,h&=65535,c+=n*f,l+=c>>>16,c&=65535,c+=r*a,l+=c>>>16,c&=65535,c+=i*u,l+=c>>>16,c&=65535,l+=t*f+n*a+r*u+i*o,l&=65535,s.fromBits(h<<16|p,l<<16|c)},s.prototype.div=function(e){if(e.isZero())throw Error("division by zero");if(this.isZero())return s.ZERO;if(this.equals(s.MIN_VALUE)){if(e.equals(s.ONE)||e.equals(s.NEG_ONE))return s.MIN_VALUE;if(e.equals(s.MIN_VALUE))return s.ONE;var t=this.shiftRight(1),n=t.div(e).shiftLeft(1);if(n.equals(s.ZERO))return e.isNegative()?s.ONE:s.NEG_ONE;var r=this.subtract(e.multiply(n)),i=n.add(r.div(e));return i}if(e.equals(s.MIN_VALUE))return s.ZERO;if(this.isNegative())return e.isNegative()?this.negate().div(e.negate()):this.negate().div(e).negate();if(e.isNegative())return this.div(e.negate()).negate();var o=s.ZERO,r=this;while(r.greaterThanOrEqual(e)){var n=Math.max(1,Math.floor(r.toNumber()/e.toNumber())),u=Math.ceil(Math.log(n)/Math.LN2),a=u<=48?1:Math.pow(2,u-48),f=s.fromNumber(n),l=f.multiply(e);while(l.isNegative()||l.greaterThan(r))n-=a,f=s.fromNumber(n),l=f.multiply(e);f.isZero()&&(f=s.ONE),o=o.add(f),r=r.subtract(l)}return o},s.prototype.modulo=function(e){return this.subtract(this.div(e).multiply(e))},s.prototype.not=function(){return s.fromBits(~this.low_,~this.high_)},s.prototype.and=function(e){return s.fromBits(this.low_&e.low_,this.high_&e.high_)},s.prototype.or=function(e){return s.fromBits(this.low_|e.low_,this.high_|e.high_)},s.prototype.xor=function(e){return s.fromBits(this.low_^e.low_,this.high_^e.high_)},s.prototype.shiftLeft=function(e){e&=63;if(e==0)return this;var t=this.low_;if(e<32){var n=this.high_;return s.fromBits(t<<e,n<<e|t>>>32-e)}return s.fromBits(0,t<<e-32)},s.prototype.shiftRight=function(e){e&=63;if(e==0)return this;var t=this.high_;if(e<32){var n=this.low_;return s.fromBits(n>>>e|t<<32-e,t>>e)}return s.fromBits(t>>e-32,t>=0?0:-1)},s.prototype.shiftRightUnsigned=function(e){e&=63;if(e==0)return this;var t=this.high_;if(e<32){var n=this.low_;return s.fromBits(n>>>e|t<<32-e,t>>>e)}return e==32?s.fromBits(t,0):s.fromBits(t>>>e-32,0)},s.fromInt=function(e){if(-128<=e&&e<128){var t=s.INT_CACHE_[e];if(t)return t}var n=new s(e|0,e<0?-1:0);return-128<=e&&e<128&&(s.INT_CACHE_[e]=n),n},s.fromNumber=function(e){return isNaN(e)||!isFinite(e)?s.ZERO:e<=-s.TWO_PWR_63_DBL_?s.MIN_VALUE:e+1>=s.TWO_PWR_63_DBL_?s.MAX_VALUE:e<0?s.fromNumber(-e).negate():new s(e%s.TWO_PWR_32_DBL_|0,e/s.TWO_PWR_32_DBL_|0)},s.fromBits=function(e,t){return new s(e,t)},s.fromString=function(e,t){if(e.length==0)throw Error("number format error: empty string");var n=t||10;if(n<2||36<n)throw Error("radix out of range: "+n);if(e.charAt(0)=="-")return s.fromString(e.substring(1),n).negate();if(e.indexOf("-")>=0)throw Error('number format error: interior "-" character: '+e);var r=s.fromNumber(Math.pow(n,8)),i=s.ZERO;for(var o=0;o<e.length;o+=8){var u=Math.min(8,e.length-o),a=parseInt(e.substring(o,o+u),n);if(u<8){var f=s.fromNumber(Math.pow(n,u));i=i.multiply(f).add(s.fromNumber(a))}else i=i.multiply(r),i=i.add(s.fromNumber(a))}return i},s.INT_CACHE_={},s.TWO_PWR_16_DBL_=65536,s.TWO_PWR_24_DBL_=1<<24,s.TWO_PWR_32_DBL_=s.TWO_PWR_16_DBL_*s.TWO_PWR_16_DBL_,s.TWO_PWR_31_DBL_=s.TWO_PWR_32_DBL_/2,s.TWO_PWR_48_DBL_=s.TWO_PWR_32_DBL_*s.TWO_PWR_16_DBL_,s.TWO_PWR_64_DBL_=s.TWO_PWR_32_DBL_*s.TWO_PWR_32_DBL_,s.TWO_PWR_63_DBL_=s.TWO_PWR_64_DBL_/2,s.ZERO=s.fromInt(0),s.ONE=s.fromInt(1),s.NEG_ONE=s.fromInt(-1),s.MAX_VALUE=s.fromBits(-1,2147483647),s.MIN_VALUE=s.fromBits(0,-2147483648),s.TWO_PWR_24_=s.fromInt(1<<24),t.Long=s},max_key:function(e,t,n,r,i){function s(){if(!(this instanceof s))return new s;this._bsontype="MaxKey"}t.MaxKey=s},min_key:function(e,t,n,r,i){function s(){if(!(this instanceof s))return new s;this._bsontype="MinKey"}t.MinKey=s},objectid:function(e,t,n,r,i){var s=r("./binary_parser").BinaryParser,o=parseInt(Math.random()*16777215,10),u=new RegExp("^[0-9a-fA-F]{24}$"),a=function l(e,t){if(!(this instanceof l))return new l(e,t);this._bsontype="ObjectID";var n=null;if(e!=null&&"number"!=typeof e&&e.length!=12&&e.length!=24)throw new Error("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters");if(e==null||typeof e=="number")this.id=this.generate(e);else{if(e==null||e.length!==12){if(u.test(e))return l.createFromHexString(e);throw new Error("Value passed in is not a valid 24 character hex string")}this.id=e}l.cacheHexString&&(this.__id=this.toHexString())},f=a;a.prototype.toHexString=function(){if(a.cacheHexString&&this.__id)return this.__id;var e="",t,n;for(var r=0,i=this.id.length;r<i;r++)n=s.toByte(this.id[r]),t=n<=15?"0"+n.toString(16):n.toString(16),e+=t;return a.cacheHexString&&(this.__id=e),e},a.prototype.get_inc=function(){return a.index=(a.index+1)%16777215},a.prototype.getInc=function(){return this.get_inc()},a.prototype.generate=function(e){if("number"==typeof e)var t=s.encodeInt(e,32,!0,!0),n=s.encodeInt(o,24,!1),r=s.fromShort(typeof process=="undefined"?Math.floor(Math.random()*1e5):process.pid),i=s.encodeInt(this.get_inc(),24,!1,!0);else var u=parseInt(Date.now()/1e3,10),t=s.encodeInt(u,32,!0,!0),n=s.encodeInt(o,24,!1),r=s.fromShort(typeof process=="undefined"?Math.floor(Math.random()*1e5):process.pid),i=s.encodeInt(this.get_inc(),24,!1,!0);return t+n+r+i},a.prototype.toString=function(){return this.toHexString()},a.prototype.inspect=a.prototype.toString,a.prototype.toJSON=function(){return this.toHexString()},a.prototype.equals=function(t){var n=t instanceof a||t.toHexString?t.id:a.createFromHexString(t).id;return this.id===n},a.prototype.getTimestamp=function(){var e=new Date;return e.setTime(Math.floor(s.decodeInt(this.id.substring(0,4),32,!0,!0))*1e3),e},a.index=0,a.createPk=function(){return new a},a.createFromTime=function(t){var n=s.encodeInt(t,32,!0,!0)+s.encodeInt(0,64,!0,!0);return new a(n)},a.createFromHexString=function(t){if(typeof t=="undefined"||t!=null&&t.length!=24)throw new Error("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters");var n=t.length;if(n>24)throw new Error("Id cannot be longer than 12 bytes");var r="",i,o;for(var u=0;u<n;u+=2)i=t.substr(u,2),o=parseInt(i,16),r+=s.fromByte(o);return new a(r,t)},Object.defineProperty(a.prototype,"generationTime",{enumerable:!0,get:function(){return Math.floor(s.decodeInt(this.id.substring(0,4),32,!0,!0))},set:function(e){var e=s.encodeInt(e,32,!0,!0);this.id=e+this.id.substr(4),this.toHexString()}}),t.ObjectID=a,t.ObjectId=a},symbol:function(e,t,n,r,i){function s(e){if(!(this instanceof s))return new s(e);this._bsontype="Symbol",this.value=e}s.prototype.valueOf=function(){return this.value},s.prototype.toString=function(){return this.value},s.prototype.inspect=function(){return this.value},s.prototype.toJSON=function(){return this.value},t.Symbol=s},timestamp:function(e,t,n,r,i){function s(e,t){if(!(this instanceof s))return new s(e,t);this._bsontype="Timestamp",this.low_=e|0,this.high_=t|0}s.prototype.toInt=function(){return this.low_},s.prototype.toNumber=function(){return this.high_*s.TWO_PWR_32_DBL_+this.getLowBitsUnsigned()},s.prototype.toJSON=function(){return this.toString()},s.prototype.toString=function(e){var t=e||10;if(t<2||36<t)throw Error("radix out of range: "+t);if(this.isZero())return"0";if(this.isNegative()){if(this.equals(s.MIN_VALUE)){var n=s.fromNumber(t),r=this.div(n),i=r.multiply(n).subtract(this);return r.toString(t)+i.toInt().toString(t)}return"-"+this.negate().toString(t)}var o=s.fromNumber(Math.pow(t,6)),i=this,u="";for(;;){var a=i.div(o),f=i.subtract(a.multiply(o)).toInt(),l=f.toString(t);i=a;if(i.isZero())return l+u;while(l.length<6)l="0"+l;u=""+l+u}},s.prototype.getHighBits=function(){return this.high_},s.prototype.getLowBits=function(){return this.low_},s.prototype.getLowBitsUnsigned=function(){return this.low_>=0?this.low_:s.TWO_PWR_32_DBL_+this.low_},s.prototype.getNumBitsAbs=function(){if(this.isNegative())return this.equals(s.MIN_VALUE)?64:this.negate().getNumBitsAbs();var e=this.high_!=0?this.high_:this.low_;for(var t=31;t>0;t--)if((e&1<<t)!=0)break;return this.high_!=0?t+33:t+1},s.prototype.isZero=function(){return this.high_==0&&this.low_==0},s.prototype.isNegative=function(){return this.high_<0},s.prototype.isOdd=function(){return(this.low_&1)==1},s.prototype.equals=function(e){return this.high_==e.high_&&this.low_==e.low_},s.prototype.notEquals=function(e){return this.high_!=e.high_||this.low_!=e.low_},s.prototype.lessThan=function(e){return this.compare(e)<0},s.prototype.lessThanOrEqual=function(e){return this.compare(e)<=0},s.prototype.greaterThan=function(e){return this.compare(e)>0},s.prototype.greaterThanOrEqual=function(e){return this.compare(e)>=0},s.prototype.compare=function(e){if(this.equals(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.subtract(e).isNegative()?-1:1},s.prototype.negate=function(){return this.equals(s.MIN_VALUE)?s.MIN_VALUE:this.not().add(s.ONE)},s.prototype.add=function(e){var t=this.high_>>>16,n=this.high_&65535,r=this.low_>>>16,i=this.low_&65535,o=e.high_>>>16,u=e.high_&65535,a=e.low_>>>16,f=e.low_&65535,l=0,c=0,h=0,p=0;return p+=i+f,h+=p>>>16,p&=65535,h+=r+a,c+=h>>>16,h&=65535,c+=n+u,l+=c>>>16,c&=65535,l+=t+o,l&=65535,s.fromBits(h<<16|p,l<<16|c)},s.prototype.subtract=function(e){return this.add(e.negate())},s.prototype.multiply=function(e){if(this.isZero())return s.ZERO;if(e.isZero())return s.ZERO;if(this.equals(s.MIN_VALUE))return e.isOdd()?s.MIN_VALUE:s.ZERO;if(e.equals(s.MIN_VALUE))return this.isOdd()?s.MIN_VALUE:s.ZERO;if(this.isNegative())return e.isNegative()?this.negate().multiply(e.negate()):this.negate().multiply(e).negate();if(e.isNegative())return this.multiply(e.negate()).negate();if(this.lessThan(s.TWO_PWR_24_)&&e.lessThan(s.TWO_PWR_24_))return s.fromNumber(this.toNumber()*e.toNumber());var t=this.high_>>>16,n=this.high_&65535,r=this.low_>>>16,i=this.low_&65535,o=e.high_>>>16,u=e.high_&65535,a=e.low_>>>16,f=e.low_&65535,l=0,c=0,h=0,p=0;return p+=i*f,h+=p>>>16,p&=65535,h+=r*f,c+=h>>>16,h&=65535,h+=i*a,c+=h>>>16,h&=65535,c+=n*f,l+=c>>>16,c&=65535,c+=r*a,l+=c>>>16,c&=65535,c+=i*u,l+=c>>>16,c&=65535,l+=t*f+n*a+r*u+i*o,l&=65535,s.fromBits(h<<16|p,l<<16|c)},s.prototype.div=function(e){if(e.isZero())throw Error("division by zero");if(this.isZero())return s.ZERO;if(this.equals(s.MIN_VALUE)){if(e.equals(s.ONE)||e.equals(s.NEG_ONE))return s.MIN_VALUE;if(e.equals(s.MIN_VALUE))return s.ONE;var t=this.shiftRight(1),n=t.div(e).shiftLeft(1);if(n.equals(s.ZERO))return e.isNegative()?s.ONE:s.NEG_ONE;var r=this.subtract(e.multiply(n)),i=n.add(r.div(e));return i}if(e.equals(s.MIN_VALUE))return s.ZERO;if(this.isNegative())return e.isNegative()?this.negate().div(e.negate()):this.negate().div(e).negate();if(e.isNegative())return this.div(e.negate()).negate();var o=s.ZERO,r=this;while(r.greaterThanOrEqual(e)){var n=Math.max(1,Math.floor(r.toNumber()/e.toNumber())),u=Math.ceil(Math.log(n)/Math.LN2),a=u<=48?1:Math.pow(2,u-48),f=s.fromNumber(n),l=f.multiply(e);while(l.isNegative()||l.greaterThan(r))n-=a,f=s.fromNumber(n),l=f.multiply(e);f.isZero()&&(f=s.ONE),o=o.add(f),r=r.subtract(l)}return o},s.prototype.modulo=function(e){return this.subtract(this.div(e).multiply(e))},s.prototype.not=function(){return s.fromBits(~this.low_,~this.high_)},s.prototype.and=function(e){return s.fromBits(this.low_&e.low_,this.high_&e.high_)},s.prototype.or=function(e){return s.fromBits(this.low_|e.low_,this.high_|e.high_)},s.prototype.xor=function(e){return s.fromBits(this.low_^e.low_,this.high_^e.high_)},s.prototype.shiftLeft=function(e){e&=63;if(e==0)return this;var t=this.low_;if(e<32){var n=this.high_;return s.fromBits(t<<e,n<<e|t>>>32-e)}return s.fromBits(0,t<<e-32)},s.prototype.shiftRight=function(e){e&=63;if(e==0)return this;var t=this.high_;if(e<32){var n=this.low_;return s.fromBits(n>>>e|t<<32-e,t>>e)}return s.fromBits(t>>e-32,t>=0?0:-1)},s.prototype.shiftRightUnsigned=function(e){e&=63;if(e==0)return this;var t=this.high_;if(e<32){var n=this.low_;return s.fromBits(n>>>e|t<<32-e,t>>>e)}return e==32?s.fromBits(t,0):s.fromBits(t>>>e-32,0)},s.fromInt=function(e){if(-128<=e&&e<128){var t=s.INT_CACHE_[e];if(t)return t}var n=new s(e|0,e<0?-1:0);return-128<=e&&e<128&&(s.INT_CACHE_[e]=n),n},s.fromNumber=function(e){return isNaN(e)||!isFinite(e)?s.ZERO:e<=-s.TWO_PWR_63_DBL_?s.MIN_VALUE:e+1>=s.TWO_PWR_63_DBL_?s.MAX_VALUE:e<0?s.fromNumber(-e).negate():new s(e%s.TWO_PWR_32_DBL_|0,e/s.TWO_PWR_32_DBL_|0)},s.fromBits=function(e,t){return new s(e,t)},s.fromString=function(e,t){if(e.length==0)throw Error("number format error: empty string");var n=t||10;if(n<2||36<n)throw Error("radix out of range: "+n);if(e.charAt(0)=="-")return s.fromString(e.substring(1),n).negate();if(e.indexOf("-")>=0)throw Error('number format error: interior "-" character: '+e);var r=s.fromNumber(Math.pow(n,8)),i=s.ZERO;for(var o=0;o<e.length;o+=8){var u=Math.min(8,e.length-o),a=parseInt(e.substring(o,o+u),n);if(u<8){var f=s.fromNumber(Math.pow(n,u));i=i.multiply(f).add(s.fromNumber(a))}else i=i.multiply(r),i=i.add(s.fromNumber(a))}return i},s.INT_CACHE_={},s.TWO_PWR_16_DBL_=65536,s.TWO_PWR_24_DBL_=1<<24,s.TWO_PWR_32_DBL_=s.TWO_PWR_16_DBL_*s.TWO_PWR_16_DBL_,s.TWO_PWR_31_DBL_=s.TWO_PWR_32_DBL_/2,s.TWO_PWR_48_DBL_=s.TWO_PWR_32_DBL_*s.TWO_PWR_16_DBL_,s.TWO_PWR_64_DBL_=s.TWO_PWR_32_DBL_*s.TWO_PWR_32_DBL_,s.TWO_PWR_63_DBL_=s.TWO_PWR_64_DBL_/2,s.ZERO=s.fromInt(0),s.ONE=s.fromInt(1),s.NEG_ONE=s.fromInt(-1),s.MAX_VALUE=s.fromBits(-1,2147483647),s.MIN_VALUE=s.fromBits(0,-2147483648),s.TWO_PWR_24_=s.fromInt(1<<24),t.Timestamp=s}}),typeof module!="undefined"&&module.exports&&(module.exports=bson,module.parent||bson()),typeof window!="undefined"&&typeof require=="undefined"&&(window.require=bson.require);