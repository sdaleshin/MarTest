function options(e){var t=/;/.test(e)?";":"&",n=qs.parse(e,t);return Object.keys(n).forEach(function(e){var t=n[e];"readPreferenceTags"==e?(t=readPref(t),t&&(n[e]=Array.isArray(t)?t:[t])):n[e]=format(t)}),n}function format(e){var t;return"true"==e?!0:"false"==e?!1:(t=parseInt(e,10),isNaN(t)?e:t)}function readPref(e){var t;if(Array.isArray(e))return t=e.map(readPref).filter(Boolean),t.length?t:undefined;var n=e.split(","),r;return t={},n.forEach(function(e){e=(e||"").trim();if(!e)return;r=!0;var n=e.split(":");t[n[0]]=format(n[1])}),r&&t}function parse(e){var t=e,n={},r,i,s;return t=t.replace(/^mongodb:\/\//,""),/@/.test(t)&&(r=t.split(/@/),i=r[0],t=r[1],r=i.split(":"),n.auth={},n.auth.user=r[0],n.auth.pass=r[1]),ipcRgx.test(t)?(s=t.split(ipcRgx),n.ipc=s[0]+".sock",s[1]&&(s[1]=s[1].replace(/^\//,""),s[1]&&(n.db=s[1])),n):(r=t.split("/"),r[1]&&(n.db=r[1]),r=r[0].split(":"),n.host=r[0],n.port=r[1]||DEFAULT_PORT,n)}var qs=require("querystring");const DEFAULT_PORT=27017,DEFAULT_DB="test",ADMIN_DB="admin";module.exports=exports=function(t){if(!/^mongodb:\/\//.test(t))throw new Error('Invalid mongodb uri. Must begin with "mongodb://"\n  Received: '+t);var n={hosts:[],db:DEFAULT_DB,options:{}},r=/^mongodb:\/\/([^?]+)(\??.*)$/.exec(t);if(!r||"/"==r[1])throw new Error("Invalid mongodb uri. Missing hostname");var i=r[1],s=r[2],o;i.split(",").forEach(function(e){var t=parse(e);t.host?(n.hosts.push({host:t.host,port:parseInt(t.port,10)}),!o&&t.db&&(o=t.db)):t.ipc&&n.hosts.push({ipc:t.ipc}),t.auth&&(n.auth={user:t.auth.user,pass:t.auth.pass})});if(!n.hosts.length)throw new Error("Invalid mongodb uri. Missing hostname");var u=s.split("?");return o||(u[0]?o=u[0].replace(/^\//,""):(o=/\/([^\.]+)$/.exec(r[1]),o&&o[1]&&(o=o[1]))),o?n.db=o:n.auth&&(n.db=ADMIN_DB),u[1]&&(n.options=options(u[1])),n};var ipcRgx=/\.sock/;module.exports.version=JSON.parse(require("fs").readFileSync(__dirname+"/../package.json","utf8")).version;