/*!
 * socket.io-node
 * Copyright(c) 2011 LearnBoost <dev@learnboost.com>
 * MIT Licensed
 */

function JSONPPolling(e,t,n){HTTPPolling.call(this,e,t,n),this.head="io.j[0](",this.foot=");",t.query.i&&jsonpolling_re.test(t.query.i)&&(this.head="io.j["+t.query.i+"](")}var HTTPPolling=require("./http-polling"),jsonpolling_re=/^\d+$/;exports=module.exports=JSONPPolling,JSONPPolling.prototype.__proto__=HTTPPolling.prototype,JSONPPolling.prototype.name="jsonppolling",JSONPPolling.prototype.postEncoded=!0,JSONPPolling.prototype.onData=function(e){try{e=JSON.parse(e)}catch(t){this.error("parse","reconnect");return}HTTPPolling.prototype.onData.call(this,e)},JSONPPolling.prototype.doWrite=function(e){HTTPPolling.prototype.doWrite.call(this);var e=e===undefined?"":this.head+JSON.stringify(e)+this.foot;this.response.writeHead(200,{"Content-Type":"text/javascript; charset=UTF-8","Content-Length":Buffer.byteLength(e),Connection:"Keep-Alive","X-XSS-Protection":"0"}),this.response.write(e),this.log.debug(this.name+" writing",e)};