/*!
 * socket.io-node
 * Copyright(c) 2011 LearnBoost <dev@learnboost.com>
 * MIT Licensed
 */

function FlashSocket(e,t,n){return WebSocket.call(this,e,t,n)}var WebSocket=require("./websocket");exports=module.exports=FlashSocket,FlashSocket.prototype.__proto__=WebSocket.prototype,FlashSocket.prototype.name="flashsocket",FlashSocket.init=function(e){function n(){if(!e.get("flash policy server"))return;t=require("policyfile").createServer({log:function(t){e.log.info(t)}},e.get("origins")),t.on("close",function(e){t=null}),t.listen(e.get("flash policy port"),e.server),e.flashPolicyServer=t}var t;e.on("set:origins",function(e,n){if(!t)return;t.origins=Array.isArray(e)?e:[e],t.compile()}),e.on("set:flash policy port",function(r,i){var s=e.get("transports");if(~s.indexOf("flashsocket")){if(t){if(t.port===r)return;try{t.close()}catch(o){}}n()}}),e.on("set:flash policy server",function(r,i){var s=e.get("transports");if(~s.indexOf("flashsocket")){if(t&&!r)try{t.close()}catch(o){}}else!t&&r&&n()}),e.on("set:transports",function(r,i){!t&&~e.get("transports").indexOf("flashsocket")&&n()}),~e.get("transports").indexOf("flashsocket")&&n()};