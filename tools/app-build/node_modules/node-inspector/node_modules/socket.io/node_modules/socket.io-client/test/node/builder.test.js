/*!
 * socket.io-node
 * Copyright(c) 2011 LearnBoost <dev@learnboost.com>
 * MIT Licensed
 */

var builder=require("../../bin/builder"),common=require("./builder.common"),should=require("should");module.exports={"version number":function(){builder.version.should().match(/([0-9]+)\.([0-9]+)\.([0-9]+)/),builder.version.should().equal(require("../../lib/io").version)},"production build LOC":function(){builder(function(e,t){should.strictEqual(e,null);var n=t.split("\n");n.length.should().be.below(5),n[0].should().match(/production/gi),Buffer.byteLength(t).should().be.below(43e3)})},"development build LOC":function(){builder({minify:!1},function(e,t){should.strictEqual(e,null);var n=t.split("\n");n.length.should().be.above(5),n[0].should().match(/development/gi),Buffer.byteLength(t).should().be.above(35e3)})},"default builds":function(){builder(function(e,t){should.strictEqual(e,null);var n=common.execute(t).io,r=Object.keys(n.Transport),i=Object.keys(builder.transports);r.length.should().be.equal(i.length+1),i.forEach(function(e){r.indexOf(e).should().be.above(-1)})})},"custom build":function(){builder(["websocket"],function(e,t){should.strictEqual(e,null);var n=common.execute(t).io,r=Object.keys(n.Transport);r.should().have.length(1),r[0].should().eql("websocket")})},"custom code":function(){var e='var hello = "world";';builder({custom:[e],minify:!1},function(t,n){should.strictEqual(t,null),n.should().include.string(e)})},"node if":function(){var e='// if node \nvar hello = "world";\n// end node\nvar pew = "pew";';builder({custom:[e],minify:!1},function(t,n){should.strictEqual(t,null),n.should().not.include.string(e),n.should().not.include.string("// if node"),n.should().not.include.string("// end node"),n.should().not.include.string('"world"'),n.should().include.string('var pew = "pew"')})},"preserve the encoding during minification":function(){builder(function(e,t){should.strictEqual(e,null),t.should().match(/(\\ufffd)/g)})},globals:function(){builder(function(e,t){should.strictEqual(e,null);var n=common.execute(t),r=common.env(),i=["io","swfobject","WEB_SOCKET_DISABLE_AUTO_INITIALIZATION"];Array.prototype.push.apply(i,Object.keys(r)),Object.keys(n).forEach(function(e){var t=i.indexOf(e);if(!~t)throw new Error("Global leak: "+e)})})}};