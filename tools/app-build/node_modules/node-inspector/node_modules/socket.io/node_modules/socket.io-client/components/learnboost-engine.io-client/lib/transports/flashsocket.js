function FlashWS(e){WS.call(this,e),this.flashPath=e.flashPath,this.policyPort=e.policyPort}function create(e,t){if(scripts[e])return t();var n=document.createElement("script"),r=!1;debug('loading "%s"',e),n.onload=n.onreadystatechange=function(){if(r||scripts[e])return;var i=n.readyState;if(!i||"loaded"==i||"complete"==i)debug('loaded "%s"',e),n.onload=n.onreadystatechange=null,r=!0,scripts[e]=!0,t()},n.async=1,n.src=e;var i=document.getElementsByTagName("head")[0];i.insertBefore(n,i.firstChild)}function load(e,t){function n(r){if(!e[r])return t();create(e[r],function(){n(++r)})}n(0)}var WS=require("./websocket"),util=require("../util"),debug=require("debug")("engine.io-client:flashsocket");module.exports=FlashWS;var xobject=global[["Active"].concat("Object").join("X")];util.inherits(FlashWS,WS),FlashWS.prototype.name="flashsocket",FlashWS.prototype.doOpen=function(){function e(e){return function(){var t=Array.prototype.join.call(arguments," ");debug("[websocketjs %s] %s",e,t)}}if(!this.check())return;WEB_SOCKET_LOGGER={log:e("debug"),error:e("error")},WEB_SOCKET_SUPPRESS_CROSS_DOMAIN_SWF_ERROR=!0,WEB_SOCKET_DISABLE_AUTO_INITIALIZATION=!0,"undefined"==typeof WEB_SOCKET_SWF_LOCATION&&(WEB_SOCKET_SWF_LOCATION=this.flashPath+"WebSocketMainInsecure.swf");var t=[this.flashPath+"web_socket.js"];"undefined"==typeof swfobject&&t.unshift(this.flashPath+"swfobject.js");var n=this;load(t,function(){n.ready(function(){WebSocket.__addTask(function(){WS.prototype.doOpen.call(n)})})})},FlashWS.prototype.doClose=function(){if(!this.socket)return;var e=this;WebSocket.__addTask(function(){WS.prototype.doClose.call(e)})},FlashWS.prototype.write=function(){var e=this,t=arguments;WebSocket.__addTask(function(){WS.prototype.write.apply(e,t)})},FlashWS.prototype.ready=function(e){function t(){FlashWS.loaded||(843!=n.policyPort&&WebSocket.loadFlashPolicyFile("xmlsocket://"+n.host+":"+n.policyPort),WebSocket.__initialize(),FlashWS.loaded=!0),e.call(n)}if(!(typeof WebSocket!="undefined"&&"__initialize"in WebSocket)||!swfobject)return;if(swfobject.getFlashPlayerVersion().major<10)return;var n=this;if(document.body)return t();util.load(t)},FlashWS.prototype.check=function(){if("undefined"!=typeof process)return!1;if(typeof WebSocket=="undefined"||"__initialize"in WebSocket){if(xobject){var e=null;try{e=new xobject("ShockwaveFlash.ShockwaveFlash")}catch(t){}if(e)return!0}else for(var n=0,r=navigator.plugins.length;n<r;n++)for(var i=0,s=navigator.plugins[n].length;i<s;i++)if(navigator.plugins[n][i].description=="Shockwave Flash")return!0;return!1}return!1};var scripts={};