function Polling(e){Transport.call(this,e)}var Transport=require("../transport"),util=require("../util"),parser=require("../parser"),debug=require("debug")("engine.io-client:polling");module.exports=Polling;var global="undefined"!=typeof window?window:global;util.inherits(Polling,Transport),Polling.prototype.name="polling",Polling.prototype.doOpen=function(){this.poll()},Polling.prototype.pause=function(e){function r(){debug("paused"),n.readyState="paused",e()}var t=0,n=this;this.readyState="pausing";if(this.polling||!this.writable){var i=0;this.polling&&(debug("we are currently polling - waiting to pause"),i++,this.once("pollComplete",function(){debug("pre-pause polling complete"),--i||r()})),this.writable||(debug("we are currently writing - waiting to pause"),i++,this.once("drain",function(){debug("pre-pause writing complete"),--i||r()}))}else r()},Polling.prototype.poll=function(){debug("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},Polling.prototype.onData=function(e){debug("polling got data %s",e);var t=parser.decodePayload(e);for(var n=0,r=t.length;n<r;n++){"opening"==this.readyState&&this.onOpen();if("close"==t[n].type){this.onClose();return}this.onPacket(t[n])}this.polling=!1,this.emit("pollComplete"),"open"==this.readyState?this.poll():debug('ignoring poll - transport state "%s"',this.readyState)},Polling.prototype.doClose=function(){debug("sending close packet"),this.send([{type:"close"}])},Polling.prototype.write=function(e){var t=this;this.writable=!1,this.doWrite(parser.encodePayload(e),function(){t.writable=!0,t.emit("drain")})},Polling.prototype.uri=function(){var e=this.query||{},t=this.secure?"https":"http",n="";if(global.ActiveXObject||util.ua.android||util.ua.ios6||this.timestampRequests)e[this.timestampParam]=+(new Date);return e=util.qs(e),this.port&&("https"==t&&this.port!=443||"http"==t&&this.port!=80)&&(n=":"+this.port),e.length&&(e="?"+e),t+"://"+this.host+n+this.path+e};