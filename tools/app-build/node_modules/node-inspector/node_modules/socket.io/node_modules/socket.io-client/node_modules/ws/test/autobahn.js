function nextTest(){if(currentTest>testCount||lastTest!=-1&&currentTest>lastTest){console.log("Updating reports and shutting down");var e=new WebSocket("ws://localhost:9001/updateReports?agent=ws");e.on("close",function(){process.exit()});return}console.log("Running test case "+currentTest+"/"+testCount);var e=new WebSocket("ws://localhost:9001/runCase?case="+currentTest+"&agent=ws");e.on("message",function(t,n){e.send(n.buffer,{binary:n.binary===!0,mask:!0})}),e.on("close",function(e){currentTest+=1,process.nextTick(nextTest)}),e.on("error",function(e){})}var WebSocket=require("../"),currentTest=1,lastTest=-1,testCount=null;process.on("uncaughtException",function(e){console.log("Caught exception: ",e,e.stack)}),process.on("SIGINT",function(){try{console.log("Updating reports and shutting down");var e=new WebSocket("ws://localhost:9001/updateReports?agent=ws");e.on("close",function(){process.exit()})}catch(t){process.exit()}});var ws=new WebSocket("ws://localhost:9001/getCaseCount");ws.on("message",function(e,t){testCount=parseInt(e)}),ws.on("close",function(){testCount>0&&nextTest()});