var assert=require("assert"),expect=require("expect.js"),Receiver=require("../lib/Receiver.hixie");require("./hybi-common"),describe("Receiver",function(){it("can parse text message",function(){var e=new Receiver,t="00 48 65 6c 6c 6f ff",n=!1;e.ontext=function(e){n=!0,assert.equal("Hello",e)},e.add(getBufferFromHexString(t)),expect(n).to.equal(!0)}),it("can parse multiple text messages",function(){var e=new Receiver,t="00 48 65 6c 6c 6f ff 00 48 65 6c 6c 6f ff",n=!1,r=[];e.ontext=function(e){n=!0,r.push(e)},e.add(getBufferFromHexString(t)),expect(n).to.equal(!0);for(var i=0;i<2;++i)expect(r[i]).to.equal("Hello")}),it("can parse empty message",function(){var e=new Receiver,t="00 ff",n=!1;e.ontext=function(e){n=!0,assert.equal("",e)},e.add(getBufferFromHexString(t)),expect(n).to.equal(!0)}),it("can parse text messages delivered over multiple frames",function(){var e=new Receiver,t=["00 48","65 6c 6c","6f ff 00 48","65","6c 6c 6f","ff"],n=!1,r=[];e.ontext=function(e){n=!0,r.push(e)};for(var i=0;i<t.length;++i)e.add(getBufferFromHexString(t[i]));expect(n).to.equal(!0);for(var i=0;i<2;++i)expect(r[i]).to.equal("Hello")}),it("emits an error if a payload doesnt start with 0x00",function(){var e=new Receiver,t=["00 6c ff","00 6c ff ff","ff 00 6c ff 00 6c ff","00","6c 6c 6f","ff"],n=!1,r=!1,i=[];e.ontext=function(e){n=!0,i.push(e)},e.onerror=function(e,t){r=t==1};for(var s=0;s<t.length&&!r;++s)e.add(getBufferFromHexString(t[s]));expect(r).to.equal(!0),expect(i[0]).to.equal("l"),expect(i[1]).to.equal("l"),expect(i.length).to.equal(2)}),it("can parse close messages",function(){var e=new Receiver,t=["ff 00"],n=!1,r=!1;e.onclose=function(){n=!0},e.onerror=function(e,t){r=t==1};for(var i=0;i<t.length&&!r;++i)e.add(getBufferFromHexString(t[i]));expect(n).to.equal(!0),expect(r).to.equal(!1)}),it("can parse binary messages delivered over multiple frames",function(){var e=new Receiver,t=["80 05 48","65 6c 6c","6f 80 80 05 48","65","6c 6c 6f"],n=!1,r=[];e.ontext=function(e){n=!0,r.push(e)};for(var i=0;i<t.length;++i)e.add(getBufferFromHexString(t[i]));expect(n).to.equal(!0);for(var i=0;i<2;++i)expect(r[i]).to.equal("Hello")})});