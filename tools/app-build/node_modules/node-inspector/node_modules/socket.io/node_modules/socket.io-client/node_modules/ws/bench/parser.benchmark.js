/*!
 * ws: a node.js websocket client
 * Copyright(c) 2011 Einar Otto Stangvik <einaros@gmail.com>
 * MIT Licensed
 */

var benchmark=require("benchmark"),Receiver=require("../").Receiver,suite=new benchmark.Suite("Receiver");require("tinycolor"),require("./util"),suite.on("start",function(){receiver=new Receiver}),suite.on("cycle",function(){receiver=new Receiver});var pingMessage="Hello",pingPacket1=getBufferFromHexString("89 "+pack(2,128|pingMessage.length)+" 34 83 a8 68 "+getHexStringFromBuffer(mask(pingMessage,"34 83 a8 68")));suite.add("ping message",function(){receiver.add(pingPacket1)});var pingPacket2=getBufferFromHexString("89 00");suite.add("ping with no data",function(){receiver.add(pingPacket2)});var closePacket=getBufferFromHexString("88 00");suite.add("close message",function(){receiver.add(closePacket),receiver.endPacket()});var maskedTextPacket=getBufferFromHexString("81 93 34 83 a8 68 01 b9 92 52 4f a1 c6 09 59 e6 8a 52 16 e6 cb 00 5b a1 d5");suite.add("masked text message",function(){receiver.add(maskedTextPacket)}),binaryDataPacket=function(){var e=125,t=new Buffer(e);for(var n=0;n<e;++n)t[n]=n%10;return getBufferFromHexString("82 "+getHybiLengthAsHexString(e,!0)+" 34 83 a8 68 "+getHexStringFromBuffer(mask(t),"34 83 a8 68"))}(),suite.add("binary data (125 bytes)",function(){try{receiver.add(binaryDataPacket)}catch(e){console.log(e)}}),binaryDataPacket2=function(){var e=65535,t=new Buffer(e);for(var n=0;n<e;++n)t[n]=n%10;return getBufferFromHexString("82 "+getHybiLengthAsHexString(e,!0)+" 34 83 a8 68 "+getHexStringFromBuffer(mask(t),"34 83 a8 68"))}(),suite.add("binary data (65535 bytes)",function(){receiver.add(binaryDataPacket2)}),binaryDataPacket3=function(){var e=204800,t=new Buffer(e);for(var n=0;n<e;++n)t[n]=n%10;return getBufferFromHexString("82 "+getHybiLengthAsHexString(e,!0)+" 34 83 a8 68 "+getHexStringFromBuffer(mask(t),"34 83 a8 68"))}(),suite.add("binary data (200 kB)",function(){receiver.add(binaryDataPacket3)}),suite.on("cycle",function(e,t){console.log("\n  "+suite.name.grey,t.name.white.bold),console.log("  "+[t.hz.toFixed(2).cyan+" ops/sec".grey,t.count.toString().white+" times executed".grey,"benchmark took ".grey+t.times.elapsed.toString().white+" sec.".grey].join(", ".grey))}),module.parent?module.exports=suite:suite.run();