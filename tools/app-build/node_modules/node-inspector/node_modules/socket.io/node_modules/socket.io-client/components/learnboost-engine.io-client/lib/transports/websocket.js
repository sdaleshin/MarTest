function WS(e){Transport.call(this,e)}function ws(){return"undefined"!=typeof process?require("ws"):global.WebSocket||global.MozWebSocket}var Transport=require("../transport"),parser=require("../parser"),util=require("../util"),debug=require("debug")("engine.io-client:websocket");module.exports=WS;var global="undefined"!=typeof window?window:global;util.inherits(WS,Transport),WS.prototype.name="websocket",WS.prototype.doOpen=function(){if(!this.check())return;var e=this;this.socket=new(ws())(this.uri()),this.socket.onopen=function(){e.onOpen()},this.socket.onclose=function(){e.onClose()},this.socket.onmessage=function(t){e.onData(t.data)},this.socket.onerror=function(t){e.onError("websocket error",t)}},WS.prototype.write=function(e){for(var t=0,n=e.length;t<n;t++)this.socket.send(parser.encodePacket(e[t]))},WS.prototype.doClose=function(){typeof this.socket!="undefined"&&this.socket.close()},WS.prototype.uri=function(){var e=this.query||{},t=this.secure?"wss":"ws",n="";return this.port&&("wss"==t&&this.port!=443||"ws"==t&&this.port!=80)&&(n=":"+this.port),this.timestampRequests&&(e[this.timestampParam]=+(new Date)),e=util.qs(e),e.length&&(e="?"+e),t+"://"+this.host+n+this.path+e},WS.prototype.check=function(){var e=ws();return!!e&&!("__initialize"in e&&this.name===WS.prototype.name)};