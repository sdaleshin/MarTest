/*!
 * base64id v0.1.0
 */

var crypto=require("crypto"),Base64Id=function(){};Base64Id.prototype.getRandomBytes=function(e){var t=4096,n=this;e=e||12;if(e>t)return crypto.randomBytes(e);var r=parseInt(t/e),i=parseInt(r*.85);if(!i)return crypto.randomBytes(e);this.bytesBufferIndex==null&&(this.bytesBufferIndex=-1),this.bytesBufferIndex==r&&(this.bytesBuffer=null,this.bytesBufferIndex=-1);if(this.bytesBufferIndex==-1||this.bytesBufferIndex>i){this.isGeneratingBytes||(this.isGeneratingBytes=!0,crypto.randomBytes(t,function(e,t){n.bytesBuffer=t,n.bytesBufferIndex=0,n.isGeneratingBytes=!1}));if(this.bytesBufferIndex==-1)return crypto.randomBytes(e)}var s=this.bytesBuffer.slice(e*this.bytesBufferIndex,e*(this.bytesBufferIndex+1));return this.bytesBufferIndex++,s},Base64Id.prototype.generateId=function(){var e=new Buffer(15);return e.writeInt32BE?(this.sequenceNumber=this.sequenceNumber+1|0,e.writeInt32BE(this.sequenceNumber,11),crypto.randomBytes?this.getRandomBytes(12).copy(e):[0,4,8].forEach(function(t){e.writeInt32BE(Math.random()*Math.pow(2,32)|0,t)}),e.toString("base64").replace(/\//g,"_").replace(/\+/g,"-")):Math.abs(Math.random()*Math.random()*Date.now()|0).toString()+Math.abs(Math.random()*Math.random()*Date.now()|0).toString()},exports=module.exports=new Base64Id;