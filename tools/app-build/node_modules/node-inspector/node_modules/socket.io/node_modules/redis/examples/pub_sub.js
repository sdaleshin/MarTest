var redis=require("redis"),client1=redis.createClient(),msg_count=0,client2=redis.createClient();redis.debug_mode=!1,client1.on("subscribe",function(e,t){console.log("client1 subscribed to "+e+", "+t+" total subscriptions"),t===2&&(client2.publish("a nice channel","I am sending a message."),client2.publish("another one","I am sending a second message."),client2.publish("a nice channel","I am sending my last message."))}),client1.on("unsubscribe",function(e,t){console.log("client1 unsubscribed from "+e+", "+t+" total subscriptions"),t===0&&(client2.end(),client1.end())}),client1.on("message",function(e,t){console.log("client1 channel "+e+": "+t),msg_count+=1,msg_count===3&&client1.unsubscribe()}),client1.on("ready",function(){client1.incr("did a thing"),client1.subscribe("a nice channel","another one")}),client2.on("ready",function(){});