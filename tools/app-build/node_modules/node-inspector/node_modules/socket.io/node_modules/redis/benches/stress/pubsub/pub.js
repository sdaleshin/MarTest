function exec(){pub.publish("timeline",codec.encode({foo:payload})),++sent,pub.should_buffer||process.nextTick(exec)}var freemem=require("os").freemem,profiler=require("v8-profiler"),codec=require("../codec"),sent=0,pub=require("redis").createClient(null,null,{}).on("ready",function(){this.emit("drain")}).on("drain",function(){process.nextTick(exec)}),payload="1";for(var i=0;i<12;++i)payload+=payload;console.log("Message payload length",payload.length),profiler.takeSnapshot("s_0"),exec(),setInterval(function(){profiler.takeSnapshot("s_"+sent),console.error("sent",sent,"free",freemem(),"cmdqlen",pub.command_queue.length,"offqlen",pub.offline_queue.length)},2e3);