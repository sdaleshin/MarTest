function exec(){pub.rpush("timeline",codec.encode({foo:payload})),++sent,pub.should_buffer||process.nextTick(exec)}var freemem=require("os").freemem,codec=require("../codec"),sent=0,pub=require("redis").createClient(null,null,{}).on("ready",function(){this.del("timeline"),this.emit("drain")}).on("drain",function(){process.nextTick(exec)}),payload="1";for(var i=0;i<12;++i)payload+=payload;console.log("Message payload length",payload.length),exec(),setInterval(function(){pub.llen("timeline",function(e,t){console.error("sent",sent,"free",freemem(),"cmdqlen",pub.command_queue.length,"offqlen",pub.offline_queue.length,"llen",t)})},2e3);