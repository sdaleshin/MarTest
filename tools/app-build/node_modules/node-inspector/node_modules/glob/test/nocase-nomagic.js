var fs=require("fs"),test=require("tap").test,glob=require("../");test("mock fs",function(e){function s(e){var t;switch(e.toLowerCase()){case"/tmp":case"/tmp/":t={isDirectory:function(){return!0}};break;case"/tmp/a":t={isDirectory:function(){return!1}}}return t}function o(e){var t;switch(e.toLowerCase()){case"/tmp":case"/tmp/":t=["a","A"];break;case"/":t=["tmp","tMp","tMP","TMP"]}return t}var t=fs.stat,n=fs.statSync,r=fs.readdir,i=fs.readdirSync;fs.stat=function(e,n){var r=s(e);r?process.nextTick(function(){n(null,r)}):t.call(fs,e,n)},fs.statSync=function(e){return s(e)||n.call(fs,e)},fs.readdir=function(e,t){var n=o(e);n?process.nextTick(function(){t(null,n)}):r.call(fs,e,t)},fs.readdirSync=function(e){return o(e)||i.call(fs,e)},e.pass("mocked"),e.end()}),test("nocase, nomagic",function(e){var t=2,n=["/TMP/A","/TMP/a","/tMP/A","/tMP/a","/tMp/A","/tMp/a","/tmp/A","/tmp/a"];glob("/tmp/a",{nocase:!0},function(r,i){if(r)throw r;e.same(i.sort(),n),--t===0&&e.end()}),glob("/tmp/A",{nocase:!0},function(r,i){if(r)throw r;e.same(i.sort(),n),--t===0&&e.end()})}),test("nocase, with some magic",function(e){e.plan(2);var t=["/TMP/A","/TMP/a","/tMP/A","/tMP/a","/tMp/A","/tMp/a","/tmp/A","/tmp/a"];glob("/tmp/*",{nocase:!0},function(n,r){if(n)throw n;e.same(r.sort(),t)}),glob("/tmp/*",{nocase:!0},function(n,r){if(n)throw n;e.same(r.sort(),t)})});