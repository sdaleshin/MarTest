(function(){function r(e,r,i){function m(r,i,s){if(!r.text)return;var u=c?0:r.text.length-1,a=c?r.text.length:-1;if(r.text.length>o)return null;s!=null&&(u=s+h);for(;u!=a;u+=h){var f=r.text.charAt(u);if(v.test(f)&&e.getTokenTypeAt(t(i,u+1))==p){var l=n[f];if(l.charAt(1)==">"==c)d.push(f);else{if(d.pop()!=l.charAt(0))return{pos:u,match:!1};if(!d.length)return{pos:u,match:!0}}}}}var s=e.state.matchBrackets,o=s&&s.maxScanLineLength||1e4,u=r||e.getCursor(),a=e.getLineHandle(u.line),f=u.ch-1,l=f>=0&&n[a.text.charAt(f)]||n[a.text.charAt(++f)];if(!l)return null;var c=l.charAt(1)==">",h=c?1:-1;if(i&&c!=(f==u.ch))return null;var p=e.getTokenTypeAt(t(u.line,f+1)),d=[a.text.charAt(f)],v=/[(){}[\]]/;for(var g=u.line,y,b=c?Math.min(g+100,e.lineCount()):Math.max(-1,g-100);g!=b;g+=h){g==u.line?y=m(a,g,f):y=m(e.getLineHandle(g),g);if(y)break}return{from:t(u.line,f),to:y&&t(g,y.pos),match:y&&y.match,forward:c}}function i(n,i){var s=n.state.matchBrackets.maxHighlightLineLength||1e3,o=r(n);if(!o||n.getLine(o.from.line).length>s||o.to&&n.getLine(o.to.line).length>s)return;var u=o.match?"CodeMirror-matchingbracket":"CodeMirror-nonmatchingbracket",a=n.markText(o.from,t(o.from.line,o.from.ch+1),{className:u}),f=o.to&&n.markText(o.to,t(o.to.line,o.to.ch+1),{className:u});e&&n.state.focused&&n.display.input.focus();var l=function(){n.operation(function(){a.clear(),f&&f.clear()})};if(!i)return l;setTimeout(l,800)}function o(e){e.operation(function(){s&&(s(),s=null),e.somethingSelected()||(s=i(e,!1))})}var e=/MSIE \d/.test(navigator.userAgent)&&(document.documentMode==null||document.documentMode<8),t=CodeMirror.Pos,n={"(":")>",")":"(<","[":"]>","]":"[<","{":"}>","}":"{<"},s=null;CodeMirror.defineOption("matchBrackets",!1,function(e,t,n){n&&n!=CodeMirror.Init&&e.off("cursorActivity",o),t&&(e.state.matchBrackets=typeof t=="object"?t:{},e.on("cursorActivity",o))}),CodeMirror.defineExtension("matchBrackets",function(){i(this,!0)}),CodeMirror.defineExtension("findMatchingBracket",function(e,t){return r(this,e,t)})})();