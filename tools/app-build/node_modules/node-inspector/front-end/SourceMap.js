/*
 * Copyright (C) 2012 Google Inc. All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 * notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above
 * copyright notice, this list of conditions and the following disclaimer
 * in the documentation and/or other materials provided with the
 * distribution.
 *     * Neither the name of Google Inc. nor the names of its
 * contributors may be used to endorse or promote products derived from
 * this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

WebInspector.SourceMap=function(e,t){if(!WebInspector.SourceMap.prototype._base64Map){const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";WebInspector.SourceMap.prototype._base64Map={};for(var r=0;r<n.length;++r)WebInspector.SourceMap.prototype._base64Map[n.charAt(r)]=r}this._sourceMappingURL=e,this._reverseMappingsBySourceURL={},this._mappings=[],this._sources={},this._sourceContentByURL={},this._parseMappingPayload(t)},WebInspector.SourceMap._sourceMapRequestHeaderName="X-Source-Map-Request-From",WebInspector.SourceMap._sourceMapRequestHeaderValue="inspector",WebInspector.SourceMap.hasSourceMapRequestHeader=function(e){return e&&e.requestHeaderValue(WebInspector.SourceMap._sourceMapRequestHeaderName)===WebInspector.SourceMap._sourceMapRequestHeaderValue},WebInspector.SourceMap.load=function(e,t,n){function i(r,i,s,o){if(r||!o||i>=400){n(null);return}o.slice(0,3)===")]}"&&(o=o.substring(o.indexOf("\n")));try{var u=JSON.parse(o),a=e.startsWith("data:")?t:e;n(new WebInspector.SourceMap(a,u))}catch(f){console.error(f.message),n(null)}}var r={};r[WebInspector.SourceMap._sourceMapRequestHeaderName]=WebInspector.SourceMap._sourceMapRequestHeaderValue,NetworkAgent.loadResourceForFrontend(WebInspector.resourceTreeModel.mainFrame.id,e,r,i.bind(this))},WebInspector.SourceMap.prototype={sources:function(){return Object.keys(this._sources)},sourceContent:function(e){return this._sourceContentByURL[e]},sourceContentProvider:function(e,t){var n=e.lastIndexOf("."),r=n!==-1?e.substr(n+1):"",i=WebInspector.ResourceType.mimeTypesForExtensions[r.toLowerCase()],s=this.sourceContent(e);return s?new WebInspector.StaticContentProvider(t,s,i):new WebInspector.CompilerSourceMappingContentProvider(e,t,i)},_parseMappingPayload:function(e){e.sections?this._parseSections(e.sections):this._parseMap(e,0,0)},_parseSections:function(e){for(var t=0;t<e.length;++t){var n=e[t];this._parseMap(n.map,n.offset.line,n.offset.column)}},findEntry:function(e,t){var n=0,r=this._mappings.length;while(r>1){var i=r>>1,s=n+i,o=this._mappings[s];e<o[0]||e===o[0]&&t<o[1]?r=i:(n=s,r-=i)}var u=this._mappings[n];return!n&&u&&(e<u[0]||e===u[0]&&t<u[1])?null:u},findEntryReversed:function(e,t){var n=this._reverseMappingsBySourceURL[e];for(;t<n.length;++t){var r=n[t];if(r)return r}return this._mappings[0]},_parseMap:function(e,t,n){var r=0,i=0,s=0,o=0,u=[],a={};for(var f=0;f<e.sources.length;++f){var l=e.sources[f],c=e.sourceRoot||"";c&&!c.endsWith("/")&&(c+="/");var h=c+l,p=WebInspector.ParsedURL.completeURL(this._sourceMappingURL,h)||h;a[l]=p,u.push(p),this._sources[p]=!0,e.sourcesContent&&e.sourcesContent[f]&&(this._sourceContentByURL[p]=e.sourcesContent[f])}var d=new WebInspector.SourceMap.StringCharIterator(e.mappings),v=u[r];for(;;){if(d.peek()===",")d.next();else{while(d.peek()===";")t+=1,n=0,d.next();if(!d.hasNext())break}n+=this._decodeVLQ(d);if(this._isSeparator(d.peek())){this._mappings.push([t,n]);continue}var m=this._decodeVLQ(d);m&&(r+=m,v=u[r]),i+=this._decodeVLQ(d),s+=this._decodeVLQ(d),this._isSeparator(d.peek())||(o+=this._decodeVLQ(d)),this._mappings.push([t,n,v,i,s])}for(var f=0;f<this._mappings.length;++f){var g=this._mappings[f],p=g[2];if(!p)continue;this._reverseMappingsBySourceURL[p]||(this._reverseMappingsBySourceURL[p]=[]);var y=this._reverseMappingsBySourceURL[p],b=g[3];y[b]||(y[b]=[g[0],g[1]])}},_isSeparator:function(e){return e===","||e===";"},_decodeVLQ:function(e){var t=0,n=0;do{var r=this._base64Map[e.next()];t+=(r&this._VLQ_BASE_MASK)<<n,n+=this._VLQ_BASE_SHIFT}while(r&this._VLQ_CONTINUATION_MASK);var i=t&1;return t>>=1,i?-t:t},_VLQ_BASE_SHIFT:5,_VLQ_BASE_MASK:31,_VLQ_CONTINUATION_MASK:32},WebInspector.SourceMap.StringCharIterator=function(e){this._string=e,this._position=0},WebInspector.SourceMap.StringCharIterator.prototype={next:function(){return this._string.charAt(this._position++)},peek:function(){return this._string.charAt(this._position)},hasNext:function(){return this._position<this._string.length}};