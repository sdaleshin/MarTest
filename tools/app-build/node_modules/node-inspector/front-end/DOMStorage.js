/*
 * Copyright (C) 2008 Nokia Inc.  All rights reserved.
 * Copyright (C) 2013 Samsung Electronics. All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 *
 * 1.  Redistributions of source code must retain the above copyright
 *     notice, this list of conditions and the following disclaimer.
 * 2.  Redistributions in binary form must reproduce the above copyright
 *     notice, this list of conditions and the following disclaimer in the
 *     documentation and/or other materials provided with the distribution.
 * 3.  Neither the name of Apple Computer, Inc. ("Apple") nor the names of
 *     its contributors may be used to endorse or promote products derived
 *     from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL APPLE OR ITS CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
 * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

WebInspector.DOMStorage=function(e,t){this._securityOrigin=e,this._isLocalStorage=t},WebInspector.DOMStorage.storageId=function(e,t){return{securityOrigin:e,isLocalStorage:t}},WebInspector.DOMStorage.Events={DOMStorageItemsCleared:"DOMStorageItemsCleared",DOMStorageItemRemoved:"DOMStorageItemRemoved",DOMStorageItemAdded:"DOMStorageItemAdded",DOMStorageItemUpdated:"DOMStorageItemUpdated"},WebInspector.DOMStorage.prototype={get id(){return WebInspector.DOMStorage.storageId(this._securityOrigin,this._isLocalStorage)},get securityOrigin(){return this._securityOrigin},get isLocalStorage(){return this._isLocalStorage},getItems:function(e){DOMStorageAgent.getDOMStorageItems(this.id,e)},setItem:function(e,t){DOMStorageAgent.setDOMStorageItem(this.id,e,t)},removeItem:function(e){DOMStorageAgent.removeDOMStorageItem(this.id,e)},__proto__:WebInspector.Object.prototype},WebInspector.DOMStorageModel=function(){this._storages={},InspectorBackend.registerDOMStorageDispatcher(new WebInspector.DOMStorageDispatcher(this)),DOMStorageAgent.enable(),WebInspector.resourceTreeModel.addEventListener(WebInspector.ResourceTreeModel.EventTypes.SecurityOriginAdded,this._securityOriginAdded,this),WebInspector.resourceTreeModel.addEventListener(WebInspector.ResourceTreeModel.EventTypes.SecurityOriginRemoved,this._securityOriginRemoved,this)},WebInspector.DOMStorageModel.Events={DOMStorageAdded:"DOMStorageAdded",DOMStorageRemoved:"DOMStorageRemoved"},WebInspector.DOMStorageModel.prototype={_securityOriginAdded:function(e){var t=e.data,n=this._storageKey(t,!0);console.assert(!this._storages[n]);var r=new WebInspector.DOMStorage(t,!0);this._storages[n]=r,this.dispatchEventToListeners(WebInspector.DOMStorageModel.Events.DOMStorageAdded,r);var i=this._storageKey(t,!1);console.assert(!this._storages[i]);var s=new WebInspector.DOMStorage(t,!1);this._storages[i]=s,this.dispatchEventToListeners(WebInspector.DOMStorageModel.Events.DOMStorageAdded,s)},_securityOriginRemoved:function(e){var t=e.data,n=this._storageKey(t,!0),r=this._storages[n];console.assert(r),delete this._storages[n],this.dispatchEventToListeners(WebInspector.DOMStorageModel.Events.DOMStorageRemoved,r);var i=this._storageKey(t,!1),s=this._storages[i];console.assert(s),delete this._storages[i],this.dispatchEventToListeners(WebInspector.DOMStorageModel.Events.DOMStorageRemoved,s)},_storageKey:function(e,t){return JSON.stringify(WebInspector.DOMStorage.storageId(e,t))},_domStorageItemsCleared:function(e){var t=this.storageForId(e);if(!t)return;var n={};t.dispatchEventToListeners(WebInspector.DOMStorage.Events.DOMStorageItemsCleared,n)},_domStorageItemRemoved:function(e,t){var n=this.storageForId(e);if(!n)return;var r={key:t};n.dispatchEventToListeners(WebInspector.DOMStorage.Events.DOMStorageItemRemoved,r)},_domStorageItemAdded:function(e,t,n){var r=this.storageForId(e);if(!r)return;var i={key:t,value:n};r.dispatchEventToListeners(WebInspector.DOMStorage.Events.DOMStorageItemAdded,i)},_domStorageItemUpdated:function(e,t,n,r){var i=this.storageForId(e);if(!i)return;var s={key:t,oldValue:n,value:r};i.dispatchEventToListeners(WebInspector.DOMStorage.Events.DOMStorageItemUpdated,s)},storageForId:function(e){return this._storages[JSON.stringify(e)]},storages:function(){var e=[];for(var t in this._storages)e.push(this._storages[t]);return e},__proto__:WebInspector.Object.prototype},WebInspector.DOMStorageDispatcher=function(e){this._model=e},WebInspector.DOMStorageDispatcher.prototype={domStorageItemsCleared:function(e){this._model._domStorageItemsCleared(e)},domStorageItemRemoved:function(e,t){this._model._domStorageItemRemoved(e,t)},domStorageItemAdded:function(e,t,n){this._model._domStorageItemAdded(e,t,n)},domStorageItemUpdated:function(e,t,n,r){this._model._domStorageItemUpdated(e,t,n,r)}},WebInspector.domStorageModel=null;