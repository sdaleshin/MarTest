/*
 * Copyright (C) 2011 Google Inc.  All rights reserved.
 * Copyright (C) 2006, 2007, 2008 Apple Inc.  All rights reserved.
 * Copyright (C) 2007 Matt Lilek (pewtermoose@gmail.com).
 * Copyright (C) 2009 Joseph Pecoraro
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 *
 * 1.  Redistributions of source code must retain the above copyright
 *     notice, this list of conditions and the following disclaimer.
 * 2.  Redistributions in binary form must reproduce the above copyright
 *     notice, this list of conditions and the following disclaimer in the
 *     documentation and/or other materials provided with the distribution.
 * 3.  Neither the name of Apple Computer, Inc. ("Apple") nor the names of
 *     its contributors may be used to endorse or promote products derived
 *     from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY APPLE AND ITS CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL APPLE OR ITS CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
 * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

WebInspector.installDragHandle=function(e,t,n,r,i){e.addEventListener("mousedown",WebInspector._elementDragStart.bind(WebInspector,t,n,r,i),!1)},WebInspector._elementDragStart=function(e,t,n,r,i){if(i.button||WebInspector.isMac()&&i.ctrlKey)return;if(WebInspector._elementDraggingEventListener)return;if(e&&!e(i))return;WebInspector._elementDraggingGlassPane&&(WebInspector._elementDraggingGlassPane.dispose(),delete WebInspector._elementDraggingGlassPane);var s=i.target.ownerDocument;WebInspector._elementDraggingEventListener=t,WebInspector._elementEndDraggingEventListener=n,WebInspector._mouseOutWhileDraggingTargetDocument=s,s.addEventListener("mousemove",WebInspector._elementDragMove,!0),s.addEventListener("mouseup",WebInspector._elementDragEnd,!0),s.addEventListener("mouseout",WebInspector._mouseOutWhileDragging,!0),s.body.style.cursor=r,i.preventDefault()},WebInspector._mouseOutWhileDragging=function(){WebInspector._unregisterMouseOutWhileDragging(),WebInspector._elementDraggingGlassPane=new WebInspector.GlassPane},WebInspector._unregisterMouseOutWhileDragging=function(){if(!WebInspector._mouseOutWhileDraggingTargetDocument)return;WebInspector._mouseOutWhileDraggingTargetDocument.removeEventListener("mouseout",WebInspector._mouseOutWhileDragging,!0),delete WebInspector._mouseOutWhileDraggingTargetDocument},WebInspector._elementDragMove=function(e){WebInspector._elementDraggingEventListener(e)&&WebInspector._cancelDragEvents(e)},WebInspector._cancelDragEvents=function(e){var t=e.target.ownerDocument;t.removeEventListener("mousemove",WebInspector._elementDragMove,!0),t.removeEventListener("mouseup",WebInspector._elementDragEnd,!0),WebInspector._unregisterMouseOutWhileDragging(),t.body.style.removeProperty("cursor"),WebInspector._elementDraggingGlassPane&&WebInspector._elementDraggingGlassPane.dispose(),delete WebInspector._elementDraggingGlassPane,delete WebInspector._elementDraggingEventListener,delete WebInspector._elementEndDraggingEventListener},WebInspector._elementDragEnd=function(e){var t=WebInspector._elementEndDraggingEventListener;WebInspector._cancelDragEvents(e),e.preventDefault(),t&&t(e)},WebInspector.GlassPane=function(){this.element=document.createElement("div"),this.element.style.cssText="position:absolute;top:0;bottom:0;left:0;right:0;background-color:transparent;z-index:1000;",this.element.id="glass-pane",document.body.appendChild(this.element),WebInspector._glassPane=this},WebInspector.GlassPane.prototype={dispose:function(){delete WebInspector._glassPane,WebInspector.HelpScreen.isVisible()?WebInspector.HelpScreen.focus():WebInspector.inspectorView.focus(),this.element.remove()}},WebInspector.animateStyle=function(e,t,n){function v(){if(i)return;var a=(new Date).getTime()-r;for(var f=0;f<s;++f){var l=e[f],c=l.element,h=l.start,d=l.end;if(!c||!d)continue;var m=c.style;for(p in d){var g=d[p];if(a<t){var y=h[p],b=y+(g-y)*a/t;m.setProperty(p,b+(p in o?o[p]:u))}else m.setProperty(p,g+(p in o?o[p]:u))}}a>=t&&(i=!0),n&&n(i),i||window.requestAnimationFrame(v)}function m(){if(i)return;t=0,v()}var r=(new Date).getTime(),i=!1;const s=e.length,o={opacity:""},u="px";for(var a=0;a<s;++a){var f=e[a],l=null,c=null,h=null,p=null;for(p in f)p==="element"?l=f[p]:p==="start"?c=f[p]:p==="end"&&(h=f[p]);if(!l||!h)continue;if(!c){var d=l.ownerDocument.defaultView.getComputedStyle(l);c={};for(p in h)c[p]=parseInt(d.getPropertyValue(p),10);f.start=c}else for(p in c)l.style.setProperty(p,c[p]+(p in o?o[p]:u))}return window.requestAnimationFrame(v),{forceComplete:m}},WebInspector.isBeingEdited=function(e){if(e.hasStyleClass("text-prompt")||e.nodeName==="INPUT"||e.nodeName==="TEXTAREA")return!0;if(!WebInspector.__editingCount)return!1;while(e){if(e.__editing)return!0;e=e.parentElement}return!1},WebInspector.markBeingEdited=function(e,t){if(t){if(e.__editing)return!1;e.addStyleClass("being-edited"),e.__editing=!0,WebInspector.__editingCount=(WebInspector.__editingCount||0)+1}else{if(!e.__editing)return!1;e.removeStyleClass("being-edited"),delete e.__editing,--WebInspector.__editingCount}return!0},WebInspector.EditingConfig=function(e,t,n){this.commitHandler=e,this.cancelHandler=t,this.context=n,this.pasteHandler,this.multiline,this.customFinishHandler},WebInspector.EditingConfig.prototype={setPasteHandler:function(e){this.pasteHandler=e},setMultilineOptions:function(e,t,n,r,i){this.multiline=!0,this.initialValue=e,this.mode=t,this.theme=n,this.lineWrapping=r,this.smartIndent=i},setCustomFinishHandler:function(e){this.customFinishHandler=e}},WebInspector.CSSNumberRegex=/^(-?(?:\d+(?:\.\d+)?|\.\d+))$/,WebInspector.StyleValueDelimiters="  	\n\"':;,/()",WebInspector._valueModificationDirection=function(e){var t=null;if(e.type==="mousewheel")e.wheelDeltaY>0?t="Up":e.wheelDeltaY<0&&(t="Down");else if(e.keyIdentifier==="Up"||e.keyIdentifier==="PageUp")t="Up";else if(e.keyIdentifier==="Down"||e.keyIdentifier==="PageDown")t="Down";return t},WebInspector._modifiedHexValue=function(e,t){var n=WebInspector._valueModificationDirection(t);if(!n)return e;var r=parseInt(e,16);if(isNaN(r)||!isFinite(r))return e;var i=Math.pow(16,e.length)-1,s=t.keyIdentifier==="Up"||t.keyIdentifier==="Down"||t.type==="mousewheel",o;s?o=n==="Up"?1:-1:o=t.keyIdentifier==="PageUp"?16:-16,t.shiftKey&&(o*=16);var u=r+o;if(u<0)u=0;else if(u>i)return e;var a=u.toString(16).toUpperCase();for(var f=0,l=e.length-a.length;f<l;++f)a="0"+a;return a},WebInspector._modifiedFloatNumber=function(e,t){var n=WebInspector._valueModificationDirection(t);if(!n)return e;var r=t.keyIdentifier==="Up"||t.keyIdentifier==="Down"||t.type==="mousewheel",i=1;t.shiftKey&&!r?i=100:t.shiftKey||!r?i=10:t.altKey&&(i=.1),n==="Down"&&(i*=-1);var s=Number((e+i).toFixed(6));return String(s).match(WebInspector.CSSNumberRegex)?s:null},WebInspector.handleElementValueModifications=function(e,t,n,r,i){var s=e.keyIdentifier==="Up"||e.keyIdentifier==="Down"||e.type==="mousewheel",o=e.keyIdentifier==="PageUp"||e.keyIdentifier==="PageDown";if(!s&&!o)return!1;var u=window.getSelection();if(!u.rangeCount)return!1;var a=u.getRangeAt(0);if(!a.commonAncestorContainer.isSelfOrDescendant(t))return!1;var f=t.textContent,l=a.startContainer.rangeOfWord(a.startOffset,WebInspector.StyleValueDelimiters,t),c=l.toString();if(r&&r(c))return!1;var h,p,d,v,m;m=/(.*#)([\da-fA-F]+)(.*)/.exec(c);if(m&&m.length)p=m[1],d=m[3],v=WebInspector._modifiedHexValue(m[2],e),i&&(v=i(v)),h=p+v+d;else{m=/(.*?)(-?(?:\d+(?:\.\d+)?|\.\d+))(.*)/.exec(c);if(m&&m.length){p=m[1],d=m[3],v=WebInspector._modifiedFloatNumber(parseFloat(m[2]),e);if(v===null)return!1;i&&(v=i(v)),h=p+v+d}}if(h){var g=document.createTextNode(h);l.deleteContents(),l.insertNode(g);var y=document.createRange();return y.setStart(g,0),y.setEnd(g,h.length),u.removeAllRanges(),u.addRange(y),e.handled=!0,e.preventDefault(),n&&n(f,h),!0}return!1},WebInspector.startEditing=function(e,t){function h(e){e.consume()}function p(e){const t=30;l.getWrapperElement().style.width=e-l.getWrapperElement().offsetLeft-t+"px",l.refresh()}function d(t){(!o||!t||!t.relatedTarget||!t.relatedTarget.isSelfOrDescendant(e))&&y.call(e)}function v(e){return o?l.getValue():e.tagName==="INPUT"&&e.type==="text"?e.value:e.textContent}function m(){WebInspector.markBeingEdited(e,!1),e.removeEventListener("blur",d,o),e.removeEventListener("keydown",S,!0),i&&e.removeEventListener("paste",E,!0),WebInspector.restoreFocusFromElement(e);if(o){e.removeEventListener("copy",h,!1),c.detach();return}this.removeStyleClass("editing"),typeof f!="number"?e.removeAttribute("tabIndex"):this.tabIndex=f,this.scrollTop=0,this.scrollLeft=0}function g(){o?l.setValue(u):this.tagName==="INPUT"&&this.type==="text"?this.value=u:this.textContent=u,m.call(this),r(this,s)}function y(){m.call(this),n(this,v(this),u,s,a)}function b(e){var t=WebInspector.isMac()?e.metaKey&&!e.shiftKey&&!e.ctrlKey&&!e.altKey:e.ctrlKey&&!e.shiftKey&&!e.metaKey&&!e.altKey;if(isEnterKey(e)&&(e.isMetaOrCtrlForTest||!o||t))return"commit";if(e.keyCode===WebInspector.KeyboardShortcut.Keys.Esc.code||e.keyIdentifier==="U+001B")return"cancel";if(!o&&e.keyIdentifier==="U+0009")return"move-"+(e.shiftKey?"backward":"forward")}function w(t,n){t==="commit"?(y.call(e),n.consume(!0)):t==="cancel"?(g.call(e),n.consume(!0)):t&&t.startsWith("move-")&&(a=t.substring(5),n.keyIdentifier!=="U+0009"&&d())}function E(e){var t=i(e);w(t,e)}function S(e){var n=t.customFinishHandler||b,r=n(e);w(r,e)}if(!WebInspector.markBeingEdited(e,!0))return null;t=t||new WebInspector.EditingConfig(function(){},function(){});var n=t.commitHandler,r=t.cancelHandler,i=t.pasteHandler,s=t.context,o=t.multiline||!1,u=o?t.initialValue:v(e),a="",f,l,c;if(o)loadScript("CodeMirrorTextEditor.js"),c=new WebInspector.CodeMirrorCSSLoadView,c.show(e),WebInspector.setCurrentFocusElement(e),e.addEventListener("copy",h,!1),l=window.CodeMirror(e,{mode:t.mode,lineWrapping:t.lineWrapping,smartIndent:t.smartIndent,autofocus:!0,theme:t.theme,value:u}),l.getWrapperElement().addStyleClass("source-code"),l.on("cursorActivity",function(e){e.display.cursor.scrollIntoViewIfNeeded(!1)});else{e.addStyleClass("editing"),f=e.getAttribute("tabIndex");if(typeof f!="number"||f<0)e.tabIndex=0;WebInspector.setCurrentFocusElement(e)}return e.addEventListener("blur",d,o),e.addEventListener("keydown",S,!0),i&&e.addEventListener("paste",E,!0),{cancel:g.bind(e),commit:y.bind(e),codeMirror:l,setWidth:p}},Number.secondsToString=function(e,t){if(!isFinite(e))return"-";if(e===0)return"0";var n=e*1e3;if(t&&n<1e3)return WebInspector.UIString("%.3f ms",n);if(n<1e3)return WebInspector.UIString("%.0f ms",n);if(e<60)return WebInspector.UIString("%.2f s",e);var r=e/60;if(r<60)return WebInspector.UIString("%.1f min",r);var i=r/60;if(i<24)return WebInspector.UIString("%.1f hrs",i);var s=i/24;return WebInspector.UIString("%.1f days",s)},Number.bytesToString=function(e){if(e<1024)return WebInspector.UIString("%.0f B",e);var t=e/1024;if(t<100)return WebInspector.UIString("%.1f KB",t);if(t<1024)return WebInspector.UIString("%.0f KB",t);var n=t/1024;return n<100?WebInspector.UIString("%.1f MB",n):WebInspector.UIString("%.0f MB",n)},Number.withThousandsSeparator=function(e){var t=e+"",n=/(\d+)(\d{3})/;while(t.match(n))t=t.replace(n,"$1 $2");return t},WebInspector.useLowerCaseMenuTitles=function(){return WebInspector.platform()==="windows"},WebInspector.formatLocalized=function(e,t,n,r,i){return String.format(WebInspector.UIString(e),t,n,r,i)},WebInspector.openLinkExternallyLabel=function(){return WebInspector.UIString(WebInspector.useLowerCaseMenuTitles()?"Open link in new tab":"Open Link in New Tab")},WebInspector.copyLinkAddressLabel=function(){return WebInspector.UIString(WebInspector.useLowerCaseMenuTitles()?"Copy link address":"Copy Link Address")},WebInspector.platform=function(){return WebInspector._platform||(WebInspector._platform=InspectorFrontendHost.platform()),WebInspector._platform},WebInspector.isMac=function(){return typeof WebInspector._isMac=="undefined"&&(WebInspector._isMac=WebInspector.platform()==="mac"),WebInspector._isMac},WebInspector.isWin=function(){return typeof WebInspector._isWin=="undefined"&&(WebInspector._isWin=WebInspector.platform()==="windows"),WebInspector._isWin},WebInspector.PlatformFlavor={WindowsVista:"windows-vista",MacTiger:"mac-tiger",MacLeopard:"mac-leopard",MacSnowLeopard:"mac-snowleopard",MacLion:"mac-lion",MacMountainLion:"mac-mountain-lion"},WebInspector.platformFlavor=function(){function e(){const e=navigator.userAgent;if(WebInspector.platform()==="windows"){var t=e.match(/Windows NT (\d+)\.(?:\d+)/);return t&&t[1]>=6?WebInspector.PlatformFlavor.WindowsVista:null}if(WebInspector.platform()==="mac"){var t=e.match(/Mac OS X\s*(?:(\d+)_(\d+))?/);if(!t||t[1]!=10)return WebInspector.PlatformFlavor.MacSnowLeopard;switch(Number(t[2])){case 4:return WebInspector.PlatformFlavor.MacTiger;case 5:return WebInspector.PlatformFlavor.MacLeopard;case 6:return WebInspector.PlatformFlavor.MacSnowLeopard;case 7:return WebInspector.PlatformFlavor.MacLion;case 8:return WebInspector.PlatformFlavor.MacMountainLion;default:return""}}}return WebInspector._platformFlavor||(WebInspector._platformFlavor=e()),WebInspector._platformFlavor},WebInspector.port=function(){return WebInspector._port||(WebInspector._port=InspectorFrontendHost.port()),WebInspector._port},WebInspector.installPortStyles=function(){var e=WebInspector.platform();document.body.addStyleClass("platform-"+e);var t=WebInspector.platformFlavor();t&&document.body.addStyleClass("platform-"+t);var n=WebInspector.port();document.body.addStyleClass("port-"+n)},WebInspector._windowFocused=function(e){e.target.document.nodeType===Node.DOCUMENT_NODE&&document.body.removeStyleClass("inactive")},WebInspector._windowBlurred=function(e){e.target.document.nodeType===Node.DOCUMENT_NODE&&document.body.addStyleClass("inactive")},WebInspector.previousFocusElement=function(){return WebInspector._previousFocusElement},WebInspector.currentFocusElement=function(){return WebInspector._currentFocusElement},WebInspector._focusChanged=function(e){WebInspector.setCurrentFocusElement(e.target)},WebInspector._textInputTypes=["text","search","tel","url","email","password"].keySet(),WebInspector._isTextEditingElement=function(e){return e instanceof HTMLInputElement?e.type in WebInspector._textInputTypes:e instanceof HTMLTextAreaElement?!0:!1},WebInspector.setCurrentFocusElement=function(e){if(WebInspector._glassPane&&e&&!WebInspector._glassPane.element.isAncestor(e))return;WebInspector._currentFocusElement!==e&&(WebInspector._previousFocusElement=WebInspector._currentFocusElement),WebInspector._currentFocusElement=e;if(WebInspector._currentFocusElement){WebInspector._currentFocusElement.focus();var t=window.getSelection();if(!WebInspector._isTextEditingElement(WebInspector._currentFocusElement)&&t.isCollapsed&&!WebInspector._currentFocusElement.isInsertionCaretInside()){var n=WebInspector._currentFocusElement.ownerDocument.createRange();n.setStart(WebInspector._currentFocusElement,0),n.setEnd(WebInspector._currentFocusElement,0),t.removeAllRanges(),t.addRange(n)}}else WebInspector._previousFocusElement&&WebInspector._previousFocusElement.blur()},WebInspector.restoreFocusFromElement=function(e){e&&e.isSelfOrAncestor(WebInspector.currentFocusElement())&&WebInspector.setCurrentFocusElement(WebInspector.previousFocusElement())},WebInspector.setToolbarColors=function(e,t){WebInspector._themeStyleElement||(WebInspector._themeStyleElement=document.createElement("style"),document.head.appendChild(WebInspector._themeStyleElement)),WebInspector._themeStyleElement.textContent="#toolbar {             background-image: none !important;             background-color: "+e+" !important;         }                  .toolbar-label {             color: "+t+" !important;             text-shadow: none;         }"},WebInspector.resetToolbarColors=function(){WebInspector._themeStyleElement&&(WebInspector._themeStyleElement.textContent="")},WebInspector.highlightSearchResult=function(e,t,n,r){var i=WebInspector.highlightSearchResults(e,[{offset:t,length:n}],r);return i.length?i[0]:null},WebInspector.highlightSearchResults=function(e,t,n){return WebInspector.highlightRangesWithStyleClass(e,t,"highlighted-search-result",n)},WebInspector.highlightRangesWithStyleClass=function(e,t,n,r){r=r||[];var i=[],s=e.textContent,o=e.ownerDocument,u=o.evaluate(".//text()",e,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null),a=u.snapshotLength;if(a===0)return i;var f=[],l=0;for(var c=0;c<a;++c){var h={};h.offset=l,h.length=u.snapshotItem(c).textContent.length,l=h.offset+h.length,f.push(h)}var p=0;for(var c=0;c<t.length;++c){var d=t[c].offset,v=d+t[c].length;while(p<a&&f[p].offset+f[p].length<=d)p++;var m=p;while(m<a&&f[m].offset+f[m].length<v)m++;if(m===a)break;var g=o.createElement("span");g.className=n,g.textContent=s.substring(d,v);var y=u.snapshotItem(m),b=y.textContent;y.textContent=b.substring(v-f[m].offset),r.push({node:y,type:"changed",oldText:b,newText:y.textContent});if(p===m){y.parentElement.insertBefore(g,y),r.push({node:g,type:"added",nextSibling:y,parent:y.parentElement}),i.push(g);var w=o.createTextNode(b.substring(0,d-f[p].offset));y.parentElement.insertBefore(w,g),r.push({node:w,type:"added",nextSibling:g,parent:y.parentElement})}else{var E=u.snapshotItem(p),S=E.textContent,x=E.nextSibling;E.parentElement.insertBefore(g,x),r.push({node:g,type:"added",nextSibling:x,parent:E.parentElement}),i.push(g),E.textContent=S.substring(0,d-f[p].offset),r.push({node:E,type:"changed",oldText:S,newText:E.textContent});for(var T=p+1;T<m;T++){var N=u.snapshotItem(T),C=N.textContent;N.textContent="",r.push({node:N,type:"changed",oldText:C,newText:N.textContent})}}p=m,f[p].offset=v,f[p].length=y.textContent.length}return i},WebInspector.applyDomChanges=function(e){for(var t=0,n=e.length;t<n;++t){var r=e[t];switch(r.type){case"added":r.parent.insertBefore(r.node,r.nextSibling);break;case"changed":r.node.textContent=r.newText}}},WebInspector.revertDomChanges=function(e){for(var t=e.length-1;t>=0;--t){var n=e[t];switch(n.type){case"added":n.node.remove();break;case"changed":n.node.textContent=n.oldText}}},WebInspector._coalescingLevel=0,WebInspector.startBatchUpdate=function(){WebInspector._coalescingLevel||(WebInspector._postUpdateHandlers=new Map),WebInspector._coalescingLevel++},WebInspector.endBatchUpdate=function(){if(--WebInspector._coalescingLevel)return;var e=WebInspector._postUpdateHandlers;delete WebInspector._postUpdateHandlers;var t=e.keys();for(var n=0;n<t.length;++n){var r=t[n],i=e.get(r).keys();for(var s=0;s<i.length;++s)i[s].call(r)}},WebInspector.invokeOnceAfterBatchUpdate=function(e,t){if(!WebInspector._coalescingLevel){t.call(e);return}var n=WebInspector._postUpdateHandlers.get(e);n||(n=new Map,WebInspector._postUpdateHandlers.put(e,n)),n.put(t)},WebInspector.CodeMirrorCSSLoadView=function(){WebInspector.View.call(this),this.element.addStyleClass("hidden"),this.registerRequiredCSS("cm/codemirror.css"),this.registerRequiredCSS("cm/cmdevtools.css")},WebInspector.CodeMirrorCSSLoadView.prototype={__proto__:WebInspector.View.prototype},function(){function e(){window.addEventListener("focus",WebInspector._windowFocused,!1),window.addEventListener("blur",WebInspector._windowBlurred,!1),document.addEventListener("focus",WebInspector._focusChanged.bind(this),!0),window.removeEventListener("DOMContentLoaded",e,!1)}window.addEventListener("DOMContentLoaded",e,!1)}();