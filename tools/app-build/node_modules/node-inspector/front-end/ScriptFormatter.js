/*
 * Copyright (C) 2011 Google Inc. All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 * notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above
 * copyright notice, this list of conditions and the following disclaimer
 * in the documentation and/or other materials provided with the
 * distribution.
 *     * Neither the name of Google Inc. nor the names of its
 * contributors may be used to endorse or promote products derived from
 * this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

WebInspector.Formatter=function(){},WebInspector.Formatter.createFormatter=function(e){return e===WebInspector.resourceTypes.Script||e===WebInspector.resourceTypes.Document?new WebInspector.ScriptFormatter:new WebInspector.IdentityFormatter},WebInspector.Formatter.locationToPosition=function(e,t,n){var r=t?e[t-1]+1:0;return r+n},WebInspector.Formatter.positionToLocation=function(e,t){var n=e.upperBound(t-1);if(!n)var r=t;else var r=t-e[n-1]-1;return[n,r]},WebInspector.Formatter.prototype={formatContent:function(e,t,n){}},WebInspector.ScriptFormatter=function(){this._tasks=[]},WebInspector.ScriptFormatter.prototype={formatContent:function(e,t,n){t=t.replace(/\r\n?|[\n\u2028\u2029]/g,"\n").replace(/^\uFEFF/,"");const r="format";var i={mimeType:e,content:t,indentString:WebInspector.settings.textEditorIndent.get()};this._tasks.push({data:i,callback:n}),this._worker.postMessage({method:r,params:i})},_didFormatContent:function(e){var t=this._tasks.shift(),n=t.data.content,r=e.data.content,i=e.data.mapping,s=new WebInspector.FormatterSourceMappingImpl(n.lineEndings(),r.lineEndings(),i);t.callback(r,s)},get _worker(){return this._cachedWorker||(this._cachedWorker=new Worker("ScriptFormatterWorker.js"),this._cachedWorker.onmessage=this._didFormatContent.bind(this)),this._cachedWorker}},WebInspector.IdentityFormatter=function(){this._tasks=[]},WebInspector.IdentityFormatter.prototype={formatContent:function(e,t,n){n(t,new WebInspector.IdentityFormatterSourceMapping)}},WebInspector.FormatterMappingPayload=function(){this.original=[],this.formatted=[]},WebInspector.FormatterSourceMapping=function(){},WebInspector.FormatterSourceMapping.prototype={originalToFormatted:function(e,t){},formattedToOriginal:function(e,t){}},WebInspector.IdentityFormatterSourceMapping=function(){},WebInspector.IdentityFormatterSourceMapping.prototype={originalToFormatted:function(e,t){return[e,t||0]},formattedToOriginal:function(e,t){return[e,t||0]}},WebInspector.FormatterSourceMappingImpl=function(e,t,n){this._originalLineEndings=e,this._formattedLineEndings=t,this._mapping=n},WebInspector.FormatterSourceMappingImpl.prototype={originalToFormatted:function(e,t){var n=WebInspector.Formatter.locationToPosition(this._originalLineEndings,e,t||0),r=this._convertPosition(this._mapping.original,this._mapping.formatted,n||0);return WebInspector.Formatter.positionToLocation(this._formattedLineEndings,r)},formattedToOriginal:function(e,t){var n=WebInspector.Formatter.locationToPosition(this._formattedLineEndings,e,t||0),r=this._convertPosition(this._mapping.formatted,this._mapping.original,n);return WebInspector.Formatter.positionToLocation(this._originalLineEndings,r||0)},_convertPosition:function(e,t,n){var r=e.upperBound(n)-1,i=t[r]+n-e[r];return r<t.length-1&&i>t[r+1]&&(i=t[r+1]),i}};