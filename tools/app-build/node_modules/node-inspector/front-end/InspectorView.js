/*
 * Copyright (C) 2011 Google Inc. All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 * notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above
 * copyright notice, this list of conditions and the following disclaimer
 * in the documentation and/or other materials provided with the
 * distribution.
 *     * Neither the name of Google Inc. nor the names of its
 * contributors may be used to endorse or promote products derived from
 * this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

WebInspector.InspectorView=function(){WebInspector.View.call(this),this.markAsRoot(),this.element.id="main-panels",this.element.setAttribute("spellcheck",!1),this._history=[],this._historyIterator=-1,document.addEventListener("keydown",this._keyDown.bind(this),!1),document.addEventListener("keypress",this._keyPress.bind(this),!1),this._panelOrder=[],this._panelDescriptors={},this._openBracketIdentifiers=["U+005B","U+00DB"].keySet(),this._closeBracketIdentifiers=["U+005D","U+00DD"].keySet(),this._footerElementContainer=this.element.createChild("div","inspector-footer status-bar hidden"),this._panelsElement=this.element.createChild("div","fill")},WebInspector.InspectorView.Events={PanelSelected:"PanelSelected"},WebInspector.InspectorView.prototype={addPanel:function(e){this._panelOrder.push(e.name()),this._panelDescriptors[e.name()]=e,WebInspector.toolbar.addPanel(e)},panel:function(e){var t=this._panelDescriptors[e];return!t&&this._panelOrder.length&&(t=this._panelDescriptors[this._panelOrder[0]]),t?t.panel():null},showPanel:function(e){var t=this.panel(e);return t&&this.setCurrentPanel(t),t},currentPanel:function(){return this._currentPanel},getSearchProvider:function(){return this._currentPanel},setCurrentPanel:function(e){if(this._currentPanel===e)return;WebInspector.searchController.cancelSearch(),this._currentPanel&&this._currentPanel.detach(),this._currentPanel=e,e&&(e.show(),this.dispatchEventToListeners(WebInspector.InspectorView.Events.PanelSelected));for(var t in WebInspector.panels)WebInspector.panels[t]===e&&(WebInspector.settings.lastActivePanel.set(t),this._pushToHistory(t),WebInspector.userMetrics.panelShown(t))},defaultFocusedElement:function(){return this._currentPanel?this._currentPanel.defaultFocusedElement():null},_keyPress:function(e){if(e.charCode<32&&WebInspector.isWin())return;clearTimeout(this._keyDownTimer),delete this._keyDownTimer},_keyDown:function(e){if(!WebInspector.KeyboardShortcut.eventHasCtrlOrMeta(e))return;var t=WebInspector.settings.shortcutPanelSwitch.get();if(t&&!e.shiftKey&&!e.altKey&&e.keyCode>48&&e.keyCode<58){var n=this._panelOrder[e.keyCode-49];n&&(this.showPanel(n),e.consume(!0));return}if(!WebInspector.isWin()||!this._openBracketIdentifiers[e.keyIdentifier]&&!this._closeBracketIdentifiers[e.keyIdentifier]){this._keyDownInternal(e);return}this._keyDownTimer=setTimeout(this._keyDownInternal.bind(this,e),0)},_keyDownInternal:function(e){if(this._openBracketIdentifiers[e.keyIdentifier]){var t=!e.shiftKey&&!e.altKey;if(t){var n=this._panelOrder.indexOf(this.currentPanel().name);n=n===0?this._panelOrder.length-1:n-1,this.showPanel(this._panelOrder[n]),e.consume(!0);return}var r=e.altKey;r&&this._canGoBackInHistory()&&(this._goBackInHistory(),e.consume(!0));return}if(this._closeBracketIdentifiers[e.keyIdentifier]){var i=!e.shiftKey&&!e.altKey;if(i){var n=this._panelOrder.indexOf(this.currentPanel().name);n=(n+1)%this._panelOrder.length,this.showPanel(this._panelOrder[n]),e.consume(!0);return}var s=e.altKey;s&&this._canGoForwardInHistory()&&(this._goForwardInHistory(),e.consume(!0));return}},_canGoBackInHistory:function(){return this._historyIterator>0},_goBackInHistory:function(){this._inHistory=!0,this.setCurrentPanel(WebInspector.panels[this._history[--this._historyIterator]]),delete this._inHistory},_canGoForwardInHistory:function(){return this._historyIterator<this._history.length-1},_goForwardInHistory:function(){this._inHistory=!0,this.setCurrentPanel(WebInspector.panels[this._history[++this._historyIterator]]),delete this._inHistory},_pushToHistory:function(e){if(this._inHistory)return;this._history.splice(this._historyIterator+1,this._history.length-this._historyIterator-1),(!this._history.length||this._history[this._history.length-1]!==e)&&this._history.push(e),this._historyIterator=this._history.length-1},panelsElement:function(){return this._panelsElement},setFooterElement:function(e){if(this._currentPanel&&this._currentPanel.canSetFooterElement()){this._currentPanel.setFooterElement(e);return}e?(this._footerElementContainer.removeStyleClass("hidden"),this._footerElementContainer.appendChild(e),this._panelsElement.style.bottom=this._footerElementContainer.offsetHeight+"px"):(this._footerElementContainer.addStyleClass("hidden"),this._footerElementContainer.removeChildren(),this._panelsElement.style.bottom=0),this.doResize()},__proto__:WebInspector.View.prototype},WebInspector.inspectorView=null;