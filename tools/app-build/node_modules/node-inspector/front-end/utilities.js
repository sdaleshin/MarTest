/*
 * Copyright (C) 2007 Apple Inc.  All rights reserved.
 * Copyright (C) 2012 Google Inc. All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 *
 * 1.  Redistributions of source code must retain the above copyright
 *     notice, this list of conditions and the following disclaimer.
 * 2.  Redistributions in binary form must reproduce the above copyright
 *     notice, this list of conditions and the following disclaimer in the
 *     documentation and/or other materials provided with the distribution.
 * 3.  Neither the name of Apple Computer, Inc. ("Apple") nor the names of
 *     its contributors may be used to endorse or promote products derived
 *     from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY APPLE AND ITS CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL APPLE OR ITS CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
 * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

function sanitizeHref(e){return e&&e.trim().toLowerCase().startsWith("javascript:")?null:e}function insertionIndexForObjectInListSortedByFunction(e,t,n,r){return r?t.upperBound(e,n):t.lowerBound(e,n)}function createSearchRegex(e,t,n){var r=t?"g":"gi",i;if(n)try{i=new RegExp(e,r)}catch(s){}return i||(i=createPlainTextSearchRegex(e,r)),i}function createPlainTextSearchRegex(e,t){var n=String.regexSpecialCharacters(),r="";for(var i=0;i<e.length;++i){var s=e.charAt(i);n.indexOf(s)!=-1&&(r+="\\"),r+=s}return new RegExp(r,t||"")}function countRegexMatches(e,t){var n=t,r=0,i;while(n&&(i=e.exec(n)))i[0].length>0&&++r,n=n.substring(i.index+1);return r}function numberToStringWithSpacesPadding(e,t){var n=e.toString(),r=Math.max(0,t-n.length),i=Array(r+1).join(" ");return i+n}function loadXHR(e,t,n){function r(){if(i.readyState!==XMLHttpRequest.DONE)return;if(i.status===200){n(i.responseText);return}n(null)}var i=new XMLHttpRequest;return i.open("GET",e,t),t&&(i.onreadystatechange=r),i.send(null),t?null:i.status===200?i.responseText:null}function StringPool(){this.reset()}function importScript(e){if(_importedScripts[e])return;var t=new XMLHttpRequest;_importedScripts[e]=!0,t.open("GET",e,!1),t.send(null);if(!t.responseText)throw"empty response arrived for script '"+e+"'";var n=WebInspector.ParsedURL.completeURL(window.location.href,e);window.eval(t.responseText+"\n//# sourceURL="+n)}function CallbackBarrier(){this._pendingIncomingCallbacksCount=0}Object.isEmpty=function(e){for(var t in e)return!1;return!0},Object.values=function(e){var t=Object.keys(e),n=t.length;for(var r=0;r<n;++r)t[r]=e[t[r]];return t},String.prototype.findAll=function(e){var t=[],n=this.indexOf(e);while(n!==-1)t.push(n),n=this.indexOf(e,n+e.length);return t},String.prototype.lineEndings=function(){return this._lineEndings||(this._lineEndings=this.findAll("\n"),this._lineEndings.push(this.length)),this._lineEndings},String.prototype.escapeCharacters=function(e){var t=!1;for(var n=0;n<e.length;++n)if(this.indexOf(e.charAt(n))!==-1){t=!0;break}if(!t)return String(this);var r="";for(var n=0;n<this.length;++n)e.indexOf(this.charAt(n))!==-1&&(r+="\\"),r+=this.charAt(n);return r},String.regexSpecialCharacters=function(){return"^[]{}()\\.$*+?|-,"},String.prototype.escapeForRegExp=function(){return this.escapeCharacters(String.regexSpecialCharacters())},String.prototype.escapeHTML=function(){return this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},String.prototype.collapseWhitespace=function(){return this.replace(/[\s\xA0]+/g," ")},String.prototype.trimMiddle=function(e){if(this.length<=e)return String(this);var t=e>>1,n=e-t-1;return this.substr(0,t)+"…"+this.substr(this.length-n,n)},String.prototype.trimEnd=function(e){return this.length<=e?String(this):this.substr(0,e-1)+"…"},String.prototype.trimURL=function(e){var t=this.replace(/^(https|http|file):\/\//i,"");return e&&(t=t.replace(new RegExp("^"+e.escapeForRegExp(),"i"),"")),t},String.prototype.toTitleCase=function(){return this.substring(0,1).toUpperCase()+this.substring(1)},String.prototype.compareTo=function(e){return this>e?1:this<e?-1:0},String.prototype.removeURLFragment=function(){var e=this.indexOf("#");return e==-1&&(e=this.length),this.substring(0,e)},String.prototype.startsWith=function(e){return!this.lastIndexOf(e,0)},String.prototype.endsWith=function(e){return this.indexOf(e,this.length-e.length)!==-1},String.naturalOrderComparator=function(e,t){var n=/^\d+|^\D+/,r,i,s,o;for(;;){if(!e)return t?-1:0;if(!t)return 1;r=e.match(n)[0],i=t.match(n)[0],s=!isNaN(r),o=!isNaN(i);if(s&&!o)return-1;if(o&&!s)return 1;if(s&&o){var u=r-i;if(u)return u;if(r.length!==i.length)return!+r&&!+i?r.length-i.length:i.length-r.length}else if(r!==i)return r<i?-1:1;e=e.substring(r.length),t=t.substring(i.length)}},Number.constrain=function(e,t,n){return e<t?e=t:e>n&&(e=n),e},Number.gcd=function(e,t){return t===0?e:Number.gcd(t,e%t)},Number.toFixedIfFloating=function(e){if(!e||isNaN(e))return e;var t=Number(e);return t%1?t.toFixed(3):String(t)},Date.prototype.toISO8601Compact=function(){function e(e){return(e>9?"":"0")+e}return this.getFullYear()+e(this.getMonth()+1)+e(this.getDate())+"T"+e(this.getHours())+e(this.getMinutes())+e(this.getSeconds())},Object.defineProperty(Array.prototype,"remove",{value:function(e,t){if(t){var n=this.indexOf(e);n!==-1&&this.splice(n,1);return}var r=this.length;for(var i=0;i<r;++i)this[i]===e&&this.splice(i,1)}}),Object.defineProperty(Array.prototype,"keySet",{value:function(){var e={};for(var t=0;t<this.length;++t)e[this[t]]=!0;return e}}),Object.defineProperty(Array.prototype,"rotate",{value:function(e){var t=[];for(var n=e;n<e+this.length;++n)t.push(this[n%this.length]);return t}}),Object.defineProperty(Uint32Array.prototype,"sort",{value:Array.prototype.sort}),function(){var e={value:function(e,t,n,r){function i(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}var s=this[r];i(this,n,r);var o=t;for(var u=t;u<n;++u)e(this[u],s)<0&&(i(this,o,u),++o);return i(this,n,o),o}};Object.defineProperty(Array.prototype,"partition",e),Object.defineProperty(Uint32Array.prototype,"partition",e);var t={value:function(e,t,n,r){function i(e,t,n,r,s){if(r<=n)return;var o=Math.floor(Math.random()*(r-n))+n,u=e.partition(t,n,r,o);i(e,t,n,u-1,s),u<n+s-1&&i(e,t,u+1,r,n+s-1-u)}return t===0&&n===this.length-1&&r>=this.length?this.sort(e):i(this,e,t,n,r),this}};Object.defineProperty(Array.prototype,"sortRange",t),Object.defineProperty(Uint32Array.prototype,"sortRange",t)}(),Object.defineProperty(Array.prototype,"qselect",{value:function(e,t){if(e<0||e>=this.length)return;t||(t=function(e,t){return e-t});var n=0,r=this.length-1;for(;;){var i=this.partition(t,n,r,Math.floor((r+n)/2));if(i===e)return this[e];i>e?r=i-1:n=i+1}}}),Object.defineProperty(Array.prototype,"lowerBound",{value:function(e,t){function n(e,t){return e<t?-1:e>t?1:0}t=t||n;var r=0,i=this.length;while(r<i){var s=r+i>>1;t(e,this[s])>0?r=s+1:i=s}return i}}),Object.defineProperty(Array.prototype,"upperBound",{value:function(e,t){function n(e,t){return e<t?-1:e>t?1:0}t=t||n;var r=0,i=this.length;while(r<i){var s=r+i>>1;t(e,this[s])>=0?r=s+1:i=s}return i}}),Object.defineProperty(Array.prototype,"binaryIndexOf",{value:function(e,t){var n=this.lowerBound(e,t);return n<this.length&&t(e,this[n])===0?n:-1}}),Object.defineProperty(Array.prototype,"select",{value:function(e){var t=new Array(this.length);for(var n=0;n<this.length;++n)t[n]=this[n][e];return t}}),Object.defineProperty(Array.prototype,"peekLast",{value:function(){return this[this.length-1]}}),String.sprintf=function(e,t){return String.vsprintf(e,Array.prototype.slice.call(arguments,1))},String.tokenizeFormatString=function(e,t){function i(e){n.push({type:"string",value:e})}function s(e,t,r){n.push({type:"specifier",specifier:e,precision:t,substitutionIndex:r})}function o(e){return!!/[0-9]/.exec(e)}var n=[],r=0,u=0;for(var a=e.indexOf("%",u);a!==-1;a=e.indexOf("%",u)){i(e.substring(u,a)),u=a+1;if(o(e[u])){var f=parseInt(e.substring(u),10);while(o(e[u]))++u;f>0&&e[u]==="$"&&(r=f-1,++u)}var l=-1;if(e[u]==="."){++u,l=parseInt(e.substring(u),10),isNaN(l)&&(l=0);while(o(e[u]))++u}if(!(e[u]in t)){i(e.substring(a,u+1)),++u;continue}s(e[u],l,r),++r,++u}return i(e.substring(u)),n},String.standardFormatters={d:function(e){return isNaN(e)?0:e},f:function(e,t){return e&&t.precision>-1&&(e=e.toFixed(t.precision)),isNaN(e)?t.precision>-1?Number(0).toFixed(t.precision):0:e},s:function(e){return e}},String.vsprintf=function(e,t){return String.format(e,t,String.standardFormatters,"",function(e,t){return e+t}).formattedResult},String.format=function(e,t,n,r,i){function s(){return'String.format("'+e+'", "'+t.join('", "')+'")'}function o(e){console.warn(s()+": "+e)}function u(e){console.error(s()+": "+e)}if(!e||!t||!t.length)return{formattedResult:i(r,e),unusedSubstitutions:t};var a=r,f=String.tokenizeFormatString(e,n),l={};for(var c=0;c<f.length;++c){var h=f[c];if(h.type==="string"){a=i(a,h.value);continue}if(h.type!=="specifier"){u('Unknown token type "'+h.type+'" found.');continue}if(h.substitutionIndex>=t.length){u("not enough substitution arguments. Had "+t.length+" but needed "+(h.substitutionIndex+1)+", so substitution was skipped."),a=i(a,"%"+(h.precision>-1?h.precision:"")+h.specifier);continue}l[h.substitutionIndex]=!0;if(!(h.specifier in n)){o("unsupported format character “"+h.specifier+"”. Treating as a string."),a=i(a,t[h.substitutionIndex]);continue}a=i(a,n[h.specifier](t[h.substitutionIndex],h))}var p=[];for(var c=0;c<t.length;++c){if(c in l)continue;p.push(t[c])}return{formattedResult:a,unusedSubstitutions:p}};var createObjectIdentifier=function(){return"_"+ ++createObjectIdentifier._last};createObjectIdentifier._last=0;var Set=function(){this._set={},this._size=0};Set.prototype={add:function(e){var t=e.__identifier;t||(t=createObjectIdentifier(),e.__identifier=t),this._set[t]||++this._size,this._set[t]=e},remove:function(e){return this._set[e.__identifier]?(--this._size,delete this._set[e.__identifier],!0):!1},items:function(){var e=new Array(this._size),t=0;for(var n in this._set)e[t++]=this._set[n];return e},hasItem:function(e){return!!this._set[e.__identifier]},size:function(){return this._size},clear:function(){this._set={},this._size=0}};var Map=function(){this._map={},this._size=0};Map.prototype={put:function(e,t){var n=e.__identifier;n||(n=createObjectIdentifier(),e.__identifier=n),this._map[n]||++this._size,this._map[n]=[e,t]},remove:function(e){var t=this._map[e.__identifier];return t?(--this._size,delete this._map[e.__identifier],t[1]):undefined},keys:function(){return this._list(0)},values:function(){return this._list(1)},_list:function(e){var t=new Array(this._size),n=0;for(var r in this._map)t[n++]=this._map[r][e];return t},get:function(e){var t=this._map[e.__identifier];return t?t[1]:undefined},contains:function(e){var t=this._map[e.__identifier];return!!t},size:function(){return this._size},clear:function(){this._map={},this._size=0}};var StringMap=function(){this._map={},this._size=0};StringMap.prototype={put:function(e,t){if(e==="__proto__"){this._hasProtoKey||(++this._size,this._hasProtoKey=!0),this._protoValue=t;return}Object.prototype.hasOwnProperty.call(this._map,e)||++this._size,this._map[e]=t},remove:function(e){var t;return e==="__proto__"?this._hasProtoKey?(--this._size,delete this._hasProtoKey,t=this._protoValue,delete this._protoValue,t):undefined:Object.prototype.hasOwnProperty.call(this._map,e)?(--this._size,t=this._map[e],delete this._map[e],t):undefined},keys:function(){var e=Object.keys(this._map)||[];return this._hasProtoKey&&e.push("__proto__"),e},values:function(){var e=Object.values(this._map);return this._hasProtoKey&&e.push(this._protoValue),e},get:function(e){return e==="__proto__"?this._protoValue:Object.prototype.hasOwnProperty.call(this._map,e)?this._map[e]:undefined},contains:function(e){var t;return e==="__proto__"?this._hasProtoKey:Object.prototype.hasOwnProperty.call(this._map,e)},size:function(){return this._size},clear:function(){this._map={},this._size=0,delete this._hasProtoKey,delete this._protoValue}},StringPool.prototype={intern:function(e){if(e==="__proto__")return"__proto__";var t=this._strings[e];return t===undefined&&(this._strings[e]=e,t=e),t},reset:function(){this._strings=Object.create(null)},internObjectStrings:function(e,t){if(typeof t!="number")t=100;else if(--t<0)throw"recursion depth limit reached in StringPool.deepIntern(), perhaps attempting to traverse cyclical references?";for(var n in e)switch(typeof e[n]){case"string":e[n]=this.intern(e[n]);break;case"object":this.internObjectStrings(e[n],t)}}};var _importedScripts={},loadScript=importScript;CallbackBarrier.prototype={createCallback:function(e){return console.assert(!this._outgoingCallback,"CallbackBarrier.createCallback() is called after CallbackBarrier.callWhenDone()"),++this._pendingIncomingCallbacksCount,this._incomingCallback.bind(this,e)},callWhenDone:function(e){console.assert(!this._outgoingCallback,"CallbackBarrier.callWhenDone() is called multiple times"),this._outgoingCallback=e,this._pendingIncomingCallbacksCount||this._outgoingCallback()},_incomingCallback:function(e){console.assert(this._pendingIncomingCallbacksCount>0);if(e){var t=Array.prototype.slice.call(arguments,1);e.apply(null,t)}!--this._pendingIncomingCallbacksCount&&this._outgoingCallback&&this._outgoingCallback()}};