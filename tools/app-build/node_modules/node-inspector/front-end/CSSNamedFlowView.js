/*
 * Copyright (C) 2012 Adobe Systems Incorporated. All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 *
 * 1. Redistributions of source code must retain the above
 *    copyright notice, this list of conditions and the following
 *    disclaimer.
 * 2. Redistributions in binary form must reproduce the above
 *    copyright notice, this list of conditions and the following
 *    disclaimer in the documentation and/or other materials
 *    provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
 * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
 * COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,
 * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT,
 * STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED
 * OF THE POSSIBILITY OF SUCH DAMAGE.
 */

WebInspector.CSSNamedFlowView=function(e){WebInspector.View.call(this),this.element.addStyleClass("css-named-flow"),this.element.addStyleClass("outline-disclosure"),this._treeOutline=new TreeOutline(this.element.createChild("ol"),!0),this._contentTreeItem=new TreeElement(WebInspector.UIString("content"),null,!0),this._treeOutline.appendChild(this._contentTreeItem),this._regionsTreeItem=new TreeElement(WebInspector.UIString("region chain"),null,!0),this._regionsTreeItem.expand(),this._treeOutline.appendChild(this._regionsTreeItem),this._flow=e;var t=e.content;for(var n=0;n<t.length;++n)this._insertContentNode(t[n]);var r=e.regions;for(var n=0;n<r.length;++n)this._insertRegion(r[n])},WebInspector.CSSNamedFlowView.OversetTypeMessageMap={empty:"empty",fit:"fit",overset:"overset"},WebInspector.CSSNamedFlowView.prototype={_createFlowTreeOutline:function(e){if(!e)return null;var t=new WebInspector.ElementsTreeOutline(!1,!1);return t.element.addStyleClass("named-flow-element"),t.setVisible(!0),t.rootDOMNode=e,t.wireToDomAgent(),WebInspector.domAgent.removeEventListener(WebInspector.DOMAgent.Events.DocumentUpdated,t._elementsTreeUpdater._documentUpdated,t._elementsTreeUpdater),t},_insertContentNode:function(e,t){var n=this._createFlowTreeOutline(WebInspector.domAgent.nodeForId(e)),r=new TreeElement(n.element,n);if(t===undefined){this._contentTreeItem.appendChild(r);return}this._contentTreeItem.insertChild(r,t)},_insertRegion:function(e,t){var n=this._createFlowTreeOutline(WebInspector.domAgent.nodeForId(e.nodeId));n.element.addStyleClass("region-"+e.regionOverset);var r=new TreeElement(n.element,n),i=WebInspector.UIString(WebInspector.CSSNamedFlowView.OversetTypeMessageMap[e.regionOverset]);r.tooltip=WebInspector.UIString("Region is %s.",i);if(t===undefined){this._regionsTreeItem.appendChild(r);return}this._regionsTreeItem.insertChild(r,t)},get flow(){return this._flow},set flow(e){this._update(e)},_updateRegionOverset:function(e,t,n){var r=e.representedObject.element;r.removeStyleClass("region-"+n),r.addStyleClass("region-"+t);var i=WebInspector.UIString(WebInspector.CSSNamedFlowView.OversetTypeMessageMap[t]);e.tooltip=WebInspector.UIString("Region is %s.",i)},_mergeContentNodes:function(e,t){var n={};for(var r=0;r<t.length;++r)n[t[r]]=!0;var i=0,s=0,o=0;while(i<e.length||s<t.length){if(i===e.length){this._insertContentNode(t[s]),++s;continue}if(s===t.length){this._contentTreeItem.removeChildAtIndex(o),++i;continue}if(e[i]===t[s]){++i,++s,++o;continue}if(n[e[i]]){this._insertContentNode(t[s],o),++s,++o;continue}this._contentTreeItem.removeChildAtIndex(o),++i}},_mergeRegions:function(e,t){var n={};for(var r=0;r<t.length;++r)n[t[r].nodeId]=!0;var i=0,s=0,o=0;while(i<e.length||s<t.length){if(i===e.length){this._insertRegion(t[s]),++s;continue}if(s===t.length){this._regionsTreeItem.removeChildAtIndex(o),++i;continue}if(e[i].nodeId===t[s].nodeId){e[i].regionOverset!==t[s].regionOverset&&this._updateRegionOverset(this._regionsTreeItem.children[o],t[s].regionOverset,e[i].regionOverset),++i,++s,++o;continue}if(n[e[i].nodeId]){this._insertRegion(t[s],o),++s,++o;continue}this._regionsTreeItem.removeChildAtIndex(o),++i}},_update:function(e){this._mergeContentNodes(this._flow.content,e.content),this._mergeRegions(this._flow.regions,e.regions),this._flow=e},__proto__:WebInspector.View.prototype};