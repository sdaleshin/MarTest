/*
 * Copyright (C) 2010 Google Inc. All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 * notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above
 * copyright notice, this list of conditions and the following disclaimer
 * in the documentation and/or other materials provided with the
 * distribution.
 *     * Neither the name of Google Inc. nor the names of its
 * contributors may be used to endorse or promote products derived from
 * this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

WebInspector.RequestTimingView=function(e){WebInspector.View.call(this),this.element.addStyleClass("resource-timing-view"),this._request=e},WebInspector.RequestTimingView.prototype={wasShown:function(){this._request.addEventListener(WebInspector.NetworkRequest.Events.TimingChanged,this._refresh,this);if(!this._request.timing){this._emptyView||(this._emptyView=new WebInspector.EmptyView(WebInspector.UIString("This request has no detailed timing info.")),this._emptyView.show(this.element),this.innerView=this._emptyView);return}this._emptyView&&(this._emptyView.detach(),delete this._emptyView),this._refresh()},willHide:function(){this._request.removeEventListener(WebInspector.NetworkRequest.Events.TimingChanged,this._refresh,this)},_refresh:function(){this._tableElement&&this._tableElement.remove(),this._tableElement=WebInspector.RequestTimingView.createTimingTable(this._request),this.element.appendChild(this._tableElement)},__proto__:WebInspector.View.prototype},WebInspector.RequestTimingView.createTimingTable=function(e){function r(e,t,r,i){var s={};s.title=e,s.className=t,s.start=r,s.end=i,n.push(s)}var t=document.createElement("table"),n=[];e.timing.proxyStart!==-1&&r(WebInspector.UIString("Proxy"),"proxy",e.timing.proxyStart,e.timing.proxyEnd),e.timing.dnsStart!==-1&&r(WebInspector.UIString("DNS Lookup"),"dns",e.timing.dnsStart,e.timing.dnsEnd);if(e.timing.connectStart!==-1){var i=e.connectionReused?WebInspector.UIString("Blocking"):WebInspector.UIString("Connecting");r(i,"connecting",e.timing.connectStart,e.timing.connectEnd)}e.timing.sslStart!==-1&&r(WebInspector.UIString("SSL"),"ssl",e.timing.sslStart,e.timing.sslEnd),r(WebInspector.UIString("Sending"),"sending",e.timing.sendStart,e.timing.sendEnd),r(WebInspector.UIString("Waiting"),"waiting",e.timing.sendEnd,e.timing.receiveHeadersEnd),r(WebInspector.UIString("Receiving"),"receiving",(e.responseReceivedTime-e.timing.requestTime)*1e3,(e.endTime-e.timing.requestTime)*1e3);const s=200;var o=(e.endTime-e.timing.requestTime)*1e3,u=s/o;for(var a=0;a<n.length;++a){var f=document.createElement("tr");t.appendChild(f);var l=document.createElement("td");l.textContent=n[a].title,f.appendChild(l),l=document.createElement("td"),l.width=s+"px";var c=document.createElement("div");c.className="network-timing-row",l.appendChild(c);var h=document.createElement("span");h.className="network-timing-bar "+n[a].className,h.style.left=u*n[a].start+"px",h.style.right=u*(o-n[a].end)+"px",h.style.backgroundColor=n[a].color,h.textContent="â€‹",c.appendChild(h);var p=document.createElement("span");p.className="network-timing-bar-title",o-n[a].end<n[a].start?p.style.right=u*(o-n[a].end)+3+"px":p.style.left=u*n[a].start+3+"px",p.textContent=Number.secondsToString((n[a].end-n[a].start)/1e3),c.appendChild(p),f.appendChild(l)}return t};