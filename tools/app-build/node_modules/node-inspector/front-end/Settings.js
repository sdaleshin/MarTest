/*
 * Copyright (C) 2009 Google Inc. All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 * notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above
 * copyright notice, this list of conditions and the following disclaimer
 * in the documentation and/or other materials provided with the
 * distribution.
 *     * Neither the name of Google Inc. nor the names of its
 * contributors may be used to endorse or promote products derived from
 * this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

var Preferences={maxInlineTextChildLength:80,minConsoleHeight:75,minSidebarWidth:100,minSidebarHeight:75,minElementsSidebarWidth:200,minElementsSidebarHeight:200,minScriptsSidebarWidth:200,applicationTitle:"Developer Tools - %s",experimentsEnabled:!1},Capabilities={canInspectWorkers:!1};WebInspector.Settings=function(){this._eventSupport=new WebInspector.Object,this._registry={},this.colorFormat=this.createSetting("colorFormat","original"),this.consoleHistory=this.createSetting("consoleHistory",[]),this.domWordWrap=this.createSetting("domWordWrap",!0),this.eventListenersFilter=this.createSetting("eventListenersFilter","all"),this.lastActivePanel=this.createSetting("lastActivePanel","elements"),this.lastViewedScriptFile=this.createSetting("lastViewedScriptFile","application"),this.monitoringXHREnabled=this.createSetting("monitoringXHREnabled",!1),this.preserveConsoleLog=this.createSetting("preserveConsoleLog",!1),this.resourcesLargeRows=this.createSetting("resourcesLargeRows",!0),this.resourcesSortOptions=this.createSetting("resourcesSortOptions",{timeOption:"responseTime",sizeOption:"transferSize"}),this.resourceViewTab=this.createSetting("resourceViewTab","preview"),this.showInheritedComputedStyleProperties=this.createSetting("showInheritedComputedStyleProperties",!1),this.showUserAgentStyles=this.createSetting("showUserAgentStyles",!0),this.watchExpressions=this.createSetting("watchExpressions",[]),this.breakpoints=this.createSetting("breakpoints",[]),this.eventListenerBreakpoints=this.createSetting("eventListenerBreakpoints",[]),this.domBreakpoints=this.createSetting("domBreakpoints",[]),this.xhrBreakpoints=this.createSetting("xhrBreakpoints",[]),this.jsSourceMapsEnabled=this.createSetting("sourceMapsEnabled",!0),this.cssSourceMapsEnabled=this.createSetting("cssSourceMapsEnabled",!0),this.cacheDisabled=this.createSetting("cacheDisabled",!1),this.enableOverridesOnStartup=this.createSetting("enableOverridesOnStartup",!1),this.overrideUserAgent=this.createSetting("overrideUserAgent",!1),this.userAgent=this.createSetting("userAgent",""),this.overrideDeviceMetrics=this.createSetting("overrideDeviceMetrics",!1),this.deviceMetrics=this.createSetting("deviceMetrics",""),this.deviceFitWindow=this.createSetting("deviceFitWindow",!1),this.emulateTouchEvents=this.createSetting("emulateTouchEvents",!1),this.showShadowDOM=this.createSetting("showShadowDOM",!1),this.zoomLevel=this.createSetting("zoomLevel",0),this.savedURLs=this.createSetting("savedURLs",{}),this.javaScriptDisabled=this.createSetting("javaScriptDisabled",!1),this.overrideGeolocation=this.createSetting("overrideGeolocation",!1),this.geolocationOverride=this.createSetting("geolocationOverride",""),this.overrideDeviceOrientation=this.createSetting("overrideDeviceOrientation",!1),this.deviceOrientationOverride=this.createSetting("deviceOrientationOverride",""),this.showAdvancedHeapSnapshotProperties=this.createSetting("showAdvancedHeapSnapshotProperties",!1),this.searchInContentScripts=this.createSetting("searchInContentScripts",!1),this.textEditorIndent=this.createSetting("textEditorIndent","    "),this.textEditorAutoDetectIndent=this.createSetting("textEditorAutoIndentIndent",!0),this.lastDockState=this.createSetting("lastDockState",""),this.cssReloadEnabled=this.createSetting("cssReloadEnabled",!1),this.showCpuOnTimelineRuler=this.createSetting("showCpuOnTimelineRuler",!1),this.timelineStackFramesToCapture=this.createSetting("timelineStackFramesToCapture",30),this.timelineLimitStackFramesFlag=this.createSetting("timelineLimitStackFramesFlag",!1),this.showMetricsRulers=this.createSetting("showMetricsRulers",!1),this.overrideCSSMedia=this.createSetting("overrideCSSMedia",!1),this.emulatedCSSMedia=this.createSetting("emulatedCSSMedia","print"),this.workerInspectorWidth=this.createSetting("workerInspectorWidth",600),this.workerInspectorHeight=this.createSetting("workerInspectorHeight",600),this.messageURLFilters=this.createSetting("messageURLFilters",{}),this.messageSourceFilters=this.createSetting("messageSourceFilters",{CSS:!0}),this.messageLevelFilters=this.createSetting("messageLevelFilters",{}),this.splitVerticallyWhenDockedToRight=this.createSetting("splitVerticallyWhenDockedToRight",!0),this.visiblePanels=this.createSetting("visiblePanels",{}),this.shortcutPanelSwitch=this.createSetting("shortcutPanelSwitch",!1),this.showWhitespacesInEditor=this.createSetting("showWhitespacesInEditor",!1),this.skipStackFramesSwitch=this.createSetting("skipStackFramesSwitch",!1),this.skipStackFramesPattern=this.createSetting("skipStackFramesPattern","")},WebInspector.Settings.prototype={createSetting:function(e,t){return this._registry[e]||(this._registry[e]=new WebInspector.Setting(e,t,this._eventSupport,window.localStorage)),this._registry[e]},createBackendSetting:function(e,t,n){return this._registry[e]||(this._registry[e]=new WebInspector.BackendSetting(e,t,this._eventSupport,window.localStorage,n)),this._registry[e]}},WebInspector.Setting=function(e,t,n,r){this._name=e,this._defaultValue=t,this._eventSupport=n,this._storage=r},WebInspector.Setting.prototype={addChangeListener:function(e,t){this._eventSupport.addEventListener(this._name,e,t)},removeChangeListener:function(e,t){this._eventSupport.removeEventListener(this._name,e,t)},get name(){return this._name},get:function(){if(typeof this._value!="undefined")return this._value;this._value=this._defaultValue;if(this._storage&&this._name in this._storage)try{this._value=JSON.parse(this._storage[this._name])}catch(e){delete this._storage[this._name]}return this._value},set:function(e){this._value=e;if(this._storage)try{this._storage[this._name]=JSON.stringify(e)}catch(t){console.error("Error saving setting with name:"+this._name)}this._eventSupport.dispatchEventToListeners(this._name,e)}},WebInspector.BackendSetting=function(e,t,n,r,i){WebInspector.Setting.call(this,e,t,n,r),this._setterCallback=i;var s=this.get();s!==t&&(this._value=t,this.set(s))},WebInspector.BackendSetting.prototype={set:function(e){function t(t){if(t){WebInspector.log("Error applying setting "+this._name+": "+t),this._eventSupport.dispatchEventToListeners(this._name,this._value);return}WebInspector.Setting.prototype.set.call(this,e)}this._setterCallback(e,t.bind(this))},__proto__:WebInspector.Setting.prototype},WebInspector.ExperimentsSettings=function(){this._setting=WebInspector.settings.createSetting("experiments",{}),this._experiments=[],this._enabledForTest={},this.fileSystemInspection=this._createExperiment("fileSystemInspection","FileSystem inspection"),this.canvasInspection=this._createExperiment("canvasInspection ","Canvas inspection"),this.cssRegions=this._createExperiment("cssRegions","CSS Regions Support"),this.showOverridesInDrawer=this._createExperiment("showOverridesInDrawer","Show Overrides in drawer"),this.customizableToolbar=this._createExperiment("customizableToolbar","Enable toolbar customization"),this.drawerOverlay=this._createExperiment("drawerOverlay","Open console as overlay"),this.frameworksDebuggingSupport=this._createExperiment("frameworksDebuggingSupport","Enable frameworks debugging support"),this.layersPanel=this._createExperiment("layersPanel","Show Layers panel"),this.screencast=this._createExperiment("screencast","Enable screencast"),this.stepIntoSelection=this._createExperiment("stepIntoSelection","Show step-in candidates while debugging."),this.openConsoleWithCtrlTilde=this._createExperiment("openConsoleWithCtrlTilde","Open console with Ctrl/Cmd+Tilde, not Esc"),this._cleanUpSetting()},WebInspector.ExperimentsSettings.prototype={get experiments(){return this._experiments.slice()},get experimentsEnabled(){return Preferences.experimentsEnabled||"experiments"in WebInspector.queryParamsObject},_createExperiment:function(e,t){var n=new WebInspector.Experiment(this,e,t);return this._experiments.push(n),n},isEnabled:function(e){if(this._enabledForTest[e])return!0;if(!this.experimentsEnabled)return!1;var t=this._setting.get();return t[e]},setEnabled:function(e,t){var n=this._setting.get();n[e]=t,this._setting.set(n)},_enableForTest:function(e){this._enabledForTest[e]=!0},_cleanUpSetting:function(){var e=this._setting.get(),t={};for(var n=0;n<this._experiments.length;++n){var r=this._experiments[n].name;e[r]&&(t[r]=!0)}this._setting.set(t)}},WebInspector.Experiment=function(e,t,n){this._name=t,this._title=n,this._experimentsSettings=e},WebInspector.Experiment.prototype={get name(){return this._name},get title(){return this._title},isEnabled:function(){return this._experimentsSettings.isEnabled(this._name)},setEnabled:function(e){return this._experimentsSettings.setEnabled(this._name,e)},enableForTest:function(){this._experimentsSettings._enableForTest(this._name)}},WebInspector.VersionController=function(){},WebInspector.VersionController.currentVersion=4,WebInspector.VersionController.prototype={updateVersion:function(){var e=WebInspector.settings.createSetting("inspectorVersion",0),t=WebInspector.VersionController.currentVersion,n=e.get(),r=this._methodsToRunToUpdateVersion(n,t);for(var i=0;i<r.length;++i)this[r[i]].call(this);e.set(t)},_methodsToRunToUpdateVersion:function(e,t){var n=[];for(var r=e;r<t;++r)n.push("_updateVersionFrom"+r+"To"+(r+1));return n},_updateVersionFrom0To1:function(){this._clearBreakpointsWhenTooMany(WebInspector.settings.breakpoints,5e5)},_updateVersionFrom1To2:function(){var e=WebInspector.settings.createSetting("previouslyViewedFiles",[]);e.set([])},_updateVersionFrom2To3:function(){var e=WebInspector.settings.createSetting("fileSystemMapping",{});e.set({}),delete window.localStorage.fileMappingEntries},_updateVersionFrom3To4:function(){var e=WebInspector.settings.createSetting("showHeaSnapshotObjectsHiddenProperties",!1).get();WebInspector.settings.showAdvancedHeapSnapshotProperties.set(e)},_clearBreakpointsWhenTooMany:function(e,t){e.get().length>t&&e.set([])}},WebInspector.settings=new WebInspector.Settings,WebInspector.experimentsSettings=new WebInspector.ExperimentsSettings;