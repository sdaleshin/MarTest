/*
 * Copyright (C) 2007, 2008 Apple Inc.  All rights reserved.
 * Copyright (C) 2008 Matt Lilek <webkit@mattlilek.com>
 * Copyright (C) 2009 Joseph Pecoraro
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 *
 * 1.  Redistributions of source code must retain the above copyright
 *     notice, this list of conditions and the following disclaimer.
 * 2.  Redistributions in binary form must reproduce the above copyright
 *     notice, this list of conditions and the following disclaimer in the
 *     documentation and/or other materials provided with the distribution.
 * 3.  Neither the name of Apple Computer, Inc. ("Apple") nor the names of
 *     its contributors may be used to endorse or promote products derived
 *     from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY APPLE AND ITS CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL APPLE OR ITS CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
 * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

WebInspector.ElementsTreeOutline=function(e,t,n,r){this.element=document.createElement("ol"),this.element.className="elements-tree-outline",this.element.addEventListener("mousedown",this._onmousedown.bind(this),!1),this.element.addEventListener("mousemove",this._onmousemove.bind(this),!1),this.element.addEventListener("mouseout",this._onmouseout.bind(this),!1),this.element.addEventListener("dragstart",this._ondragstart.bind(this),!1),this.element.addEventListener("dragover",this._ondragover.bind(this),!1),this.element.addEventListener("dragleave",this._ondragleave.bind(this),!1),this.element.addEventListener("drop",this._ondrop.bind(this),!1),this.element.addEventListener("dragend",this._ondragend.bind(this),!1),this.element.addEventListener("keydown",this._onkeydown.bind(this),!1),TreeOutline.call(this,this.element),this._includeRootDOMNode=!e,this._selectEnabled=t,this._rootDOMNode=null,this._selectedDOMNode=null,this._eventSupport=new WebInspector.Object,this._visible=!1,this.element.addEventListener("contextmenu",this._contextMenuEventFired.bind(this),!0),this._contextMenuCallback=n,this._setPseudoClassCallback=r,this._createNodeDecorators()},WebInspector.ElementsTreeOutline.Events={SelectedNodeChanged:"SelectedNodeChanged",ElementsTreeUpdated:"ElementsTreeUpdated"},WebInspector.ElementsTreeOutline.MappedCharToEntity={" ":"nbsp"," ":"ensp"," ":"emsp"," ":"thinsp"," ":"#8202","​":"#8203","‌":"zwnj","‍":"zwj","‎":"lrm","‏":"rlm","‪":"#8234","‫":"#8235","‬":"#8236","‭":"#8237","‮":"#8238"},WebInspector.ElementsTreeOutline.prototype={setVisibleWidth:function(e){this._visibleWidth=e,this._multilineEditing&&this._multilineEditing.setWidth(this._visibleWidth)},_createNodeDecorators:function(){this._nodeDecorators=[],this._nodeDecorators.push(new WebInspector.ElementsTreeOutline.PseudoStateDecorator)},wireToDomAgent:function(){this._elementsTreeUpdater=new WebInspector.ElementsTreeUpdater(this)},setVisible:function(e){this._visible=e;if(!this._visible)return;this._updateModifiedNodes(),this._selectedDOMNode&&this._revealAndSelectNode(this._selectedDOMNode,!1)},addEventListener:function(e,t,n){this._eventSupport.addEventListener(e,t,n)},removeEventListener:function(e,t,n){this._eventSupport.removeEventListener(e,t,n)},get rootDOMNode(){return this._rootDOMNode},set rootDOMNode(e){if(this._rootDOMNode===e)return;this._rootDOMNode=e,this._isXMLMimeType=e&&e.isXMLNode(),this.update()},get isXMLMimeType(){return this._isXMLMimeType},selectedDOMNode:function(){return this._selectedDOMNode},selectDOMNode:function(e,t){if(this._selectedDOMNode===e){this._revealAndSelectNode(e,!t);return}this._selectedDOMNode=e,this._revealAndSelectNode(e,!t),this._selectedDOMNode===e&&this._selectedNodeChanged()},editing:function(){var e=this.selectedDOMNode();if(!e)return!1;var t=this.findTreeElement(e);return t?t._editing||!1:!1},update:function(){var e=this.selectedTreeElement?this.selectedTreeElement._node:null;this.removeChildren();if(!this.rootDOMNode)return;var t;if(this._includeRootDOMNode)t=new WebInspector.ElementsTreeElement(this.rootDOMNode),t.selectable=this._selectEnabled,this.appendChild(t);else{var n=this.rootDOMNode.firstChild;while(n)t=new WebInspector.ElementsTreeElement(n),t.selectable=this._selectEnabled,this.appendChild(t),n=n.nextSibling}e&&this._revealAndSelectNode(e,!0)},updateSelection:function(){if(!this.selectedTreeElement)return;var e=this.treeOutline.selectedTreeElement;e.updateSelection()},updateOpenCloseTags:function(e){var t=this.findTreeElement(e);t&&t.updateTitle();var n=t.children,r=n[n.length-1];r&&r._elementCloseTag&&r.updateTitle()},_selectedNodeChanged:function(){this._eventSupport.dispatchEventToListeners(WebInspector.ElementsTreeOutline.Events.SelectedNodeChanged,this._selectedDOMNode)},_fireElementsTreeUpdated:function(e){this._eventSupport.dispatchEventToListeners(WebInspector.ElementsTreeOutline.Events.ElementsTreeUpdated,e)},findTreeElement:function(e){function t(e,t){return e.isAncestor(t)}function n(e){return e.parentNode}var r=TreeOutline.prototype.findTreeElement.call(this,e,t,n);return!r&&e.nodeType()===Node.TEXT_NODE&&(r=TreeOutline.prototype.findTreeElement.call(this,e.parentNode,t,n)),r},createTreeElementFor:function(e){var t=this.findTreeElement(e);return t?t:e.parentNode?(t=this.createTreeElementFor(e.parentNode),t?t._showChild(e):null):null},set suppressRevealAndSelect(e){if(this._suppressRevealAndSelect===e)return;this._suppressRevealAndSelect=e},_revealAndSelectNode:function(e,t){if(this._suppressRevealAndSelect)return;!this._includeRootDOMNode&&e===this.rootDOMNode&&this.rootDOMNode&&(e=this.rootDOMNode.firstChild);if(!e)return;var n=this.createTreeElementFor(e);if(!n)return;n.revealAndSelect(t)},_treeElementFromEvent:function(e){var t=this.element.parentElement,n=t.totalOffsetLeft()+t.offsetWidth-36,r=e.pageY,i=this.treeElementFromPoint(n,r),s=this.treeElementFromPoint(n,r-2),o;return i===s?o=i:o=this.treeElementFromPoint(n,r+2),o},_onmousedown:function(e){var t=this._treeElementFromEvent(e);if(!t||t.isEventWithinDisclosureTriangle(e))return;t.select()},_onmousemove:function(e){var t=this._treeElementFromEvent(e);if(t&&this._previousHoveredElement===t)return;this._previousHoveredElement&&(this._previousHoveredElement.hovered=!1,delete this._previousHoveredElement),t&&(t.hovered=!0,this._previousHoveredElement=t),WebInspector.domAgent.highlightDOMNode(t&&t._node?t._node.id:0)},_onmouseout:function(e){var t=document.elementFromPoint(e.pageX,e.pageY);if(t&&t.isDescendant(this.element))return;this._previousHoveredElement&&(this._previousHoveredElement.hovered=!1,delete this._previousHoveredElement),WebInspector.domAgent.hideDOMNodeHighlight()},_ondragstart:function(e){if(!window.getSelection().isCollapsed)return!1;if(e.target.nodeName==="A")return!1;var t=this._treeElementFromEvent(e);return t?this._isValidDragSourceOrTarget(t)?t._node.nodeName()==="BODY"||t._node.nodeName()==="HEAD"?!1:(e.dataTransfer.setData("text/plain",t.listItemElement.textContent),e.dataTransfer.effectAllowed="copyMove",this._treeElementBeingDragged=t,WebInspector.domAgent.hideDOMNodeHighlight(),!0):!1:!1},_ondragover:function(e){if(!this._treeElementBeingDragged)return!1;var t=this._treeElementFromEvent(e);if(!this._isValidDragSourceOrTarget(t))return!1;var n=t._node;while(n){if(n===this._treeElementBeingDragged._node)return!1;n=n.parentNode}return t.updateSelection(),t.listItemElement.addStyleClass("elements-drag-over"),this._dragOverTreeElement=t,e.preventDefault(),e.dataTransfer.dropEffect="move",!1},_ondragleave:function(e){return this._clearDragOverTreeElementMarker(),e.preventDefault(),!1},_isValidDragSourceOrTarget:function(e){if(!e)return!1;var t=e.representedObject;return t instanceof WebInspector.DOMNode?!t.parentNode||t.parentNode.nodeType()!==Node.ELEMENT_NODE?!1:!0:!1},_ondrop:function(e){e.preventDefault();var t=this._treeElementFromEvent(e);t&&this._doMove(t)},_doMove:function(e){if(!this._treeElementBeingDragged)return;var t,n;if(e._elementCloseTag)t=e._node;else{var r=e._node;t=r.parentNode,n=r}var i=this._treeElementBeingDragged.expanded;this._treeElementBeingDragged._node.moveTo(t,n,this._selectNodeAfterEdit.bind(this,i)),delete this._treeElementBeingDragged},_ondragend:function(e){e.preventDefault(),this._clearDragOverTreeElementMarker(),delete this._treeElementBeingDragged},_clearDragOverTreeElementMarker:function(){this._dragOverTreeElement&&(this._dragOverTreeElement.updateSelection(),this._dragOverTreeElement.listItemElement.removeStyleClass("elements-drag-over"),delete this._dragOverTreeElement)},_onkeydown:function(e){var t=e,n=this.selectedDOMNode(),r=this.getCachedTreeElement(n);if(!r)return;if(!r._editing&&WebInspector.KeyboardShortcut.hasNoModifiers(t)&&t.keyCode===WebInspector.KeyboardShortcut.Keys.H.code){this._toggleHideShortcut(n),e.consume(!0);return}},_contextMenuEventFired:function(e){var t=this._treeElementFromEvent(e);if(!t)return;var n=new WebInspector.ContextMenu(e);n.appendApplicableItems(t._node),n.show()},populateContextMenu:function(e,t){var n=this._treeElementFromEvent(t);if(!n)return;var r=n._node.nodeType()===Node.ELEMENT_NODE,i=t.target.enclosingNodeOrSelfWithClass("webkit-html-text-node");i&&i.hasStyleClass("bogus")&&(i=null);var s=t.target.enclosingNodeOrSelfWithClass("webkit-html-comment");e.appendApplicableItems(t.target),i?(e.appendSeparator(),n._populateTextContextMenu(e,i)):r?(e.appendSeparator(),n._populateTagContextMenu(e,t)):s&&(e.appendSeparator(),n._populateNodeContextMenu(e,i))},_updateModifiedNodes:function(){this._elementsTreeUpdater&&this._elementsTreeUpdater._updateModifiedNodes()},_populateContextMenu:function(e,t){this._contextMenuCallback&&this._contextMenuCallback(e,t)},handleShortcut:function(e){var t=this.selectedDOMNode(),n=this.getCachedTreeElement(t);if(!t||!n)return;if(e.keyIdentifier==="F2"){this._toggleEditAsHTML(t),e.handled=!0;return}if(WebInspector.KeyboardShortcut.eventHasCtrlOrMeta(e)&&t.parentNode){if(e.keyIdentifier==="Up"&&t.previousSibling){t.moveTo(t.parentNode,t.previousSibling,this._selectNodeAfterEdit.bind(this,n.expanded)),e.handled=!0;return}if(e.keyIdentifier==="Down"&&t.nextSibling){t.moveTo(t.parentNode,t.nextSibling.nextSibling,this._selectNodeAfterEdit.bind(this,n.expanded)),e.handled=!0;return}}},_toggleEditAsHTML:function(e){var t=this.getCachedTreeElement(e);if(!t)return;t._editing&&t._htmlEditElement&&WebInspector.isBeingEdited(t._htmlEditElement)?t._editing.commit():t._editAsHTML()},_selectNodeAfterEdit:function(e,t,n){if(t)return;this._updateModifiedNodes();var r=n?WebInspector.domAgent.nodeForId(n):null;if(!r)return;this.selectDOMNode(r,!0);var i=this.findTreeElement(r);return e&&i&&i.expand(),i},_toggleHideShortcut:function(e,t){function n(e){function n(){const e="__web-inspector-hide-shortcut__",t="__web-inspector-hide-shortcut-style__",n=".__web-inspector-hide-shortcut__, .__web-inspector-hide-shortcut__ * { visibility: hidden !important; }";this.classList.toggle(e);var r=document.head.querySelector("style#"+t);if(r)return;r=document.createElement("style"),r.id=t,r.type="text/css",r.innerHTML=n,document.head.appendChild(r)}if(!e)return;e.callFunction(n,undefined,t),e.release()}WebInspector.RemoteObject.resolveNode(e,"",n)},__proto__:TreeOutline.prototype},WebInspector.ElementsTreeOutline.showShadowDOM=function(){return WebInspector.settings.showShadowDOM.get()||WebInspector.ElementsTreeOutline.showShadowDOMForTest},WebInspector.ElementsTreeOutline.ElementDecorator=function(){},WebInspector.ElementsTreeOutline.ElementDecorator.prototype={decorate:function(e){},decorateAncestor:function(e){}},WebInspector.ElementsTreeOutline.PseudoStateDecorator=function(){WebInspector.ElementsTreeOutline.ElementDecorator.call(this)},WebInspector.ElementsTreeOutline.PseudoStateDecorator.PropertyName="pseudoState",WebInspector.ElementsTreeOutline.PseudoStateDecorator.prototype={decorate:function(e){if(e.nodeType()!==Node.ELEMENT_NODE)return null;var t=e.getUserProperty(WebInspector.ElementsTreeOutline.PseudoStateDecorator.PropertyName);return t?WebInspector.UIString("Element state: %s",":"+t.join(", :")):null},decorateAncestor:function(e){if(e.nodeType()!==Node.ELEMENT_NODE)return null;var t=e.descendantUserPropertyCount(WebInspector.ElementsTreeOutline.PseudoStateDecorator.PropertyName);return t?t===1?WebInspector.UIString("%d descendant with forced state",t):WebInspector.UIString("%d descendants with forced state",t):null},__proto__:WebInspector.ElementsTreeOutline.ElementDecorator.prototype},WebInspector.ElementsTreeElement=function(e,t){TreeElement.call(this,"",e),this._node=e,this._elementCloseTag=t,this._updateHasChildren(),this._node.nodeType()==Node.ELEMENT_NODE&&!t&&(this._canAddAttributes=!0),this._searchQuery=null,this._expandedChildrenLimit=WebInspector.ElementsTreeElement.InitialChildrenLimit},WebInspector.ElementsTreeElement.InitialChildrenLimit=500,WebInspector.ElementsTreeElement.ForbiddenClosingTagElements=["area","base","basefont","br","canvas","col","command","embed","frame","hr","img","input","isindex","keygen","link","meta","param","source"].keySet(),WebInspector.ElementsTreeElement.EditTagBlacklist=["html","head","body"].keySet(),WebInspector.ElementsTreeElement.prototype={highlightSearchResults:function(e){this._searchQuery!==e&&(this._updateSearchHighlight(!1),delete this._highlightResult),this._searchQuery=e,this._searchHighlightsVisible=!0,this.updateTitle(!0)},hideSearchHighlights:function(){delete this._searchHighlightsVisible,this._updateSearchHighlight(!1)},_updateSearchHighlight:function(e){function t(e){switch(e.type){case"added":e.parent.insertBefore(e.node,e.nextSibling);break;case"changed":e.node.textContent=e.newText}}function n(e){switch(e.type){case"added":e.node.remove();break;case"changed":e.node.textContent=e.oldText}}if(!this._highlightResult)return;if(e)for(var r=0,i=this._highlightResult.length;r<i;++r)t(this._highlightResult[r]);else for(var r=this._highlightResult.length-1;r>=0;--r)n(this._highlightResult[r])},get hovered(){return this._hovered},set hovered(e){if(this._hovered===e)return;this._hovered=e,this.listItemElement&&(e?(this.updateSelection(),this.listItemElement.addStyleClass("hovered")):this.listItemElement.removeStyleClass("hovered"))},get expandedChildrenLimit(){return this._expandedChildrenLimit},set expandedChildrenLimit(e){if(this._expandedChildrenLimit===e)return;this._expandedChildrenLimit=e,this.treeOutline&&!this._updateChildrenInProgress&&this._updateChildren(!0)},get expandedChildCount(){var e=this.children.length;return e&&this.children[e-1]._elementCloseTag&&e--,e&&this.children[e-1].expandAllButton&&e--,e},_showChild:function(e){if(this._elementCloseTag)return null;var t=this._visibleChildren().indexOf(e);return t===-1?null:(t>=this.expandedChildrenLimit&&(this._expandedChildrenLimit=t+1,this._updateChildren(!0)),this.expandedChildCount>t?this.children[t]:null)},updateSelection:function(){var e=this.listItemElement;if(!e)return;if(!this._readyToUpdateSelection){if(!(document.body.offsetWidth>0))return;this._readyToUpdateSelection=!0}this.selectionElement||(this.selectionElement=document.createElement("div"),this.selectionElement.className="selection selected",e.insertBefore(this.selectionElement,e.firstChild)),this.selectionElement.style.height=e.offsetHeight+"px"},onattach:function(){this._hovered&&(this.updateSelection(),this.listItemElement.addStyleClass("hovered")),this.updateTitle(),this._preventFollowingLinksOnDoubleClick(),this.listItemElement.draggable=!0},_preventFollowingLinksOnDoubleClick:function(){var e=this.listItemElement.querySelectorAll("li > .webkit-html-tag > .webkit-html-attribute > .webkit-html-external-link, li > .webkit-html-tag > .webkit-html-attribute > .webkit-html-resource-link");if(!e)return;for(var t=0;t<e.length;++t)e[t].preventFollowOnDoubleClick=!0},onpopulate:function(){if(this.children.length||this._showInlineText()||this._elementCloseTag)return;this.updateChildren()},updateChildren:function(e){if(this._elementCloseTag)return;this._node.getChildNodes(this._updateChildren.bind(this,e))},insertChildElement:function(e,t,n){var r=new WebInspector.ElementsTreeElement(e,n);return r.selectable=this.treeOutline._selectEnabled,this.insertChild(r,t),r},moveChild:function(e,t){var n=e.selected;this.removeChild(e),this.insertChild(e,t),n&&e.select()},_updateChildren:function(e){function a(){var e=s.treeOutline,n=this._visibleChildren();for(var r=0;r<n.length;++r){var i=n[r],a=s.children[o];if(!a||a._node!==i){var f=null;for(var l=o+1,c=s.expandedChildCount;l<c;++l)if(s.children[l]._node===i){f=s.children[l];break}if(f&&f.parent===s)s.moveChild(f,o);else if(o<s.expandedChildrenLimit){var h=s.insertChildElement(i,o);i===t&&(u=h),s.expandedChildCount>s.expandedChildrenLimit&&s.expandedChildrenLimit++}}++o}}if(this._updateChildrenInProgress||!this.treeOutline._visible)return;this._updateChildrenInProgress=!0;var t=this.treeOutline.selectedDOMNode(),n=0;if(e){var r=this.treeOutline.element.parentNode;n=r.scrollTop;var i=this.treeOutline.selectedTreeElement;i&&i.hasAncestor(this)&&this.select(),this.removeChildren()}var s=this,o=0,u;for(var f=this.children.length-1;f>=0;--f){var l=this.children[f],c=l._node;if(!c)continue;var h=c.parentNode;if(h===this._node)continue;var i=this.treeOutline.selectedTreeElement;i&&(i===l||i.hasAncestor(l))&&this.select(),this.removeChildAtIndex(f)}a.call(this),this._adjustCollapsedRange();var p=this.children[this.children.length-1];this._node.nodeType()==Node.ELEMENT_NODE&&(!p||!p._elementCloseTag)&&this.insertChildElement(this._node,this.children.length,!0),e&&u&&(u.select(),r&&n<=r.scrollHeight&&(r.scrollTop=n)),delete this._updateChildrenInProgress},_adjustCollapsedRange:function(){var e=this._visibleChildren();this.expandAllButtonElement&&this.expandAllButtonElement.__treeElement.parent&&this.removeChild(this.expandAllButtonElement.__treeElement);const t=e.length;for(var n=this.expandedChildCount,r=Math.min(this.expandedChildrenLimit,t);n<r;++n)this.insertChildElement(e[n],n);const i=this.expandedChildCount;if(t>this.expandedChildCount){var s=i;if(!this.expandAllButtonElement){var o=document.createElement("button");o.className="show-all-nodes",o.value="";var u=new TreeElement(o,null,!1);u.selectable=!1,u.expandAllButton=!0,this.insertChild(u,s),this.expandAllButtonElement=u.listItemElement.firstChild,this.expandAllButtonElement.__treeElement=u,this.expandAllButtonElement.addEventListener("click",this.handleLoadAllChildren.bind(this),!1)}else this.expandAllButtonElement.__treeElement.parent||this.insertChild(this.expandAllButtonElement.__treeElement,s);this.expandAllButtonElement.textContent=WebInspector.UIString("Show All Nodes (%d More)",t-i)}else this.expandAllButtonElement&&delete this.expandAllButtonElement},handleLoadAllChildren:function(){this.expandedChildrenLimit=Math.max(this._visibleChildCount(),this.expandedChildrenLimit+WebInspector.ElementsTreeElement.InitialChildrenLimit)},expandRecursively:function(){function e(){TreeElement.prototype.expandRecursively.call(this,Number.MAX_VALUE)}this._node.getSubtree(-1,e.bind(this))},onexpand:function(){if(this._elementCloseTag)return;this.updateTitle(),this.treeOutline.updateSelection()},oncollapse:function(){if(this._elementCloseTag)return;this.updateTitle(),this.treeOutline.updateSelection()},onreveal:function(){if(this.listItemElement){var e=this.listItemElement.getElementsByClassName("webkit-html-tag-name");e.length?e[0].scrollIntoViewIfNeeded(!1):this.listItemElement.scrollIntoViewIfNeeded(!1)}},onselect:function(e){return this.treeOutline.suppressRevealAndSelect=!0,this.treeOutline.selectDOMNode(this._node,e),e&&WebInspector.domAgent.highlightDOMNode(this._node.id),this.updateSelection(),this.treeOutline.suppressRevealAndSelect=!1,!0},ondelete:function(){var e=this.treeOutline.findTreeElement(this._node);return e?e.remove():this.remove(),!0},onenter:function(){return this._editing?!1:(this._startEditing(),!0)},selectOnMouseDown:function(e){TreeElement.prototype.selectOnMouseDown.call(this,e);if(this._editing)return;this.treeOutline._showInElementsPanelEnabled&&(WebInspector.showPanel("elements"),this.treeOutline.selectDOMNode(this._node,!0)),e.detail>=2&&e.preventDefault()},ondblclick:function(e){if(this._editing||this._elementCloseTag)return;if(this._startEditingTarget(e.target))return;this.hasChildren&&!this.expanded&&this.expand()},_insertInLastAttributePosition:function(e,t){if(e.getElementsByClassName("webkit-html-attribute").length>0)e.insertBefore(t,e.lastChild);else{var n=e.textContent.match(/^<(.*?)>$/)[1];e.textContent="",e.appendChild(document.createTextNode("<"+n)),e.appendChild(t),e.appendChild(document.createTextNode(">"))}this.updateSelection()},_startEditingTarget:function(e){if(this.treeOutline.selectedDOMNode()!=this._node)return;if(this._node.nodeType()!=Node.ELEMENT_NODE&&this._node.nodeType()!=Node.TEXT_NODE)return!1;var t=e.enclosingNodeOrSelfWithClass("webkit-html-text-node");if(t)return this._startEditingTextNode(t);var n=e.enclosingNodeOrSelfWithClass("webkit-html-attribute");if(n)return this._startEditingAttribute(n,e);var r=e.enclosingNodeOrSelfWithClass("webkit-html-tag-name");if(r)return this._startEditingTagName(r);var i=e.enclosingNodeOrSelfWithClass("add-attribute");return i?this._addNewAttribute():!1},_populateTagContextMenu:function(e,t){var n=t.target.enclosingNodeOrSelfWithClass("webkit-html-attribute"),r=t.target.enclosingNodeOrSelfWithClass("add-attribute"),i=this._elementCloseTag?this.treeOutline.findTreeElement(this._node):this;e.appendItem(WebInspector.UIString(WebInspector.useLowerCaseMenuTitles()?"Add attribute":"Add Attribute"),this._addNewAttribute.bind(i)),n&&!r&&e.appendItem(WebInspector.UIString(WebInspector.useLowerCaseMenuTitles()?"Edit attribute":"Edit Attribute"),this._startEditingAttribute.bind(this,n,t.target)),e.appendSeparator();if(this.treeOutline._setPseudoClassCallback){var s=e.appendSubMenuItem(WebInspector.UIString(WebInspector.useLowerCaseMenuTitles()?"Force element state":"Force Element State"));this._populateForcedPseudoStateItems(s),e.appendSeparator()}this._populateNodeContextMenu(e),this.treeOutline._populateContextMenu(e,this._node),e.appendSeparator(),e.appendItem(WebInspector.UIString(WebInspector.useLowerCaseMenuTitles()?"Scroll into view":"Scroll into View"),this._scrollIntoView.bind(this))},_populateForcedPseudoStateItems:function(e){const t=["active","hover","focus","visited"];var n=this._node,r=(n?n.getUserProperty("pseudoState"):null)||[];for(var i=0;i<t.length;++i){var s=r.indexOf(t[i])>=0;e.appendCheckboxItem(":"+t[i],this.treeOutline._setPseudoClassCallback.bind(null,n.id,t[i],!s),s,!1)}},_populateTextContextMenu:function(e,t){e.appendItem(WebInspector.UIString(WebInspector.useLowerCaseMenuTitles()?"Edit text":"Edit Text"),this._startEditingTextNode.bind(this,t)),this._populateNodeContextMenu(e)},_populateNodeContextMenu:function(e){var t=this.treeOutline.getCachedTreeElement(this.representedObject)||this;e.appendItem(WebInspector.UIString("Edit as HTML"),t._editAsHTML.bind(t)),e.appendItem(WebInspector.UIString("Copy as HTML"),this._copyHTML.bind(this)),e.appendItem(WebInspector.UIString("Copy XPath"),this._copyXPath.bind(this)),e.appendItem(WebInspector.UIString(WebInspector.useLowerCaseMenuTitles()?"Delete node":"Delete Node"),this.remove.bind(this)),e.appendItem(WebInspector.UIString(WebInspector.useLowerCaseMenuTitles()?"Inspect DOM properties":"Inspect DOM Properties"),this._inspectDOMProperties.bind(this))},_startEditing:function(){if(this.treeOutline.selectedDOMNode()!==this._node)return;var e=this._listItemNode;if(this._canAddAttributes){var t=e.getElementsByClassName("webkit-html-attribute")[0];return t?this._startEditingAttribute(t,t.getElementsByClassName("webkit-html-attribute-value")[0]):this._addNewAttribute()}if(this._node.nodeType()===Node.TEXT_NODE){var n=e.getElementsByClassName("webkit-html-text-node")[0];if(n)return this._startEditingTextNode(n);return}},_addNewAttribute:function(){var e=document.createElement("span");this._buildAttributeDOM(e," ","");var t=e.firstChild;t.style.marginLeft="2px",t.style.marginRight="2px";var n=this.listItemElement.getElementsByClassName("webkit-html-tag")[0];return this._insertInLastAttributePosition(n,t),t.scrollIntoViewIfNeeded(!0),this._startEditingAttribute(t,t)},_triggerEditAttribute:function(e){var t=this.listItemElement.getElementsByClassName("webkit-html-attribute-name");for(var n=0,r=t.length;n<r;++n)if(t[n].textContent===e)for(var i=t[n].nextSibling;i;i=i.nextSibling){if(i.nodeType!==Node.ELEMENT_NODE)continue;if(i.hasStyleClass("webkit-html-attribute-value"))return this._startEditingAttribute(i.parentNode,i)}},_startEditingAttribute:function(e,t){function s(e){if(e.nodeType===Node.TEXT_NODE){e.nodeValue=e.nodeValue.replace(/\u200B/g,"");return}if(e.nodeType!==Node.ELEMENT_NODE)return;for(var t=e.firstChild;t;t=t.nextSibling)s(t)}function l(t){var n=WebInspector.isMac()?t.metaKey&&!t.shiftKey&&!t.ctrlKey&&!t.altKey:t.ctrlKey&&!t.shiftKey&&!t.metaKey&&!t.altKey;return isEnterKey(t)&&(t.isMetaOrCtrlForTest||!f.multiline||n)?"commit":t.keyCode===WebInspector.KeyboardShortcut.Keys.Esc.code||t.keyIdentifier==="U+001B"?"cancel":t.keyIdentifier==="U+0009"?"move-"+(t.shiftKey?"backward":"forward"):(WebInspector.handleElementValueModifications(t,e),"")}if(WebInspector.isBeingEdited(e))return!0;var n=e.getElementsByClassName("webkit-html-attribute-name")[0];if(!n)return!1;var r=n.textContent,i=e.getElementsByClassName("webkit-html-attribute-value")[0],o,u=e.enclosingNodeOrSelfWithNodeName("li");r&&i&&u&&u.treeElement&&(o=u.treeElement.representedObject);var a=o?o.getAttribute(r):undefined;typeof a!="undefined"&&(i.textContent=a),s(e);var f=new WebInspector.EditingConfig(this._attributeEditingCommitted.bind(this),this._editingCancelled.bind(this),r);return f.customFinishHandler=l.bind(this),this._editing=WebInspector.startEditing(e,f),window.getSelection().setBaseAndExtent(t,0,t,1),!0},_startEditingTextNode:function(e){if(WebInspector.isBeingEdited(e))return!0;var t=this._node;t.nodeType()===Node.ELEMENT_NODE&&t.firstChild&&(t=t.firstChild);var n=e.enclosingNodeOrSelfWithClass("webkit-html-text-node");n&&(n.textContent=t.nodeValue());var r=new WebInspector.EditingConfig(this._textNodeEditingCommitted.bind(this,t),this._editingCancelled.bind(this));return this._editing=WebInspector.startEditing(e,r),window.getSelection().setBaseAndExtent(e,0,e,1),!0},_startEditingTagName:function(e){function r(t){n&&(n.textContent="</"+e.textContent+">")}function i(t,n){e.removeEventListener("keyup",r,!1),this._tagNameEditingCommitted.apply(this,arguments)}function s(){e.removeEventListener("keyup",r,!1),this._editingCancelled.apply(this,arguments)}if(!e){e=this.listItemElement.getElementsByClassName("webkit-html-tag-name")[0];if(!e)return!1}var t=e.textContent;if(WebInspector.ElementsTreeElement.EditTagBlacklist[t.toLowerCase()])return!1;if(WebInspector.isBeingEdited(e))return!0;var n=this._distinctClosingTagElement();e.addEventListener("keyup",r,!1);var o=new WebInspector.EditingConfig(i.bind(this),s.bind(this),t);return this._editing=WebInspector.startEditing(e,o),window.getSelection().setBaseAndExtent(e,0,e,1),!0},_startEditingAsHTML:function(e,t,n){function r(e){e.eventPhase===Event.AT_TARGET&&e.consume(!0)}function s(t,r){e(n,r),o.call(this)}function o(){delete this._editing,delete this.treeOutline._multilineEditing,this.listItemElement.removeChild(this._htmlEditElement),delete this._htmlEditElement,this._childrenListNode&&this._childrenListNode.style.removeProperty("display");var e=this.listItemElement.firstChild;while(e)e.style.removeProperty("display"),e=e.nextSibling;this.treeOutline.childrenListElement.parentElement.removeEventListener("mousedown",r,!1),this.updateSelection(),this.treeOutline.element.focus()}if(t)return;if(this._editing)return;n=this._convertWhitespaceToEntities(n),this._htmlEditElement=document.createElement("div"),this._htmlEditElement.className="source-code elements-tree-editor";var i=this.listItemElement.firstChild;while(i)i.style.display="none",i=i.nextSibling;this._childrenListNode&&(this._childrenListNode.style.display="none"),this.listItemElement.appendChild(this._htmlEditElement),this.treeOutline.childrenListElement.parentElement.addEventListener("mousedown",r,!1),this.updateSelection();var u=new WebInspector.EditingConfig(s.bind(this),o.bind(this));u.setMultilineOptions(n,{name:"xml",htmlMode:!0},"web-inspector-html",WebInspector.settings.domWordWrap.get(),!0),this._editing=WebInspector.startEditing(this._htmlEditElement,u),this._editing.setWidth(this.treeOutline._visibleWidth),this.treeOutline._multilineEditing=this._editing},_attributeEditingCommitted:function(e,t,n,r,i){function o(n){n&&this._editingCancelled(e,r);if(!i)return;s._updateModifiedNodes();var o=this._node.attributes();for(var u=0;u<o.length;++u){if(o[u].name!==r)continue;i==="backward"?u===0?this._startEditingTagName():this._triggerEditAttribute(o[u-1].name):u===o.length-1?this._addNewAttribute():this._triggerEditAttribute(o[u+1].name);return}i==="backward"?t===" "?o.length>0&&this._triggerEditAttribute(o[o.length-1].name):o.length>1&&this._triggerEditAttribute(o[o.length-2].name):i==="forward"&&(/^\s*$/.test(t)?this._startEditingTagName():this._addNewAttribute())}delete this._editing;var s=this.treeOutline;if(!r.trim()&&!t.trim()){e.remove(),o.call(this);return}if(n!==t){this._node.setAttribute(r,t,o.bind(this));return}this.updateTitle(),o.call(this)},_tagNameEditingCommitted:function(e,t,n,r,i){function o(){var t=s._distinctClosingTagElement();t&&(t.textContent="</"+r+">"),s._editingCancelled(e,r),u.call(s)}function u(){if(i!=="forward"){this._addNewAttribute();return}var e=this._node.attributes();e.length>0?this._triggerEditAttribute(e[0].name):this._addNewAttribute()}function l(e,t){if(e||!t){o();return}var n=a._selectNodeAfterEdit(f,e,t);u.call(n)}delete this._editing;var s=this;t=t.trim();if(t===n){o();return}var a=this.treeOutline,f=this.expanded;this._node.setNodeName(t,l)},_textNodeEditingCommitted:function(e,t,n){function r(){this.updateTitle()}delete this._editing,e.setNodeValue(n,r.bind(this))},_editingCancelled:function(e,t){delete this._editing,this.updateTitle()},_distinctClosingTagElement:function(){if(this.expanded){var e=this._childrenListNode.querySelectorAll(".close");return e[e.length-1]}var t=this.listItemElement.getElementsByClassName("webkit-html-tag");return t.length===1?null:t[t.length-1]},updateTitle:function(e){if(this._editing)return;if(e)this._highlightResult&&this._updateSearchHighlight(!1);else{var t=document.createElement("span");t.className="highlight",t.appendChild(this._nodeTitleInfo(WebInspector.linkifyURLAsNode).titleDOM),this.title=t,this._updateDecorations(),delete this._highlightResult}delete this.selectionElement,this.selected&&this.updateSelection(),this._preventFollowingLinksOnDoubleClick(),this._highlightSearchResults()},_createDecoratorElement:function(){var e=this._node,t=[],n=[];for(var r=0;r<this.treeOutline._nodeDecorators.length;++r){var i=this.treeOutline._nodeDecorators[r],s=i.decorate(e);if(s){t.push(s);continue}if(this.expanded||this._elementCloseTag)continue;s=i.decorateAncestor(e),s&&n.push(s)}if(!t.length&&!n.length)return null;var o=document.createElement("div");return o.addStyleClass("elements-gutter-decoration"),t.length||o.addStyleClass("elements-has-decorated-children"),o.title=t.concat(n).join("\n"),o},_updateDecorations:function(){this._decoratorElement&&this._decoratorElement.remove(),this._decoratorElement=this._createDecoratorElement(),this._decoratorElement&&this.listItemElement&&this.listItemElement.insertBefore(this._decoratorElement,this.listItemElement.firstChild)},_buildAttributeDOM:function(e,t,n,r,i){var s=n.length>0,o=e.createChild("span","webkit-html-attribute"),u=o.createChild("span","webkit-html-attribute-name");u.textContent=t,s&&o.appendChild(document.createTextNode('=​"'));if(!i||t!=="src"&&t!=="href"){n=n.replace(/([\/;:\)\]\}])/g,"$1​");var f=o.createChild("span","webkit-html-attribute-value");f.textContent=n}else{var a=r.resolveURL(n);n=n.replace(/([\/;:\)\]\}])/g,"$1​");if(a===null){var f=o.createChild("span","webkit-html-attribute-value");f.textContent=n}else n.startsWith("data:")&&(n=n.trimMiddle(60)),o.appendChild(i(a,n,"webkit-html-attribute-value",r.nodeName().toLowerCase()==="a"))}s&&o.appendChild(document.createTextNode('"'))},_buildTagDOM:function(e,t,n,r,i){var s=this._node,o=["webkit-html-tag"];n&&r&&o.push("close"),s.isInShadowTree()&&o.push("shadow");var u=e.createChild("span",o.join(" "));u.appendChild(document.createTextNode("<"));var a=u.createChild("span",n?"":"webkit-html-tag-name");a.textContent=(n?"/":"")+t;if(!n&&s.hasAttributes()){var f=s.attributes();for(var l=0;l<f.length;++l){var c=f[l];u.appendChild(document.createTextNode(" ")),this._buildAttributeDOM(u,c.name,c.value,s,i)}}u.appendChild(document.createTextNode(">")),e.appendChild(document.createTextNode("​"))},_convertWhitespaceToEntities:function(e){var t="",n=0,r=WebInspector.ElementsTreeOutline.MappedCharToEntity;for(var i=0,s=e.length;i<s;++i){var o=e.charAt(i);r[o]&&(t+=e.substring(n,i)+"&"+r[o]+";",n=i+1)}return t?(t+=e.substring(n),t):e},_nodeTitleInfo:function(e){var t=this._node,n={titleDOM:document.createDocumentFragment(),hasChildren:this.hasChildren};switch(t.nodeType()){case Node.ATTRIBUTE_NODE:var r=t.value||"​";this._buildAttributeDOM(n.titleDOM,t.name,r);break;case Node.ELEMENT_NODE:var i=t.nodeNameInCorrectCase();if(this._elementCloseTag){this._buildTagDOM(n.titleDOM,i,!0,!0),n.hasChildren=!1;break}this._buildTagDOM(n.titleDOM,i,!1,!1,e);var s=this._showInlineText()&&!this.hasChildren;if(!this.expanded&&!s&&(this.treeOutline.isXMLMimeType||!WebInspector.ElementsTreeElement.ForbiddenClosingTagElements[i])){if(this.hasChildren){var o=n.titleDOM.createChild("span","webkit-html-text-node bogus");o.textContent="…",n.titleDOM.appendChild(document.createTextNode("​"))}this._buildTagDOM(n.titleDOM,i,!0,!1)}if(s){var o=n.titleDOM.createChild("span","webkit-html-text-node");o.textContent=this._convertWhitespaceToEntities(t.firstChild.nodeValue()),n.titleDOM.appendChild(document.createTextNode("​")),this._buildTagDOM(n.titleDOM,i,!0,!1),n.hasChildren=!1}break;case Node.TEXT_NODE:if(t.parentNode&&t.parentNode.nodeName().toLowerCase()==="script"){var u=n.titleDOM.createChild("span","webkit-html-text-node webkit-html-js-node");u.textContent=t.nodeValue();var a=new WebInspector.DOMSyntaxHighlighter("text/javascript",!0);a.syntaxHighlightNode(u)}else if(t.parentNode&&t.parentNode.nodeName().toLowerCase()==="style"){var u=n.titleDOM.createChild("span","webkit-html-text-node webkit-html-css-node");u.textContent=t.nodeValue();var f=new WebInspector.DOMSyntaxHighlighter("text/css",!0);f.syntaxHighlightNode(u)}else{n.titleDOM.appendChild(document.createTextNode('"'));var o=n.titleDOM.createChild("span","webkit-html-text-node");o.textContent=this._convertWhitespaceToEntities(t.nodeValue()),n.titleDOM.appendChild(document.createTextNode('"'))}break;case Node.COMMENT_NODE:var l=n.titleDOM.createChild("span","webkit-html-comment");l.appendChild(document.createTextNode("<!--"+t.nodeValue()+"-->"));break;case Node.DOCUMENT_TYPE_NODE:var c=n.titleDOM.createChild("span","webkit-html-doctype");c.appendChild(document.createTextNode("<!DOCTYPE "+t.nodeName())),t.publicId?(c.appendChild(document.createTextNode(' PUBLIC "'+t.publicId+'"')),t.systemId&&c.appendChild(document.createTextNode(' "'+t.systemId+'"'))):t.systemId&&c.appendChild(document.createTextNode(' SYSTEM "'+t.systemId+'"')),t.internalSubset&&c.appendChild(document.createTextNode(" ["+t.internalSubset+"]")),c.appendChild(document.createTextNode(">"));break;case Node.CDATA_SECTION_NODE:var h=n.titleDOM.createChild("span","webkit-html-text-node");h.appendChild(document.createTextNode("<![CDATA["+t.nodeValue()+"]]>"));break;case Node.DOCUMENT_FRAGMENT_NODE:var p=n.titleDOM.createChild("span","webkit-html-fragment");p.textContent=t.nodeNameInCorrectCase().collapseWhitespace(),t.isInShadowTree()&&p.addStyleClass("shadow");break;default:n.titleDOM.appendChild(document.createTextNode(t.nodeNameInCorrectCase().collapseWhitespace()))}return n},_showInlineText:function(){if(this._node.templateContent()||WebInspector.ElementsTreeOutline.showShadowDOM()&&this._node.hasShadowRoots())return!1;if(this._node.nodeType()!==Node.ELEMENT_NODE)return!1;if(!this._node.firstChild||this._node.firstChild!==this._node.lastChild||this._node.firstChild.nodeType()!==Node.TEXT_NODE)return!1;var e=this._node.firstChild;return e.nodeValue().length<Preferences.maxInlineTextChildLength?!0:!1},remove:function(){function n(n,r){if(n)return;e.removeChild(t),e._adjustCollapsedRange()}var e=this.parent;if(!e)return;var t=this;if(!this._node.parentNode||this._node.parentNode.nodeType()===Node.DOCUMENT_NODE)return;this._node.removeNode(n)},_editAsHTML:function(){function s(t,s){if(t)return;e._updateModifiedNodes();var o=n?n.children()[r]||n:null;if(!o)return;e.selectDOMNode(o,!0);if(i){var u=e.findTreeElement(o);u&&u.expand()}}function o(e,n){if(e===n)return;t.setOuterHTML(n,s)}var e=this.treeOutline,t=this._node,n=t.parentNode,r=t.index,i=this.expanded;t.getOuterHTML(this._startEditingAsHTML.bind(this,o))},_copyHTML:function(){this._node.copyNode()},_copyXPath:function(){this._node.copyXPath(!0)},_inspectDOMProperties:function(){function e(e){if(!e)return;var t=WebInspector.ConsoleMessage.create(WebInspector.ConsoleMessage.MessageSource.ConsoleAPI,WebInspector.ConsoleMessage.MessageLevel.Log,"",WebInspector.ConsoleMessage.MessageType.Dir,undefined,undefined,undefined,undefined,[e]);WebInspector.console.addMessage(t),WebInspector.showConsole()}WebInspector.RemoteObject.resolveNode(this._node,"console",e)},_highlightSearchResults:function(){if(!this._searchQuery||!this._searchHighlightsVisible)return;if(this._highlightResult){this._updateSearchHighlight(!0);return}var e=this.listItemElement.textContent,t=createPlainTextSearchRegex(this._searchQuery,"gi"),n=0,r=t.exec(e),i=[];while(r)i.push({offset:r.index,length:r[0].length}),r=t.exec(e);i.length||i.push({offset:0,length:e.length}),this._highlightResult=[],WebInspector.highlightSearchResults(this.listItemElement,i,this._highlightResult)},_scrollIntoView:function(){function e(e){function t(){this.scrollIntoViewIfNeeded(!0)}e&&e.callFunction(t)}WebInspector.RemoteObject.resolveNode(this._node,"",e)},_visibleChildren:function(){var e=WebInspector.ElementsTreeOutline.showShadowDOM()?this._node.shadowRoots():[];return this._node.templateContent()&&e.push(this._node.templateContent()),this._node.childNodeCount()&&(e=e.concat(this._node.children())),e},_visibleChildCount:function(){var e=this._node.childNodeCount();return this._node.templateContent()&&e++,WebInspector.ElementsTreeOutline.showShadowDOM()&&(e+=this._node.shadowRoots().length),e},_updateHasChildren:function(){this.hasChildren=!this._elementCloseTag&&!this._showInlineText()&&this._visibleChildCount()>0},__proto__:TreeElement.prototype},WebInspector.ElementsTreeUpdater=function(e){WebInspector.domAgent.addEventListener(WebInspector.DOMAgent.Events.NodeInserted,this._nodeInserted,this),WebInspector.domAgent.addEventListener(WebInspector.DOMAgent.Events.NodeRemoved,this._nodeRemoved,this),WebInspector.domAgent.addEventListener(WebInspector.DOMAgent.Events.AttrModified,this._attributesUpdated,this),WebInspector.domAgent.addEventListener(WebInspector.DOMAgent.Events.AttrRemoved,this._attributesUpdated,this),WebInspector.domAgent.addEventListener(WebInspector.DOMAgent.Events.CharacterDataModified,this._characterDataModified,this),WebInspector.domAgent.addEventListener(WebInspector.DOMAgent.Events.DocumentUpdated,this._documentUpdated,this),WebInspector.domAgent.addEventListener(WebInspector.DOMAgent.Events.ChildNodeCountUpdated,this._childNodeCountUpdated,this),this._treeOutline=e,this._recentlyModifiedNodes=new Map},WebInspector.ElementsTreeUpdater.prototype={_nodeModified:function(e,t,n){this._treeOutline._visible&&this._updateModifiedNodesSoon();var r=this._recentlyModifiedNodes.get(e);if(!r){r=new WebInspector.ElementsTreeUpdater.UpdateEntry(t,n),this._recentlyModifiedNodes.put(e,r);return}r.isUpdated|=t,n&&(r.parent=n)},_documentUpdated:function(e){var t=e.data;this._reset();if(!t)return;this._treeOutline.rootDOMNode=t},_attributesUpdated:function(e){this._nodeModified(e.data.node,!0)},_characterDataModified:function(e){this._nodeModified(e.data,!0)},_nodeInserted:function(e){this._nodeModified(e.data,!1,e.data.parentNode)},_nodeRemoved:function(e){this._nodeModified(e.data.node,!1,e.data.parent)},_childNodeCountUpdated:function(e){var t=this._treeOutline.findTreeElement(e.data);t&&t._updateHasChildren()},_updateModifiedNodesSoon:function(){if(this._updateModifiedNodesTimeout)return;this._updateModifiedNodesTimeout=setTimeout(this._updateModifiedNodes.bind(this),50)},_updateModifiedNodes:function(){this._updateModifiedNodesTimeout&&(clearTimeout(this._updateModifiedNodesTimeout),delete this._updateModifiedNodesTimeout);var e=[],t=this._recentlyModifiedNodes.size()>10;if(t){var n=this._treeOutline.element.parentNode;this._treeOutline.element.addStyleClass("hidden");var r=n?n.scrollTop:0}var i=this._recentlyModifiedNodes.keys();for(var s=0,o=i.length;s<o;++s){var u=i[s],a=this._recentlyModifiedNodes.get(u),f=a.parent;if(f===this._treeOutline._rootDOMNode){this._treeOutline.update(),this._treeOutline.element.removeStyleClass("hidden");return}if(a.isUpdated){var l=this._treeOutline.findTreeElement(u);l&&l.updateTitle()}var c=f?this._treeOutline.findTreeElement(f):null;c&&!c.alreadyUpdatedChildren&&(c.updateChildren(),c.alreadyUpdatedChildren=!0,e.push(c))}for(var s=0;s<e.length;++s)delete e[s].alreadyUpdatedChildren;t&&(this._treeOutline.element.removeStyleClass("hidden"),r&&(n.scrollTop=r),this._treeOutline.updateSelection()),this._recentlyModifiedNodes.clear(),this._treeOutline._fireElementsTreeUpdated(i)},_reset:function(){this._treeOutline.rootDOMNode=null,this._treeOutline.selectDOMNode(null,!1),WebInspector.domAgent.hideDOMNodeHighlight(),this._recentlyModifiedNodes.clear()}},WebInspector.ElementsTreeUpdater.UpdateEntry=function(e,t){this.isUpdated=e,t&&(this.parent=t)};