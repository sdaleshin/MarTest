/*
 * Copyright (C) 2012 Google Inc. All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 * 1. Redistributions of source code must retain the above copyright
 * notice, this list of conditions and the following disclaimer.
 *
 * 2. Redistributions in binary form must reproduce the above
 * copyright notice, this list of conditions and the following disclaimer
 * in the documentation and/or other materials provided with the
 * distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY GOOGLE INC. AND ITS CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL GOOGLE INC.
 * OR ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

WebInspector.SplitView=function(e,t,n,r){WebInspector.View.call(this),this.registerRequiredCSS("splitView.css"),this.element.className="split-view",this._firstElement=this.element.createChild("div","split-view-contents scroll-target split-view-contents-first"),this._secondElement=this.element.createChild("div","split-view-contents scroll-target split-view-contents-second"),this._resizerElement=this.element.createChild("div","split-view-resizer"),this.installResizer(this._resizerElement),this._resizable=!0,this._savedSidebarWidth=n||200,this._savedSidebarHeight=r||this._savedSidebarWidth,0<this._savedSidebarWidth&&this._savedSidebarWidth<1&&0<this._savedSidebarHeight&&this._savedSidebarHeight<1&&(this._useFraction=!0),this._sidebarSizeSettingName=t,this.setSecondIsSidebar(!0),this._innerSetVertical(e)},WebInspector.SplitView.prototype={isVertical:function(){return this._isVertical},setVertical:function(e){if(this._isVertical===e)return;this._innerSetVertical(e),this.isShowing()&&this._updateLayout()},_innerSetVertical:function(e){this.element.removeStyleClass(this._isVertical?"split-view-vertical":"split-view-horizontal"),this._isVertical=e,this.element.addStyleClass(this._isVertical?"split-view-vertical":"split-view-horizontal"),delete this._resizerElementSize,this._sidebarSize=-1},_updateLayout:function(){delete this._totalSize,this._innerSetSidebarSize(this._lastSidebarSize())},firstElement:function(){return this._firstElement},secondElement:function(){return this._secondElement},get mainElement(){return this.isSidebarSecond()?this.firstElement():this.secondElement()},get sidebarElement(){return this.isSidebarSecond()?this.secondElement():this.firstElement()},isSidebarSecond:function(){return this._secondIsSidebar},setSecondIsSidebar:function(e){this.sidebarElement.removeStyleClass("split-view-sidebar"),this._secondIsSidebar=e,this.sidebarElement.addStyleClass("split-view-sidebar")},resizerElement:function(){return this._resizerElement},showOnlyFirst:function(){this._showOnly(this._firstElement,this._secondElement)},showOnlySecond:function(){this._showOnly(this._secondElement,this._firstElement)},_showOnly:function(e,t){e.removeStyleClass("hidden"),e.addStyleClass("maximized"),t.addStyleClass("hidden"),t.removeStyleClass("maximized"),this._removeAllLayoutProperties(),this._isShowingOne=!0,this._sidebarSize=-1,this.setResizable(!1),this.doResize()},_removeAllLayoutProperties:function(){this._firstElement.style.removeProperty("right"),this._firstElement.style.removeProperty("bottom"),this._firstElement.style.removeProperty("width"),this._firstElement.style.removeProperty("height"),this._secondElement.style.removeProperty("left"),this._secondElement.style.removeProperty("top"),this._secondElement.style.removeProperty("width"),this._secondElement.style.removeProperty("height"),this._resizerElement.style.removeProperty("left"),this._resizerElement.style.removeProperty("right"),this._resizerElement.style.removeProperty("top"),this._resizerElement.style.removeProperty("bottom"),this._resizerElement.style.removeProperty("margin-left"),this._resizerElement.style.removeProperty("margin-right"),this._resizerElement.style.removeProperty("margin-top"),this._resizerElement.style.removeProperty("margin-bottom")},showBoth:function(){this._firstElement.removeStyleClass("hidden"),this._firstElement.removeStyleClass("maximized"),this._secondElement.removeStyleClass("hidden"),this._secondElement.removeStyleClass("maximized"),this._isShowingOne=!1,this._sidebarSize=-1,this.setResizable(!0),this.doResize()},setResizable:function(e){this._resizable=e,this._resizerElement.enableStyleClass("hidden",!e)},setSidebarSize:function(e){this._innerSetSidebarSize(e),this._saveSidebarSize()},sidebarSize:function(){return Math.max(0,this._sidebarSize)},totalSize:function(){return this._totalSize||(this._totalSize=this._isVertical?this.element.offsetWidth:this.element.offsetHeight),this._totalSize},_innerSetSidebarSize:function(e){if(this._isShowingOne){this._sidebarSize=e;return}e=this._applyConstraints(e);if(this._sidebarSize===e)return;if(e<0)return;this._removeAllLayoutProperties();var t;this._useFraction?t=e/this.totalSize()*100+"%":t=e+"px",this._resizerElementSize||(this._resizerElementSize=this._isVertical?this._resizerElement.offsetWidth:this._resizerElement.offsetHeight),this._isVertical?this._secondIsSidebar?(this._firstElement.style.right=t,this._secondElement.style.width=t,this._resizerElement.style.right=t,this._resizerElement.style.marginRight=-this._resizerElementSize/2+"px"):(this._firstElement.style.width=t,this._secondElement.style.left=t,this._resizerElement.style.left=t,this._resizerElement.style.marginLeft=-this._resizerElementSize/2+"px"):this._secondIsSidebar?(this._firstElement.style.bottom=t,this._secondElement.style.height=t,this._resizerElement.style.bottom=t,this._resizerElement.style.marginBottom=-this._resizerElementSize/2+"px"):(this._firstElement.style.height=t,this._secondElement.style.top=t,this._resizerElement.style.top=t,this._resizerElement.style.marginTop=-this._resizerElementSize/2+"px"),this._sidebarSize=e,this._muteOnResize=!0,this.doResize(),delete this._muteOnResize},setSidebarElementConstraints:function(e,t){typeof e=="number"&&(this._minimumSidebarWidth=e),typeof t=="number"&&(this._minimumSidebarHeight=t)},setMainElementConstraints:function(e,t){typeof e=="number"&&(this._minimumMainWidth=e),typeof t=="number"&&(this._minimumMainHeight=t)},_applyConstraints:function(e){const t=20;var n=this.totalSize(),r=(this.isVertical()?this._minimumSidebarWidth:this._minimumSidebarHeight)||0,i=!1;r&&r<1&&(i=!0,r=Math.round(n*r)),r=Math.max(r,t);var s=(this.isVertical()?this._minimumMainWidth:this._minimumMainHeight)||0,o=!1;s&&s<1&&(o=!0,s=Math.round(n*s)),s=Math.max(s,t);var u=n-s;return r<=u?Number.constrain(e,r,u):!i&&!o?-1:o&&e>=r&&r<n?r:i&&e<=u&&u<n?u:-1},wasShown:function(){this._updateLayout()},onResize:function(){if(this._muteOnResize)return;this._updateLayout()},_startResizerDragging:function(e){return this._resizable?(this._saveSidebarSizeRecursively(),this._dragOffset=(this._secondIsSidebar?this.totalSize()-this._sidebarSize:this._sidebarSize)-(this._isVertical?e.pageX:e.pageY),!0):!1},_resizerDragging:function(e){var t=(this._isVertical?e.pageX:e.pageY)+this._dragOffset,n=this._secondIsSidebar?this.totalSize()-t:t;this.setSidebarSize(n),e.preventDefault()},_endResizerDragging:function(e){delete this._dragOffset,this._saveSidebarSizeRecursively()},_saveSidebarSizeRecursively:function(){function e(){this._saveSidebarSize&&this._saveSidebarSize(),this._callOnVisibleChildren(e)}this._saveSidebarSize(),this._callOnVisibleChildren(e)},installResizer:function(e){e.addEventListener("mousedown",this._onDragStart.bind(this),!1)},_onDragStart:function(e){WebInspector._elementDragStart(this._startResizerDragging.bind(this),this._resizerDragging.bind(this),this._endResizerDragging.bind(this),this._isVertical?"ew-resize":"ns-resize",e)},_sizeSetting:function(){if(!this._sidebarSizeSettingName)return null;var e=this._sidebarSizeSettingName+(this._isVertical?"":"H");return WebInspector.settings[e]||(WebInspector.settings[e]=WebInspector.settings.createSetting(e,undefined)),WebInspector.settings[e]},_lastSidebarSize:function(){var e=this._sizeSetting(),t=e?e.get():0;return t||(t=this._isVertical?this._savedSidebarWidth:this._savedSidebarHeight),this._useFraction&&(t*=this.totalSize()),t},_saveSidebarSize:function(){var e=this._sidebarSize;if(e<0)return;this._useFraction&&(e/=this.totalSize()),this._isVertical?this._savedSidebarWidth=e:this._savedSidebarHeight=e;var t=this._sizeSetting();t&&t.set(e)},__proto__:WebInspector.View.prototype};