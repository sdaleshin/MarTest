/*
 * Copyright (C) 2012 Google Inc. All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 * notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above
 * copyright notice, this list of conditions and the following disclaimer
 * in the documentation and/or other materials provided with the
 * distribution.
 *     * Neither the name of Google Inc. nor the names of its
 * contributors may be used to endorse or promote products derived from
 * this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

WebInspector.OverridesView=function(){function f(e){var t=a.createChild("div","help-block");for(var n=0;n<e.length;++n)t.appendChild(e[n])}WebInspector.View.call(this),this.registerRequiredCSS("helpScreen.css"),this.element.addStyleClass("fill"),this.element.addStyleClass("help-window-main"),this.element.addStyleClass("settings-tab-container");var e=this.element.createChild("div","tabbed-pane-content"),t=e.createChild("header").createChild("h3");t.appendChild(document.createTextNode(WebInspector.UIString("Overrides")));var n=e.createChild("div","help-container-wrapper overrides-view"),r=n.createChild("div","settings-tab help-content"),i=r.createChild("div","help-block"),s=WebInspector.SettingsTab.createSettingCheckbox(WebInspector.UIString("Enable on DevTools startup"),WebInspector.settings.enableOverridesOnStartup);s.id="enable-devtools-on-startup",this._enableOnStartupField=s;var o=this._createNonPersistedCheckbox(WebInspector.UIString("Enable"),this._setOverridesActive.bind(this)),u=o.getElementsByTagName("input")[0];u.checked=WebInspector.settings.enableOverridesOnStartup.get(),i.appendChild(o),i.appendChild(s);var a=r.createChild("fieldset","help-container");this._mainContainer=a,this.containerElement=r,f([this._createUserAgentControl()]),f([this._createDeviceMetricsControl()]),f([this._createGeolocationOverrideControl()]),f([this._createDeviceOrientationOverrideControl()]),f([WebInspector.SettingsTab.createSettingCheckbox(WebInspector.UIString("Emulate touch events"),WebInspector.settings.emulateTouchEvents)]),f([this._createMediaEmulationElement()]),this._setOverridesActive(u.checked),this._statusElement=document.createElement("span"),this._statusElement.textContent=WebInspector.UIString("Overrides")},WebInspector.OverridesView.showInDrawer=function(){WebInspector.OverridesView._view||(WebInspector.OverridesView._view=new WebInspector.OverridesView);var e=WebInspector.OverridesView._view;WebInspector.showViewInDrawer(e._statusElement,e)},WebInspector.OverridesView.prototype={_setOverridesActive:function(e){WebInspector.overridesSupport.setOverridesActive(e),this._mainContainer.disabled=!e,this._enableOnStartupField.disabled=!e},_createSettingCheckbox:function(e,t,n){function i(e){t.set(e),n&&n(e)}var r=WebInspector.SettingsTab.createCheckbox(e,t.get.bind(t),i);return r},_createUserAgentControl:function(){var e=WebInspector.SettingsTab.createSettingCheckbox(WebInspector.UIString("User Agent"),WebInspector.settings.overrideUserAgent);return e.appendChild(this._createUserAgentSelectRowElement()),e},_createUserAgentSelectRowElement:function(){function a(){this._selectElement.selectedIndex=t.length-1,this._selectionChanged()}function f(){WebInspector.settings.userAgent.set(this._otherUserAgentElement.value)}var e=WebInspector.settings.userAgent.get();const t=[["Internet Explorer 10","Mozilla/5.0 (compatible; MSIE 10.0; Windows NT 6.2; Trident/6.0)"],["Internet Explorer 9","Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Trident/5.0)"],["Internet Explorer 8","Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.0; Trident/4.0)"],["Internet Explorer 7","Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.0)"],["Firefox 7 — Windows","Mozilla/5.0 (Windows NT 6.1; Intel Mac OS X 10.6; rv:7.0.1) Gecko/20100101 Firefox/7.0.1"],["Firefox 7 — Mac","Mozilla/5.0 (Macintosh; Intel Mac OS X 10.6; rv:7.0.1) Gecko/20100101 Firefox/7.0.1"],["Firefox 4 — Windows","Mozilla/5.0 (Windows NT 6.1; rv:2.0.1) Gecko/20100101 Firefox/4.0.1"],["Firefox 4 — Mac","Mozilla/5.0 (Macintosh; Intel Mac OS X 10.6; rv:2.0.1) Gecko/20100101 Firefox/4.0.1"],["Firefox 14 — Android Mobile","Mozilla/5.0 (Android; Mobile; rv:14.0) Gecko/14.0 Firefox/14.0"],["Firefox 14 — Android Tablet","Mozilla/5.0 (Android; Tablet; rv:14.0) Gecko/14.0 Firefox/14.0"],["Chrome — Android Mobile","Mozilla/5.0 (Linux; Android 4.0.4; Galaxy Nexus Build/IMM76B) AppleWebKit/535.19 (KHTML, like Gecko) Chrome/18.0.1025.133 Mobile Safari/535.19"],["Chrome — Android Tablet","Mozilla/5.0 (Linux; Android 4.1.2; Nexus 7 Build/JZ054K) AppleWebKit/535.19 (KHTML, like Gecko) Chrome/18.0.1025.166 Safari/535.19"],["iPhone — iOS 6","Mozilla/5.0 (iPhone; CPU iPhone OS 6_0 like Mac OS X) AppleWebKit/536.26 (KHTML, like Gecko) Version/6.0 Mobile/10A5376e Safari/8536.25","640x1136x1"],["iPhone — iOS 5","Mozilla/5.0 (iPhone; CPU iPhone OS 5_0 like Mac OS X) AppleWebKit/534.46 (KHTML, like Gecko) Version/5.1 Mobile/9A334 Safari/7534.48.3","640x960x1"],["iPhone — iOS 4","Mozilla/5.0 (iPhone; U; CPU iPhone OS 4_3_2 like Mac OS X; en-us) AppleWebKit/533.17.9 (KHTML, like Gecko) Version/5.0.2 Mobile/8H7 Safari/6533.18.5","640x960x1"],["iPad — iOS 6","Mozilla/5.0 (iPad; CPU OS 6_0 like Mac OS X) AppleWebKit/536.26 (KHTML, like Gecko) Version/6.0 Mobile/10A5376e Safari/8536.25","1024x768x1"],["iPad — iOS 5","Mozilla/5.0 (iPad; CPU OS 5_0 like Mac OS X) AppleWebKit/534.46 (KHTML, like Gecko) Version/5.1 Mobile/9A334 Safari/7534.48.3","1024x768x1"],["iPad — iOS 4","Mozilla/5.0 (iPad; CPU OS 4_3_2 like Mac OS X; en-us) AppleWebKit/533.17.9 (KHTML, like Gecko) Version/5.0.2 Mobile/8H7 Safari/6533.18.5","1024x768x1"],["Android 2.3 — Nexus S","Mozilla/5.0 (Linux; U; Android 2.3.6; en-us; Nexus S Build/GRK39F) AppleWebKit/533.1 (KHTML, like Gecko) Version/4.0 Mobile Safari/533.1","480x800x1.1"],["Android 4.0.2 — Galaxy Nexus","Mozilla/5.0 (Linux; U; Android 4.0.2; en-us; Galaxy Nexus Build/ICL53F) AppleWebKit/534.30 (KHTML, like Gecko) Version/4.0 Mobile Safari/534.30","720x1280x1.1"],["BlackBerry — PlayBook 2.1","Mozilla/5.0 (PlayBook; U; RIM Tablet OS 2.1.0; en-US) AppleWebKit/536.2+ (KHTML, like Gecko) Version/7.2.1.0 Safari/536.2+","1024x600x1"],["BlackBerry — 9900","Mozilla/5.0 (BlackBerry; U; BlackBerry 9900; en-US) AppleWebKit/534.11+ (KHTML, like Gecko) Version/7.0.0.187 Mobile Safari/534.11+","640x480x1"],["BlackBerry — BB10","Mozilla/5.0 (BB10; Touch) AppleWebKit/537.1+ (KHTML, like Gecko) Version/10.0.0.1337 Mobile Safari/537.1+","768x1280x1"],["MeeGo — Nokia N9","Mozilla/5.0 (MeeGo; NokiaN9) AppleWebKit/534.13 (KHTML, like Gecko) NokiaBrowser/8.5.0 Mobile Safari/534.13","480x854x1"],[WebInspector.UIString("Other..."),"Other"]];var n=WebInspector.SettingsTab.createSettingFieldset(WebInspector.settings.overrideUserAgent),r=n.createChild("p");this._selectElement=r.createChild("select"),this._otherUserAgentElement=r.createChild("input"),this._otherUserAgentElement.type="text",this._otherUserAgentElement.value=e,this._otherUserAgentElement.title=e;var i=!1;for(var s=0;s<t.length;++s){var o=t[s],u=new Option(o[0],o[1]);u._metrics=o[2]?o[2]:"",this._selectElement.add(u),e===o[1]&&(this._selectElement.selectedIndex=s,i=!0)}return i||(e?this._selectElement.selectedIndex=t.length-1:this._selectElement.selectedIndex=0),this._selectElement.addEventListener("change",this._selectionChanged.bind(this,!0),!1),n.addEventListener("dblclick",a.bind(this),!1),this._otherUserAgentElement.addEventListener("blur",f.bind(this),!1),n},_selectionChanged:function(e){var t=this._selectElement.options[this._selectElement.selectedIndex].value;t!=="Other"?(WebInspector.settings.userAgent.set(t),this._otherUserAgentElement.value=t,this._otherUserAgentElement.title=t,this._otherUserAgentElement.disabled=!0):(this._otherUserAgentElement.disabled=!1,this._otherUserAgentElement.focus());if(e){var n=this._selectElement.options[this._selectElement.selectedIndex]._metrics;this._setDeviceMetricsOverride(WebInspector.OverridesSupport.DeviceMetrics.parseSetting(n),!1)}},_createInput:function(e,t,n,r,i){var s=e.createChild("input");return s.id=t,s.type="text",s.maxLength=12,s.style.width="80px",s.value=n,s.align="right",i&&(s.className="numeric"),s.addEventListener("blur",r,!1),s},_createNonPersistedCheckbox:function(e,t){function i(){t(r.checked)}var n=document.createElement("label"),r=n.createChild("input");return r.type="checkbox",r.checked=!1,r.addEventListener("click",i,!1),n.appendChild(document.createTextNode(e)),n},_createDeviceMetricsControl:function(){const e=WebInspector.settings.deviceMetrics.get();var t=WebInspector.OverridesSupport.DeviceMetrics.parseSetting(e),n=this._createSettingCheckbox(WebInspector.UIString("Device metrics"),WebInspector.settings.overrideDeviceMetrics,this._onMetricsCheckboxClicked.bind(this));return n.appendChild(this._createDeviceMetricsElement(t)),this._onMetricsCheckboxClicked(WebInspector.settings.overrideDeviceMetrics.get()),n},_onMetricsCheckboxClicked:function(e){e&&!this._widthOverrideElement.value&&this._widthOverrideElement.focus()},_applyDeviceMetricsUserInput:function(){this._setDeviceMetricsOverride(WebInspector.OverridesSupport.DeviceMetrics.parseUserInput(this._widthOverrideElement.value.trim(),this._heightOverrideElement.value.trim(),this._fontScaleFactorOverrideElement.value.trim()),!0)},_setDeviceMetricsOverride:function(e,t){function n(e,t){e?t.removeStyleClass("error-input"):t.addStyleClass("error-input")}n(e&&e.isWidthValid(),this._widthOverrideElement),n(e&&e.isHeightValid(),this._heightOverrideElement),n(e&&e.isFontScaleFactorValid(),this._fontScaleFactorOverrideElement);if(!e)return;t||(this._widthOverrideElement.value=e.widthToInput(),this._heightOverrideElement.value=e.heightToInput(),this._fontScaleFactorOverrideElement.value=e.fontScaleFactorToInput());if(e.isValid()){var r=e.toSetting();r!==WebInspector.settings.deviceMetrics.get()&&WebInspector.settings.deviceMetrics.set(r)}},_createDeviceMetricsElement:function(e){function r(e){var t=this._widthOverrideElement.value;this._widthOverrideElement.value=this._heightOverrideElement.value,this._heightOverrideElement.value=t,this._applyDeviceMetricsUserInput()}var t=WebInspector.SettingsTab.createSettingFieldset(WebInspector.settings.overrideDeviceMetrics);t.id="metrics-override-section";var n=t.createChild("p"),i=n.createChild("table","nowrap"),s=i.createChild("tr"),o=s.createChild("td");o.appendChild(document.createTextNode(WebInspector.UIString("Screen resolution:"))),o=s.createChild("td"),this._widthOverrideElement=this._createInput(o,"metrics-override-width",String(e.width||screen.width),this._applyDeviceMetricsUserInput.bind(this),!0),o.appendChild(document.createTextNode(" × ")),this._heightOverrideElement=this._createInput(o,"metrics-override-height",String(e.height||screen.height),this._applyDeviceMetricsUserInput.bind(this),!0),o.appendChild(document.createTextNode(" — ")),this._swapDimensionsElement=o.createChild("button"),this._swapDimensionsElement.appendChild(document.createTextNode(" ⇄ ")),this._swapDimensionsElement.title=WebInspector.UIString("Swap dimensions"),this._swapDimensionsElement.addEventListener("click",r.bind(this),!1),s=i.createChild("tr"),o=s.createChild("td"),o.appendChild(document.createTextNode(WebInspector.UIString("Font scale factor:"))),o=s.createChild("td"),this._fontScaleFactorOverrideElement=this._createInput(o,"metrics-override-font-scale",String(e.fontScaleFactor||1),this._applyDeviceMetricsUserInput.bind(this),!0),s=i.createChild("tr"),o=s.createChild("td"),o.colSpan=2;var u=WebInspector.SettingsTab.createSettingCheckbox(WebInspector.UIString("Fit in window"),WebInspector.settings.deviceFitWindow,!0);return o.appendChild(u),t},_createGeolocationOverrideControl:function(){const e=WebInspector.settings.geolocationOverride.get();var t=WebInspector.OverridesSupport.GeolocationPosition.parseSetting(e),n=this._createSettingCheckbox(WebInspector.UIString("Override Geolocation"),WebInspector.settings.overrideGeolocation,this._geolocationOverrideCheckboxClicked.bind(this)),r=this._createGeolocationOverrideElement(t);return n.appendChild(r),this._geolocationOverrideCheckboxClicked(WebInspector.settings.overrideGeolocation.get()),n},_geolocationOverrideCheckboxClicked:function(e){e&&!this._latitudeElement.value&&this._latitudeElement.focus()},_applyGeolocationUserInput:function(){this._setGeolocationPosition(WebInspector.OverridesSupport.GeolocationPosition.parseUserInput(this._latitudeElement.value.trim(),this._longitudeElement.value.trim(),this._geolocationErrorElement.checked),!0)},_setGeolocationPosition:function(e,t){if(!e)return;t||(this._latitudeElement.value=e.latitude,this._longitudeElement.value=e.longitude);var n=e.toSetting();WebInspector.settings.geolocationOverride.set(n)},_createGeolocationOverrideElement:function(e){var t=WebInspector.SettingsTab.createSettingFieldset(WebInspector.settings.overrideGeolocation);t.id="geolocation-override-section";var n=t.createChild("p"),r=n.createChild("table"),i=r.createChild("tr"),s=i.createChild("td");s.appendChild(document.createTextNode(WebInspector.UIString("Geolocation Position")+":")),s=i.createChild("td"),s.appendChild(document.createTextNode(WebInspector.UIString("Lat = "))),this._latitudeElement=this._createInput(s,"geolocation-override-latitude",String(e.latitude),this._applyGeolocationUserInput.bind(this),!0),s.appendChild(document.createTextNode(" , ")),s.appendChild(document.createTextNode(WebInspector.UIString("Lon = "))),this._longitudeElement=this._createInput(s,"geolocation-override-longitude",String(e.longitude),this._applyGeolocationUserInput.bind(this),!0),i=r.createChild("tr"),s=i.createChild("td"),s.colSpan=2;var o=document.createElement("label"),u=o.createChild("input");return u.id="geolocation-error",u.type="checkbox",u.checked=!e||e.error,u.addEventListener("click",this._applyGeolocationUserInput.bind(this),!1),o.appendChild(document.createTextNode(WebInspector.UIString("Emulate position unavailable"))),this._geolocationErrorElement=u,s.appendChild(o),t},_createDeviceOrientationOverrideControl:function(){const e=WebInspector.settings.deviceOrientationOverride.get();var t=WebInspector.OverridesSupport.DeviceOrientation.parseSetting(e),n=this._createSettingCheckbox(WebInspector.UIString("Override Device Orientation"),WebInspector.settings.overrideDeviceOrientation,this._deviceOrientationOverrideCheckboxClicked.bind(this)),r=this._createDeviceOrientationOverrideElement(t);return n.appendChild(r),this._deviceOrientationOverrideCheckboxClicked(WebInspector.settings.overrideDeviceOrientation.get()),n},_deviceOrientationOverrideCheckboxClicked:function(e){e&&!this._alphaElement.value&&this._alphaElement.focus()},_applyDeviceOrientationUserInput:function(){this._setDeviceOrientation(WebInspector.OverridesSupport.DeviceOrientation.parseUserInput(this._alphaElement.value.trim(),this._betaElement.value.trim(),this._gammaElement.value.trim()),!0)},_setDeviceOrientation:function(e,t){if(!e)return;t||(this._alphaElement.value=e.alpha,this._betaElement.value=e.beta,this._gammaElement.value=e.gamma);var n=e.toSetting();WebInspector.settings.deviceOrientationOverride.set(n)},_createDeviceOrientationOverrideElement:function(e){var t=WebInspector.SettingsTab.createSettingFieldset(WebInspector.settings.overrideDeviceOrientation);t.id="device-orientation-override-section";var n=t.createChild("p"),r=n.createChild("table"),i=r.createChild("tr"),s=i.createChild("td");return s.appendChild(document.createTextNode("α: ")),this._alphaElement=this._createInput(s,"device-orientation-override-alpha",String(e.alpha),this._applyDeviceOrientationUserInput.bind(this),!0),s.appendChild(document.createTextNode(" β: ")),this._betaElement=this._createInput(s,"device-orientation-override-beta",String(e.beta),this._applyDeviceOrientationUserInput.bind(this),!0),s.appendChild(document.createTextNode(" γ: ")),this._gammaElement=this._createInput(s,"device-orientation-override-gamma",String(e.gamma),this._applyDeviceOrientationUserInput.bind(this),!0),t},_createMediaEmulationElement:function(){var e=WebInspector.SettingsTab.createSettingCheckbox(WebInspector.UIString("Emulate CSS media"),WebInspector.settings.overrideCSSMedia),t=WebInspector.SettingsTab.createSettingFieldset(WebInspector.settings.overrideCSSMedia);e.appendChild(t);var n=t.createChild("p"),r=n.createChild("select"),i=WebInspector.CSSStyleModel.MediaTypes,s=WebInspector.settings.emulatedCSSMedia.get();for(var o=0;o<i.length;++o){var u=i[o];if(u==="all")continue;var a=document.createElement("option");a.text=u,a.value=u,r.add(a),u===s&&(r.selectedIndex=r.options.length-1)}return r.addEventListener("change",this._emulateMediaChanged.bind(this,r),!1),e},_emulateMediaChanged:function(e){var t=e.options[e.selectedIndex].value;WebInspector.settings.emulatedCSSMedia.set(t)},__proto__:WebInspector.View.prototype};