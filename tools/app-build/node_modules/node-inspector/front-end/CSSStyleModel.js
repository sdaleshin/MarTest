/*
 * Copyright (C) 2010 Google Inc. All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 * notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above
 * copyright notice, this list of conditions and the following disclaimer
 * in the documentation and/or other materials provided with the
 * distribution.
 *     * Neither the name of Google Inc. nor the names of its
 * contributors may be used to endorse or promote products derived from
 * this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

WebInspector.CSSStyleModel=function(e){this._workspace=e,this._pendingCommandsMajorState=[],WebInspector.domAgent.addEventListener(WebInspector.DOMAgent.Events.UndoRedoRequested,this._undoRedoRequested,this),WebInspector.domAgent.addEventListener(WebInspector.DOMAgent.Events.UndoRedoCompleted,this._undoRedoCompleted,this),WebInspector.resourceTreeModel.addEventListener(WebInspector.ResourceTreeModel.EventTypes.MainFrameCreatedOrNavigated,this._mainFrameCreatedOrNavigated,this),this._namedFlowCollections={},WebInspector.domAgent.addEventListener(WebInspector.DOMAgent.Events.DocumentUpdated,this._resetNamedFlowCollections,this),InspectorBackend.registerCSSDispatcher(new WebInspector.CSSDispatcher(this)),CSSAgent.enable(),this._resetStyleSheets()},WebInspector.CSSStyleModel.parseRuleArrayPayload=function(e){var t=[];for(var n=0;n<e.length;++n)t.push(WebInspector.CSSRule.parsePayload(e[n]));return t},WebInspector.CSSStyleModel.parseRuleMatchArrayPayload=function(e){var t=[];for(var n=0;n<e.length;++n)t.push(WebInspector.CSSRule.parsePayload(e[n].rule,e[n].matchingSelectors));return t},WebInspector.CSSStyleModel.Events={StyleSheetAdded:"StyleSheetAdded",StyleSheetChanged:"StyleSheetChanged",StyleSheetRemoved:"StyleSheetRemoved",MediaQueryResultChanged:"MediaQueryResultChanged",NamedFlowCreated:"NamedFlowCreated",NamedFlowRemoved:"NamedFlowRemoved",RegionLayoutUpdated:"RegionLayoutUpdated",RegionOversetChanged:"RegionOversetChanged"},WebInspector.CSSStyleModel.MediaTypes=["all","braille","embossed","handheld","print","projection","screen","speech","tty","tv"],WebInspector.CSSStyleModel.prototype={getMatchedStylesAsync:function(e,t,n,r){function i(e,t,n,r,i){if(t){e&&e(null);return}var s={};n&&(s.matchedCSSRules=WebInspector.CSSStyleModel.parseRuleMatchArrayPayload(n));if(r){s.pseudoElements=[];for(var o=0;o<r.length;++o){var u=r[o];s.pseudoElements.push({pseudoId:u.pseudoId,rules:WebInspector.CSSStyleModel.parseRuleMatchArrayPayload(u.matches)})}}if(i){s.inherited=[];for(var o=0;o<i.length;++o){var u=i[o],a={};u.inlineStyle&&(a.inlineStyle=WebInspector.CSSStyleDeclaration.parsePayload(u.inlineStyle)),u.matchedCSSRules&&(a.matchedCSSRules=WebInspector.CSSStyleModel.parseRuleMatchArrayPayload(u.matchedCSSRules)),s.inherited.push(a)}}e&&e(s)}CSSAgent.getMatchedStylesForNode(e,t,n,i.bind(null,r))},getComputedStyleAsync:function(e,t){function n(e,t,n){t||!n?e(null):e(WebInspector.CSSStyleDeclaration.parseComputedStylePayload(n))}CSSAgent.getComputedStyleForNode(e,n.bind(null,t))},getPlatformFontsForNode:function(e,t){function n(e,n,r){e?t(null,null):t(n,r)}CSSAgent.getPlatformFontsForNode(e,n)},getInlineStylesAsync:function(e,t){function n(e,t,n,r){t||!n?e(null,null):e(WebInspector.CSSStyleDeclaration.parsePayload(n),r?WebInspector.CSSStyleDeclaration.parsePayload(r):null)}CSSAgent.getInlineStylesForNode(e,n.bind(null,t))},forcePseudoState:function(e,t,n){CSSAgent.forcePseudoState(e,t||[],n)},getNamedFlowCollectionAsync:function(e,t){function r(t,n,r){if(n||!r)t(null);else{var i=new WebInspector.NamedFlowCollection(r);this._namedFlowCollections[e]=i,t(i)}}var n=this._namedFlowCollections[e];if(n){t(n);return}CSSAgent.getNamedFlowCollection(e,r.bind(this,t))},getFlowByNameAsync:function(e,t,n){function i(e,n){n?e(n.flowByName(t)):e(null)}var r=this._namedFlowCollections[e];if(r){n(r.flowByName(t));return}this.getNamedFlowCollectionAsync(e,i.bind(this,n))},setRuleSelector:function(e,t,n,r,i){function s(e,t,n,r){if(!r)return;var i=r.indexOf(e)>=0,s=WebInspector.CSSRule.parsePayload(n);t(s,i)}function o(e,t,n,r,i,o){this._pendingCommandsMajorState.pop();if(i)n();else{WebInspector.domAgent.markUndoableState();var u=this._ownerDocumentId(e);u?WebInspector.domAgent.querySelectorAll(u,r,s.bind(this,e,t,o)):n()}}this._pendingCommandsMajorState.push(!0),CSSAgent.setRuleSelector(e,n,o.bind(this,t,r,i,n))},addRule:function(e,t,n,r){function i(e,t,n,r){if(!r)return;var i=r.indexOf(e)>=0,s=WebInspector.CSSRule.parsePayload(n);t(s,i)}function s(t,n,r,s,o){this._pendingCommandsMajorState.pop();if(s)n();else{WebInspector.domAgent.markUndoableState();var u=this._ownerDocumentId(e);u?WebInspector.domAgent.querySelectorAll(u,r,i.bind(this,e,t,o)):n()}}this._pendingCommandsMajorState.push(!0),CSSAgent.addRule(e,t,s.bind(this,n,r,t))},mediaQueryResultChanged:function(){this.dispatchEventToListeners(WebInspector.CSSStyleModel.Events.MediaQueryResultChanged)},styleSheetHeaderForId:function(e){return this._styleSheetIdToHeader[e]},styleSheetHeaders:function(){return Object.values(this._styleSheetIdToHeader)},_ownerDocumentId:function(e){var t=WebInspector.domAgent.nodeForId(e);return t?t.ownerDocument?t.ownerDocument.id:null:null},_fireStyleSheetChanged:function(e){if(!this._pendingCommandsMajorState.length)return;var t=this._pendingCommandsMajorState[this._pendingCommandsMajorState.length-1];if(!t||!e||!this.hasEventListeners(WebInspector.CSSStyleModel.Events.StyleSheetChanged))return;this.dispatchEventToListeners(WebInspector.CSSStyleModel.Events.StyleSheetChanged,{styleSheetId:e,majorChange:t})},_styleSheetAdded:function(e){console.assert(!this._styleSheetIdToHeader[e.styleSheetId]);var t=new WebInspector.CSSStyleSheetHeader(e);this._styleSheetIdToHeader[e.styleSheetId]=t;var n=t.resourceURL();this._styleSheetIdsForURL[n]||(this._styleSheetIdsForURL[n]={});var r=this._styleSheetIdsForURL[n],i=r[t.frameId];i||(i=[],r[t.frameId]=i),i.push(t.id),this.dispatchEventToListeners(WebInspector.CSSStyleModel.Events.StyleSheetAdded,t)},_styleSheetRemoved:function(e){var t=this._styleSheetIdToHeader[e];console.assert(t),delete this._styleSheetIdToHeader[e];var n=t.resourceURL(),r=this._styleSheetIdsForURL[n];r[t.frameId].remove(e),r[t.frameId].length||(delete r[t.frameId],Object.keys(this._styleSheetIdsForURL[n]).length||delete this._styleSheetIdsForURL[n]),this.dispatchEventToListeners(WebInspector.CSSStyleModel.Events.StyleSheetRemoved,t)},styleSheetIdsForURL:function(e){var t=this._styleSheetIdsForURL[e];if(!t)return[];var n=[];for(var r in t)n=n.concat(t[r]);return n},styleSheetIdsByFrameIdForURL:function(e){var t=this._styleSheetIdsForURL[e];return t?t:{}},_namedFlowCreated:function(e){var t=WebInspector.NamedFlow.parsePayload(e),n=this._namedFlowCollections[t.documentNodeId];if(!n)return;n._appendNamedFlow(t),this.dispatchEventToListeners(WebInspector.CSSStyleModel.Events.NamedFlowCreated,t)},_namedFlowRemoved:function(e,t){var n=this._namedFlowCollections[e];if(!n)return;n._removeNamedFlow(t),this.dispatchEventToListeners(WebInspector.CSSStyleModel.Events.NamedFlowRemoved,{documentNodeId:e,flowName:t})},_regionLayoutUpdated:function(e){var t=WebInspector.NamedFlow.parsePayload(e),n=this._namedFlowCollections[t.documentNodeId];if(!n)return;n._appendNamedFlow(t),this.dispatchEventToListeners(WebInspector.CSSStyleModel.Events.RegionLayoutUpdated,t)},_regionOversetChanged:function(e){var t=WebInspector.NamedFlow.parsePayload(e),n=this._namedFlowCollections[t.documentNodeId];if(!n)return;n._appendNamedFlow(t),this.dispatchEventToListeners(WebInspector.CSSStyleModel.Events.RegionOversetChanged,t)},setStyleSheetText:function(e,t,n,r){function i(e){this._pendingCommandsMajorState.pop(),!e&&n&&WebInspector.domAgent.markUndoableState(),!e&&r&&r(e)}this._pendingCommandsMajorState.push(n),CSSAgent.setStyleSheetText(e,t,i.bind(this))},_undoRedoRequested:function(){this._pendingCommandsMajorState.push(!0)},_undoRedoCompleted:function(){this._pendingCommandsMajorState.pop()},_mainFrameCreatedOrNavigated:function(){this._resetStyleSheets()},_resetStyleSheets:function(){this._styleSheetIdsForURL={},this._styleSheetIdToHeader={}},_resetNamedFlowCollections:function(){this._namedFlowCollections={}},updateLocations:function(){var e=Object.values(this._styleSheetIdToHeader);for(var t=0;t<e.length;++t)e[t].updateLocations()},createLiveLocation:function(e,t,n){if(!t)return null;var r=this.styleSheetHeaderForId(e);return r?r.createLiveLocation(t,n):null},rawLocationToUILocation:function(e){var t=this._styleSheetIdsForURL[e.url];if(!t)return null;var n=[];for(var r in t)n=n.concat(t[r]);var i;for(var s=0;!i&&s<n.length;++s){var o=this.styleSheetHeaderForId(n[s]);console.assert(o),i=o.rawLocationToUILocation(e.lineNumber,e.columnNumber)}return i||null},__proto__:WebInspector.Object.prototype},WebInspector.CSSStyleModel.LiveLocation=function(e,t,n){WebInspector.LiveLocation.call(this,e,t),this._header=n},WebInspector.CSSStyleModel.LiveLocation.prototype={uiLocation:function(){var e=this.rawLocation();return this._header.rawLocationToUILocation(e.lineNumber,e.columnNumber)},dispose:function(){WebInspector.LiveLocation.prototype.dispose.call(this),this._header._removeLocation(this)},__proto__:WebInspector.LiveLocation.prototype},WebInspector.CSSLocation=function(e,t,n){this.url=e,this.lineNumber=t,this.columnNumber=n||0},WebInspector.CSSStyleDeclaration=function(e){this.id=e.styleId,this.width=e.width,this.height=e.height,this.range=e.range,this._shorthandValues=WebInspector.CSSStyleDeclaration.buildShorthandValueMap(e.shorthandEntries),this._livePropertyMap={},this._allProperties=[],this.__disabledProperties={};var t=e.cssProperties.length,n=0;for(var r=0;r<t;++r){var i=WebInspector.CSSProperty.parsePayload(this,r,e.cssProperties[r]);this._allProperties.push(i),i.disabled&&(this.__disabledProperties[r]=i);if(!i.active&&!i.styleBased)continue;var s=i.name;this[n]=s,this._livePropertyMap[s]=i,++n}this.length=n,"cssText"in e&&(this.cssText=e.cssText)},WebInspector.CSSStyleDeclaration.buildShorthandValueMap=function(e){var t={};for(var n=0;n<e.length;++n)t[e[n].name]=e[n].value;return t},WebInspector.CSSStyleDeclaration.parsePayload=function(e){return new WebInspector.CSSStyleDeclaration(e)},WebInspector.CSSStyleDeclaration.parseComputedStylePayload=function(e){var t={cssProperties:[],shorthandEntries:[],width:"",height:""};return e&&(t.cssProperties=e),new WebInspector.CSSStyleDeclaration(t)},WebInspector.CSSStyleDeclaration.prototype={get allProperties(){return this._allProperties},getLiveProperty:function(e){return this._livePropertyMap[e]},getPropertyValue:function(e){var t=this._livePropertyMap[e];return t?t.value:""},getPropertyPriority:function(e){var t=this._livePropertyMap[e];return t?t.priority:""},isPropertyImplicit:function(e){var t=this._livePropertyMap[e];return t?t.implicit:""},longhandProperties:function(e){var t=WebInspector.CSSMetadata.cssPropertiesMetainfo.longhands(e),n=[];for(var r=0;t&&r<t.length;++r){var i=this._livePropertyMap[t[r]];i&&n.push(i)}return n},shorthandValue:function(e){return this._shorthandValues[e]},propertyAt:function(e){return e<this.allProperties.length?this.allProperties[e]:null},pastLastSourcePropertyIndex:function(){for(var e=this.allProperties.length-1;e>=0;--e){var t=this.allProperties[e];if(t.active||t.disabled)return e+1}return 0},newBlankProperty:function(e){return e=typeof e=="undefined"?this.pastLastSourcePropertyIndex():e,new WebInspector.CSSProperty(this,e,"","","","active",!0,!1,"")},insertPropertyAt:function(e,t,n,r){function i(e,t){WebInspector.cssModel._pendingCommandsMajorState.pop();if(!r)return;e?(console.error(e),r(null)):r(WebInspector.CSSStyleDeclaration.parsePayload(t))}if(!this.id)throw"No style id";WebInspector.cssModel._pendingCommandsMajorState.push(!0),CSSAgent.setPropertyText(this.id,e,t+": "+n+";",!1,i.bind(this))},appendProperty:function(e,t,n){this.insertPropertyAt(this.allProperties.length,e,t,n)},setText:function(e,t){function n(e,n){WebInspector.cssModel._pendingCommandsMajorState.pop();if(!t)return;e?(console.error(e),t(null)):t(WebInspector.CSSStyleDeclaration.parsePayload(n))}if(!this.id)throw"No style id";if(typeof this.cssText=="undefined"){t(null);return}WebInspector.cssModel._pendingCommandsMajorState.push(!0),CSSAgent.setStyleText(this.id,e,n)}},WebInspector.CSSRule=function(e,t){this.id=e.ruleId,t&&(this.matchingSelectors=t),this.selectors=e.selectorList.selectors,this.selectorText=this.selectors.join(", "),this.selectorRange=e.selectorList.range,this.sourceURL=e.sourceURL,this.origin=e.origin,this.style=WebInspector.CSSStyleDeclaration.parsePayload(e.style),this.style.parentRule=this,e.media&&(this.media=WebInspector.CSSMedia.parseMediaArrayPayload(e.media)),this._setRawLocationAndFrameId()},WebInspector.CSSRule.parsePayload=function(e,t){return new WebInspector.CSSRule(e,t)},WebInspector.CSSRule.prototype={_setRawLocationAndFrameId:function(){if(!this.id)return;var e=WebInspector.cssModel.styleSheetHeaderForId(this.id.styleSheetId);this.frameId=e.frameId;var t=e.resourceURL();if(!t)return;this.rawLocation=new WebInspector.CSSLocation(t,this.lineNumberInSource(),this.columnNumberInSource())},resourceURL:function(){if(!this.id)return"";var e=WebInspector.cssModel.styleSheetHeaderForId(this.id.styleSheetId);return e.resourceURL()},lineNumberInSource:function(){if(!this.selectorRange)return 0;var e=WebInspector.cssModel.styleSheetHeaderForId(this.id.styleSheetId);return e.lineNumberInSource(this.selectorRange.startLine)},columnNumberInSource:function(){if(!this.selectorRange)return undefined;var e=WebInspector.cssModel.styleSheetHeaderForId(this.id.styleSheetId);return console.assert(e),e.columnNumberInSource(this.selectorRange.startLine,this.selectorRange.startColumn)},get isUserAgent(){return this.origin==="user-agent"},get isUser(){return this.origin==="user"},get isViaInspector(){return this.origin==="inspector"},get isRegular(){return this.origin==="regular"}},WebInspector.CSSProperty=function(e,t,n,r,i,s,o,u,a,f){this.ownerStyle=e,this.index=t,this.name=n,this.value=r,this.priority=i,this.status=s,this.parsedOk=o,this.implicit=u,this.text=a,this.range=f},WebInspector.CSSProperty.parsePayload=function(e,t,n){var r=new WebInspector.CSSProperty(e,t,n.name,n.value,n.priority||"",n.status||"style","parsedOk"in n?!!n.parsedOk:!0,!!n.implicit,n.text,n.range);return r},WebInspector.CSSProperty.prototype={get propertyText(){return this.text!==undefined?this.text:this.name===""?"":this.name+": "+this.value+(this.priority?" !"+this.priority:"")+";"},get isLive(){return this.active||this.styleBased},get active(){return this.status==="active"},get styleBased(){return this.status==="style"},get inactive(){return this.status==="inactive"},get disabled(){return this.status==="disabled"},setText:function(e,t,n,r){function i(e){r&&r(e)}function s(n,s){WebInspector.cssModel._pendingCommandsMajorState.pop();if(!n){t&&WebInspector.domAgent.markUndoableState(),this.text=e;var o=WebInspector.CSSStyleDeclaration.parsePayload(s),u=o.allProperties[this.index];if(u&&this.disabled&&!e.match(/^\s*$/)){u.setDisabled(!1,i);return}r&&r(o)}else r&&r(null)}if(!this.ownerStyle)throw"No ownerStyle for property";if(!this.ownerStyle.id)throw"No owner style id";WebInspector.cssModel._pendingCommandsMajorState.push(t),CSSAgent.setPropertyText(this.ownerStyle.id,this.index,e,n,s.bind(this))},setValue:function(e,t,n,r){var i=this.name+": "+e+(this.priority?" !"+this.priority:"")+";";this.setText(i,t,n,r)},setDisabled:function(e,t){function n(e,n){WebInspector.cssModel._pendingCommandsMajorState.pop();if(e){t&&t(null);return}WebInspector.domAgent.markUndoableState();if(t){var r=WebInspector.CSSStyleDeclaration.parsePayload(n);t(r)}}!this.ownerStyle&&t&&t(null),e===this.disabled&&t&&t(this.ownerStyle);if(!this.ownerStyle.id)throw"No owner style id";WebInspector.cssModel._pendingCommandsMajorState.push(!1),CSSAgent.toggleProperty(this.ownerStyle.id,this.index,e,n.bind(this))},uiLocation:function(e){if(!this.range||!this.ownerStyle||!this.ownerStyle.parentRule)return null;var t=this.ownerStyle.parentRule.resourceURL();if(!t)return null;var n=this.range,r=e?n.startLine:n.endLine,i=e?n.startColumn:n.endColumn-(this.text&&this.text.endsWith(";")?2:1),s=new WebInspector.CSSLocation(t,r,i);return WebInspector.cssModel.rawLocationToUILocation(s)}},WebInspector.CSSMedia=function(e){this.text=e.text,this.source=e.source,this.sourceURL=e.sourceURL||"",this.range=e.range,this.parentStyleSheetId=e.parentStyleSheetId},WebInspector.CSSMedia.Source={LINKED_SHEET:"linkedSheet",INLINE_SHEET:"inlineSheet",MEDIA_RULE:"mediaRule",IMPORT_RULE:"importRule"},WebInspector.CSSMedia.parsePayload=function(e){return new WebInspector.CSSMedia(e)},WebInspector.CSSMedia.parseMediaArrayPayload=function(e){var t=[];for(var n=0;n<e.length;++n)t.push(WebInspector.CSSMedia.parsePayload(e[n]));return t},WebInspector.CSSMedia.prototype={lineNumberInSource:function(){if(!this.range)return undefined;var e=this.header();return e?e.lineNumberInSource(this.range.startLine):undefined},columnNumberInSource:function(){if(!this.range)return undefined;var e=this.header();return e?e.columnNumberInSource(this.range.startLine,this.range.startColumn):undefined},header:function(){return this.parentStyleSheetId?WebInspector.cssModel.styleSheetHeaderForId(this.parentStyleSheetId):null}},WebInspector.CSSStyleSheetHeader=function(e){this.id=e.styleSheetId,this.frameId=e.frameId,this.sourceURL=e.sourceURL,this.hasSourceURL=!!e.hasSourceURL,this.sourceMapURL=e.sourceMapURL,this.origin=e.origin,this.title=e.title,this.disabled=e.disabled,this.isInline=e.isInline,this.startLine=e.startLine,this.startColumn=e.startColumn,this._locations=new Set,this._sourceMappings=[]},WebInspector.CSSStyleSheetHeader.prototype={resourceURL:function(){return this.origin==="inspector"?this._viaInspectorResourceURL():this.sourceURL},createLiveLocation:function(e,t){var n=new WebInspector.CSSStyleModel.LiveLocation(e,t,this);return this._locations.add(n),n.update(),n},updateLocations:function(){var e=this._locations.items();for(var t=0;t<e.length;++t)e[t].update()},_removeLocation:function(e){this._locations.remove(e)},rawLocationToUILocation:function(e,t){var n,r=new WebInspector.CSSLocation(this.resourceURL(),e,t||0);for(var i=this._sourceMappings.length-1;!n&&i>=0;--i)n=this._sourceMappings[i].rawLocationToUILocation(r);return n||null},pushSourceMapping:function(e){this._sourceMappings.push(e),this.updateLocations()},_key:function(){return this.frameId+":"+this.resourceURL()},_viaInspectorResourceURL:function(){var e=WebInspector.resourceTreeModel.frameForId(this.frameId);console.assert(e);var t=new WebInspector.ParsedURL(e.url),n="inspector://"+t.host+t.folderPathComponents;return n.endsWith("/")||(n+="/"),n+="inspector-stylesheet",n},lineNumberInSource:function(e){return this.startLine+e},columnNumberInSource:function(e,t){return(e?0:this.startColumn)+t},contentURL:function(){return this.resourceURL()},contentType:function(){return WebInspector.resourceTypes.Stylesheet},requestContent:function(e){function t(t,n){t&&(WebInspector.log("Failed to get text for stylesheet "+this.id+": "+t),n=""),e(n,!1,"text/css")}CSSAgent.getStyleSheetText(this.id,t.bind(this))},searchInContent:function(e,t,n,r){function i(i){r(WebInspector.ContentProvider.performSearchInContent(i,e,t,n))}this.requestContent(i)}},WebInspector.CSSStyleSheet=function(e){this.id=e.styleSheetId,this.rules=[],this.styles={};for(var t=0;t<e.rules.length;++t){var n=WebInspector.CSSRule.parsePayload(e.rules[t]);this.rules.push(n),n.style&&(this.styles[n.style.id]=n.style)}"text"in e&&(this._text=e.text)},WebInspector.CSSStyleSheet.createForId=function(e,t){function n(e,n){e?t(null):t(new WebInspector.CSSStyleSheet(n))}CSSAgent.getStyleSheet(e,n.bind(this))},WebInspector.CSSStyleSheet.prototype={getText:function(){return this._text},setText:function(e,t,n){function r(e){e||WebInspector.domAgent.markUndoableState(),WebInspector.cssModel._pendingCommandsMajorState.pop(),n&&n(e)}WebInspector.cssModel._pendingCommandsMajorState.push(t),CSSAgent.setStyleSheetText(this.id,e,r.bind(this))}},WebInspector.CSSDispatcher=function(e){this._cssModel=e},WebInspector.CSSDispatcher.prototype={mediaQueryResultChanged:function(){this._cssModel.mediaQueryResultChanged()},styleSheetChanged:function(e){this._cssModel._fireStyleSheetChanged(e)},styleSheetAdded:function(e){this._cssModel._styleSheetAdded(e)},styleSheetRemoved:function(e){this._cssModel._styleSheetRemoved(e)},namedFlowCreated:function(e){this._cssModel._namedFlowCreated(e)},namedFlowRemoved:function(e,t){this._cssModel._namedFlowRemoved(e,t)},regionLayoutUpdated:function(e){this._cssModel._regionLayoutUpdated(e)},regionOversetChanged:function(e){this._cssModel._regionOversetChanged(e)}},WebInspector.NamedFlow=function(e){this.documentNodeId=e.documentNodeId,this.name=e.name,this.overset=e.overset,this.content=e.content,this.regions=e.regions},WebInspector.NamedFlow.parsePayload=function(e){return new WebInspector.NamedFlow(e)},WebInspector.NamedFlowCollection=function(e){this.namedFlowMap={};for(var t=0;t<e.length;++t){var n=WebInspector.NamedFlow.parsePayload(e[t]);this.namedFlowMap[n.name]=n}},WebInspector.NamedFlowCollection.prototype={_appendNamedFlow:function(e){this.namedFlowMap[e.name]=e},_removeNamedFlow:function(e){delete this.namedFlowMap[e]},flowByName:function(e){var t=this.namedFlowMap[e];return t?t:null}},WebInspector.cssModel=null;