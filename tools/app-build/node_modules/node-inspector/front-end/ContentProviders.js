/*
 * Copyright (C) 2011 Google Inc. All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 * notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above
 * copyright notice, this list of conditions and the following disclaimer
 * in the documentation and/or other materials provided with the
 * distribution.
 *     * Neither the name of Google Inc. nor the names of its
 * contributors may be used to endorse or promote products derived from
 * this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

WebInspector.ConcatenatedScriptsContentProvider=function(e){this._mimeType="text/html",this._scripts=e},WebInspector.ConcatenatedScriptsContentProvider.scriptOpenTag="<script>",WebInspector.ConcatenatedScriptsContentProvider.scriptCloseTag="</script>",WebInspector.ConcatenatedScriptsContentProvider.prototype={_sortedScripts:function(){if(this._sortedScriptsArray)return this._sortedScriptsArray;this._sortedScriptsArray=[];var e=this._scripts.slice();e.sort(function(e,t){return e.lineOffset-t.lineOffset||e.columnOffset-t.columnOffset});var t=WebInspector.ConcatenatedScriptsContentProvider.scriptOpenTag.length,n=WebInspector.ConcatenatedScriptsContentProvider.scriptCloseTag.length;this._sortedScriptsArray.push(e[0]);for(var r=1;r<e.length;++r){var i=this._sortedScriptsArray[this._sortedScriptsArray.length-1],s=i.endLine,o=i.endColumn+n+t;(s<e[r].lineOffset||s===e[r].lineOffset&&o<=e[r].columnOffset)&&this._sortedScriptsArray.push(e[r])}return this._sortedScriptsArray},contentURL:function(){return""},contentType:function(){return WebInspector.resourceTypes.Document},requestContent:function(e){function r(r,i,s){n.push(r),n.length==t.length&&e(this._concatenateScriptsContent(t,n),!1,this._mimeType)}var t=this._sortedScripts(),n=[];for(var i=0;i<t.length;++i)t[i].requestContent(r.bind(this))},searchInContent:function(e,t,n,r){function u(){if(o)return;var e=[];for(var t=0;t<s.length;++t)e=e.concat(i[s[t].scriptId]);r(e)}function a(e,t){i[e.scriptId]=[];for(var n=0;n<t.length;++n){var r=new WebInspector.ContentProvider.SearchMatch(t[n].lineNumber+e.lineOffset,t[n].lineContent);i[e.scriptId].push(r)}o--,u.call(this)}var i={},s=this._sortedScripts(),o=s.length;u();for(var f=0;f<s.length;++f)s[f].searchInContent(e,t,n,a.bind(this,s[f]))},_concatenateScriptsContent:function(e,t){var n="",r=0,i=0,s=WebInspector.ConcatenatedScriptsContentProvider.scriptOpenTag,o=WebInspector.ConcatenatedScriptsContentProvider.scriptCloseTag;for(var u=0;u<e.length;++u){for(var a=e[u].lineOffset-r;a>0;--a)i=0,n+="\n";for(var f=e[u].columnOffset-i-s.length;f>0;--f)n+=" ";n+=s,n+=t[u],n+=o,r=e[u].endLine,i=e[u].endColumn+o.length}return n},__proto__:WebInspector.ContentProvider.prototype},WebInspector.CompilerSourceMappingContentProvider=function(e,t,n){this._sourceURL=e,this._contentType=t,this._mimeType=n},WebInspector.CompilerSourceMappingContentProvider.prototype={contentURL:function(){return this._sourceURL},contentType:function(){return this._contentType},requestContent:function(e){function t(t,n,r,i){if(t||n>=400){console.error("Could not load content for "+this._sourceURL+" : "+(t||"HTTP status code: "+n)),e(null,!1,this._mimeType);return}e(i,!1,this._mimeType)}NetworkAgent.loadResourceForFrontend(WebInspector.resourceTreeModel.mainFrame.id,this._sourceURL,undefined,t.bind(this))},searchInContent:function(e,t,n,r){function i(i,s,o){if(typeof i!="string"){r([]);return}r(WebInspector.ContentProvider.performSearchInContent(i,e,t,n))}this.requestContent(i)},__proto__:WebInspector.ContentProvider.prototype},WebInspector.StaticContentProvider=function(e,t,n){this._content=t,this._contentType=e,this._mimeType=n},WebInspector.StaticContentProvider.prototype={contentURL:function(){return""},contentType:function(){return this._contentType},requestContent:function(e){e(this._content,!1,this._mimeType||this._contentType.canonicalMimeType())},searchInContent:function(e,t,n,r){function i(){r(WebInspector.ContentProvider.performSearchInContent(this._content,e,t,n))}window.setTimeout(i.bind(this),0)},__proto__:WebInspector.ContentProvider.prototype},WebInspector.ContentProviderOverridingMimeType=function(e,t){this._contentProvider=e,this._mimeType=t},WebInspector.ContentProviderOverridingMimeType.prototype={contentURL:function(){return this._contentProvider.contentURL()},contentType:function(){return this._contentProvider.contentType()},requestContent:function(e){function t(t,n,r){e(t,n,this._mimeType)}this._contentProvider.requestContent(t.bind(this))},searchInContent:function(e,t,n,r){this._contentProvider.searchInContent(e,t,n,r)},__proto__:WebInspector.ContentProvider.prototype};