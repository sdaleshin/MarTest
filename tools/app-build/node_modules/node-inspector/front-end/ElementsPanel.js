/*
 * Copyright (C) 2007, 2008 Apple Inc.  All rights reserved.
 * Copyright (C) 2008 Matt Lilek <webkit@mattlilek.com>
 * Copyright (C) 2009 Joseph Pecoraro
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 *
 * 1.  Redistributions of source code must retain the above copyright
 *     notice, this list of conditions and the following disclaimer.
 * 2.  Redistributions in binary form must reproduce the above copyright
 *     notice, this list of conditions and the following disclaimer in the
 *     documentation and/or other materials provided with the distribution.
 * 3.  Neither the name of Apple Computer, Inc. ("Apple") nor the names of
 *     its contributors may be used to endorse or promote products derived
 *     from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY APPLE AND ITS CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL APPLE OR ITS CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
 * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

importScript("CSSNamedFlowCollectionsView.js"),importScript("CSSNamedFlowView.js"),importScript("EventListenersSidebarPane.js"),importScript("MetricsSidebarPane.js"),importScript("PlatformFontsSidebarPane.js"),importScript("PropertiesSidebarPane.js"),importScript("StylesSidebarPane.js"),WebInspector.ElementsPanel=function(){WebInspector.Panel.call(this,"elements"),this.registerRequiredCSS("breadcrumbList.css"),this.registerRequiredCSS("elementsPanel.css"),this.registerRequiredCSS("textPrompt.css"),this.setHideOnDetach();const e=325,t=.34,n=325,r=.34;this.createSidebarView(this.element,WebInspector.SidebarView.SidebarPosition.End,e,n),this.splitView.setSidebarElementConstraints(Preferences.minElementsSidebarWidth,Preferences.minElementsSidebarHeight),this.splitView.setMainElementConstraints(t,r),this.splitView.addEventListener(WebInspector.SidebarView.EventTypes.Resized,this._updateTreeOutlineVisibleWidth.bind(this)),this.contentElement=this.splitView.mainElement,this.contentElement.id="elements-content",this.contentElement.addStyleClass("outline-disclosure"),this.contentElement.addStyleClass("source-code"),WebInspector.settings.domWordWrap.get()||this.contentElement.classList.add("nowrap"),WebInspector.settings.domWordWrap.addChangeListener(this._domWordWrapSettingChanged.bind(this)),this.contentElement.addEventListener("contextmenu",this._contextMenuEventFired.bind(this),!0),this.splitView.sidebarElement.addEventListener("contextmenu",this._sidebarContextMenuEventFired.bind(this),!1),this.treeOutline=new WebInspector.ElementsTreeOutline(!0,!0,this._populateContextMenu.bind(this),this._setPseudoClassForNodeId.bind(this)),this.treeOutline.wireToDomAgent(),this.treeOutline.addEventListener(WebInspector.ElementsTreeOutline.Events.SelectedNodeChanged,this._selectedNodeChanged,this),this.treeOutline.addEventListener(WebInspector.ElementsTreeOutline.Events.ElementsTreeUpdated,this._updateBreadcrumbIfNeeded,this),this.crumbsElement=document.createElement("div"),this.crumbsElement.className="crumbs",this.crumbsElement.addEventListener("mousemove",this._mouseMovedInCrumbs.bind(this),!1),this.crumbsElement.addEventListener("mouseout",this._mouseMovedOutOfCrumbs.bind(this),!1),this.sidebarPanes={},this.sidebarPanes.platformFonts=new WebInspector.PlatformFontsSidebarPane,this.sidebarPanes.computedStyle=new WebInspector.ComputedStyleSidebarPane,this.sidebarPanes.styles=new WebInspector.StylesSidebarPane(this.sidebarPanes.computedStyle,this._setPseudoClassForNodeId.bind(this)),this.sidebarPanes.metrics=new WebInspector.MetricsSidebarPane,this.sidebarPanes.properties=new WebInspector.PropertiesSidebarPane,this.sidebarPanes.domBreakpoints=WebInspector.domBreakpointsSidebarPane.createProxy(this),this.sidebarPanes.eventListeners=new WebInspector.EventListenersSidebarPane,this.sidebarPanes.styles.addEventListener(WebInspector.SidebarPane.EventTypes.wasShown,this.updateStyles.bind(this,!1)),this.sidebarPanes.metrics.addEventListener(WebInspector.SidebarPane.EventTypes.wasShown,this.updateMetrics.bind(this)),this.sidebarPanes.platformFonts.addEventListener(WebInspector.SidebarPane.EventTypes.wasShown,this.updatePlatformFonts.bind(this)),this.sidebarPanes.properties.addEventListener(WebInspector.SidebarPane.EventTypes.wasShown,this.updateProperties.bind(this)),this.sidebarPanes.eventListeners.addEventListener(WebInspector.SidebarPane.EventTypes.wasShown,this.updateEventListeners.bind(this)),this.sidebarPanes.styles.addEventListener("style edited",this._stylesPaneEdited,this),this.sidebarPanes.styles.addEventListener("style property toggled",this._stylesPaneEdited,this),this.sidebarPanes.metrics.addEventListener("metrics edited",this._metricsPaneEdited,this),WebInspector.dockController.addEventListener(WebInspector.DockController.Events.DockSideChanged,this._dockSideChanged.bind(this)),WebInspector.settings.splitVerticallyWhenDockedToRight.addChangeListener(this._dockSideChanged.bind(this)),this._dockSideChanged(),this._popoverHelper=new WebInspector.PopoverHelper(this.element,this._getPopoverAnchor.bind(this),this._showPopover.bind(this)),this._popoverHelper.setTimeout(0),WebInspector.domAgent.addEventListener(WebInspector.DOMAgent.Events.DocumentUpdated,this._documentUpdatedEvent,this),WebInspector.settings.showShadowDOM.addChangeListener(this._showShadowDOMChanged.bind(this)),WebInspector.domAgent.existingDocument()&&this._documentUpdated(WebInspector.domAgent.existingDocument())},WebInspector.ElementsPanel.prototype={_updateTreeOutlineVisibleWidth:function(){if(!this.treeOutline)return;var e=this.splitView.element.offsetWidth;this.splitView.isVertical()&&(e-=this.splitView.sidebarWidth()),this.treeOutline.setVisibleWidth(e)},get statusBarItems(){return[this.crumbsElement]},defaultFocusedElement:function(){return this.treeOutline.element},statusBarResized:function(){this.updateBreadcrumbSizes()},wasShown:function(){this.treeOutline.element.parentElement!==this.contentElement&&this.contentElement.appendChild(this.treeOutline.element),WebInspector.Panel.prototype.wasShown.call(this),this.updateBreadcrumb(),this.treeOutline.updateSelection(),this.treeOutline.setVisible(!0),this.treeOutline.rootDOMNode||WebInspector.domAgent.requestDocument()},willHide:function(){WebInspector.domAgent.hideDOMNodeHighlight(),this.treeOutline.setVisible(!1),this._popoverHelper.hidePopover(),this.contentElement.removeChild(this.treeOutline.element),WebInspector.Panel.prototype.willHide.call(this)},onResize:function(){this.treeOutline.updateSelection(),this.updateBreadcrumbSizes()},_setPseudoClassForNodeId:function(e,t,n){var r=WebInspector.domAgent.nodeForId(e);if(!r)return;var i=r.getUserProperty(WebInspector.ElementsTreeOutline.PseudoStateDecorator.PropertyName);if(n){i=i||[];if(i.indexOf(t)>=0)return;i.push(t),r.setUserProperty(WebInspector.ElementsTreeOutline.PseudoStateDecorator.PropertyName,i)}else{if(!i||i.indexOf(t)<0)return;i.remove(t),i.length||r.removeUserProperty(WebInspector.ElementsTreeOutline.PseudoStateDecorator.PropertyName)}this.treeOutline.updateOpenCloseTags(r),WebInspector.cssModel.forcePseudoState(r.id,r.getUserProperty(WebInspector.ElementsTreeOutline.PseudoStateDecorator.PropertyName)),this._metricsPaneEdited(),this._stylesPaneEdited(),WebInspector.notifications.dispatchEventToListeners(WebInspector.UserMetrics.UserAction,{action:WebInspector.UserMetrics.UserActionNames.ForcedElementState,selector:r.appropriateSelectorFor(!1),enabled:n,state:t})},_selectedNodeChanged:function(){var e=this.selectedDOMNode();!e&&this._lastValidSelectedNode&&(this._selectedPathOnReset=this._lastValidSelectedNode.path()),this.updateBreadcrumb(!1),this._updateSidebars(),e&&(ConsoleAgent.addInspectedNode(e.id),this._lastValidSelectedNode=e),WebInspector.notifications.dispatchEventToListeners(WebInspector.ElementsTreeOutline.Events.SelectedNodeChanged)},_updateSidebars:function(){for(var e in this.sidebarPanes)this.sidebarPanes[e].needsUpdate=!0;this.updateStyles(!0),this.updateMetrics(),this.updatePlatformFonts(),this.updateProperties(),this.updateEventListeners()},_reset:function(){delete this.currentQuery},_documentUpdatedEvent:function(e){this._documentUpdated(e.data)},_documentUpdated:function(e){function t(t){t||(t=e.body||e.documentElement);if(!t)return;this.selectDOMNode(t),this.treeOutline.selectedTreeElement&&this.treeOutline.selectedTreeElement.expand()}function n(e){if(this.selectedDOMNode())return;var n=e?WebInspector.domAgent.nodeForId(e):null;t.call(this,n)}this._reset(),this.searchCanceled(),this.treeOutline.rootDOMNode=e;if(!e){this.isShowing()&&WebInspector.domAgent.requestDocument();return}WebInspector.domBreakpointsSidebarPane.restoreBreakpoints(),this._selectedPathOnReset?WebInspector.domAgent.pushNodeByPathToFrontend(this._selectedPathOnReset,n.bind(this)):t.call(this),delete this._selectedPathOnReset},searchCanceled:function(){delete this._searchQuery,this._hideSearchHighlights(),WebInspector.searchController.updateSearchMatchesCount(0,this),delete this._currentSearchResultIndex,delete this._searchResults,WebInspector.domAgent.cancelSearch()},performSearch:function(e,t){function r(e){WebInspector.searchController.updateSearchMatchesCount(e,this);if(!e)return;this._searchResults=new Array(e),this._currentSearchResultIndex=-1,t&&this.jumpToNextSearchResult()}this.searchCanceled();const n=e.trim();if(!n.length)return;this._searchQuery=e,WebInspector.domAgent.performSearch(n,r.bind(this))},_contextMenuEventFired:function(e){function t(){WebInspector.settings.domWordWrap.set(!WebInspector.settings.domWordWrap.get())}var n=new WebInspector.ContextMenu(e);this.treeOutline.populateContextMenu(n,e),WebInspector.experimentsSettings.cssRegions.isEnabled()&&(n.appendSeparator(),n.appendItem(WebInspector.UIString(WebInspector.useLowerCaseMenuTitles()?"CSS named flows…":"CSS Named Flows…"),this._showNamedFlowCollections.bind(this))),n.appendSeparator(),n.appendCheckboxItem(WebInspector.UIString(WebInspector.useLowerCaseMenuTitles()?"Word wrap":"Word Wrap"),t.bind(this),WebInspector.settings.domWordWrap.get()),n.show()},_showNamedFlowCollections:function(){WebInspector.cssNamedFlowCollectionsView||(WebInspector.cssNamedFlowCollectionsView=new WebInspector.CSSNamedFlowCollectionsView),WebInspector.cssNamedFlowCollectionsView.showInDrawer()},_domWordWrapSettingChanged:function(e){e.data?this.contentElement.removeStyleClass("nowrap"):this.contentElement.addStyleClass("nowrap");var t=this.selectedDOMNode();if(!t)return;var n=this.treeOutline.findTreeElement(t);n&&n.updateSelection()},switchToAndFocus:function(e){WebInspector.searchController.cancelSearch(),WebInspector.inspectorView.setCurrentPanel(this),this.selectDOMNode(e,!0)},_populateContextMenu:function(e,t){e.appendSeparator();var n=WebInspector.domBreakpointsSidebarPane;n.populateNodeContextMenu(t,e)},_getPopoverAnchor:function(e){var t=e.enclosingNodeOrSelfWithClass("webkit-html-resource-link");if(t){if(!t.href)return null;var n=WebInspector.resourceTreeModel.resourceForURL(t.href);if(!n||n.type!==WebInspector.resourceTypes.Image)return null;t.removeAttribute("title")}return t},_loadDimensionsForNode:function(e,t){function r(e){function n(){return{offsetWidth:this.offsetWidth,offsetHeight:this.offsetHeight,naturalWidth:this.naturalWidth,naturalHeight:this.naturalHeight}}if(!e){t();return}e.callFunctionJSON(n,undefined,t),e.release()}if(e.treeOutline!==this.treeOutline){t();return}var n=e.representedObject;if(!n.nodeName()||n.nodeName().toLowerCase()!=="img"){t();return}WebInspector.RemoteObject.resolveNode(n,"",r)},_showPopover:function(e,t){function r(n){if(!n)return;t.setCanShrink(!1),t.show(n,e)}var n=e.enclosingNodeOrSelfWithNodeName("li");n&&n.treeElement?this._loadDimensionsForNode(n.treeElement,WebInspector.DOMPresentationUtils.buildImagePreviewContents.bind(WebInspector.DOMPresentationUtils,e.href,!0,r)):WebInspector.DOMPresentationUtils.buildImagePreviewContents(e.href,!0,r)},jumpToNextSearchResult:function(){if(!this._searchResults)return;this._hideSearchHighlights(),++this._currentSearchResultIndex>=this._searchResults.length&&(this._currentSearchResultIndex=0),this._highlightCurrentSearchResult()},jumpToPreviousSearchResult:function(){if(!this._searchResults)return;this._hideSearchHighlights(),--this._currentSearchResultIndex<0&&(this._currentSearchResultIndex=this._searchResults.length-1),this._highlightCurrentSearchResult()},_highlightCurrentSearchResult:function(){var e=this._currentSearchResultIndex,t=this._searchResults,n=t[e];if(n===null){WebInspector.searchController.updateCurrentMatchIndex(e,this);return}if(typeof n=="undefined"){function r(n){t[e]=n||null,this._highlightCurrentSearchResult()}WebInspector.domAgent.searchResult(e,r.bind(this));return}WebInspector.searchController.updateCurrentMatchIndex(e,this);var i=this.treeOutline.findTreeElement(n);if(i){i.highlightSearchResults(this._searchQuery),i.reveal();var s=i.listItemElement.getElementsByClassName("highlighted-search-result");s.length&&s[0].scrollIntoViewIfNeeded()}},_hideSearchHighlights:function(){if(!this._searchResults)return;var e=this._searchResults[this._currentSearchResultIndex];if(!e)return;var t=this.treeOutline.findTreeElement(e);t&&t.hideSearchHighlights()},selectedDOMNode:function(){return this.treeOutline.selectedDOMNode()},selectDOMNode:function(e,t){this.treeOutline.selectDOMNode(e,t)},_updateBreadcrumbIfNeeded:function(e){var t=e.data||[];if(!t.length)return;var n=this.crumbsElement;for(var r=n.firstChild;r;r=r.nextSibling)if(t.indexOf(r.representedObject)!==-1){this.updateBreadcrumb(!0);return}},_stylesPaneEdited:function(){this.sidebarPanes.metrics.needsUpdate=!0,this.updateMetrics(),this.sidebarPanes.platformFonts.needsUpdate=!0,this.updatePlatformFonts()},_metricsPaneEdited:function(){this.sidebarPanes.styles.needsUpdate=!0,this.updateStyles(!0)},_mouseMovedInCrumbs:function(e){var t=document.elementFromPoint(e.pageX,e.pageY),n=t.enclosingNodeOrSelfWithClass("crumb");WebInspector.domAgent.highlightDOMNode(n?n.representedObject.id:0),"_mouseOutOfCrumbsTimeout"in this&&(clearTimeout(this._mouseOutOfCrumbsTimeout),delete this._mouseOutOfCrumbsTimeout)},_mouseMovedOutOfCrumbs:function(e){var t=document.elementFromPoint(e.pageX,e.pageY);if(t&&t.isDescendant(this.crumbsElement))return;WebInspector.domAgent.hideDOMNodeHighlight(),this._mouseOutOfCrumbsTimeout=setTimeout(this.updateBreadcrumbSizes.bind(this),1e3)},updateBreadcrumb:function(e){function s(e){var t=e.currentTarget;if(t.hasStyleClass("collapsed")){if(t===i.crumbsElement.firstChild){var n=t;while(n){var r=n.hasStyleClass("hidden"),s=n.hasStyleClass("collapsed");if(!r&&!s)break;t=n,n=n.nextSibling}}i.updateBreadcrumbSizes(t)}else i.selectDOMNode(t.representedObject,!0);e.preventDefault()}if(!this.isShowing())return;var t=this.crumbsElement,n=!1,r=t.firstChild;while(r)r.representedObject===this.selectedDOMNode()?(r.addStyleClass("selected"),n=!0):r.removeStyleClass("selected"),r=r.nextSibling;if(n&&!e){this.updateBreadcrumbSizes();return}t.removeChildren();var i=this;for(var o=this.selectedDOMNode();o;o=o.parentNode){if(o.nodeType()===Node.DOCUMENT_NODE)continue;r=document.createElement("span"),r.className="crumb",r.representedObject=o,r.addEventListener("mousedown",s,!1);var u="";switch(o.nodeType()){case Node.ELEMENT_NODE:WebInspector.DOMPresentationUtils.decorateNodeLabel(o,r);break;case Node.TEXT_NODE:u=WebInspector.UIString("(text)");break;case Node.COMMENT_NODE:u="<!-->";break;case Node.DOCUMENT_TYPE_NODE:u="<!DOCTYPE>";break;default:u=o.nodeNameInCorrectCase()}if(!r.childNodes.length){var a=document.createElement("span");a.textContent=u,r.appendChild(a),r.title=u}o===this.selectedDOMNode()&&r.addStyleClass("selected"),t.childNodes.length||r.addStyleClass("end"),t.appendChild(r)}t.hasChildNodes()&&t.lastChild.addStyleClass("start"),this.updateBreadcrumbSizes()},updateBreadcrumbSizes:function(e){function c(){return a+t.offsetWidth+u<f}function v(s,o,u){function l(e){var n=t.childNodes[e];return n&&n!==u&&s(n),c()?!0:!1}u||(u=e||i);if(u===i)var a=n;else if(u===e)var a=r;else{var a=0;for(var f=0;f<t.childNodes.length;++f)if(t.childNodes[f]===u){a=f;break}}if(o){var h=o>0?0:t.childNodes.length-1;while(h!==a){if(l(h))return!0;h+=o>0?1:-1}}else{var p=0,d=t.childNodes.length-1;while(p!=a||d!=a){var v=a-p,m=d-a;if(v>=m)var h=p++;else var h=d--;if(l(h))return!0}}return!1}function m(){var e=t.firstChild,n=!1,r=!1,i=!1;while(e){var s=e.hasStyleClass("hidden");if(!s){var o=e.hasStyleClass("collapsed");if(n&&o){e.addStyleClass("hidden"),e.removeStyleClass("compact"),e.removeStyleClass("collapsed"),e.hasStyleClass("start")&&(e.removeStyleClass("start"),r=!0),e.hasStyleClass("end")&&(e.removeStyleClass("end"),i=!0);continue}n=o,i&&(i=!1,e.addStyleClass("end"))}else n=!0;e=e.nextSibling}if(r){e=t.lastChild;while(e){if(!e.hasStyleClass("hidden")){e.addStyleClass("start");break}e=e.previousSibling}}}function g(e){if(e.hasStyleClass("hidden"))return;e.addStyleClass("compact")}function y(e,t){if(e.hasStyleClass("hidden"))return;e.addStyleClass("collapsed"),e.removeStyleClass("compact"),t||m()}if(!this.isShowing())return;if(document.body.offsetWidth<=0)return;var t=this.crumbsElement;if(!t.childNodes.length||t.offsetWidth<=0)return;var n=0,r=0,i,s=0,o=t.firstChild;while(o)!i&&o.hasStyleClass("selected")&&(i=o,n=s),o===e&&(r=s),o!==t.lastChild&&o.removeStyleClass("start"),o!==t.firstChild&&o.removeStyleClass("end"),o.removeStyleClass("compact"),o.removeStyleClass("collapsed"),o.removeStyleClass("hidden"),o=o.nextSibling,++s;t.firstChild.addStyleClass("end"),t.lastChild.addStyleClass("start");var u=20,a=t.totalOffsetLeft(),f=window.innerWidth,l=document.getElementById("error-warning-count");WebInspector.drawer.visible||(l&&(u+=l.offsetWidth),u+=WebInspector.settingsController.statusBarItem.offsetWidth);if(c())return;var h=0,p=-1,d=1;if(!e){if(v(g,d))return;if(v(y,d))return}if(v(g,e?h:p))return;if(v(y,e?h:p))return;if(!i)return;g(i);if(c())return;y(i,!0)},updateStyles:function(e){var t=this.sidebarPanes.styles,n=this.sidebarPanes.computedStyle;if(!t.isShowing()&&!n.isShowing()||!t.needsUpdate)return;t.update(this.selectedDOMNode(),e),t.needsUpdate=!1},updateMetrics:function(){var e=this.sidebarPanes.metrics;if(!e.isShowing()||!e.needsUpdate)return;e.update(this.selectedDOMNode()),e.needsUpdate=!1},updatePlatformFonts:function(){var e=this.sidebarPanes.platformFonts;if(!e.isShowing()||!e.needsUpdate)return;e.update(this.selectedDOMNode()),e.needsUpdate=!1},updateProperties:function(){var e=this.sidebarPanes.properties;if(!e.isShowing()||!e.needsUpdate)return;e.update(this.selectedDOMNode()),e.needsUpdate=!1},updateEventListeners:function(){var e=this.sidebarPanes.eventListeners;if(!e.isShowing()||!e.needsUpdate)return;e.update(this.selectedDOMNode()),e.needsUpdate=!1},handleShortcut:function(e){function t(){if(WebInspector.KeyboardShortcut.eventHasCtrlOrMeta(e)&&!e.shiftKey&&e.keyIdentifier==="U+005A"){WebInspector.domAgent.undo(this._updateSidebars.bind(this)),e.handled=!0;return}var t=WebInspector.isMac()?e.metaKey&&e.shiftKey&&e.keyIdentifier==="U+005A":e.ctrlKey&&e.keyIdentifier==="U+0059";t&&(DOMAgent.redo(this._updateSidebars.bind(this)),e.handled=!0)}if(!this.treeOutline.editing()){t.call(this);if(e.handled)return}this.treeOutline.handleShortcut(e)},handleCopyEvent:function(e){var t=WebInspector.currentFocusElement();if(t&&WebInspector.isBeingEdited(t))return;if(!window.getSelection().isCollapsed)return;e.clipboardData.clearData(),e.preventDefault(),this.selectedDOMNode().copyNode()},sidebarResized:function(e){this.treeOutline.updateSelection()},revealAndSelectNode:function(e){WebInspector.inspectorView.setCurrentPanel(this);var t=WebInspector.domAgent.nodeForId(e);if(!t)return;while(!WebInspector.ElementsTreeOutline.showShadowDOM()&&t&&t.isInShadowTree())t=t.parentNode;WebInspector.domAgent.highlightDOMNodeForTwoSeconds(e),this.selectDOMNode(t,!0)},appendApplicableItems:function(e,t,n){function r(e){e&&WebInspector.domAgent.inspectElement(e)}function i(e){e.pushNodeToFrontend(r)}var s;if(n instanceof WebInspector.RemoteObject){var o=n;o.subtype==="node"&&(s=i.bind(this,o))}else if(n instanceof WebInspector.DOMNode){var u=n;u.id&&(s=WebInspector.domAgent.inspectElement.bind(WebInspector.domAgent,u.id))}if(!s)return;if(this.treeOutline.element.isAncestor(e.target))return;t.appendItem(WebInspector.useLowerCaseMenuTitles()?"Reveal in Elements panel":"Reveal in Elements Panel",s)},_sidebarContextMenuEventFired:function(e){var t=new WebInspector.ContextMenu(e);t.show()},_dockSideChanged:function(){var e=WebInspector.dockController.dockSide(),t=e===WebInspector.DockController.State.DockedToRight&&WebInspector.settings.splitVerticallyWhenDockedToRight.get();this._splitVertically(t)},_showShadowDOMChanged:function(){this.treeOutline.update()},_splitVertically:function(e){if(this.sidebarPaneView&&e===!this.splitView.isVertical())return;this.sidebarPaneView&&this.sidebarPaneView.detach(),this.splitView.setVertical(!e);var t=new WebInspector.SidebarPane(WebInspector.UIString("Computed"));t.element.addStyleClass("composite"),t.element.addStyleClass("fill");var n=t.expand.bind(t);t.bodyElement.appendChild(this.sidebarPanes.computedStyle.titleElement),t.bodyElement.addStyleClass("metrics-and-computed"),this.sidebarPanes.computedStyle.show(t.bodyElement),this.sidebarPanes.computedStyle.setExpandCallback(n),this.sidebarPanes.platformFonts.show(t.bodyElement);if(e){this.sidebarPanes.metrics.show(t.bodyElement,this.sidebarPanes.computedStyle.element),this.sidebarPanes.metrics.setExpandCallback(n),this.sidebarPaneView=new WebInspector.SidebarTabbedPane;var r=new WebInspector.SidebarPane(this.sidebarPanes.styles.title());r.element.addStyleClass("composite"),r.element.addStyleClass("fill");var i=r.expand.bind(r),s=new WebInspector.SplitView(!0,"StylesPaneSplitRatio",.5);s.show(r.bodyElement),this.sidebarPanes.styles.show(s.firstElement()),s.firstElement().appendChild(this.sidebarPanes.styles.titleElement),this.sidebarPanes.styles.setExpandCallback(i),t.show(s.secondElement()),t.setExpandCallback(i),this.sidebarPaneView.addPane(r),this.sidebarPaneView.addPane(this.sidebarPanes.properties),this.sidebarPaneView.addPane(this.sidebarPanes.domBreakpoints),this.sidebarPaneView.addPane(this.sidebarPanes.eventListeners)}else{this.sidebarPaneView=new WebInspector.SidebarTabbedPane;var o=new WebInspector.SidebarPane(this.sidebarPanes.styles.title());o.element.addStyleClass("composite"),o.element.addStyleClass("fill");var u=o.expand.bind(o);o.bodyElement.addStyleClass("metrics-and-styles"),this.sidebarPanes.styles.show(o.bodyElement),this.sidebarPanes.styles.setExpandCallback(u),this.sidebarPanes.metrics.setExpandCallback(u),o.bodyElement.appendChild(this.sidebarPanes.styles.titleElement);function a(e,t){this.sidebarPanes.metrics.show(e.bodyElement,t)}function f(e){var n=e.data.tabId;n===t.title()&&a.call(this,t,this.sidebarPanes.computedStyle.element),n===o.title()&&a.call(this,o)}this.sidebarPaneView.addEventListener(WebInspector.TabbedPane.EventTypes.TabSelected,f,this),a.call(this,o),this.sidebarPaneView.addPane(o),this.sidebarPaneView.addPane(t),this.sidebarPaneView.addPane(this.sidebarPanes.eventListeners),this.sidebarPaneView.addPane(this.sidebarPanes.domBreakpoints),this.sidebarPaneView.addPane(this.sidebarPanes.properties)}this.sidebarPaneView.show(this.splitView.sidebarElement),this.sidebarPanes.styles.expand()},addExtensionSidebarPane:function(e,t){this.sidebarPanes[e]=t,this.sidebarPaneView.addPane(t)},__proto__:WebInspector.Panel.prototype};