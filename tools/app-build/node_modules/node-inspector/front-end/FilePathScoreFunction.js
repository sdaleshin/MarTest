/*
 * Copyright (C) 2013 Google Inc. All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 * notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above
 * copyright notice, this list of conditions and the following disclaimer
 * in the documentation and/or other materials provided with the
 * distribution.
 *     * Neither the name of Google Inc. nor the names of its
 * contributors may be used to endorse or promote products derived from
 * this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

WebInspector.FilePathScoreFunction=function(e){this._query=e,this._queryUpperCase=e.toUpperCase(),this._score=null,this._sequence=null,this._dataUpperCase="",this._fileNameIndex=0},WebInspector.FilePathScoreFunction.filterRegex=function(e){const t=String.regexSpecialCharacters();var n="";for(var r=0;r<e.length;++r){var i=e.charAt(r);t.indexOf(i)!==-1&&(i="\\"+i),r&&(n+="[^"+i+"]*"),n+=i}return new RegExp(n,"i")},WebInspector.FilePathScoreFunction.prototype={score:function(e,t){if(!e||!this._query)return 0;var n=this._query.length,r=e.length;if(!this._score||this._score.length<n*r)this._score=new Int32Array(n*r*2),this._sequence=new Int32Array(n*r*2);var i=this._score,s=this._sequence;this._dataUpperCase=e.toUpperCase(),this._fileNameIndex=e.lastIndexOf("/");for(var o=0;o<n;++o)for(var u=0;u<r;++u){var a=u===0?0:i[o*r+u-1],f=o===0||u===0?0:i[(o-1)*r+u-1],l=o===0||u===0?0:s[(o-1)*r+u-1],c=this._match(this._query,e,o,u,l);c&&f+c>a?(s[o*r+u]=l+1,i[o*r+u]=f+c):(s[o*r+u]=0,i[o*r+u]=a)}return t&&this._restoreMatchIndexes(s,n,r,t),i[n*r-1]},_testWordStart:function(e,t){var n=e.charAt(t-1);return t===0||n==="_"||n==="-"||n==="/"||e[t-1]!==this._dataUpperCase[t-1]&&e[t]===this._dataUpperCase[t]},_restoreMatchIndexes:function(e,t,n,r){var i=t-1,s=n-1;while(i>=0&&s>=0)switch(e[i*n+s]){case 0:--s;break;default:r.push(s),--i,--s}r.reverse()},_singleCharScore:function(e,t,n,r){var i=this._testWordStart(t,r),s=r>this._fileNameIndex,o=r===0||t[r-1]==="/",u=e[n]===t[r]&&e[n]==this._queryUpperCase[n],a=10;return o&&(a+=4),i&&(a+=2),u&&(a+=6),s&&(a+=4),r===this._fileNameIndex+1&&n===0&&(a+=5),s&&i&&(a+=3),a},_sequenceCharScore:function(e,t,n,r,i){var s=r>this._fileNameIndex,o=r===0||t[r-1]==="/",u=10;return s&&(u+=4),o&&(u+=5),u+=i*4,u},_match:function(e,t,n,r,i){return this._queryUpperCase[n]!==this._dataUpperCase[r]?0:i?this._sequenceCharScore(e,t,n,r-i,i):this._singleCharScore(e,t,n,r)}};