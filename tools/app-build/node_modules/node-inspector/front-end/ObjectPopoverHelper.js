/*
 * Copyright (C) 2011 Google Inc. All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 * notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above
 * copyright notice, this list of conditions and the following disclaimer
 * in the documentation and/or other materials provided with the
 * distribution.
 *     * Neither the name of Google Inc. nor the names of its
 * contributors may be used to endorse or promote products derived from
 * this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

WebInspector.ObjectPopoverHelper=function(e,t,n,r,i){WebInspector.PopoverHelper.call(this,e,t,this._showObjectPopover.bind(this),this._onHideObjectPopover.bind(this),i),this._queryObject=n,this._onHideCallback=r,this._popoverObjectGroup="popover",e.addEventListener("scroll",this.hidePopover.bind(this),!0)},WebInspector.ObjectPopoverHelper.prototype={setRemoteObjectFormatter:function(e){this._remoteObjectFormatter=e},_showObjectPopover:function(e,t){function n(n,r,i){if(t.disposed)return;if(r){this.hidePopover();return}var s=i||e,o=this._remoteObjectFormatter&&this._remoteObjectFormatter(n)||n.description,u=null;if(n.type!=="object"){u=document.createElement("span"),u.className="monospace console-formatted-"+n.type,u.style.whiteSpace="pre",u.textContent=o;if(n.type==="function"){function a(e,n){if(e){console.error(e);return}var r=document.createElement("div");r.className="inline-block";var i=r.createChild("div","function-popover-title source-code"),o=i.createChild("span","function-name");o.textContent=n.name||n.inferredName||n.displayName||WebInspector.UIString("(anonymous function)"),this._linkifier=new WebInspector.Linkifier;var a=n.location,f=this._linkifier.linkifyRawLocation(a,"function-location-link");f&&i.appendChild(f),r.appendChild(u),t.show(r,s)}DebuggerAgent.getFunctionDetails(n.objectId,a.bind(this));return}n.type==="string"&&(u.textContent='"'+u.textContent+'"'),t.show(u,s)}else{n.subtype==="node"&&n.highlightAsDOMNode(),u=document.createElement("div"),this._titleElement=document.createElement("div"),this._titleElement.className="source-frame-popover-title monospace",this._titleElement.textContent=o,u.appendChild(this._titleElement);var f=new WebInspector.ObjectPropertiesSection(n);o.substr(0,4)==="HTML"&&(this._sectionUpdateProperties=f.updateProperties.bind(f),f.updateProperties=this._updateHTMLId.bind(this)),f.expanded=!0,f.element.addStyleClass("source-frame-popover-tree"),f.headerElement.addStyleClass("hidden"),u.appendChild(f.element);const l=300,c=250;t.show(u,s,l,c)}}this._queryObject(e,n.bind(this),this._popoverObjectGroup)},_onHideObjectPopover:function(){WebInspector.domAgent.hideDOMNodeHighlight(),this._linkifier&&(this._linkifier.reset(),delete this._linkifier),this._onHideCallback&&this._onHideCallback(),RuntimeAgent.releaseObjectGroup(this._popoverObjectGroup)},_updateHTMLId:function(e,t,n){for(var r=0;r<e.length;++r)if(e[r].name==="id"){e[r].value.description&&(this._titleElement.textContent+="#"+e[r].value.description);break}this._sectionUpdateProperties(e,t,n)},__proto__:WebInspector.PopoverHelper.prototype};