/*
 * Copyright (C) 2011 Google Inc. All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 * notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above
 * copyright notice, this list of conditions and the following disclaimer
 * in the documentation and/or other materials provided with the
 * distribution.
 *     * Neither the name of Google Inc. nor the names of its
 * contributors may be used to endorse or promote products derived from
 * this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

function format(e){var t=e.indentString||"    ",n={};if(e.mimeType==="text/html"){var r=new HTMLScriptFormatter(t);n=r.format(e.content)}else n.mapping={original:[0],formatted:[0]},n.content=formatScript(e.content,n.mapping,0,0,t);postMessage(n)}function getChunkCount(e,t){if(e<=t)return 1;var n=e%t,r=e-n;return r/t+(n?1:0)}function outline(e){const t=1e5,n=e.content.length,r=e.content.split("\n"),i=getChunkCount(n,t);var s=[],o=null,u=null,a=null,f=1,l=0,c=!1,h=!1,p="",d=null,v=WebInspector.CodeMirrorUtils.createTokenizer("text/javascript");for(var m=0;m<r.length;++m){var g=r[m];function y(e,n,r,v){n=n?WebInspector.CodeMirrorUtils.convertTokenType(n):null,n==="javascript-ident"?(o=e,e&&u==="function"&&(d={line:m,column:r,name:e},c=!0,o=null)):n==="javascript-keyword"?e==="function"&&o&&(u==="="||u===":")&&(d={line:m,column:r,name:o},c=!0,o=null):e==="."&&a==="javascript-ident"?o+=".":e==="("&&c&&(h=!0),h&&e&&(p+=e),e===")"&&h&&(c=!1,h=!1,d.arguments=p.replace(/,[\r\n\s]*/g,", ").replace(/([^,])[\r\n\s]+/g,"$1"),p="",s.push(d)),e.trim().length&&(u=e,a=n),l+=v-r,l>=t&&(postMessage({chunk:s,total:i,index:f++}),s=[],l=0)}v(g,y)}postMessage({chunk:s,total:i,index:i})}function formatScript(e,t,n,r,i){var s;try{var o=new Tokenizer(e),u=new FormattedContentBuilder(o.content(),t,n,r,i),a=new JavaScriptFormatter(o,u);a.format(),s=u.content()}catch(f){s=e}return s}function require(){return parse}importScripts("utilities.js"),importScripts("cm/headlesscodemirror.js"),importScripts("cm/css.js"),importScripts("cm/javascript.js"),importScripts("cm/xml.js"),importScripts("cm/htmlmixed.js"),WebInspector={},importScripts("CodeMirrorUtils.js"),onmessage=function(e){if(!e.data.method)return;self[e.data.method](e.data.params)},Array.prototype.keySet=function(){var e={};for(var t=0;t<this.length;++t)e[this[t]]=!0;return e},HTMLScriptFormatter=function(e){this._indentString=e},HTMLScriptFormatter.prototype={format:function(e){function r(e,n,r,i){e.toLowerCase()==="<script"&&n==="xml-tag"?t=!0:t&&e===">"&&n==="xml-tag"?(t=!1,this._scriptStarted(i)):e.toLowerCase()==="</script"&&n==="xml-tag"&&this._scriptEnded(r)}this.line=e,this._content=e,this._formattedContent="",this._mapping={original:[0],formatted:[0]},this._position=0;var t=!1,n=WebInspector.CodeMirrorUtils.createTokenizer("text/html");return n(e,r.bind(this)),this._formattedContent+=this._content.substring(this._position),{content:this._formattedContent,mapping:this._mapping}},_scriptStarted:function(e){this._formattedContent+=this._content.substring(this._position,e),this._formattedContent+="\n",this._position=e},_scriptEnded:function(e){if(e===this._position)return;var t=this._content.substring(this._position,e);this._mapping.original.push(this._position),this._mapping.formatted.push(this._formattedContent.length);var n=formatScript(t,this._mapping,this._position,this._formattedContent.length,this._indentString);this._formattedContent+=n,this._position=e}};var exports={};importScripts("UglifyJS/parse-js.js");var parse=exports;importScripts("JavaScriptFormatter.js");