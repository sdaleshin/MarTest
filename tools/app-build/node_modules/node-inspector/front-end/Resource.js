/*
 * Copyright (C) 2007, 2008 Apple Inc.  All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 *
 * 1.  Redistributions of source code must retain the above copyright
 *     notice, this list of conditions and the following disclaimer.
 * 2.  Redistributions in binary form must reproduce the above copyright
 *     notice, this list of conditions and the following disclaimer in the
 *     documentation and/or other materials provided with the distribution.
 * 3.  Neither the name of Apple Computer, Inc. ("Apple") nor the names of
 *     its contributors may be used to endorse or promote products derived
 *     from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY APPLE AND ITS CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL APPLE OR ITS CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
 * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

WebInspector.Resource=function(e,t,n,r,i,s,o,u){this._request=e,this.url=t,this._documentURL=n,this._frameId=r,this._loaderId=i,this._type=s||WebInspector.resourceTypes.Other,this._mimeType=o,this._isHidden=u,this._content,this._contentEncoded,this._pendingContentCallbacks=[],this._request&&!this._request.finished&&this._request.addEventListener(WebInspector.NetworkRequest.Events.FinishedLoading,this._requestFinished,this)},WebInspector.Resource.Events={MessageAdded:"message-added",MessagesCleared:"messages-cleared"},WebInspector.Resource.prototype={get request(){return this._request},get url(){return this._url},set url(e){this._url=e,this._parsedURL=new WebInspector.ParsedURL(e)},get parsedURL(){return this._parsedURL},get documentURL(){return this._documentURL},get frameId(){return this._frameId},get loaderId(){return this._loaderId},get displayName(){return this._parsedURL.displayName},get type(){return this._request?this._request.type:this._type},get mimeType(){return this._request?this._request.mimeType:this._mimeType},get messages(){return this._messages||[]},addMessage:function(e){if(!e.isErrorOrWarning()||!e.message)return;this._messages||(this._messages=[]),this._messages.push(e),this.dispatchEventToListeners(WebInspector.Resource.Events.MessageAdded,e)},get errors(){return this._errors||0},set errors(e){this._errors=e},get warnings(){return this._warnings||0},set warnings(e){this._warnings=e},clearErrorsAndWarnings:function(){this._messages=[],this._warnings=0,this._errors=0,this.dispatchEventToListeners(WebInspector.Resource.Events.MessagesCleared)},get content(){return this._content},get contentEncoded(){return this._contentEncoded},contentURL:function(){return this._url},contentType:function(){return this.type},requestContent:function(e){if(typeof this._content!="undefined"){e(this._content,!!this._contentEncoded,this.canonicalMimeType());return}this._pendingContentCallbacks.push(e),(!this._request||this._request.finished)&&this._innerRequestContent()},canonicalMimeType:function(){return this.type.canonicalMimeType()||this.mimeType},searchInContent:function(e,t,n,r){function i(e,t){r(t||[])}if(this.type===WebInspector.resourceTypes.Document){function s(i,s,o){if(i===null){r([]);return}var u=WebInspector.ContentProvider.performSearchInContent(i,e,t,n);r(u)}this.requestContent(s);return}this.frameId?PageAgent.searchInResource(this.frameId,this.url,e,t,n,i):r([])},populateImageSource:function(e){function t(){var t=WebInspector.contentAsDataURL(this._content,this.mimeType,this._contentEncoded);t===null&&(t=this.url),e.src=t}this.requestContent(t.bind(this))},_requestFinished:function(){this._request.removeEventListener(WebInspector.NetworkRequest.Events.FinishedLoading,this._requestFinished,this),this._pendingContentCallbacks.length&&this._innerRequestContent()},_innerRequestContent:function(){function e(e,n,i){if(e||n===null){r.call(this,e);return}t.call(this,n,i)}function t(e,t){this._content=e,this._contentEncoded=t;var n=this._pendingContentCallbacks.slice();for(var r=0;r<n.length;++r)n[r](this._content,this._contentEncoded,this.canonicalMimeType());this._pendingContentCallbacks.length=0,delete this._contentRequested}function n(t,n,r){e.call(this,t,n,r)}function r(e){var n=WebInspector.debuggerModel.scriptsForSourceURL(this.url);if(!n.length){console.error("Resource content request failed: "+e),t.call(this,null,!1);return}var r;this.type===WebInspector.resourceTypes.Document?r=new WebInspector.ConcatenatedScriptsContentProvider(n):this.type===WebInspector.resourceTypes.Script&&(r=n[0]);if(!r){console.error("Resource content request failed: "+e),t.call(this,null,!1);return}r.requestContent(i.bind(this))}function i(e,n,r){t.call(this,e,n)}if(this._contentRequested)return;this._contentRequested=!0;if(this.request){function s(t,n,r){e.call(this,null,t,n)}this.request.requestContent(s.bind(this));return}PageAgent.getResourceContent(this.frameId,this.url,n.bind(this))},isHidden:function(){return!!this._isHidden},__proto__:WebInspector.Object.prototype};