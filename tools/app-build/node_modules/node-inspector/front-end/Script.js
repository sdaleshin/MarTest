/*
 * Copyright (C) 2008 Apple Inc. All Rights Reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY APPLE INC. ``AS IS'' AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL APPLE INC. OR
 * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

WebInspector.Script=function(e,t,n,r,i,s,o,u,a){this.scriptId=e,this.sourceURL=t,this.lineOffset=n,this.columnOffset=r,this.endLine=i,this.endColumn=s,this.isContentScript=o,this.sourceMapURL=u,this.hasSourceURL=a,this._locations=new Set,this._sourceMappings=[]},WebInspector.Script.Events={ScriptEdited:"ScriptEdited"},WebInspector.Script.snippetSourceURLPrefix="snippets:///",WebInspector.Script.prototype={contentURL:function(){return this.sourceURL},contentType:function(){return WebInspector.resourceTypes.Script},requestContent:function(e){function t(t,n){this._source=t?"":n,e(this._source,!1,"text/javascript")}if(this._source){e(this._source,!1,"text/javascript");return}this.scriptId?DebuggerAgent.getScriptSource(this.scriptId,t.bind(this)):e("",!1,"text/javascript")},searchInContent:function(e,t,n,r){function i(e,t){e&&console.error(e);var n=[];for(var i=0;i<t.length;++i){var s=new WebInspector.ContentProvider.SearchMatch(t[i].lineNumber,t[i].lineContent);n.push(s)}r(n||[])}this.scriptId?DebuggerAgent.searchInContent(this.scriptId,e,t,n,i.bind(this)):r([])},editSource:function(e,t){function n(n,r,i,s){n||(this._source=e);var o=!!s&&s.stack_update_needs_step_in===!0;t(n,r,i,o),n||this.dispatchEventToListeners(WebInspector.Script.Events.ScriptEdited,e)}this.scriptId?DebuggerAgent.setScriptSource(this.scriptId,e,undefined,n.bind(this)):t("Script failed to parse")},isInlineScript:function(){var e=!this.lineOffset&&!this.columnOffset;return!!this.sourceURL&&!e},isAnonymousScript:function(){return!this.sourceURL},isSnippet:function(){return!!this.sourceURL&&this.sourceURL.startsWith(WebInspector.Script.snippetSourceURLPrefix)},rawLocationToUILocation:function(e,t){var n,r=new WebInspector.DebuggerModel.Location(this.scriptId,e,t||0);for(var i=this._sourceMappings.length-1;!n&&i>=0;--i)n=this._sourceMappings[i].rawLocationToUILocation(r);return console.assert(n,"Script raw location can not be mapped to any ui location."),n.uiSourceCode.overrideLocation(n)},pushSourceMapping:function(e){this._sourceMappings.push(e),this.updateLocations()},updateLocations:function(){var e=this._locations.items();for(var t=0;t<e.length;++t)e[t].update()},createLiveLocation:function(e,t){console.assert(e.scriptId===this.scriptId);var n=new WebInspector.Script.Location(this,e,t);return this._locations.add(n),n.update(),n},__proto__:WebInspector.Object.prototype},WebInspector.Script.Location=function(e,t,n){WebInspector.LiveLocation.call(this,t,n),this._script=e},WebInspector.Script.Location.prototype={uiLocation:function(){var e=this.rawLocation();return this._script.rawLocationToUILocation(e.lineNumber,e.columnNumber)},dispose:function(){WebInspector.LiveLocation.prototype.dispose.call(this),this._script._locations.remove(this)},__proto__:WebInspector.LiveLocation.prototype};