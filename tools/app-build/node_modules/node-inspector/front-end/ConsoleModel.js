/*
 * Copyright (C) 2011 Google Inc. All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 * notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above
 * copyright notice, this list of conditions and the following disclaimer
 * in the documentation and/or other materials provided with the
 * distribution.
 *     * Neither the name of Google Inc. nor the names of its
 * contributors may be used to endorse or promote products derived from
 * this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

WebInspector.ConsoleModel=function(){this.messages=[],this.warnings=0,this.errors=0,this._interruptRepeatCount=!1,InspectorBackend.registerConsoleDispatcher(new WebInspector.ConsoleDispatcher(this))},WebInspector.ConsoleModel.Events={ConsoleCleared:"console-cleared",MessageAdded:"console-message-added",RepeatCountUpdated:"repeat-count-updated"},WebInspector.ConsoleModel.prototype={enableAgent:function(){function e(){delete this._enablingConsole}WebInspector.settings.monitoringXHREnabled.get()&&ConsoleAgent.setMonitoringXHREnabled(!0),this._enablingConsole=!0,ConsoleAgent.enable(e.bind(this))},enablingConsole:function(){return!!this._enablingConsole},addMessage:function(e,t){if(t&&WebInspector.SourceMap.hasSourceMapRequestHeader(e.request()))return;e.index=this.messages.length,this.messages.push(e),this._incrementErrorWarningCount(e),t&&(this._previousMessage=e),this._interruptRepeatCount=!t,this.dispatchEventToListeners(WebInspector.ConsoleModel.Events.MessageAdded,e)},_incrementErrorWarningCount:function(e){switch(e.level){case WebInspector.ConsoleMessage.MessageLevel.Warning:this.warnings+=e.repeatDelta;break;case WebInspector.ConsoleMessage.MessageLevel.Error:this.errors+=e.repeatDelta}},requestClearMessages:function(){ConsoleAgent.clearMessages(),this.clearMessages()},clearMessages:function(){this.dispatchEventToListeners(WebInspector.ConsoleModel.Events.ConsoleCleared),this.messages=[],delete this._previousMessage,this.errors=0,this.warnings=0},_messageRepeatCountUpdated:function(e){var t=this._previousMessage;if(!t)return;var n=t.totalRepeatCount;if(!this._interruptRepeatCount)t.repeatDelta=e-n,t.repeatCount=t.repeatCount+t.repeatDelta,t.totalRepeatCount=e,t.updateRepeatCount(),this._incrementErrorWarningCount(t),this.dispatchEventToListeners(WebInspector.ConsoleModel.Events.RepeatCountUpdated,t);else{var r=t.clone();r.totalRepeatCount=e,r.repeatCount=e-n||1,r.repeatDelta=r.repeatCount,this.addMessage(r,!0)}},__proto__:WebInspector.Object.prototype},WebInspector.ConsoleMessage=function(e,t,n,r,i,s){this.source=e,this.level=t,this.url=n||null,this.line=r||0,this.column=i||0,this.message="",s=s||1,this.repeatCount=s,this.repeatDelta=s,this.totalRepeatCount=s},WebInspector.ConsoleMessage.prototype={isErrorOrWarning:function(){return this.level===WebInspector.ConsoleMessage.MessageLevel.Warning||this.level===WebInspector.ConsoleMessage.MessageLevel.Error},updateRepeatCount:function(){},clone:function(){},location:function(){}},WebInspector.ConsoleMessage.create=function(e,t,n,r,i,s,o,u,a,f,l,c){},WebInspector.ConsoleMessage.MessageSource={XML:"xml",JS:"javascript",Network:"network",ConsoleAPI:"console-api",Storage:"storage",AppCache:"appcache",Rendering:"rendering",CSS:"css",Security:"security",Other:"other",Deprecation:"deprecation"},WebInspector.ConsoleMessage.MessageType={Log:"log",Dir:"dir",DirXML:"dirxml",Table:"table",Trace:"trace",Clear:"clear",StartGroup:"startGroup",StartGroupCollapsed:"startGroupCollapsed",EndGroup:"endGroup",Assert:"assert",Result:"result",Profile:"profile",ProfileEnd:"profileEnd"},WebInspector.ConsoleMessage.MessageLevel={Log:"log",Warning:"warning",Error:"error",Debug:"debug"},WebInspector.ConsoleDispatcher=function(e){this._console=e},WebInspector.ConsoleDispatcher.prototype={messageAdded:function(e){var t=WebInspector.ConsoleMessage.create(e.source,e.level,e.text,e.type,e.url,e.line,e.column,e.repeatCount,e.parameters,e.stackTrace,e.networkRequestId,this._console._enablingConsole);this._console.addMessage(t,!0)},messageRepeatCountUpdated:function(e){this._console._messageRepeatCountUpdated(e)},messagesCleared:function(){WebInspector.settings.preserveConsoleLog.get()||this._console.clearMessages()}},WebInspector.console=null;