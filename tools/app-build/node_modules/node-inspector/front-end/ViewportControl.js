/*
 * Copyright (C) 2013 Google Inc. All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 * notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above
 * copyright notice, this list of conditions and the following disclaimer
 * in the documentation and/or other materials provided with the
 * distribution.
 *     * Neither the name of Google Inc. nor the names of its
 * contributors may be used to endorse or promote products derived from
 * this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

WebInspector.ViewportControl=function(e){this.element=document.createElement("div"),this.element.className="fill",this.element.style.overflow="auto",this._topGapElement=this.element.createChild("div"),this._contentElement=this.element.createChild("div"),this._bottomGapElement=this.element.createChild("div"),this._provider=e,this.element.addEventListener("scroll",this._onScroll.bind(this),!1),this._firstVisibleIndex=0,this._lastVisibleIndex=-1},WebInspector.ViewportControl.Provider=function(){},WebInspector.ViewportControl.Provider.prototype={itemCount:function(){return 0},itemElement:function(e){return null}},WebInspector.ViewportControl.prototype={contentElement:function(){return this._contentElement},refresh:function(){if(!this.element.clientHeight)return;this._contentElement.style.setProperty("height","100000px"),this._contentElement.removeChildren();var e=this._provider.itemCount();if(!e){this._firstVisibleIndex=-1,this._lastVisibleIndex=-1;return}if(!this._rowHeight){var t=this._provider.itemElement(0);this._rowHeight=t.measurePreferredSize(this._contentElement).height}var n=this.element.scrollTop,r=n+this.element.clientHeight;this._firstVisibleIndex=Math.floor(n/this._rowHeight),this._lastVisibleIndex=Math.min(Math.ceil(r/this._rowHeight),e)-1,this._topGapElement.style.height=this._rowHeight*this._firstVisibleIndex+"px",this._bottomGapElement.style.height=this._rowHeight*(e-this._lastVisibleIndex-1)+"px";for(var i=this._firstVisibleIndex;i<=this._lastVisibleIndex;++i)this._contentElement.appendChild(this._provider.itemElement(i));this._contentElement.style.removeProperty("height")},_onScroll:function(e){this.refresh()},rowsPerViewport:function(){return Math.floor(this.element.clientHeight/this._rowHeight)},firstVisibleIndex:function(){return this._firstVisibleIndex},lastVisibleIndex:function(){return this._lastVisibleIndex},renderedElementAt:function(e){return e<this._firstVisibleIndex?null:e>this._lastVisibleIndex?null:this._contentElement.childNodes[e-this._firstVisibleIndex]},scrollItemIntoView:function(e,t){if(e>this._firstVisibleIndex&&e<this._lastVisibleIndex)return;t?this.element.scrollTop=this._rowHeight*(e+1)-this.element.clientHeight:this.element.scrollTop=this._rowHeight*e}};