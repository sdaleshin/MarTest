/*
 * Copyright (C) 2013 Google Inc. All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 * notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above
 * copyright notice, this list of conditions and the following disclaimer
 * in the documentation and/or other materials provided with the
 * distribution.
 *     * Neither the name of Google Inc. nor the names of its
 * contributors may be used to endorse or promote products derived from
 * this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

WebInspector.SettingsScreen=function(e){WebInspector.HelpScreen.call(this),this.element.id="settings-screen",this._onHide=e,this._tabbedPane=new WebInspector.TabbedPane,this._tabbedPane.element.addStyleClass("help-window-main");var t=document.createElement("div");t.className="help-window-label",t.createTextChild(WebInspector.UIString("Settings")),this._tabbedPane.element.insertBefore(t,this._tabbedPane.element.firstChild),this._tabbedPane.element.appendChild(this._createCloseButton()),this._tabbedPane.appendTab(WebInspector.SettingsScreen.Tabs.General,WebInspector.UIString("General"),new WebInspector.GenericSettingsTab),WebInspector.experimentsSettings.showOverridesInDrawer.isEnabled()||this._tabbedPane.appendTab(WebInspector.SettingsScreen.Tabs.Overrides,WebInspector.UIString("Overrides"),new WebInspector.OverridesSettingsTab),this._tabbedPane.appendTab(WebInspector.SettingsScreen.Tabs.Workspace,WebInspector.UIString("Workspace"),new WebInspector.WorkspaceSettingsTab),WebInspector.experimentsSettings.experimentsEnabled&&this._tabbedPane.appendTab(WebInspector.SettingsScreen.Tabs.Experiments,WebInspector.UIString("Experiments"),new WebInspector.ExperimentsSettingsTab),this._tabbedPane.appendTab(WebInspector.SettingsScreen.Tabs.Shortcuts,WebInspector.UIString("Shortcuts"),WebInspector.shortcutsScreen.createShortcutsTabView()),this._tabbedPane.shrinkableTabs=!1,this._tabbedPane.verticalTabLayout=!0,this._lastSelectedTabSetting=WebInspector.settings.createSetting("lastSelectedSettingsTab",WebInspector.SettingsScreen.Tabs.General),this.selectTab(this._lastSelectedTabSetting.get()),this._tabbedPane.addEventListener(WebInspector.TabbedPane.EventTypes.TabSelected,this._tabSelected,this)},WebInspector.SettingsScreen.regexValidator=function(e){var t;try{t=new RegExp(e)}catch(n){}return t?null:"Invalid pattern"},WebInspector.SettingsScreen.integerValidator=function(e,t,n){var r=parseInt(n,10);return isNaN(r)?"Invalid number format":r<e||r>t?"Value is out of range ["+e+", "+t+"]":null},WebInspector.SettingsScreen.Tabs={General:"general",Overrides:"overrides",Workspace:"workspace",Experiments:"experiments",Shortcuts:"shortcuts"},WebInspector.SettingsScreen.prototype={selectTab:function(e){this._tabbedPane.selectTab(e)},_tabSelected:function(e){this._lastSelectedTabSetting.set(this._tabbedPane.selectedTabId)},wasShown:function(){this._tabbedPane.show(this.element),WebInspector.HelpScreen.prototype.wasShown.call(this)},isClosingKey:function(e){return[WebInspector.KeyboardShortcut.Keys.Enter.code,WebInspector.KeyboardShortcut.Keys.Esc.code].indexOf(e)>=0},willHide:function(){this._onHide(),WebInspector.HelpScreen.prototype.willHide.call(this)},__proto__:WebInspector.HelpScreen.prototype},WebInspector.SettingsTab=function(e,t){WebInspector.View.call(this),this.element.className="settings-tab-container",t&&(this.element.id=t);var n=this.element.createChild("header");n.createChild("h3").appendChild(document.createTextNode(e)),this.containerElement=this.element.createChild("div","help-container-wrapper").createChild("div","settings-tab help-content help-container")},WebInspector.SettingsTab.createCheckbox=function(e,t,n,r,i,s){function u(){n(o.checked)}var o=i||document.createElement("input");o.type="checkbox",o.name=e,o.checked=t(),o.addEventListener("click",u,!1);var a=document.createElement("label");a.appendChild(o),a.appendChild(document.createTextNode(e)),s&&(a.title=s);if(r)return a;var f=document.createElement("p");return f.appendChild(a),f},WebInspector.SettingsTab.createSettingCheckbox=function(e,t,n,r,i){return WebInspector.SettingsTab.createCheckbox(e,t.get.bind(t),t.set.bind(t),n,r,i)},WebInspector.SettingsTab.createSettingFieldset=function(e){function n(){t.disabled=!e.get()}var t=document.createElement("fieldset");return t.disabled=!e.get(),e.addChangeListener(n),t},WebInspector.SettingsTab.prototype={_appendSection:function(e){var t=this.containerElement.createChild("div","help-block");return e&&(t.createChild("div","help-section-title").textContent=e),t},_createSelectSetting:function(e,t,n){function f(e){n.set(e.target.value)}var r=document.createElement("p"),i=r.createChild("label");i.textContent=e;var s=r.createChild("select"),o=n.get();for(var u=0;u<t.length;++u){var a=t[u];s.add(new Option(a[0],a[1])),o===a[1]&&(s.selectedIndex=u)}return s.addEventListener("change",f,!1),r},_createInputSetting:function(e,t,n,r,i,s){function l(){t.set(n?Number(a.value):a.value)}var o=document.createElement("p"),u=o.createChild("label");u.textContent=e;var a=o.createChild("input");a.value=t.get(),a.type="text",n&&(a.className="numeric"),r&&(a.maxLength=r),i&&(a.style.width=i);if(s){var f=o.createChild("div");f.addStyleClass("field-error-message"),f.style.color="DarkRed",a.oninput=function(){var e=s(a.value);e||(e=""),f.textContent=e}}return a.addEventListener("blur",l,!1),o},_createCustomSetting:function(e,t){var n=document.createElement("p"),r=document.createElement("fieldset");return r.createChild("label").textContent=e,r.appendChild(t),n.appendChild(r),n},__proto__:WebInspector.View.prototype},WebInspector.GenericSettingsTab=function(){WebInspector.SettingsTab.call(this,WebInspector.UIString("General"),"general-tab-content");var e=this._appendSection();e.appendChild(WebInspector.SettingsTab.createSettingCheckbox(WebInspector.UIString("Disable cache (while DevTools is open)"),WebInspector.settings.cacheDisabled));var t=WebInspector.SettingsTab.createSettingCheckbox(WebInspector.UIString("Disable JavaScript"),WebInspector.settings.javaScriptDisabled);e.appendChild(t),WebInspector.settings.javaScriptDisabled.addChangeListener(this._javaScriptDisabledChanged,this),this._disableJSCheckbox=t.getElementsByTagName("input")[0],this._updateScriptDisabledCheckbox(),e=this._appendSection(WebInspector.UIString("Appearance")),e.appendChild(WebInspector.SettingsTab.createSettingCheckbox(WebInspector.UIString("Split panels vertically when docked to right"),WebInspector.settings.splitVerticallyWhenDockedToRight)),e=this._appendSection(WebInspector.UIString("Elements"));var n=this._createSelectSetting(WebInspector.UIString("Color format"),[[WebInspector.UIString("As authored"),WebInspector.Color.Format.Original],["HEX: #DAC0DE",WebInspector.Color.Format.HEX],["RGB: rgb(128, 255, 255)",WebInspector.Color.Format.RGB],["HSL: hsl(300, 80%, 90%)",WebInspector.Color.Format.HSL]],WebInspector.settings.colorFormat);e.appendChild(n),e.appendChild(WebInspector.SettingsTab.createSettingCheckbox(WebInspector.UIString("Show user agent styles"),WebInspector.settings.showUserAgentStyles)),e.appendChild(WebInspector.SettingsTab.createSettingCheckbox(WebInspector.UIString("Word wrap"),WebInspector.settings.domWordWrap)),e.appendChild(WebInspector.SettingsTab.createSettingCheckbox(WebInspector.UIString("Show Shadow DOM"),WebInspector.settings.showShadowDOM)),e.appendChild(WebInspector.SettingsTab.createSettingCheckbox(WebInspector.UIString("Show rulers"),WebInspector.settings.showMetricsRulers)),e=this._appendSection(WebInspector.UIString("Rendering")),e.appendChild(WebInspector.SettingsTab.createSettingCheckbox(WebInspector.UIString("Show paint rectangles"),WebInspector.settings.showPaintRects)),this._forceCompositingModeCheckbox=document.createElement("input");var r=WebInspector.SettingsTab.createSettingCheckbox(WebInspector.UIString("Force accelerated compositing"),WebInspector.settings.forceCompositingMode,!1,this._forceCompositingModeCheckbox);e.appendChild(r),WebInspector.settings.forceCompositingMode.addChangeListener(this._forceCompositingModeChanged,this);var i=WebInspector.SettingsTab.createSettingFieldset(WebInspector.settings.forceCompositingMode);this._showCompositedLayersBordersCheckbox=document.createElement("input"),i.appendChild(WebInspector.SettingsTab.createSettingCheckbox(WebInspector.UIString("Show composited layer borders"),WebInspector.settings.showDebugBorders,!1,this._showCompositedLayersBordersCheckbox)),this._showFPSCheckbox=document.createElement("input"),i.appendChild(WebInspector.SettingsTab.createSettingCheckbox(WebInspector.UIString("Show FPS meter"),WebInspector.settings.showFPSCounter,!1,this._showFPSCheckbox)),this._continousPaintingCheckbox=document.createElement("input"),i.appendChild(WebInspector.SettingsTab.createSettingCheckbox(WebInspector.UIString("Enable continuous page repainting"),WebInspector.settings.continuousPainting,!1,this._continousPaintingCheckbox)),this._showScrollBottleneckRectsCheckbox=document.createElement("input");var s=WebInspector.UIString("Shows areas of the page that slow down scrolling:\nTouch and mousewheel event listeners can delay scrolling.\nSome areas need to repaint their content when scrolled.");i.appendChild(WebInspector.SettingsTab.createSettingCheckbox(WebInspector.UIString("Show potential scroll bottlenecks"),WebInspector.settings.showScrollBottleneckRects,!1,this._showScrollBottleneckRectsCheckbox,s)),r.appendChild(i),this._forceCompositingModeChanged(),e=this._appendSection(WebInspector.UIString("Sources")),e.appendChild(WebInspector.SettingsTab.createSettingCheckbox(WebInspector.UIString("Search in content scripts"),WebInspector.settings.searchInContentScripts)),e.appendChild(WebInspector.SettingsTab.createSettingCheckbox(WebInspector.UIString("Enable JS source maps"),WebInspector.settings.jsSourceMapsEnabled)),r=WebInspector.SettingsTab.createSettingCheckbox(WebInspector.UIString("Enable CSS source maps"),WebInspector.settings.cssSourceMapsEnabled),e.appendChild(r),i=WebInspector.SettingsTab.createSettingFieldset(WebInspector.settings.cssSourceMapsEnabled);var o=i.createChild("input");i.appendChild(WebInspector.SettingsTab.createSettingCheckbox(WebInspector.UIString("Auto-reload generated CSS"),WebInspector.settings.cssReloadEnabled,!1,o)),r.appendChild(i);var u=this._createSelectSetting(WebInspector.UIString("Default indentation"),[[WebInspector.UIString("2 spaces"),WebInspector.TextUtils.Indent.TwoSpaces],[WebInspector.UIString("4 spaces"),WebInspector.TextUtils.Indent.FourSpaces],[WebInspector.UIString("8 spaces"),WebInspector.TextUtils.Indent.EightSpaces],[WebInspector.UIString("Tab character"),WebInspector.TextUtils.Indent.TabCharacter]],WebInspector.settings.textEditorIndent);e.appendChild(u),e.appendChild(WebInspector.SettingsTab.createSettingCheckbox(WebInspector.UIString("Detect indentation"),WebInspector.settings.textEditorAutoDetectIndent)),e.appendChild(WebInspector.SettingsTab.createSettingCheckbox(WebInspector.UIString("Show whitespace characters"),WebInspector.settings.showWhitespacesInEditor)),WebInspector.experimentsSettings.frameworksDebuggingSupport.isEnabled()&&(r=WebInspector.SettingsTab.createSettingCheckbox(WebInspector.UIString("Skip stepping through sources with particular names"),WebInspector.settings.skipStackFramesSwitch),i=WebInspector.SettingsTab.createSettingFieldset(WebInspector.settings.skipStackFramesSwitch),i.appendChild(this._createInputSetting(WebInspector.UIString("Pattern"),WebInspector.settings.skipStackFramesPattern,!1,1e3,"100px",WebInspector.SettingsScreen.regexValidator)),r.appendChild(i),e.appendChild(r)),WebInspector.settings.skipStackFramesSwitch.addChangeListener(this._skipStackFramesSwitchOrPatternChanged,this),WebInspector.settings.skipStackFramesPattern.addChangeListener(this._skipStackFramesSwitchOrPatternChanged,this),e=this._appendSection(WebInspector.UIString("Profiler")),e.appendChild(WebInspector.SettingsTab.createSettingCheckbox(WebInspector.UIString("Show advanced heap snapshot properties"),WebInspector.settings.showAdvancedHeapSnapshotProperties)),e=this._appendSection(WebInspector.UIString("Timeline")),r=WebInspector.SettingsTab.createSettingCheckbox(WebInspector.UIString("Limit number of captured JS stack frames"),WebInspector.settings.timelineLimitStackFramesFlag),e.appendChild(r),i=WebInspector.SettingsTab.createSettingFieldset(WebInspector.settings.timelineLimitStackFramesFlag);var a=WebInspector.SettingsScreen.integerValidator.bind(this,0,99);i.appendChild(this._createInputSetting(WebInspector.UIString("Frames to capture"),WebInspector.settings.timelineStackFramesToCapture,!0,2,"2em",a)),r.appendChild(i),e.appendChild(WebInspector.SettingsTab.createSettingCheckbox(WebInspector.UIString("Show CPU activity on the ruler"),WebInspector.settings.showCpuOnTimelineRuler)),e=this._appendSection(WebInspector.UIString("Console")),e.appendChild(WebInspector.SettingsTab.createSettingCheckbox(WebInspector.UIString("Log XMLHttpRequests"),WebInspector.settings.monitoringXHREnabled)),e.appendChild(WebInspector.SettingsTab.createSettingCheckbox(WebInspector.UIString("Preserve log upon navigation"),WebInspector.settings.preserveConsoleLog));if(WebInspector.extensionServer.hasExtensions()){var f=new WebInspector.HandlerSelector(WebInspector.openAnchorLocationRegistry);e=this._appendSection(WebInspector.UIString("Extensions")),e.appendChild(this._createCustomSetting(WebInspector.UIString("Open links in"),f.element))}e=this._appendSection();var l=WebInspector.UIString("Enable %s + 1-9 shortcut to switch panels",WebInspector.isMac()?"Cmd":"Ctrl");e.appendChild(WebInspector.SettingsTab.createSettingCheckbox(l,WebInspector.settings.shortcutPanelSwitch))},WebInspector.GenericSettingsTab.prototype={_forceCompositingModeChanged:function(e){var t=e?!!e.data:WebInspector.settings.forceCompositingMode.get();t||(this._showFPSCheckbox.checked=!1,this._continousPaintingCheckbox.checked=!1,this._showCompositedLayersBordersCheckbox.checked=!1,this._showScrollBottleneckRectsCheckbox.checked=!1,WebInspector.settings.showFPSCounter.set(!1),WebInspector.settings.continuousPainting.set(!1),WebInspector.settings.showDebugBorders.set(!1),WebInspector.settings.showScrollBottleneckRects.set(!1)),this._forceCompositingModeCheckbox.checked=t},_updateScriptDisabledCheckbox:function(){function e(e,t){if(e||!t)return;switch(t){case"forbidden":this._disableJSCheckbox.checked=!0,this._disableJSCheckbox.disabled=!0;break;case"disabled":this._disableJSCheckbox.checked=!0;break;default:this._disableJSCheckbox.checked=!1}}PageAgent.getScriptExecutionStatus(e.bind(this))},_javaScriptDisabledChanged:function(){PageAgent.setScriptExecutionDisabled(WebInspector.settings.javaScriptDisabled.get(),this._updateScriptDisabledCheckbox.bind(this))},_skipStackFramesSwitchOrPatternChanged:function(){WebInspector.DebuggerModel.applySkipStackFrameSettings()},__proto__:WebInspector.SettingsTab.prototype},WebInspector.OverridesSettingsTab=function(){WebInspector.SettingsTab.call(this,WebInspector.UIString("Overrides"),"overrides-tab-content"),this._view=new WebInspector.OverridesView,this.containerElement.parentElement.appendChild(this._view.containerElement),this.containerElement.remove(),this.containerElement=this._view.containerElement},WebInspector.OverridesSettingsTab.prototype={__proto__:WebInspector.SettingsTab.prototype},WebInspector.WorkspaceSettingsTab=function(){WebInspector.SettingsTab.call(this,WebInspector.UIString("Workspace"),"workspace-tab-content"),WebInspector.isolatedFileSystemManager.addEventListener(WebInspector.IsolatedFileSystemManager.Events.FileSystemAdded,this._fileSystemAdded,this),WebInspector.isolatedFileSystemManager.addEventListener(WebInspector.IsolatedFileSystemManager.Events.FileSystemRemoved,this._fileSystemRemoved,this),this._commonSection=this._appendSection(WebInspector.UIString("Common"));var e=this._createInputSetting(WebInspector.UIString("Folder exclude pattern"),WebInspector.settings.workspaceFolderExcludePattern,!1,0,"270px",WebInspector.SettingsScreen.regexValidator);this._commonSection.appendChild(e),this._fileSystemsSection=this._appendSection(WebInspector.UIString("Folders")),this._fileSystemsListContainer=this._fileSystemsSection.createChild("p","settings-list-container"),this._addFileSystemRowElement=this._fileSystemsSection.createChild("div");var t=this._addFileSystemRowElement.createChild("input","text-button");t.type="button",t.value=WebInspector.UIString("Add folder…"),t.addEventListener("click",this._addFileSystemClicked.bind(this)),this._editFileSystemButton=this._addFileSystemRowElement.createChild("input","text-button"),this._editFileSystemButton.type="button",this._editFileSystemButton.value=WebInspector.UIString("Edit…"),this._editFileSystemButton.addEventListener("click",this._editFileSystemClicked.bind(this)),this._updateEditFileSystemButtonState(),this._reset()},WebInspector.WorkspaceSettingsTab.prototype={wasShown:function(){WebInspector.SettingsTab.prototype.wasShown.call(this),this._reset()},_reset:function(){this._resetFileSystems()},_resetFileSystems:function(){this._fileSystemsListContainer.removeChildren();var e=WebInspector.isolatedFileSystemManager.mapping().fileSystemPaths();delete this._fileSystemsList;if(!e.length){var t=this._fileSystemsListContainer.createChild("div","no-file-systems-message");t.textContent=WebInspector.UIString("You have no file systems added.");return}this._fileSystemsList=new WebInspector.SettingsList(["path"],this._renderFileSystem.bind(this)),this._fileSystemsList.element.addStyleClass("file-systems-list"),this._fileSystemsList.addEventListener(WebInspector.SettingsList.Events.Selected,this._fileSystemSelected.bind(this)),this._fileSystemsList.addEventListener(WebInspector.SettingsList.Events.Removed,this._fileSystemRemovedfromList.bind(this)),this._fileSystemsList.addEventListener(WebInspector.SettingsList.Events.DoubleClicked,this._fileSystemDoubleClicked.bind(this)),this._fileSystemsListContainer.appendChild(this._fileSystemsList.element);for(var n=0;n<e.length;++n)this._fileSystemsList.addItem(e[n]);this._updateEditFileSystemButtonState()},_updateEditFileSystemButtonState:function(){this._editFileSystemButton.disabled=!this._selectedFileSystemPath()},_fileSystemSelected:function(e){this._updateEditFileSystemButtonState()},_fileSystemDoubleClicked:function(e){var t=e.data;this._editFileSystem(t)},_editFileSystemClicked:function(e){this._editFileSystem(this._selectedFileSystemPath())},_editFileSystem:function(e){WebInspector.EditFileSystemDialog.show(document.body,e)},_createRemoveButton:function(e){var t=document.createElement("button");return t.addStyleClass("button"),t.addStyleClass("remove-item-button"),t.value=WebInspector.UIString("Remove"),e?t.addEventListener("click",e,!1):t.disabled=!0,t},_renderFileSystem:function(e,t,n){if(!n)return"";var r=n,i=e.createChild("span","list-column-text"),s=i.createChild("span","file-system-path");s.title=r;const o=55,u=30;var a=r.lastIndexOf(WebInspector.isWin()?"\\":"/"),f=r.substr(a+1),l=r.substr(0,a+1);l=l.trimMiddle(o-Math.min(u,f.length)),f=f.trimMiddle(u);var c=s.createChild("span");c.textContent=l;var h=s.createChild("span","file-system-path-name");h.textContent=f},_fileSystemRemovedfromList:function(e){var t=e.data;if(!t)return;WebInspector.isolatedFileSystemManager.removeFileSystem(t)},_addFileSystemClicked:function(){WebInspector.isolatedFileSystemManager.addFileSystem()},_fileSystemAdded:function(e){var t=e.data;this._fileSystemsList?this._fileSystemsList.addItem(t.path()):this._reset()},_fileSystemRemoved:function(e){var t=e.data,n=this._selectedFileSystemPath();this._fileSystemsList.itemForId(t.path())&&this._fileSystemsList.removeItem(t.path()),this._fileSystemsList.itemIds().length||this._reset(),this._updateEditFileSystemButtonState()},_selectedFileSystemPath:function(){return this._fileSystemsList?this._fileSystemsList.selectedId():null},__proto__:WebInspector.SettingsTab.prototype},WebInspector.ExperimentsSettingsTab=function(){WebInspector.SettingsTab.call(this,WebInspector.UIString("Experiments"),"experiments-tab-content");var e=WebInspector.experimentsSettings.experiments;if(e.length){var t=this._appendSection();t.appendChild(this._createExperimentsWarningSubsection());for(var n=0;n<e.length;++n)t.appendChild(this._createExperimentCheckbox(e[n]))}},WebInspector.ExperimentsSettingsTab.prototype={_createExperimentsWarningSubsection:function(){var e=document.createElement("div"),t=e.createChild("span","settings-experiments-warning-subsection-warning");t.textContent=WebInspector.UIString("WARNING:"),e.appendChild(document.createTextNode(" "));var n=e.createChild("span","settings-experiments-warning-subsection-message");return n.textContent=WebInspector.UIString("These experiments could be dangerous and may require restart."),e},_createExperimentCheckbox:function(e){function n(){e.setEnabled(t.checked)}var t=document.createElement("input");t.type="checkbox",t.name=e.name,t.checked=e.isEnabled(),t.addEventListener("click",n,!1);var r=document.createElement("p"),i=document.createElement("label");return i.appendChild(t),i.appendChild(document.createTextNode(WebInspector.UIString(e.title))),r.appendChild(i),r},__proto__:WebInspector.SettingsTab.prototype},WebInspector.SettingsController=function(){this._statusBarButton=new WebInspector.StatusBarButton(WebInspector.UIString("Settings"),"settings-status-bar-item"),WebInspector.experimentsSettings.showOverridesInDrawer.isEnabled()?this._statusBarButton.element.addEventListener("mousedown",this._mouseDown.bind(this),!1):this._statusBarButton.element.addEventListener("mouseup",this._mouseUp.bind(this),!1),this._settingsScreen},WebInspector.SettingsController.prototype={get statusBarItem(){return this._statusBarButton.element},_mouseDown:function(e){function n(){this._settingsScreenVisible&&this._hideSettingsScreen(),WebInspector.OverridesView.showInDrawer()}function r(){this._settingsScreenVisible||this.showSettingsScreen()}var t=new WebInspector.ContextMenu(e);t.appendItem(WebInspector.UIString("Overrides"),n.bind(this)),t.appendItem(WebInspector.UIString("Settings"),r.bind(this)),t.showSoftMenu()},_mouseUp:function(e){this.showSettingsScreen()},_onHideSettingsScreen:function(){delete this._settingsScreenVisible},showSettingsScreen:function(e){this._settingsScreen||(this._settingsScreen=new WebInspector.SettingsScreen(this._onHideSettingsScreen.bind(this))),e&&this._settingsScreen.selectTab(e),this._settingsScreen.showModal(),this._settingsScreenVisible=!0},_hideSettingsScreen:function(){this._settingsScreen&&this._settingsScreen.hide()},resize:function(){this._settingsScreen&&this._settingsScreen.isShowing()&&this._settingsScreen.doResize()}},WebInspector.SettingsList=function(e,t){this.element=document.createElement("div"),this.element.addStyleClass("settings-list"),this.element.tabIndex=-1,this._itemRenderer=t,this._listItems={},this._ids=[],this._columns=e},WebInspector.SettingsList.Events={Selected:"Selected",Removed:"Removed",DoubleClicked:"DoubleClicked"},WebInspector.SettingsList.prototype={addItem:function(e,t){function f(t){a.disabled=!0,this.removeItem(e),this.dispatchEventToListeners(WebInspector.SettingsList.Events.Removed,e),t.consume()}var n=document.createElement("div");n._id=e,n.addStyleClass("settings-list-item"),typeof t!==undefined?this.element.insertBefore(n,this._listItems[t]):this.element.appendChild(n);var r=n.createChild("div","settings-list-item-contents"),i=r.createChild("div","settings-list-item-columns");n.columnElements={};for(var s=0;s<this._columns.length;++s){var o=i.createChild("div","list-column"),u=this._columns[s];n.columnElements[u]=o,this._itemRenderer(o,u,e)}var a=this._createRemoveButton(f.bind(this));return r.addEventListener("click",this.selectItem.bind(this,e),!1),r.addEventListener("dblclick",this._onDoubleClick.bind(this,e),!1),r.appendChild(a),this._listItems[e]=n,typeof t!==undefined?this._ids.splice(this._ids.indexOf(t),0,e):this._ids.push(e),n},removeItem:function(e){this._listItems[e].remove(),delete this._listItems[e],this._ids.remove(e),e===this._selectedId&&(delete this._selectedId,this._ids.length&&this.selectItem(this._ids[0]))},itemIds:function(){return this._ids.slice()},columns:function(){return this._columns.slice()},selectedId:function(){return this._selectedId},selectedItem:function(){return this._selectedId?this._listItems[this._selectedId]:null},itemForId:function(e){return this._listItems[e]},_onDoubleClick:function(e,t){this.dispatchEventToListeners(WebInspector.SettingsList.Events.DoubleClicked,e)},selectItem:function(e,t){typeof this._selectedId!="undefined"&&this._listItems[this._selectedId].removeStyleClass("selected"),this._selectedId=e,typeof this._selectedId!="undefined"&&this._listItems[this._selectedId].addStyleClass("selected"),this.dispatchEventToListeners(WebInspector.SettingsList.Events.Selected,e),t&&t.consume()},_createRemoveButton:function(e){var t=document.createElement("button");return t.addStyleClass("remove-item-button"),t.value=WebInspector.UIString("Remove"),t.addEventListener("click",e,!1),t},__proto__:WebInspector.Object.prototype},WebInspector.EditableSettingsList=function(e,t,n,r){WebInspector.SettingsList.call(this,e,this._renderColumn.bind(this)),this._validateHandler=n,this._editHandler=r,this._valuesProvider=t,this._addInputElements={},this._editInputElements={},this._textElements={},this._addMappingItem=this.addItem(null),this._addMappingItem.addStyleClass("item-editing"),this._addMappingItem.addStyleClass("add-list-item")},WebInspector.EditableSettingsList.prototype={addItem:function(e,t){var n=WebInspector.SettingsList.prototype.addItem.call(this,e,t);return n.addStyleClass("editable"),n},_renderColumn:function(e,t,n){function u(e){if(n===this._editingId)return;e.consume(),console.assert(!this._editingId),this._editingId=n;var t=this.itemForId(n);t.addStyleClass("item-editing");var r=e.target.inputElement||this._editInputElements[n][this.columns()[0]];r.focus(),r.select()}e.addStyleClass("settings-list-column-"+t);var r=t==="url"?WebInspector.UIString("URL prefix"):WebInspector.UIString("Folder path");if(n===null){var i=e.createChild("input","list-column-editor");i.placeholder=r,i.addEventListener("blur",this._onAddMappingInputBlur.bind(this)),i.addEventListener("input",this._validateEdit.bind(this,n)),this._addInputElements[t]=i;return}this._editInputElements[n]||(this._editInputElements[n]={}),this._textElements[n]||(this._textElements[n]={});var s=this._valuesProvider(n,t),o=e.createChild("span","list-column-text");o.textContent=s,o.title=s,e.addEventListener("click",u.bind(this),!1),this._textElements[n][t]=o;var i=e.createChild("input","list-column-editor");i.value=s,i.addEventListener("blur",this._editMappingBlur.bind(this,n)),i.addEventListener("input",this._validateEdit.bind(this,n)),e.inputElement=i,this._editInputElements[n][t]=i},_data:function(e){var t=this._inputElements(e),n={},r=this.columns();for(var i=0;i<r.length;++i)n[r[i]]=t[r[i]].value;return n},_inputElements:function(e){return e?this._editInputElements[e]:this._addInputElements},_validateEdit:function(e){var t=this._validateHandler(e,this._data(e)),n=this._hasChanges(e),r=this.columns();for(var i=0;i<r.length;++i){var s=r[i],o=this._inputElements(e)[s];n&&t.indexOf(s)!==-1?o.addStyleClass("editable-item-error"):o.removeStyleClass("editable-item-error")}return!t.length},_hasChanges:function(e){var t=!1,n=this.columns();for(var r=0;r<n.length;++r){var i=n[r],s=e?this._textElements[e][i].textContent:"",o=this._inputElements(e)[i].value;if(s!==o){t=!0;break}}return t},_editMappingBlur:function(e,t){var n=Object.values(this._editInputElements[e]);if(n.indexOf(t.relatedTarget)!==-1)return;var r=this.itemForId(e);r.removeStyleClass("item-editing"),delete this._editingId;if(!this._hasChanges(e))return;if(!this._validateEdit(e)){var i=this.columns();for(var s=0;s<i.length;++s){var o=i[s],u=this._editInputElements[e][o];u.value=this._textElements[e][o].textContent,u.removeStyleClass("editable-item-error")}return}this._editHandler(e,this._data(e))},_onAddMappingInputBlur:function(e){var t=Object.values(this._addInputElements);if(t.indexOf(e.relatedTarget)!==-1)return;if(!this._hasChanges(null))return;if(!this._validateEdit(null))return;this._editHandler(null,this._data(null));var n=this.columns();for(var r=0;r<n.length;++r){var i=n[r],s=this._addInputElements[i];s.value=""}},__proto__:WebInspector.SettingsList.prototype};