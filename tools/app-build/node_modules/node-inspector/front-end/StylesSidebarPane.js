/*
 * Copyright (C) 2007 Apple Inc.  All rights reserved.
 * Copyright (C) 2009 Joseph Pecoraro
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 *
 * 1.  Redistributions of source code must retain the above copyright
 *     notice, this list of conditions and the following disclaimer.
 * 2.  Redistributions in binary form must reproduce the above copyright
 *     notice, this list of conditions and the following disclaimer in the
 *     documentation and/or other materials provided with the distribution.
 * 3.  Neither the name of Apple Computer, Inc. ("Apple") nor the names of
 *     its contributors may be used to endorse or promote products derived
 *     from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY APPLE AND ITS CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL APPLE OR ITS CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
 * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

WebInspector.StylesSidebarPane=function(e,t){WebInspector.SidebarPane.call(this,WebInspector.UIString("Styles")),this.settingsSelectElement=document.createElement("select"),this.settingsSelectElement.className="select-settings";var n=document.createElement("option");n.value=WebInspector.Color.Format.Original,n.label=WebInspector.UIString(WebInspector.useLowerCaseMenuTitles()?"As authored":"As Authored"),this.settingsSelectElement.appendChild(n),n=document.createElement("option"),n.value=WebInspector.Color.Format.HEX,n.label=WebInspector.UIString("Hex Colors"),this.settingsSelectElement.appendChild(n),n=document.createElement("option"),n.value=WebInspector.Color.Format.RGB,n.label=WebInspector.UIString("RGB Colors"),this.settingsSelectElement.appendChild(n),n=document.createElement("option"),n.value=WebInspector.Color.Format.HSL,n.label=WebInspector.UIString("HSL Colors"),this.settingsSelectElement.appendChild(n);var r=function(e){e.consume(!0)};this.settingsSelectElement.addEventListener("click",r,!0),this.settingsSelectElement.addEventListener("change",this._changeSetting.bind(this),!1),this._updateColorFormatFilter(),this.titleElement.appendChild(this.settingsSelectElement),this._elementStateButton=document.createElement("button"),this._elementStateButton.className="pane-title-button element-state",this._elementStateButton.title=WebInspector.UIString("Toggle Element State"),this._elementStateButton.addEventListener("click",this._toggleElementStatePane.bind(this),!1),this.titleElement.appendChild(this._elementStateButton);var i=document.createElement("button");i.className="pane-title-button add",i.id="add-style-button-test-id",i.title=WebInspector.UIString("New Style Rule"),i.addEventListener("click",this._createNewRule.bind(this),!1),this.titleElement.appendChild(i),this._computedStylePane=e,e._stylesSidebarPane=this,this._setPseudoClassCallback=t,this.element.addEventListener("contextmenu",this._contextMenuEventFired.bind(this),!0),WebInspector.settings.colorFormat.addChangeListener(this._colorFormatSettingChanged.bind(this)),this._createElementStatePane(),this.bodyElement.appendChild(this._elementStatePane),this._sectionsContainer=document.createElement("div"),this.bodyElement.appendChild(this._sectionsContainer),this._spectrumHelper=new WebInspector.SpectrumPopupHelper,this._linkifier=new WebInspector.Linkifier(new WebInspector.Linkifier.DefaultCSSFormatter),WebInspector.cssModel.addEventListener(WebInspector.CSSStyleModel.Events.StyleSheetAdded,this._styleSheetOrMediaQueryResultChanged,this),WebInspector.cssModel.addEventListener(WebInspector.CSSStyleModel.Events.StyleSheetRemoved,this._styleSheetOrMediaQueryResultChanged,this),WebInspector.cssModel.addEventListener(WebInspector.CSSStyleModel.Events.StyleSheetChanged,this._styleSheetOrMediaQueryResultChanged,this),WebInspector.cssModel.addEventListener(WebInspector.CSSStyleModel.Events.MediaQueryResultChanged,this._styleSheetOrMediaQueryResultChanged,this),WebInspector.domAgent.addEventListener(WebInspector.DOMAgent.Events.AttrModified,this._attributeChanged,this),WebInspector.domAgent.addEventListener(WebInspector.DOMAgent.Events.AttrRemoved,this._attributeChanged,this),WebInspector.settings.showUserAgentStyles.addChangeListener(this._showUserAgentStylesSettingChanged.bind(this)),this.element.addEventListener("mousemove",this._mouseMovedOverElement.bind(this),!1),document.body.addEventListener("keydown",this._keyDown.bind(this),!1),document.body.addEventListener("keyup",this._keyUp.bind(this),!1)},WebInspector.StylesSidebarPane.PseudoIdNames=["","first-line","first-letter","before","after","selection","","-webkit-scrollbar","-webkit-file-upload-button","-webkit-input-placeholder","-webkit-slider-thumb","-webkit-search-cancel-button","-webkit-search-decoration","-webkit-search-results-decoration","-webkit-search-results-button","-webkit-media-controls-panel","-webkit-media-controls-play-button","-webkit-media-controls-mute-button","-webkit-media-controls-timeline","-webkit-media-controls-timeline-container","-webkit-media-controls-volume-slider","-webkit-media-controls-volume-slider-container","-webkit-media-controls-current-time-display","-webkit-media-controls-time-remaining-display","-webkit-media-controls-seek-back-button","-webkit-media-controls-seek-forward-button","-webkit-media-controls-fullscreen-button","-webkit-media-controls-rewind-button","-webkit-media-controls-return-to-realtime-button","-webkit-media-controls-toggle-closed-captions-button","-webkit-media-controls-status-display","-webkit-scrollbar-thumb","-webkit-scrollbar-button","-webkit-scrollbar-track","-webkit-scrollbar-track-piece","-webkit-scrollbar-corner","-webkit-resizer","-webkit-inner-spin-button","-webkit-outer-spin-button"],WebInspector.StylesSidebarPane._colorRegex=/((?:rgb|hsl)a?\([^)]+\)|#[0-9a-fA-F]{6}|#[0-9a-fA-F]{3}|\b\w+\b(?!-))/g,WebInspector.StylesSidebarPane.createExclamationMark=function(e){var t=document.createElement("div");return t.className="exclamation-mark"+(WebInspector.StylesSidebarPane._ignoreErrorsForProperty(e)?"":" warning-icon-small"),t.title=WebInspector.CSSMetadata.cssPropertiesMetainfo.keySet()[e.name.toLowerCase()]?WebInspector.UIString("Invalid property value."):WebInspector.UIString("Unknown property name."),t},WebInspector.StylesSidebarPane._colorFormat=function(e){const t=WebInspector.Color.Format;var n,r=WebInspector.settings.colorFormat.get();return r===t.Original?n=t.Original:r===t.RGB?n=e.hasAlpha()?t.RGBA:t.RGB:r===t.HSL?n=e.hasAlpha()?t.HSLA:t.HSL:e.hasAlpha()?n=t.RGBA:n=e.canBeShortHex()?t.ShortHEX:t.HEX,n},WebInspector.StylesSidebarPane._ignoreErrorsForProperty=function(e){function t(e){return!e.startsWith("-webkit-")&&/^[-_][\w\d]+-\w/.test(e)}var n=e.name.toLowerCase();if(n.charAt(0)==="_")return!0;if(n==="filter")return!0;if(n.startsWith("scrollbar-"))return!0;if(t(n))return!0;var r=e.value.toLowerCase();return r.endsWith("9")?!0:t(r)?!0:!1},WebInspector.StylesSidebarPane.prototype={_contextMenuEventFired:function(e){var t=new WebInspector.ContextMenu(e);t.appendApplicableItems(e.target),t.show()},get _forcedPseudoClasses(){return this.node?this.node.getUserProperty("pseudoState")||undefined:undefined},_updateForcedPseudoStateInputs:function(){if(!this.node)return;var e=this._forcedPseudoClasses;e||(e=[]);var t=this._elementStatePane.inputs;for(var n=0;n<t.length;++n)t[n].checked=e.indexOf(t[n].state)>=0},update:function(e,t){this._spectrumHelper.hide(),this._discardElementUnderMouse();var n=!1;t&&delete this.node,!t&&e===this.node&&(n=!0),e&&e.nodeType()===Node.TEXT_NODE&&e.parentNode&&(e=e.parentNode),e&&e.nodeType()!==Node.ELEMENT_NODE&&(e=null),e?this.node=e:e=this.node,this._updateForcedPseudoStateInputs(),n?this._refreshUpdate():this._rebuildUpdate()},_refreshUpdate:function(e,t,n){function i(i){delete this._refreshUpdateInProgress;if(this._lastNodeForInnerRefresh){delete this._lastNodeForInnerRefresh,this._refreshUpdate(e,t,n);return}this.node===r&&i&&this._innerRefreshUpdate(r,i,e),n&&n()}if(this._refreshUpdateInProgress){this._lastNodeForInnerRefresh=this.node;return}var r=this._validateNode(n);if(!r)return;this._computedStylePane.isShowing()||t?(this._refreshUpdateInProgress=!0,WebInspector.cssModel.getComputedStyleAsync(r.id,i.bind(this))):(this._innerRefreshUpdate(r,null,e),n&&n())},_rebuildUpdate:function(){function n(n){delete this._rebuildUpdateInProgress;var r=this._lastNodeForInnerRebuild;if(r){delete this._lastNodeForInnerRebuild;if(r!==this.node){this._rebuildUpdate();return}}n&&this.node===e&&(t.matchedCSSRules=n.matchedCSSRules,t.pseudoElements=n.pseudoElements,t.inherited=n.inherited,this._innerRebuildUpdate(e,t));if(r){this._rebuildUpdate();return}}function r(e,n){t.inlineStyle=e,t.attributesStyle=n}function i(e){t.computedStyle=e}if(this._rebuildUpdateInProgress){this._lastNodeForInnerRebuild=this.node;return}var e=this._validateNode();if(!e)return;this._rebuildUpdateInProgress=!0;var t={};this._computedStylePane.isShowing()&&WebInspector.cssModel.getComputedStyleAsync(e.id,i.bind(this)),WebInspector.cssModel.getInlineStylesAsync(e.id,r.bind(this)),WebInspector.cssModel.getMatchedStylesAsync(e.id,!0,!0,n.bind(this))},_validateNode:function(e){return this.node?this.node:(this._sectionsContainer.removeChildren(),this._computedStylePane.bodyElement.removeChildren(),this.sections={},e&&e(),null)},_styleSheetOrMediaQueryResultChanged:function(){if(this._userOperation||this._isEditingStyle)return;this._rebuildUpdate()},_attributeChanged:function(e){if(this._isEditingStyle||this._userOperation)return;if(!this._canAffectCurrentStyles(e.data.node))return;this._rebuildUpdate()},_canAffectCurrentStyles:function(e){return this.node&&(this.node===e||e.parentNode===this.node.parentNode||e.isAncestor(this.node))},_innerRefreshUpdate:function(e,t,n){for(var r in this.sections){var i=this._refreshStyleRules(this.sections[r],t),s={};this._markUsedProperties(i,s),this._refreshSectionsForStyleRules(i,s,n)}t&&this.sections[0][0].rebuildComputedTrace(this.sections[0]),this._nodeStylesUpdatedForTest(e,!1)},_innerRebuildUpdate:function(e,t){this._sectionsContainer.removeChildren(),this._computedStylePane.bodyElement.removeChildren(),this._linkifier.reset();var n=this._rebuildStyleRules(e,t),r={};this._markUsedProperties(n,r),this.sections[0]=this._rebuildSectionsForStyleRules(n,r,0,null);var i=this.sections[0].inheritedPropertiesSeparatorElement;t.computedStyle&&this.sections[0][0].rebuildComputedTrace(this.sections[0]);for(var s=0;s<t.pseudoElements.length;++s){var o=t.pseudoElements[s];n=[];var u=o.pseudoId,a={isStyleSeparator:!0,pseudoId:u};n.push(a);for(var f=o.rules.length-1;f>=0;--f){var l=o.rules[f];n.push({style:l.style,selectorText:l.selectorText,media:l.media,sourceURL:l.resourceURL(),rule:l,editable:!!l.style&&!!l.style.id})}r={},this._markUsedProperties(n,r),this.sections[u]=this._rebuildSectionsForStyleRules(n,r,u,i)}this._nodeStylesUpdatedForTest(e,!0)},_nodeStylesUpdatedForTest:function(e,t){},_refreshStyleRules:function(e,t){var n=t,r=[];for(var i=0;e&&i<e.length;++i){var s=e[i];if(s.isBlank)continue;s.computedStyle&&(s.styleRule.style=n);var o={section:s,style:s.styleRule.style,computedStyle:s.computedStyle,rule:s.rule,editable:!!s.styleRule.style&&!!s.styleRule.style.id,isAttribute:s.styleRule.isAttribute,isInherited:s.styleRule.isInherited,parentNode:s.styleRule.parentNode};r.push(o)}return r},_rebuildStyleRules:function(e,t){function i(){if(!t.attributesStyle)return;var n={style:t.attributesStyle,editable:!1};n.selectorText=e.nodeNameInCorrectCase()+"["+WebInspector.UIString("Attributes Style")+"]",r.push(n)}function l(e){var t={};t.isStyleSeparator=!0,t.node=e,r.push(t)}var n=t.computedStyle;this.sections={};var r=[];r.push({computedStyle:!0,selectorText:"",style:n,editable:!1});if(t.inlineStyle&&e.nodeType()===Node.ELEMENT_NODE){var s={selectorText:"element.style",style:t.inlineStyle,isAttribute:!0};r.push(s)}var o;for(var u=t.matchedCSSRules.length-1;u>=0;--u){var a=t.matchedCSSRules[u];if(!WebInspector.settings.showUserAgentStyles.get()&&(a.isUser||a.isUserAgent))continue;(a.isUser||a.isUserAgent)&&!o&&(o=!0,i()),r.push({style:a.style,selectorText:a.selectorText,media:a.media,sourceURL:a.resourceURL(),rule:a,editable:!!a.style&&!!a.style.id})}o||i();var f=e.parentNode;for(var c=0;c<t.inherited.length;++c){var h=t.inherited[c],p=!1;if(h.inlineStyle&&this._containsInherited(h.inlineStyle)){var s={selectorText:WebInspector.UIString("Style Attribute"),style:h.inlineStyle,isAttribute:!0,isInherited:!0,parentNode:f};p||(l(f),p=!0),r.push(s)}for(var u=h.matchedCSSRules.length-1;u>=0;--u){var d=h.matchedCSSRules[u];if(!this._containsInherited(d.style))continue;var a=d;if(!WebInspector.settings.showUserAgentStyles.get()&&(a.isUser||a.isUserAgent))continue;p||(l(f),p=!0),r.push({style:a.style,selectorText:a.selectorText,media:a.media,sourceURL:a.resourceURL(),rule:a,isInherited:!0,parentNode:f,editable:!!a.style&&!!a.style.id})}f=f.parentNode}return r},_markUsedProperties:function(e,t){var n={},r={},i={};for(var s=0;s<e.length;++s){var o=e[s];if(o.computedStyle||o.isStyleSeparator)continue;if(o.section&&o.section.noAffect)continue;o.usedProperties={};var u=o.style,a=u.allProperties;for(var f=0;f<a.length;++f){var l=a[f];if(!l.isLive||!l.parsedOk)continue;if(o.isInherited&&!WebInspector.CSSMetadata.isPropertyInherited(l.name))continue;var c=WebInspector.CSSMetadata.canonicalPropertyName(l.name);if(n.hasOwnProperty(c))continue;var h=l.priority.length;if(!h&&t.hasOwnProperty(c))continue;var p=r.hasOwnProperty(c);!p&&o.isInherited&&!i[c]&&(i[c]=o.parentNode);if(h){if(o.isInherited&&p&&o.parentNode!==i[c])continue;n[c]=!0,p&&delete r[c].usedProperties[c]}o.usedProperties[c]=!0,t[c]=!0,r[c]=o}}},_refreshSectionsForStyleRules:function(e,t,n){for(var r=0;r<e.length;++r){var i=e[r],s=i.section;i.computedStyle?(s._usedProperties=t,s.update()):(s._usedProperties=i.usedProperties,s.update(s===n))}},_rebuildSectionsForStyleRules:function(e,t,n,r){var i=[],s=!0;for(var o=0;o<e.length;++o){var u=e[o];if(u.isStyleSeparator){var a=document.createElement("div");a.className="sidebar-separator";if(u.node){var f=WebInspector.DOMPresentationUtils.linkifyNodeReference(u.node);a.appendChild(document.createTextNode(WebInspector.UIString("Inherited from")+" ")),a.appendChild(f),i.inheritedPropertiesSeparatorElement||(i.inheritedPropertiesSeparatorElement=a)}else if("pseudoId"in u){var l=WebInspector.StylesSidebarPane.PseudoIdNames[u.pseudoId];l?a.textContent=WebInspector.UIString("Pseudo ::%s element",l):a.textContent=WebInspector.UIString("Pseudo element")}else a.textContent=u.text;this._sectionsContainer.insertBefore(a,r),s=!0;continue}var c=u.computedStyle,h=u.editable;typeof h=="undefined"&&(h=!0);if(c)var p=new WebInspector.ComputedStylePropertiesSection(this,u,t);else{var p=new WebInspector.StylePropertiesSection(this,u,h,u.isInherited,s);p._markSelectorMatches()}p.expanded=!0,c?(this._computedStylePane.bodyElement.appendChild(p.element),s=!0):(this._sectionsContainer.insertBefore(p.element,r),s=!1),i.push(p)}return i},_containsInherited:function(e){var t=e.allProperties;for(var n=0;n<t.length;++n){var r=t[n];if(r.isLive&&WebInspector.CSSMetadata.isPropertyInherited(r.name))return!0}return!1},_colorFormatSettingChanged:function(e){this._updateColorFormatFilter();for(var t in this.sections){var n=this.sections[t];for(var r=0;r<n.length;++r)n[r].update(!0)}},_updateColorFormatFilter:function(){var e=0,t=WebInspector.settings.colorFormat.get(),n=this.settingsSelectElement.options;for(var r=0;r<n.length;++r)if(n[r].value===t){e=r;break}this.settingsSelectElement.selectedIndex=e},_changeSetting:function(e){var t=this.settingsSelectElement.options,n=t[this.settingsSelectElement.selectedIndex];WebInspector.settings.colorFormat.set(n.value)},_createNewRule:function(e){e.consume(),this.expand(),this.addBlankSection().startEditingSelector()},addBlankSection:function(){var e=new WebInspector.BlankStylePropertiesSection(this,this.node?this.node.appropriateSelectorFor(!0):""),t=this.sections[0][1];return this._sectionsContainer.insertBefore(e.element,t.element.nextSibling),this.sections[0].splice(2,0,e),e},removeSection:function(e){for(var t in this.sections){var n=this.sections[t],r=n.indexOf(e);if(r===-1)continue;n.splice(r,1),e.element.remove()}},_toggleElementStatePane:function(e){e.consume(),this._elementStateButton.hasStyleClass("toggled")?(this._elementStateButton.removeStyleClass("toggled"),this._elementStatePane.removeStyleClass("expanded")):(this.expand(),this._elementStateButton.addStyleClass("toggled"),this._elementStatePane.addStyleClass("expanded"))},_createElementStatePane:function(){function n(e){var t=this._validateNode();if(!t)return;this._setPseudoClassCallback(t.id,e.target.state,e.target.checked)}function r(e){var r=document.createElement("td"),i=document.createElement("label"),s=document.createElement("input");return s.type="checkbox",s.state=e,s.addEventListener("click",n.bind(this),!1),t.push(s),i.appendChild(s),i.appendChild(document.createTextNode(":"+e)),r.appendChild(i),r}this._elementStatePane=document.createElement("div"),this._elementStatePane.className="styles-element-state-pane source-code";var e=document.createElement("table"),t=[];this._elementStatePane.inputs=t;var i=document.createElement("tr");i.appendChild(r.call(this,"active")),i.appendChild(r.call(this,"hover")),e.appendChild(i),i=document.createElement("tr"),i.appendChild(r.call(this,"focus")),i.appendChild(r.call(this,"visited")),e.appendChild(i),this._elementStatePane.appendChild(e)},_showUserAgentStylesSettingChanged:function(){this._rebuildUpdate()},willHide:function(){this._spectrumHelper.hide(),this._discardElementUnderMouse()},_discardElementUnderMouse:function(){this._elementUnderMouse&&this._elementUnderMouse.removeStyleClass("styles-panel-hovered"),delete this._elementUnderMouse},_mouseMovedOverElement:function(e){this._elementUnderMouse&&e.target!==this._elementUnderMouse&&this._discardElementUnderMouse(),this._elementUnderMouse=e.target,WebInspector.KeyboardShortcut.eventHasCtrlOrMeta(e)&&this._elementUnderMouse.addStyleClass("styles-panel-hovered")},_keyDown:function(e){(!WebInspector.isMac()&&e.keyCode===WebInspector.KeyboardShortcut.Keys.Ctrl.code||WebInspector.isMac()&&e.keyCode===WebInspector.KeyboardShortcut.Keys.Meta.code)&&this._elementUnderMouse&&this._elementUnderMouse.addStyleClass("styles-panel-hovered")},_keyUp:function(e){(!WebInspector.isMac()&&e.keyCode===WebInspector.KeyboardShortcut.Keys.Ctrl.code||WebInspector.isMac()&&e.keyCode===WebInspector.KeyboardShortcut.Keys.Meta.code)&&this._discardElementUnderMouse()},__proto__:WebInspector.SidebarPane.prototype},WebInspector.ComputedStyleSidebarPane=function(){function t(t){WebInspector.settings.showInheritedComputedStyleProperties.set(e.checked),WebInspector.settings.showInheritedComputedStyleProperties.get()?this.bodyElement.addStyleClass("show-inherited"):this.bodyElement.removeStyleClass("show-inherited")}WebInspector.SidebarPane.call(this,WebInspector.UIString("Computed Style"));var e=new WebInspector.Checkbox(WebInspector.UIString("Show inherited"),"sidebar-pane-subtitle");this.titleElement.appendChild(e.element),WebInspector.settings.showInheritedComputedStyleProperties.get()&&(this.bodyElement.addStyleClass("show-inherited"),e.checked=!0),e.addEventListener(t.bind(this))},WebInspector.ComputedStyleSidebarPane.prototype={wasShown:function(){WebInspector.SidebarPane.prototype.wasShown.call(this),this._hasFreshContent||this.prepareContent()},prepareContent:function(e){function t(){this._hasFreshContent=!0,e&&e(),delete this._hasFreshContent}this._stylesSidebarPane._refreshUpdate(null,!0,t.bind(this))},__proto__:WebInspector.SidebarPane.prototype},WebInspector.StylePropertiesSection=function(e,t,n,r,i){WebInspector.PropertiesSection.call(this,""),this.element.className="styles-section matched-styles monospace"+(i?" first-styles-section":""),this.propertiesElement.removeStyleClass("properties-tree"),this._parentPane=e,this.styleRule=t,this.rule=this.styleRule.rule,this.editable=n,this.isInherited=r;if(t.media)for(var s=t.media.length-1;s>=0;--s){var o=t.media[s],u=this.titleElement.createChild("div","media"),a;switch(o.source){case WebInspector.CSSMedia.Source.LINKED_SHEET:case WebInspector.CSSMedia.Source.INLINE_SHEET:a='media="'+o.text+'"';break;case WebInspector.CSSMedia.Source.MEDIA_RULE:a="@media "+o.text;break;case WebInspector.CSSMedia.Source.IMPORT_RULE:a="@import "+o.text}if(o.sourceURL){var f=u.createChild("div","subtitle"),l,c;if(o.range){c=o.header();if(c){var h=o.lineNumberInSource(),p=o.columnNumberInSource();console.assert(typeof h!="undefined"&&typeof p!="undefined"),l=new WebInspector.CSSLocation(o.sourceURL,h,p)}}var d;l?d=this._parentPane._linkifier.linkifyCSSLocation(c.id,l):d=WebInspector.linkifyResourceAsNode(o.sourceURL,undefined,"subtitle",o.sourceURL),d.preferredPanel="scripts",d.style.float="right",f.appendChild(d)}var v=u.createChild("span");v.textContent=a,v.title=o.text}var m=document.createElement("div");this._selectorElement=document.createElement("span"),this._selectorElement.textContent=t.selectorText,m.appendChild(this._selectorElement);var g=document.createElement("span");g.textContent=" {",m.appendChild(g),m.addEventListener("mousedown",this._handleEmptySpaceMouseDown.bind(this),!1),m.addEventListener("click",this._handleSelectorContainerClick.bind(this),!1);var y=document.createElement("div");y.textContent="}",this.element.appendChild(y),this._selectorElement.addEventListener("click",this._handleSelectorClick.bind(this),!1),this.element.addEventListener("mousedown",this._handleEmptySpaceMouseDown.bind(this),!1),this.element.addEventListener("click",this._handleEmptySpaceClick.bind(this),!1),this.rule&&(this.rule.isUserAgent||this.rule.isUser?this.editable=!1:this.rule.id&&(this.navigable=!!this.rule.resourceURL()),this.titleElement.addStyleClass("styles-selector")),this._usedProperties=t.usedProperties,this._selectorRefElement=document.createElement("div"),this._selectorRefElement.className="subtitle",this._selectorRefElement.appendChild(this._createRuleOriginNode()),m.insertBefore(this._selectorRefElement,m.firstChild),this.titleElement.appendChild(m),this._selectorContainer=m,r&&this.element.addStyleClass("show-inherited"),this.navigable&&this.element.addStyleClass("navigable"),this.editable||this.element.addStyleClass("read-only")},WebInspector.StylePropertiesSection.prototype={get pane(){return this._parentPane},collapse:function(e){},isPropertyInherited:function(e){return this.isInherited?!WebInspector.CSSMetadata.isPropertyInherited(e):!1},isPropertyOverloaded:function(e,t){if(!this._usedProperties||this.noAffect)return!1;if(this.isInherited&&!WebInspector.CSSMetadata.isPropertyInherited(e))return!1;var n=WebInspector.CSSMetadata.canonicalPropertyName(e),r=n in this._usedProperties;if(r||!t)return!r;var i=this.styleRule.style.longhandProperties(e);for(var s=0;s<i.length;++s){var o=i[s];if(WebInspector.CSSMetadata.canonicalPropertyName(o.name)in this._usedProperties)return!1}return!0},nextEditableSibling:function(){var e=this;do e=e.nextSibling;while(e&&!e.editable);if(!e){e=this.firstSibling;while(e&&!e.editable)e=e.nextSibling}return e&&e.editable?e:null},previousEditableSibling:function(){var e=this;do e=e.previousSibling;while(e&&!e.editable);if(!e){e=this.lastSibling;while(e&&!e.editable)e=e.previousSibling}return e&&e.editable?e:null},update:function(e){this.styleRule.selectorText&&(this._selectorElement.textContent=this.styleRule.selectorText),this._markSelectorMatches();if(e)this.propertiesTreeOutline.removeChildren(),this.populated=!1;else{var t=this.propertiesTreeOutline.children[0];while(t)t.overloaded=this.isPropertyOverloaded(t.name,t.isShorthand),t=t.traverseNextTreeElement(!1,null,!0)}this.afterUpdate()},afterUpdate:function(){this._afterUpdate&&(this._afterUpdate(this),delete this._afterUpdate)},onpopulate:function(){var e=this.styleRule.style,t=e.allProperties;this.uniqueProperties=[];var n=this.editable&&!!e.range;if(n){for(var r=0;r<t.length;++r){var i=t[r];this.uniqueProperties.push(i);if(i.styleBased)continue;var s=!!WebInspector.CSSMetadata.cssPropertiesMetainfo.longhands(i.name),o=this.isPropertyInherited(i.name),u=i.inactive||this.isPropertyOverloaded(i.name),a=new WebInspector.StylePropertyTreeElement(this._parentPane,this.styleRule,e,i,s,o,u);this.propertiesTreeOutline.appendChild(a)}return}var f={};for(var r=0;r<t.length;++r){var i=t[r];this.uniqueProperties.push(i);var s=!!WebInspector.CSSMetadata.cssPropertiesMetainfo.longhands(i.name),l=s?null:WebInspector.CSSMetadata.cssPropertiesMetainfo.shorthands(i.name),c=!1;for(var h=0;l&&!c&&h<l.length;++h){var p=l[h];if(p in f){c=!0;continue}if(e.getLiveProperty(p)){c=!0;continue}if(!e.shorthandValue(p)){c=!1;continue}var d=new WebInspector.CSSProperty(e,e.allProperties.length,p,e.shorthandValue(p),"","style",!0,!0),u=i.inactive||this.isPropertyOverloaded(i.name,!0),a=new WebInspector.StylePropertyTreeElement(this._parentPane,this.styleRule,e,d,!0,!1,u);this.propertiesTreeOutline.appendChild(a),f[p]=d,c=!0}if(c)continue;var o=this.isPropertyInherited(i.name),u=i.inactive||this.isPropertyOverloaded(i.name,s),a=new WebInspector.StylePropertyTreeElement(this._parentPane,this.styleRule,e,i,s,o,u);this.propertiesTreeOutline.appendChild(a)}},findTreeElementWithName:function(e){var t=this.propertiesTreeOutline.children[0];while(t){if(t.name===e)return t;t=t.traverseNextTreeElement(!0,null,!0)}return null},_markSelectorMatches:function(){var e=this.styleRule.rule;if(!e)return;var t=e.matchingSelectors;if(this.noAffect||t)this._selectorElement.className="selector";if(!t)return;var n=e.selectors,r=document.createDocumentFragment(),i=0;for(var s=0,o=n.length-1;s<=o;++s){var u,a=document.createTextNode(n[s]);t[i]===s?(++i,u=document.createElement("span"),u.className="selector-matches",u.appendChild(a)):u=a,r.appendChild(u),s!==o&&r.appendChild(document.createTextNode(", "))}this._selectorElement.removeChildren(),this._selectorElement.appendChild(r)},_checkWillCancelEditing:function(){var e=this._willCauseCancelEditing;return delete this._willCauseCancelEditing,e},_handleSelectorContainerClick:function(e){if(this._checkWillCancelEditing()||!this.editable)return;e.target===this._selectorContainer&&this.addNewBlankProperty(0).startEditing()},addNewBlankProperty:function(e){var t=this.styleRule.style,n=t.newBlankProperty(e),r=new WebInspector.StylePropertyTreeElement(this._parentPane,this.styleRule,t,n,!1,!1,!1);return e=n.index,this.propertiesTreeOutline.insertChild(r,e),r.listItemElement.textContent="",r._newProperty=!0,r.updateTitle(),r},_createRuleOriginNode:function(){function e(e,t){var n=WebInspector.linkifyResourceAsNode(e,t,"",e+":"+(t+1));return n.preferredPanel="scripts",n.classList.add("webkit-html-resource-link"),n.setAttribute("data-uncopyable",n.textContent),n.textContent="",n}return this.styleRule.sourceURL?this._parentPane._linkifier.linkifyCSSLocation(this.rule.id.styleSheetId,this.rule.rawLocation)||e(this.styleRule.sourceURL,this.rule.lineNumberInSource()):this.rule?this.rule.isUserAgent?document.createTextNode(WebInspector.UIString("user agent stylesheet")):this.rule.isUser?document.createTextNode(WebInspector.UIString("user stylesheet")):this.rule.isViaInspector?document.createTextNode(WebInspector.UIString("via inspector")):document.createTextNode(""):document.createTextNode("")},_handleEmptySpaceMouseDown:function(e){this._willCauseCancelEditing=this._parentPane._isEditingStyle},_handleEmptySpaceClick:function(e){if(!this.editable)return;if(!window.getSelection().isCollapsed)return;if(this._checkWillCancelEditing())return;if(e.target.hasStyleClass("header")||this.element.hasStyleClass("read-only")||e.target.enclosingNodeOrSelfWithClass("media")){e.consume();return}this.expand(),this.addNewBlankProperty().startEditing()},_handleSelectorClick:function(e){this._startEditingOnMouseEvent(),e.consume(!0)},_startEditingOnMouseEvent:function(){if(!this.editable)return;if(!this.rule&&this.propertiesTreeOutline.children.length===0){this.expand(),this.addNewBlankProperty().startEditing();return}if(!this.rule)return;this.startEditingSelector()},startEditingSelector:function(){var e=this._selectorElement;if(WebInspector.isBeingEdited(e))return;e.scrollIntoViewIfNeeded(!1),e.textContent=e.textContent;var t=new WebInspector.EditingConfig(this.editingSelectorCommitted.bind(this),this.editingSelectorCancelled.bind(this));WebInspector.startEditing(this._selectorElement,t),window.getSelection().setBaseAndExtent(e,0,e,1)},_moveEditorFromSelector:function(e){this._markSelectorMatches();if(!e)return;if(e==="forward"){this.expand();var t=this.propertiesTreeOutline.children[0];while(t&&t.inherited)t=t.nextSibling;t?t.startEditing(t.nameElement):this.addNewBlankProperty().startEditing()}else{var n=this.previousEditableSibling();if(!n)return;n.expand(),n.addNewBlankProperty().startEditing()}},editingSelectorCommitted:function(e,t,n,r,i){function o(e,t){t?(delete this.noAffect,this.element.removeStyleClass("no-affect")):(this.noAffect=!0,this.element.addStyleClass("no-affect")),this.rule=e,this.styleRule={section:this,style:e.style,selectorText:e.selectorText,media:e.media,sourceURL:e.resourceURL(),rule:e},this._parentPane.update(s),u.call(this,i)}function u(e){delete this._parentPane._userOperation,this._moveEditorFromSelector(e)}t&&(t=t.trim());if(t===n)return this._selectorElement.textContent=t,this._moveEditorFromSelector(i);var s=this._parentPane.node;this._parentPane._userOperation=!0,WebInspector.cssModel.setRuleSelector(this.rule.id,s?s.id:0,t,o.bind(this),u.bind(this,i))},editingSelectorCancelled:function(){this._markSelectorMatches()},__proto__:WebInspector.PropertiesSection.prototype},WebInspector.ComputedStylePropertiesSection=function(e,t,n){WebInspector.PropertiesSection.call(this,""),this.headerElement.addStyleClass("hidden"),this.element.className="styles-section monospace first-styles-section read-only computed-style",this._stylesPane=e,this.styleRule=t,this._usedProperties=n,this._alwaysShowComputedProperties={display:!0,height:!0,width:!0},this.computedStyle=!0,this._propertyTreeElements={},this._expandedPropertyNames={}},WebInspector.ComputedStylePropertiesSection.prototype={collapse:function(e){},_isPropertyInherited:function(e){var t=WebInspector.CSSMetadata.canonicalPropertyName(e);return!(t in this._usedProperties)&&!(t in this._alwaysShowComputedProperties)},update:function(){this._expandedPropertyNames={};for(var e in this._propertyTreeElements)this._propertyTreeElements[e].expanded&&(this._expandedPropertyNames[e]=!0);this._propertyTreeElements={},this.propertiesTreeOutline.removeChildren(),this.populated=!1},onpopulate:function(){function e(e,t){return e.name.compareTo(t.name)}var t=this.styleRule.style;if(!t)return;var n=[],r=t.allProperties;for(var i=0;i<r.length;++i)n.push(r[i]);n.sort(e),this._propertyTreeElements={};for(var i=0;i<n.length;++i){var s=n[i],o=this._isPropertyInherited(s.name),u=new WebInspector.ComputedStylePropertyTreeElement(this._stylesPane,this.styleRule,t,s,o);this.propertiesTreeOutline.appendChild(u),this._propertyTreeElements[s.name]=u}},rebuildComputedTrace:function(e){for(var t=0;t<e.length;++t){var n=e[t];if(n.computedStyle||n.isBlank)continue;for(var r=0;r<n.uniqueProperties.length;++r){var i=n.uniqueProperties[r];if(i.disabled)continue;if(n.isInherited&&!WebInspector.CSSMetadata.isPropertyInherited(i.name))continue;var s=this._propertyTreeElements[i.name.toLowerCase()];if(s){var o=document.createDocumentFragment(),u=o.createChild("span");u.style.color="gray",u.textContent=n.styleRule.selectorText,o.appendChild(document.createTextNode(" - "+i.value+" "));var a=o.createChild("span");a.style.float="right",a.appendChild(n._createRuleOriginNode());var f=new TreeElement(o,null,!1);s.appendChild(f),(i.inactive||n.isPropertyOverloaded(i.name))&&f.listItemElement.addStyleClass("overloaded"),i.parsedOk||(f.listItemElement.addStyleClass("not-parsed-ok"),f.listItemElement.insertBefore(WebInspector.StylesSidebarPane.createExclamationMark(i),f.listItemElement.firstChild),WebInspector.StylesSidebarPane._ignoreErrorsForProperty(i)&&f.listItemElement.addStyleClass("has-ignorable-error"))}}}for(var l in this._expandedPropertyNames)l in this._propertyTreeElements&&this._propertyTreeElements[l].expand()},__proto__:WebInspector.PropertiesSection.prototype},WebInspector.BlankStylePropertiesSection=function(e,t){WebInspector.StylePropertiesSection.call(this,e,{selectorText:t,rule:{isViaInspector:!0}},!0,!1,!1),this.element.addStyleClass("blank-section")},WebInspector.BlankStylePropertiesSection.prototype={get isBlank(){return!this._normal},expand:function(){this.isBlank||WebInspector.StylePropertiesSection.prototype.expand.call(this)},editingSelectorCommitted:function(e,t,n,r,i){function s(e,t){var n={section:this,style:e.style,selectorText:e.selectorText,sourceURL:e.resourceURL(),rule:e};this.makeNormal(n),t||(this.noAffect=!0,this.element.addStyleClass("no-affect")),this._selectorRefElement.removeChildren(),this._selectorRefElement.appendChild(this._createRuleOriginNode()),this.expand(),this.element.parentElement&&this._moveEditorFromSelector(i),this._markSelectorMatches(),delete this._parentPane._userOperation}if(!this.isBlank){WebInspector.StylePropertiesSection.prototype.editingSelectorCommitted.call(this,e,t,n,r,i);return}t&&(t=t.trim()),this._parentPane._userOperation=!0,WebInspector.cssModel.addRule(this.pane.node.id,t,s.bind(this),this.editingSelectorCancelled.bind(this))},editingSelectorCancelled:function(){delete this._parentPane._userOperation;if(!this.isBlank){WebInspector.StylePropertiesSection.prototype.editingSelectorCancelled.call(this);return}this.pane.removeSection(this)},makeNormal:function(e){this.element.removeStyleClass("blank-section"),this.styleRule=e,this.rule=e.rule,this._normal=!0},__proto__:WebInspector.StylePropertiesSection.prototype},WebInspector.StylePropertyTreeElementBase=function(e,t,n,r,i,s){this._styleRule=e,this.style=t,this.property=n,this._inherited=r,this._overloaded=i,TreeElement.call(this,"",null,s),this.selectable=!1},WebInspector.StylePropertyTreeElementBase.prototype={node:function(){return null},editablePane:function(){return null},get inherited(){return this._inherited},hasIgnorableError:function(){return!this.parsedOk&&WebInspector.StylesSidebarPane._ignoreErrorsForProperty(this.property)},set inherited(e){if(e===this._inherited)return;this._inherited=e,this.updateState()},get overloaded(){return this._overloaded},set overloaded(e){if(e===this._overloaded)return;this._overloaded=e,this.updateState()},get disabled(){return this.property.disabled},get name(){if(!this.disabled||!this.property.text)return this.property.name;var e=this.property.text,t=e.indexOf(":");return t<1?this.property.name:(e=e.substring(0,t).trim(),e.startsWith("/*")&&(e=e.substring(2).trim()),e)},get priority(){return this.disabled?"":this.property.priority},get value(){if(!this.disabled||!this.property.text)return this.property.value;var e=this.property.text.match(/(.*);\s*/);if(!e||!e[1])return this.property.value;var t=e[1],n=t.indexOf(":");return n<1?this.property.value:t.substring(n+1).trim()},get parsedOk(){return this.property.parsedOk},onattach:function(){this.updateTitle()},updateTitle:function(){var e=this.value;this.updateState();var t=document.createElement("span");t.className="webkit-css-property",t.textContent=this.name,t.title=this.property.propertyText,this.nameElement=t,this._expandElement=document.createElement("span"),this._expandElement.className="expand-element";var n=document.createElement("span");n.className="value",this.valueElement=n;var r=WebInspector.Color.Format;if(e){var i=this;function s(e,t,n,r){var i=document.createDocumentFragment(),s=r.replace(e,"\0$1\0").split("\0");for(var o=0;o<s.length;++o)if(o%2===0)n?i.appendChild(n(s[o])):i.appendChild(document.createTextNode(s[o]));else{var u=t(s[o]);u&&i.appendChild(u)}return i}function o(e){var t=e,n=t.match(/['"]?([^'"]+)/);n&&(t=n[1]);var r=document.createDocumentFragment();r.appendChild(document.createTextNode("url(")),i._styleRule.sourceURL?t=WebInspector.ParsedURL.completeURL(i._styleRule.sourceURL,t):i.node()&&(t=i.node().resolveURL(t));var s=!!WebInspector.resourceForURL(t);return r.appendChild(WebInspector.linkifyURLAsNode(t,e,undefined,!s)),r.appendChild(document.createTextNode(")")),r}function u(e){function c(e){var r=e.data;a.displayText=r,v.textContent=r,f.setColorString(r),i.applyStyleText(t.textContent+": "+n.textContent,!1,!1,!1)}function h(e){l&&l.removeEventListener("scroll",p,!1);var r=e.data,s=!r&&i.originalPropertyText?i.originalPropertyText:t.textContent+": "+n.textContent;i.applyStyleText(s,!0,!0,!1),a.removeEventListener(WebInspector.Spectrum.Events.ColorChanged,c),u.removeEventListener(WebInspector.SpectrumPopupHelper.Events.Hidden,h),delete i.editablePane()._isEditingStyle,delete i.originalPropertyText}function p(){u.reposition(f.element)}function d(e){if(!u||e.shiftKey)g(e);else{var t=u.toggle(f.element,s,o);t&&(a.displayText=s.toString(o),i.originalPropertyText=i.property.propertyText,i.editablePane()._isEditingStyle=!0,a.addEventListener(WebInspector.Spectrum.Events.ColorChanged,c),u.addEventListener(WebInspector.SpectrumPopupHelper.Events.Hidden,h),l=f.element.enclosingNodeOrSelfWithClass("scroll-target"),l?l.addEventListener("scroll",p,!1):console.error("Unable to handle color picker scrolling"))}e.consume(!0)}function m(e){switch(e){case r.Original:return s.hasAlpha()?r.RGBA:r.RGB;case r.RGB:case r.RGBA:return s.hasAlpha()?r.HSLA:r.HSL;case r.HSL:case r.HSLA:if(s.nickname())return r.Nickname;return s.hasAlpha()?r.Original:s.canBeShortHex()?r.ShortHEX:r.HEX;case r.ShortHEX:return r.HEX;case r.HEX:return r.Original;case r.Nickname:return s.hasAlpha()?r.Original:s.canBeShortHex()?r.ShortHEX:r.HEX;default:return r.RGBA}}function g(e){do{o=m(o);var t=s.toString(o)}while(t===v.textContent);v.textContent=t}var s=WebInspector.Color.parse(e);if(!s)return document.createTextNode(e);var o=WebInspector.StylesSidebarPane._colorFormat(s),u=i.editablePane()&&i.editablePane()._spectrumHelper,a=u?u.spectrum():null,f=new WebInspector.ColorSwatch;f.setColorString(e),f.element.addEventListener("click",d,!1);var l,v=document.createElement("span");v.textContent=s.toString(o);var y=document.createElement("nobr");return y.appendChild(f.element),y.appendChild(v),y}var a=s.bind(window,WebInspector.StylesSidebarPane._colorRegex,u,null);n.appendChild(s(/url\(\s*([^)]+)\s*\)/g,o.bind(this),WebInspector.CSSMetadata.isColorAwareProperty(i.name)&&i.parsedOk?a:null,e))}this.listItemElement.removeChildren(),t.normalize(),n.normalize();if(!this.treeOutline)return;this.listItemElement.appendChild(t),this.listItemElement.appendChild(document.createTextNode(": ")),this.listItemElement.appendChild(this._expandElement),this.listItemElement.appendChild(n),this.listItemElement.appendChild(document.createTextNode(";")),this.parsedOk||(this.hasChildren=!1,this.listItemElement.addStyleClass("not-parsed-ok"),this.listItemElement.insertBefore(WebInspector.StylesSidebarPane.createExclamationMark(this.property),this.listItemElement.firstChild)),this.property.inactive&&this.listItemElement.addStyleClass("inactive")},updateState:function(){if(!this.listItemElement)return;this.style.isPropertyImplicit(this.name)?this.listItemElement.addStyleClass("implicit"):this.listItemElement.removeStyleClass("implicit"),this.hasIgnorableError()?this.listItemElement.addStyleClass("has-ignorable-error"):this.listItemElement.removeStyleClass("has-ignorable-error"),this.inherited?this.listItemElement.addStyleClass("inherited"):this.listItemElement.removeStyleClass("inherited"),this.overloaded?this.listItemElement.addStyleClass("overloaded"):this.listItemElement.removeStyleClass("overloaded"),this.disabled?this.listItemElement.addStyleClass("disabled"):this.listItemElement.removeStyleClass("disabled")},__proto__:TreeElement.prototype},WebInspector.ComputedStylePropertyTreeElement=function(e,t,n,r,i){WebInspector.StylePropertyTreeElementBase.call(this,t,n,r,i,!1,!1),this._stylesPane=e},WebInspector.ComputedStylePropertyTreeElement.prototype={node:function(){return this._stylesPane.node},editablePane:function(){return null},__proto__:WebInspector.StylePropertyTreeElementBase.prototype},WebInspector.StylePropertyTreeElement=function(e,t,n,r,i,s,o){WebInspector.StylePropertyTreeElementBase.call(this,t,n,r,s,o,i),this._parentPane=e,this.isShorthand=i},WebInspector.StylePropertyTreeElement.prototype={node:function(){return this._parentPane.node},editablePane:function(){return this._parentPane},section:function(){return this.treeOutline&&this.treeOutline.section},_updatePane:function(e){var t=this.section();t&&t.pane?t.pane._refreshUpdate(t,!1,e):e&&e()},toggleEnabled:function(e){function n(e){if(!e)return;e.parentRule=this.style.parentRule,this.style=e,this._styleRule.style=e;var t=this.section();t&&t.pane&&t.pane.dispatchEventToListeners("style property toggled"),this._updatePane(),delete this._parentPane._userOperation}var t=!e.target.checked;this._parentPane._userOperation=!0,this.property.setDisabled(t,n.bind(this)),e.consume()},onpopulate:function(){if(this.children.length||!this.isShorthand)return;var e=this.style.longhandProperties(this.name);for(var t=0;t<e.length;++t){var n=e[t].name,r=this.section();if(r)var i=r.isPropertyInherited(n),s=r.isPropertyOverloaded(n);var o=this.style.getLiveProperty(n);if(!o)continue;var u=new WebInspector.StylePropertyTreeElement(this._parentPane,this._styleRule,this.style,o,!1,i,s);this.appendChild(u)}},restoreNameElement:function(){if(this.nameElement===this.listItemElement.querySelector(".webkit-css-property"))return;this.nameElement=document.createElement("span"),this.nameElement.className="webkit-css-property",this.nameElement.textContent="",this.listItemElement.insertBefore(this.nameElement,this.listItemElement.firstChild)},onattach:function(){WebInspector.StylePropertyTreeElementBase.prototype.onattach.call(this),this.listItemElement.addEventListener("mousedown",this._mouseDown.bind(this)),this.listItemElement.addEventListener("mouseup",this._resetMouseDownElement.bind(this)),this.listItemElement.addEventListener("click",this._mouseClick.bind(this))},_mouseDown:function(e){this._parentPane&&(this._parentPane._mouseDownTreeElement=this,this._parentPane._mouseDownTreeElementIsName=this._isNameElement(e.target),this._parentPane._mouseDownTreeElementIsValue=this._isValueElement(e.target))},_resetMouseDownElement:function(){this._parentPane&&(delete this._parentPane._mouseDownTreeElement,delete this._parentPane._mouseDownTreeElementIsName,delete this._parentPane._mouseDownTreeElementIsValue)},updateTitle:function(){WebInspector.StylePropertyTreeElementBase.prototype.updateTitle.call(this);if(this.parsedOk&&this.section()&&this.parent.root){var e=document.createElement("input");e.className="enabled-button",e.type="checkbox",e.checked=!this.disabled,e.addEventListener("click",this.toggleEnabled.bind(this),!1),this.listItemElement.insertBefore(e,this.listItemElement.firstChild)}},_mouseClick:function(e){if(!window.getSelection().isCollapsed)return;e.consume(!0);if(e.target===this.listItemElement){var t=this.section();if(!t||!t.editable)return;if(t._checkWillCancelEditing())return;t.addNewBlankProperty(this.property.index+1).startEditing();return}if(WebInspector.KeyboardShortcut.eventHasCtrlOrMeta(e)&&this.section().navigable){this._navigateToSource(e.target);return}this.startEditing(e.target)},_navigateToSource:function(e){console.assert(this.section().navigable);var t=e===this.nameElement,n=this.property.uiLocation(t);if(!n)return;WebInspector.showPanel("scripts").showUILocation(n)},_isNameElement:function(e){return e.enclosingNodeOrSelfWithClass("webkit-css-property")===this.nameElement},_isValueElement:function(e){return!!e.enclosingNodeOrSelfWithClass("value")},startEditing:function(e){function r(e){var t=[],n=e.replace(WebInspector.StylesSidebarPane._colorRegex,"\0$1\0").split("\0");for(var r=0;r<n.length;++r){var i=WebInspector.Color.parse(n[r]);t.push(i?i.toString(WebInspector.StylesSidebarPane._colorFormat(i)):n[r])}return t.join("")}function s(e,t){var n=t.clipboardData.getData("Text");if(!n)return;var r=n.indexOf(":");if(r<0)return;var i=n.substring(0,r).trim(),s=n.substring(r+1).trim();t.preventDefault(),"originalName"in e||(e.originalName=this.nameElement.textContent,e.originalValue=this.valueElement.textContent),this.property.name=i,this.property.value=s,this.nameElement.textContent=i,this.valueElement.textContent=s,this.nameElement.normalize(),this.valueElement.normalize(),this.editingCommitted(null,t.target.textContent,e.previousContent,e,"forward")}function o(e,t){var r=this._parentPane._mouseDownTreeElement,i="";r===this&&(n&&this._parentPane._mouseDownTreeElementIsValue&&(i="forward"),!n&&this._parentPane._mouseDownTreeElementIsName&&(i="backward")),this.editingCommitted(null,t.target.textContent,e.previousContent,e,i)}if(this.parent.isShorthand)return;if(e===this._expandElement)return;var t=this.section();if(t&&!t.editable)return;e?e=e.enclosingNodeOrSelfWithClass("webkit-css-property")||e.enclosingNodeOrSelfWithClass("value"):e=this.nameElement;var n=e===this.nameElement;n||(e!==this.valueElement&&(e=this.valueElement),this.valueElement.textContent=!this._newProperty&&WebInspector.CSSMetadata.isColorAwareProperty(this.name)?r(this.value):this.value);if(WebInspector.isBeingEdited(e))return;var i={expanded:this.expanded,hasChildren:this.hasChildren,isEditingName:n,previousContent:e.textContent};this.hasChildren=!1,e.parentElement&&e.parentElement.addStyleClass("child-editing"),e.textContent=e.textContent,delete this.originalPropertyText,this._parentPane._isEditingStyle=!0,e.parentElement&&e.parentElement.scrollIntoViewIfNeeded(!1);var u=n?undefined:this._applyFreeFlowStyleTextEdit.bind(this,!0);this._prompt=new WebInspector.StylesSidebarPane.CSSPropertyPrompt(n?WebInspector.CSSMetadata.cssPropertiesMetainfo:WebInspector.CSSMetadata.keywordsForProperty(this.nameElement.textContent),this,n),u&&(this._prompt.addEventListener(WebInspector.TextPrompt.Events.ItemApplied,u,this),this._prompt.addEventListener(WebInspector.TextPrompt.Events.ItemAccepted,u,this));var a=this._prompt.attachAndStartEditing(e,o.bind(this,i));a.addEventListener("keydown",this.editingNameValueKeyDown.bind(this,i),!1),n&&a.addEventListener("paste",s.bind(this,i)),window.getSelection().setBaseAndExtent(e,0,e,1)},editingNameValueKeyDown:function(e,t){function i(e,t){var n="";for(var r=0;r<t;++r){var i=e[r];i==="\\"&&n!==""?++r:!!n||i!=='"'&&i!=="'"?n===i&&(n=""):n=i}return!n}if(t.handled)return;var n=e.isEditingName,r,s=t.keyCode===WebInspector.KeyboardShortcut.Keys.Semicolon.code&&(n?t.shiftKey:!t.shiftKey&&i(t.target.textContent,t.target.selectionLeftOffset()));if(isEnterKey(t)||s)t.preventDefault(),r="forward";else if(t.keyCode===WebInspector.KeyboardShortcut.Keys.Esc.code||t.keyIdentifier==="U+001B")r="cancel";else if(!n&&this._newProperty&&t.keyCode===WebInspector.KeyboardShortcut.Keys.Backspace.code){var o=window.getSelection();o.isCollapsed&&!o.focusOffset&&(t.preventDefault(),r="backward")}else t.keyIdentifier==="U+0009"&&(r=t.shiftKey?"backward":"forward",t.preventDefault());if(r){switch(r){case"cancel":this.editingCancelled(null,e);break;case"forward":case"backward":this.editingCommitted(null,t.target.textContent,e.previousContent,e,r)}t.consume();return}n||this._applyFreeFlowStyleTextEdit(!1)},_applyFreeFlowStyleTextEdit:function(e){function t(){var e=this.valueElement.textContent;e.indexOf(";")===-1&&this.applyStyleText(this.nameElement.textContent+": "+e,!1,!1,!1)}this._applyFreeFlowStyleTextEditTimer&&clearTimeout(this._applyFreeFlowStyleTextEditTimer),e?t.call(this):this._applyFreeFlowStyleTextEditTimer=setTimeout(t.bind(this),100)},kickFreeFlowStyleEditForTest:function(){this._applyFreeFlowStyleTextEdit(!0)},editingEnded:function(e){this._resetMouseDownElement(),this._applyFreeFlowStyleTextEditTimer&&clearTimeout(this._applyFreeFlowStyleTextEditTimer),this.hasChildren=e.hasChildren,e.expanded&&this.expand();var t=e.isEditingName?this.nameElement:this.valueElement;t.parentElement&&t.parentElement.removeStyleClass("child-editing"),delete this._parentPane._isEditingStyle},editingCancelled:function(e,t){this._removePrompt(),this._revertStyleUponEditingCanceled(this.originalPropertyText),this.editingEnded(t)},_revertStyleUponEditingCanceled:function(e){typeof e=="string"?(delete this.originalPropertyText,this.applyStyleText(e,!0,!1,!0)):this._newProperty?this.treeOutline.removeChild(this):this.updateTitle()},_findSibling:function(e){var t=this;do t=e==="forward"?t.nextSibling:t.previousSibling;while(t&&t.inherited);return t},editingCommitted:function(e,t,n,r,i){function w(e,t,n){if(!i)return;if(h&&h.parent){h.startEditing(s?h.valueElement:h.nameElement);return}if(h&&!h.parent){var r=n.propertiesTreeOutline.children;i==="forward"&&m&&!s&&--v;if(v>=r.length&&!this._newProperty)o=!0;else{var u=v>=0?r[v]:null;if(u){var f=!s||c?u.nameElement:u.valueElement;e&&m&&(f=i==="forward"?u.nameElement:u.valueElement),u.startEditing(f);return}e||(a=!0)}}if(o){if(e&&!t&&s^i==="backward")return;n.addNewBlankProperty().startEditing();return}if(d){h=this._findSibling(i);var l=h||i==="backward"?n:n.nextEditableSibling();l&&(l.rule?l.startEditingSelector():l._moveEditorFromSelector(i));return}a&&(n.rule?n.startEditingSelector():n._moveEditorFromSelector(i))}this._removePrompt(),this.editingEnded(r);var s=r.isEditingName,o,u,a,f="originalName"in r,l=f&&(this.nameElement.textContent!==r.originalName||this.valueElement.textContent!==r.originalValue),c=f&&s&&this.valueElement.textContent!==r.originalValue,h=this,p=s^i==="forward",d=this._newProperty&&!t&&(p||s);if(i==="forward"&&(!s||c)||i==="backward"&&s)h=h._findSibling(i),h?u=h.name:i==="forward"&&(!this._newProperty||t)?o=!0:i==="backward"&&(a=!0);var v=h&&this.treeOutline?this.treeOutline.children.indexOf(h):-1,m=/^\s*$/.test(t),g=this._newProperty&&(c||p||!i&&!s||s&&m),y=this.section();if((t!==n||l)&&!this._newProperty||g){y._afterUpdate=w.bind(this,this._newProperty,!m,y);var b;m||this._newProperty&&/^\s*$/.test(this.valueElement.textContent)?b="":s?b=t+": "+this.property.value:b=this.property.name+": "+t,this.applyStyleText(b,!0,!0,!1)}else s?this.property.name=t:this.property.value=t,!f&&!this._newProperty&&this.updateTitle(),w.call(this,this._newProperty,!1,y)},_removePrompt:function(){this._prompt&&(this._prompt.detach(),delete this._prompt)},_hasBeenModifiedIncrementally:function(){return typeof this.originalPropertyText=="string"||!!this.property.propertyText&&this._newProperty},applyStyleText:function(e,t,n,r){function i(e,t){t&&delete e._userOperation}function a(e,n,r){if(!r){t&&this._revertStyleUponEditingCanceled(n),e();return}this._newProperty&&(this._newPropertyInStyle=!0),r.parentRule=this.style.parentRule,this.style=r,this.property=r.propertyAt(this.property.index),this._styleRule.style=this.style,s&&s.pane&&s.pane.dispatchEventToListeners("style edited");if(t&&u===this.node()){this._updatePane(e);return}e()}!r&&!t&&!this._hasBeenModifiedIncrementally()&&(this.originalPropertyText=this.property.propertyText);if(!this.treeOutline)return;var s=this.section();e=e.replace(/\s/g," ").trim();var o=e.length;if(!o&&t&&!r&&this._newProperty&&!this._hasBeenModifiedIncrementally()){this.parent.removeChild(this),s.afterUpdate();return}var u=this._parentPane.node;t&&(this._parentPane._userOperation=!0),e.length&&!/;\s*$/.test(e)&&(e+=";");var f=!this._newProperty||!!this._newPropertyInStyle;this.property.setText(e,n,f,a.bind(this,i.bind(null,this._parentPane,t),this.originalPropertyText))},ondblclick:function(){return!0},isEventWithinDisclosureTriangle:function(e){return e.target===this._expandElement},__proto__:WebInspector.StylePropertyTreeElementBase.prototype},WebInspector.StylesSidebarPane.CSSPropertyPrompt=function(e,t,n){WebInspector.TextPrompt.call(this,this._buildPropertyCompletions.bind(this),WebInspector.StyleValueDelimiters),this.setSuggestBoxEnabled("generic-suggest"),this._cssCompletions=e,this._sidebarPane=t,this._isEditingName=n},WebInspector.StylesSidebarPane.CSSPropertyPrompt.prototype={onKeyDown:function(e){switch(e.keyIdentifier){case"Up":case"Down":case"PageUp":case"PageDown":if(this._handleNameOrValueUpDown(e)){e.preventDefault();return}break;case"Enter":if(this.autoCompleteElement&&!this.autoCompleteElement.textContent.length){this.tabKeyPressed();return}}WebInspector.TextPrompt.prototype.onKeyDown.call(this,e)},onMouseWheel:function(e){if(this._handleNameOrValueUpDown(e)){e.consume(!0);return}WebInspector.TextPrompt.prototype.onMouseWheel.call(this,e)},tabKeyPressed:function(){return this.acceptAutoComplete(),!1},_handleNameOrValueUpDown:function(e){function t(e,t){this._sidebarPane.applyStyleText(this._sidebarPane.nameElement.textContent+": "+this._sidebarPane.valueElement.textContent,!1,!1,!1)}return!this._isEditingName&&WebInspector.handleElementValueModifications(e,this._sidebarPane.valueElement,t.bind(this),this._isValueSuggestion.bind(this))?!0:!1},_isValueSuggestion:function(e){return e?(e=e.toLowerCase(),this._cssCompletions.keySet().hasOwnProperty(e)):!1},_buildPropertyCompletions:function(e,t,n,r){var i=t.toString().toLowerCase();if(!i&&!n&&(this._isEditingName||e.textContent.length)){r([]);return}var s=this._cssCompletions.startsWith(i),o=this._cssCompletions.mostUsedOf(s);r(s,o)},__proto__:WebInspector.TextPrompt.prototype};