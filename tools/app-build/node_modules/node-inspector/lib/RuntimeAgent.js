function RuntimeAgent(e,t){this._debuggerClient=t,this._callFramesProvider=new CallFramesProvider(e,t)}var convert=require("./convert.js"),util=require("util"),CallFramesProvider=require("./CallFramesProvider.js").CallFramesProvider;RuntimeAgent.prototype={enable:function(e,t){t()},evaluate:function(e,t){var n=this;n._debuggerClient.request("evaluate",{expression:e.expression,global:!0},function(e,n){e&&(e=convert.v8ErrorToInspectorError(e)),t(null,{result:e||convert.v8ResultToInspectorResult(n),wasThrown:!!e})})},callFunctionOn:function(e,t){function n(n,r){if(n){t(n);return}var i=this._handleCallFunctionOnObjectResponse.bind(this,t,e.returnByValue);this._debuggerClient.request("evaluate",r,i)}this._createEvaluateParamsForFunctionCall(e.objectId,e.functionDeclaration,e.arguments,n.bind(this))},_createEvaluateParamsForFunctionCall:function(e,t,n,r){n=n||[];try{var i=n.map(this._getFunctionCallArgsData.bind(this)),s=this._buildEvaluateParamsFromArgsData(e,t,i);r(null,s)}catch(o){r(o)}},_buildEvaluateParamsFromArgsData:function(e,t,n){n.unshift(this._getSelfArgData(e));var r=n.map(function(e){return e.code}),i=n.map(function(e){return e.context}).filter(function(e){return!!e}),s=util.format("(%s).call(%s)",t,r.join(", "));return{expression:s,global:!0,additional_context:i}},_getSelfArgData:function(e){var t="__node_inspector_self__";return{code:t,context:{name:t,handle:Number(e)}}},_getFunctionCallArgsData:function(e,t){var n="__node_inspector_arg"+t;switch(e.type){case undefined:case"string":return{code:util.format('"%s"',e.value)};case"number":return{code:e.value};case"null":case"undefined":return{code:e.type};case"object":case"function":return{code:n,context:{name:n,handle:Number(e.objectId)}};default:throw new Error(util.format('Function arguments of type "%s" are not supported',e.type))}},_handleCallFunctionOnObjectResponse:function(e,t,n,r){if(n){e(null,{err:n,wasThrown:!0});return}var i={};if(t&&r.properties)for(var s=0;s<r.properties.length;s++)i[r.properties[s].name]=!0;e(null,{result:{value:i},wasThrown:!1})},getProperties:function(e,t){if(this._callFramesProvider.isScopeId(e.objectId))this._getPropertiesOfScopeId(e.objectId,t);else{if(!e.ownProperties||e.accessorPropertiesOnly)return t(null,{result:[]});this._getPropertiesOfObjectId(e.objectId,t)}},_getPropertiesOfScopeId:function(e,t){this._callFramesProvider.resolveScopeId(e,function(e,n){e?t(e):this._getPropertiesOfObjectId(n,t)}.bind(this))},_getPropertiesOfObjectId:function(e,t){var n=parseInt(e,10),r={handles:[n],includeSource:!1};this._debuggerClient.request("lookup",r,function(e,r,i){var s,o,u;if(e){t(e);return}s=r[n],o=s.proto,u=s.properties,u&&(u=u.map(function(e){var t=i[e.ref];return{name:String(e.name),writable:(e.attributes&1)!=1,enumerable:(e.attributes&2)!=2,value:convert.v8ResultToInspectorResult(t)}})),o&&u.push({name:"__proto__",value:convert.v8RefToInspectorObject(i[o.ref])}),t(null,{result:u})})},releaseObjectGroup:function(e,t){t()}},exports.RuntimeAgent=RuntimeAgent;