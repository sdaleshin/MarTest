var test=require("tap").test,LRU=require("../");test("basic",function(e){var t=new LRU({max:10});t.set("key","value"),e.equal(t.get("key"),"value"),e.equal(t.get("nada"),undefined),e.equal(t.length,1),e.equal(t.max,10),e.end()}),test("least recently set",function(e){var t=new LRU(2);t.set("a","A"),t.set("b","B"),t.set("c","C"),e.equal(t.get("c"),"C"),e.equal(t.get("b"),"B"),e.equal(t.get("a"),undefined),e.end()}),test("lru recently gotten",function(e){var t=new LRU(2);t.set("a","A"),t.set("b","B"),t.get("a"),t.set("c","C"),e.equal(t.get("c"),"C"),e.equal(t.get("b"),undefined),e.equal(t.get("a"),"A"),e.end()}),test("del",function(e){var t=new LRU(2);t.set("a","A"),t.del("a"),e.equal(t.get("a"),undefined),e.end()}),test("max",function(e){var t=new LRU(3);t.max=100;for(var n=0;n<100;n++)t.set(n,n);e.equal(t.length,100);for(var n=0;n<100;n++)e.equal(t.get(n),n);t.max=3,e.equal(t.length,3);for(var n=0;n<97;n++)e.equal(t.get(n),undefined);for(var n=98;n<100;n++)e.equal(t.get(n),n);t.max="hello";for(var n=0;n<100;n++)t.set(n,n);e.equal(t.length,100);for(var n=0;n<100;n++)e.equal(t.get(n),n);t.max=3,e.equal(t.length,3);for(var n=0;n<97;n++)e.equal(t.get(n),undefined);for(var n=98;n<100;n++)e.equal(t.get(n),n);e.end()}),test("reset",function(e){var t=new LRU(10);t.set("a","A"),t.set("b","B"),t.reset(),e.equal(t.length,0),e.equal(t.max,10),e.equal(t.get("a"),undefined),e.equal(t.get("b"),undefined),e.end()}),test("dump",function(e){var t=new LRU(10),n=t.dump();e.equal(Object.keys(n).length,0,"nothing in dump for empty cache"),t.set("a","A");var n=t.dump();e.ok(n.a),e.equal(n.a.key,"a"),e.equal(n.a.value,"A"),e.equal(n.a.lu,0),t.set("b","B"),t.get("b"),n=t.dump(),e.ok(n.b),e.equal(n.b.key,"b"),e.equal(n.b.value,"B"),e.equal(n.b.lu,2),e.end()}),test("basic with weighed length",function(e){var t=new LRU({max:100,length:function(e){return e.size}});t.set("key",{val:"value",size:50}),e.equal(t.get("key").val,"value"),e.equal(t.get("nada"),undefined),e.equal(t.lengthCalculator(t.get("key")),50),e.equal(t.length,50),e.equal(t.max,100),e.end()}),test("weighed length item too large",function(e){var t=new LRU({max:10,length:function(e){return e.size}});e.equal(t.max,10),t.set("key",{val:"value",size:50}),e.equal(t.length,0),e.equal(t.get("key"),undefined),e.end()}),test("least recently set with weighed length",function(e){var t=new LRU({max:8,length:function(e){return e.length}});t.set("a","A"),t.set("b","BB"),t.set("c","CCC"),t.set("d","DDDD"),e.equal(t.get("d"),"DDDD"),e.equal(t.get("c"),"CCC"),e.equal(t.get("b"),undefined),e.equal(t.get("a"),undefined),e.end()}),test("lru recently gotten with weighed length",function(e){var t=new LRU({max:8,length:function(e){return e.length}});t.set("a","A"),t.set("b","BB"),t.set("c","CCC"),t.get("a"),t.get("b"),t.set("d","DDDD"),e.equal(t.get("c"),undefined),e.equal(t.get("d"),"DDDD"),e.equal(t.get("b"),"BB"),e.equal(t.get("a"),"A"),e.end()}),test("set returns proper booleans",function(e){var t=new LRU({max:5,length:function(e){return e.length}});e.equal(t.set("a","A"),!0),e.equal(t.set("b","donuts"),!1),e.equal(t.set("b","B"),!0),e.equal(t.set("c","CCCC"),!0),e.end()}),test("drop the old items",function(e){var t=new LRU({max:5,maxAge:50});t.set("a","A"),setTimeout(function(){t.set("b","b"),e.equal(t.get("a"),"A")},25),setTimeout(function(){t.set("c","C"),e.notOk(t.get("a"))},60),setTimeout(function(){e.notOk(t.get("b")),e.equal(t.get("c"),"C")},90),setTimeout(function(){e.notOk(t.get("c")),e.end()},155)}),test("disposal function",function(e){var t=!1,n=new LRU({max:1,dispose:function(e,n){t=n}});n.set(1,1),n.set(2,2),e.equal(t,1),n.set(3,3),e.equal(t,2),n.reset(),e.equal(t,3),e.end()}),test("disposal function on too big of item",function(e){var t=!1,n=new LRU({max:1,length:function(e){return e.length},dispose:function(e,n){t=n}}),r=[1,2];e.equal(t,!1),n.set("obj",r),e.equal(t,r),e.end()}),test("has()",function(e){var t=new LRU({max:1,maxAge:10});t.set("foo","bar"),e.equal(t.has("foo"),!0),t.set("blu","baz"),e.equal(t.has("foo"),!1),e.equal(t.has("blu"),!0),setTimeout(function(){e.equal(t.has("blu"),!1),e.end()},15)}),test("stale",function(e){var t=new LRU({maxAge:10,stale:!0});t.set("foo","bar"),e.equal(t.get("foo"),"bar"),e.equal(t.has("foo"),!0),setTimeout(function(){e.equal(t.has("foo"),!1),e.equal(t.get("foo"),"bar"),e.equal(t.get("foo"),undefined),e.end()},15)}),test("lru update via set",function(e){var t=LRU({max:2});t.set("foo",1),t.set("bar",2),t.del("bar"),t.set("baz",3),t.set("qux",4),e.equal(t.get("foo"),undefined),e.equal(t.get("bar"),undefined),e.equal(t.get("baz"),3),e.equal(t.get("qux"),4),e.end()}),test("least recently set w/ peek",function(e){var t=new LRU(2);t.set("a","A"),t.set("b","B"),e.equal(t.peek("a"),"A"),t.set("c","C"),e.equal(t.get("c"),"C"),e.equal(t.get("b"),"B"),e.equal(t.get("a"),undefined),e.end()}),test("pop the least used item",function(e){var t=new LRU(3),n;t.set("a","A"),t.set("b","B"),t.set("c","C"),e.equal(t.length,3),e.equal(t.max,3),t.get("b","B"),n=t.pop(),e.equal(n.key,"a"),e.equal(n.value,"A"),e.equal(t.length,2),e.equal(t.max,3),n=t.pop(),e.equal(n.key,"c"),e.equal(n.value,"C"),e.equal(t.length,1),e.equal(t.max,3),n=t.pop(),e.equal(n.key,"b"),e.equal(n.value,"B"),e.equal(t.length,0),e.equal(t.max,3),n=t.pop(),e.equal(n,null),e.equal(t.length,0),e.equal(t.max,3),e.end()});