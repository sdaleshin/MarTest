function isFunction(e){return toString.call(e)=="[object Function]"}function isString(e){return toString.call(e)=="[object String]"}function isRegExp(e){return toString.call(e)=="[object RegExp]"}function isUndefined(e){return e===void 0}function readdir(e,t,n){function d(e){function t(e){function t(e){return e.indexOf("!")===0}var n=e.some(t);if(!n)return!1;if(e.every(t))return!0;throw new Error("Cannot mix negated with non negated glob filters: "+e+"\n"+"https://github.com/thlorenz/readdirp#filters")}if(isUndefined(e))return undefined;if(isFunction(e))return e;if(isString(e))return function(t){return minimatch(t.name,e.trim())};if(e&&Array.isArray(e))return e&&(e=e.map(function(e){return e.trim()})),t(e)?function(t){return e.every(function(e){return minimatch(t.name,e)})}:function(t){return e.some(function(e){return minimatch(t.name,e)})}}function v(e,t,n){if(h)return;var r=t.length,s=0,o=[];fs.realpath(e,function(e,u){if(h)return;if(e){i(e),n(o);return}var a=path.relative(c,u);t.length===0?n([]):t.forEach(function(e){var t=path.join(u,e),f=path.join(a,e);fs.stat(t,function(l,c){l?i(l):o.push({name:e,path:f,fullPath:t,parentDir:a,fullParentDir:u,stat:c}),s++,s===r&&n(o)})})})}function m(t,n,r){if(h)return;fs.readdir(t,function(s,o){if(s){i(s),r();return}v(t,o,function(t){var i=t.filter(function(t){return t.stat.isDirectory()&&e.directoryFilter(t)});i.forEach(function(e){a.directories.push(e)}),t.filter(function(t){return t.stat.isFile()&&e.fileFilter(t)}).forEach(function(e){f(e),a.files.push(e)});var s=i.length;s===0||n===e.depth?r():i.forEach(function(e){m(e.fullPath,n+1,function(){s-=1,s===0&&r()})})})})}var r,i,s,o=0,u=[],a={directories:[],files:[]},f,l,c,h=!1;if(isUndefined(t)){var p=require("./stream-api")();r=p.stream,t=p.processEntry,n=p.done,i=p.handleError,s=p.handleFatalError,r.on("close",function(){h=!0})}else i=function(e){u.push(e)},s=function(e){i(e),l(u,null)};if(isUndefined(e))return s(new Error("Need to pass at least one argument: opts! \nhttps://github.com/thlorenz/readdirp#options")),r;e.root=e.root||".",e.fileFilter=e.fileFilter||function(){return!0},e.directoryFilter=e.directoryFilter||function(){return!0},e.depth=typeof e.depth=="undefined"?999999999:e.depth,isUndefined(n)?(f=function(){},l=t):(f=t,l=n);try{e.fileFilter=d(e.fileFilter),e.directoryFilter=d(e.directoryFilter)}catch(g){return s(g),r}return fs.realpath(e.root,function(t,n){if(t)return s(t),r;c=n,m(e.root,0,function(){u.length>0?l(u,a):l(null,a)})}),r}var fs=require("fs"),path=require("path"),minimatch=require("minimatch"),toString=Object.prototype.toString;module.exports=readdir;