(function(){function e(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function t(){return 1}function n(e){if(!(this instanceof n))return new n(e);typeof e=="number"&&(e={max:e}),e||(e={}),this._max=e.max;if(!this._max||typeof this._max!="number"||this._max<=0)this._max=Infinity;this._lengthCalculator=e.length||t,typeof this._lengthCalculator!="function"&&(this._lengthCalculator=t),this._allowStale=e.stale||!1,this._maxAge=e.maxAge||null,this._dispose=e.dispose,this.reset()}function r(e,t,n){var r=e._cache[t];return r&&(e._maxAge&&Date.now()-r.now>e._maxAge?(u(e,r),e._allowStale||(r=undefined)):n&&i(e,r),r&&(r=r.value)),r}function i(e,t){o(e,t),t.lu=e._mru++,e._lruList[t.lu]=t}function s(e){while(e._lru<e._mru&&e._length>e._max)u(e,e._lruList[e._lru])}function o(e,t){delete e._lruList[t.lu];while(e._lru<e._mru&&!e._lruList[e._lru])e._lru++}function u(e,t){t&&(e._dispose&&e._dispose(t.key,t.value),e._length-=t.length,e._itemCount--,delete e._cache[t.key],o(e,t))}function a(e,t,n,r,i){this.key=e,this.value=t,this.lu=n,this.length=r,this.now=i}typeof module=="object"&&module.exports?module.exports=n:this.LRUCache=n,Object.defineProperty(n.prototype,"max",{set:function(e){if(!e||typeof e!="number"||e<=0)e=Infinity;this._max=e,this._length>this._max&&s(this)},get:function(){return this._max},enumerable:!0}),Object.defineProperty(n.prototype,"lengthCalculator",{set:function(e){if(typeof e!="function"){this._lengthCalculator=t,this._length=this._itemCount;for(var n in this._cache)this._cache[n].length=1}else{this._lengthCalculator=e,this._length=0;for(var n in this._cache)this._cache[n].length=this._lengthCalculator(this._cache[n].value),this._length+=this._cache[n].length}this._length>this._max&&s(this)},get:function(){return this._lengthCalculator},enumerable:!0}),Object.defineProperty(n.prototype,"length",{get:function(){return this._length},enumerable:!0}),Object.defineProperty(n.prototype,"itemCount",{get:function(){return this._itemCount},enumerable:!0}),n.prototype.forEach=function(e,t){t=t||this;var n=0;for(var r=this._mru-1;r>=0&&n<this._itemCount;r--)if(this._lruList[r]){n++;var i=this._lruList[r];this._maxAge&&Date.now()-i.now>this._maxAge&&(u(this,i),this._allowStale||(i=undefined)),i&&e.call(t,i.value,i.key,this)}},n.prototype.keys=function(){var e=new Array(this._itemCount),t=0;for(var n=this._mru-1;n>=0&&t<this._itemCount;n--)if(this._lruList[n]){var r=this._lruList[n];e[t++]=r.key}return e},n.prototype.values=function(){var e=new Array(this._itemCount),t=0;for(var n=this._mru-1;n>=0&&t<this._itemCount;n--)if(this._lruList[n]){var r=this._lruList[n];e[t++]=r.value}return e},n.prototype.reset=function(){if(this._dispose&&this._cache)for(var e in this._cache)this._dispose(e,this._cache[e].value);this._cache=Object.create(null),this._lruList=Object.create(null),this._mru=0,this._lru=0,this._length=0,this._itemCount=0},n.prototype.dump=function(){return this._cache},n.prototype.dumpLru=function(){return this._lruList},n.prototype.set=function(t,n){if(e(this._cache,t))return this._dispose&&this._dispose(t,this._cache[t].value),this._maxAge&&(this._cache[t].now=Date.now()),this._cache[t].value=n,this.get(t),!0;var r=this._lengthCalculator(n),i=this._maxAge?Date.now():0,o=new a(t,n,this._mru++,r,i);return o.length>this._max?(this._dispose&&this._dispose(t,n),!1):(this._length+=o.length,this._lruList[o.lu]=this._cache[t]=o,this._itemCount++,this._length>this._max&&s(this),!0)},n.prototype.has=function(t){if(!e(this._cache,t))return!1;var n=this._cache[t];return this._maxAge&&Date.now()-n.now>this._maxAge?!1:!0},n.prototype.get=function(e){return r(this,e,!0)},n.prototype.peek=function(e){return r(this,e,!1)},n.prototype.pop=function(){var e=this._lruList[this._lru];return u(this,e),e||null},n.prototype.del=function(e){u(this,this._cache[e])}})();