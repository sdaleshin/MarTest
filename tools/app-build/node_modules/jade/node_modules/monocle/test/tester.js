function cb_helper(e,t,n){t.name===e&&(monocle.unwatchAll(),n())}function complete_helper(e){fs.writeFile(__dirname+e,(new Date).getTime()+"\n")}var fs=require("fs"),assert=require("assert"),Monocle=require("../monocle"),monocle=null,sample_dir=__dirname+"/sample_files";before(function(){monocle=Monocle()}),after(function(){fs.unlinkSync(__dirname+"/sample_files/creation.txt"),fs.unlinkSync(__dirname+"/sample_files/creation2.txt"),fs.unlinkSync(__dirname+"/sample_files/creation3.txt"),fs.unlinkSync(__dirname+"/sample_files/creation4.txt"),fs.unlinkSync(__dirname+"/sample_files/creation5.txt"),fs.unlinkSync(__dirname+"/sample_files/nestedDir/creation3.txt")}),describe("file changes",function(){it("should detect a change",function(e){monocle.watchDirectory({root:sample_dir,listener:function(t){cb_helper("foo.txt",t,e)},complete:function(){complete_helper("/sample_files/foo.txt")}})}),it("should detect a change in a nested dir file",function(e){monocle.watchDirectory({root:sample_dir,listener:function(t){cb_helper("servent.txt",t,e)},complete:function(){complete_helper("/sample_files/nestedDir/servent.txt")}})}),it("should detect a change",function(e){monocle.watchDirectory({root:sample_dir,listener:function(t){cb_helper("longbow.js",t,e)},complete:function(){complete_helper("/sample_files/longbow.js")}})}),it("should detect a change",function(e){monocle.watchPaths({path:sample_dir,listener:function(t){cb_helper("longbow.js",t,e)},complete:function(){complete_helper("/sample_files/longbow.js")}})})}),describe("file added",function(){it("should detect a file added",function(e){monocle.watchDirectory({root:sample_dir,listener:function(t){cb_helper("creation.txt",t,e)},complete:function(){complete_helper("/sample_files/creation.txt")}})}),it("should detect another file added",function(e){monocle.watchDirectory({root:sample_dir,listener:function(t){cb_helper("creation2.txt",t,e)},complete:function(){complete_helper("/sample_files/creation2.txt")}})}),it("should detect another file added in a nested folder",function(e){monocle.watchDirectory({root:sample_dir,listener:function(t){cb_helper("creation3.txt",t,e)},complete:function(){complete_helper("/sample_files/nestedDir/creation3.txt")}})}),it("should detect another file added",function(e){monocle.watchPaths({path:sample_dir,listener:function(t){cb_helper("creation2.txt",t,e)},complete:function(){complete_helper("/sample_files/creation2.txt")}})}),it("should detect another file added but passed as list",function(e){monocle.watchPaths({path:[sample_dir],listener:function(t){cb_helper("creation2.txt",t,e)},complete:function(){complete_helper("/sample_files/creation2.txt")}})})}),describe("files watched",function(){it("should detect a file changed of multiple",function(e){complete_helper("/sample_files/creation.txt"),complete_helper("/sample_files/creation2.txt"),complete_helper("/sample_files/creation3.txt"),monocle.watchFiles({files:[__dirname+"/sample_files/creation.txt",__dirname+"/sample_files/creation2.txt"],listener:function(t){cb_helper("creation2.txt",t,e)},complete:function(){complete_helper("/sample_files/creation2.txt")}})}),it("should detect a file changed (delayed)",function(e){complete_helper("/sample_files/creation3.txt"),monocle.watchFiles({files:[__dirname+"/sample_files/creation3.txt"],listener:function(t){setTimeout(function(){cb_helper("creation3.txt",t,e)},400)},complete:function(){complete_helper("/sample_files/creation3.txt")}})}),it("should detect a file changed (short delayed)",function(e){complete_helper("/sample_files/creation4.txt"),monocle.watchFiles({files:[__dirname+"/sample_files/creation4.txt"],listener:function(t){setTimeout(function(){cb_helper("creation4.txt",t,e)},100)},complete:function(){complete_helper("/sample_files/creation4.txt")}})}),it("should detect a file changed",function(e){complete_helper("/sample_files/creation.txt"),monocle.watchFiles({files:[__dirname+"/sample_files/creation.txt"],listener:function(t){cb_helper("creation.txt",t,e)},complete:function(){complete_helper("/sample_files/creation.txt")}})}),it("should not bomb when no callback is passed",function(e){complete_helper("/sample_files/creation5.txt"),monocle.watchFiles({files:[__dirname+"/sample_files/creation5.txt"],complete:function(){complete_helper("/sample_files/creation5.txt")}}),setTimeout(function(){e()},300)})}),describe("paths watched",function(){it("should detect a file changed of multiple",function(e){complete_helper("/sample_files/creation.txt"),complete_helper("/sample_files/creation2.txt"),complete_helper("/sample_files/creation3.txt"),monocle.watchPaths({path:[__dirname+"/sample_files/creation.txt",__dirname+"/sample_files/creation2.txt"],listener:function(t){cb_helper("creation2.txt",t,e)},complete:function(){complete_helper("/sample_files/creation2.txt")}})}),it("should detect a file changed (delayed)",function(e){complete_helper("/sample_files/creation3.txt"),monocle.watchPaths({path:[__dirname+"/sample_files/creation3.txt"],listener:function(t){setTimeout(function(){cb_helper("creation3.txt",t,e)},400)},complete:function(){complete_helper("/sample_files/creation3.txt")}})}),it("should detect a file changed (short delayed)",function(e){complete_helper("/sample_files/creation4.txt"),monocle.watchPaths({path:[__dirname+"/sample_files/creation4.txt"],listener:function(t){setTimeout(function(){cb_helper("creation4.txt",t,e)},100)},complete:function(){complete_helper("/sample_files/creation4.txt")}})}),it("should detect a file changed",function(e){complete_helper("/sample_files/creation.txt"),monocle.watchPaths({path:[__dirname+"/sample_files/creation.txt"],listener:function(t){cb_helper("creation.txt",t,e)},complete:function(){complete_helper("/sample_files/creation.txt")}})}),it("should not bomb when no callback is passed",function(e){complete_helper("/sample_files/creation5.txt"),monocle.watchPaths({path:[__dirname+"/sample_files/creation5.txt"],complete:function(){complete_helper("/sample_files/creation5.txt")}}),setTimeout(function(){e()},300)})}),describe("different parameters of watchPaths",function(){it("can be a file",function(e){monocle.watchPaths({path:sample_dir+"/foo.txt",listener:function(t){cb_helper("foo.txt",t,e)},complete:function(){complete_helper("/sample_files/foo.txt")}})}),it("can be a directory",function(e){monocle.watchPaths({path:sample_dir,listener:function(t){cb_helper("foo.txt",t,e)},complete:function(){complete_helper("/sample_files/foo.txt")}})}),it("can be a list of directories",function(e){monocle.watchPaths({path:[sample_dir],listener:function(t){cb_helper("foo.txt",t,e)},complete:function(){complete_helper("/sample_files/foo.txt")}})}),it("can be a list of directories and a file",function(e){monocle.watchPaths({path:[sample_dir+"/nestedDir",sample_dir+"/foo.txt"],listener:function(t){cb_helper("foo.txt",t,e)},complete:function(){complete_helper("/sample_files/foo.txt")}})}),it("can be a list of files and a directory",function(e){monocle.watchPaths({path:[sample_dir+"/foo.txt",sample_dir+"/nestedDir"],listener:function(t){cb_helper("servent.txt",t,e)},complete:function(){complete_helper("/sample_files/nestedDir/servent.txt")}})})});