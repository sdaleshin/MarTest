function sync(e,t){var n=this.cache(t)||this.cache(t,this.engine.compile(e,t));return n(t)}var dirname=require("path").dirname,Transformer=require("./shared"),uglifyJS=require("uglify-js");exports.uglify=exports.uglifyJS=exports["uglify-js"]=new Transformer({name:"uglify-js",engines:["."],outputFormat:"js",isMinifier:!0,sync:function(e,t){return t.fromString=!0,this.cache(t)||this.cache(t,uglifyJS.minify(e,t).code)}});var uglifyCSS=require("css");exports.uglifyCSS=exports["uglify-css"]=new Transformer({name:"uglify-css",engines:["."],outputFormat:"css",isMinifier:!0,sync:function(e,t){return t.compress=t.compress!=0&&t.beautify!=1,this.cache(t)||this.cache(t,uglifyCSS.stringify(uglifyCSS.parse(e),t))}}),exports.uglifyJSON=exports["uglify-json"]=new Transformer({name:"uglify-json",engines:["."],outputFormat:"json",isMinifier:!0,sync:function(e,t){return JSON.stringify(JSON.parse(e),null,t.beautify)}}),exports.swig=new Transformer({name:"swig",engines:["swig"],outputFormat:"xml",sync:sync}),exports.atpl=new Transformer({name:"atpl",engines:["atpl"],outputFormat:"xml",sync:function(t,n){var r=this.cache(n);if(!r){var i={cache:n.cache,filename:n.filename};n.filename&&delete n.filename,r=this.cache(i,this.engine.compile(t,n))}return r(n)}}),exports.dot=new Transformer({name:"dot",engines:["dot"],outputFormat:"xml",sync:function(t,n){var r=this.cache(n)||this.cache(n,this.engine.template(t));return r(n)}}),exports.liquor=new Transformer({name:"liquor",engines:["liquor"],outputFormat:"xml",sync:sync}),exports.ejs=new Transformer({name:"ejs",engines:["ejs"],outputFormat:"xml",sync:sync}),exports.eco=new Transformer({name:"eco",engines:["eco"],outputFormat:"xml",sync:sync}),exports.jqtpl=new Transformer({name:"jqtpl",engines:["jqtpl"],outputFormat:"xml",sync:function(e,t){var n=this.engine,r=t.cache&&t.filename?t.filename:"@";n.compile(e,r);var i=this.engine.render(r,t);return(!t.cache||!t.filename)&&delete n.cache[r],this.cache(t,!0),i}}),exports.haml=new Transformer({name:"haml",engines:["hamljs"],outputFormat:"xml",sync:sync}),exports["haml-coffee"]=new Transformer({name:"haml-coffee",engines:["haml-coffee"],outputFormat:"xml",sync:sync}),exports.whiskers=new Transformer({name:"whiskers",engines:["whiskers"],outputFormat:"xml",sync:sync}),exports.hogan=new Transformer({name:"hogan",engines:["hogan.js"],outputFormat:"xml",sync:function(e,t){var n=this.cache(t)||this.cache(t,this.engine.compile(e,t));return n.render(t,t.partials)}}),exports.handlebars=new Transformer({name:"handlebars",engines:["handlebars"],outputFormat:"xml",sync:function(e,t){for(var n in t.partials)this.engine.registerPartial(n,t.partials[n]);var r=this.cache(t)||this.cache(t,this.engine.compile(e,t));return r(t)}}),exports.underscore=new Transformer({name:"underscore",engines:["underscore"],outputFormat:"xml",sync:function(e,t){var n=this.cache(t)||this.cache(t,this.engine.template(e));return n(t)}}),exports.walrus=new Transformer({name:"walrus",engines:["walrus"],outputFormat:"xml",sync:function(e,t){var n=this.cache(t)||this.cache(t,this.engine.parse(e));return n.compile(t)}}),exports.mustache=new Transformer({name:"mustache",engines:["mustache"],outputFormat:"xml",sync:function(e,t){var n=this.cache(t)||this.cache(t,this.engine.compile(e));return n(t,t.partials)}}),exports.templayed=new Transformer({name:"templayed",engines:["templayed"],outputFormat:"xml",sync:function(e,t){var n=this.cache(t)||this.cache(t,this.engine(e));return n(t)}}),exports.plates=new Transformer({name:"plates",engines:["plates"],outputFormat:"xml",sync:function(e,t){return e=this.cache(t)||this.cache(t,e),this.engine.bind(e,t,t.map)}}),exports.mote=new Transformer({name:"mote",engines:["mote"],outputFormat:"xml",sync:sync}),exports.toffee=new Transformer({name:"toffee",engines:["toffee"],outputFormat:"xml",sync:function(e,t){var n=this.engine.view,r=this.cache(t)||this.cache(t,new n(e,t)),i=r.run(t,require("vm").createContext({}));if(i[0])throw i[0];return i[1]}}),exports.coffeekup=exports.coffeecup=new Transformer({name:"coffeecup",engines:["coffeecup","coffeekup"],outputFormat:"xml",sync:function(e,t){var n=this.cache(t)||this.cache(t,this.engine.compile(e,t));return n(t)}}),exports.just=new Transformer({name:"just",engines:["just"],outputFormat:"xml",sudoSync:!0,async:function(e,t,n){var r=this.engine,i=this.cache(t)||this.cache(t,new r({root:{page:e}}));i.render("page",t,n)}}),exports.ect=new Transformer({name:"ect",engines:["ect"],outputFormat:"xml",sudoSync:!0,async:function(e,t,n){var r=this.engine,i=this.cache(t)||this.cache(t,new r({root:{page:e}}));i.render("page",t,n)}}),exports.jade=new Transformer({name:"jade",engines:["jade","then-jade"],outputFormat:"xml",sudoSync:"The jade file FILENAME could not be rendered syncronously.  N.B. then-jade does not support syncronous rendering.",async:function(e,t,n){this.cache(t,!0),this.engine.render(e,t,n)}}),exports.dust=new Transformer({name:"dust",engines:["dust","dustjs-linkedin"],outputFormat:"xml",sudoSync:!1,async:function(e,t,n){var r="dust",i=".";t&&(t.ext&&(r=t.ext),t.views&&(i=t.views),t.settings&&t.settings.views&&(i=t.settings.views)),this.engine.onLoad=function(e,n){""==extname(e)&&(e+="."+r),"/"!==e[0]&&(e=i+"/"+e),read(e,t,n)};var s=this.cache(t)||this.cache(t,this.engine.compileFn(e));t&&!t.cache&&(this.engine.cache={}),s(t,n)}}),exports.jazz=new Transformer({name:"jazz",engines:["jazz"],outputFormat:"xml",sudoSync:!0,async:function(e,t,n){var r=this.cache(t)||this.cache(t,this.engine.compile(e,t));r.eval(t,function(e){n(null,e)})}}),exports.qejs=new Transformer({name:"qejs",engines:["qejs"],outputFormat:"xml",sudoSync:!1,async:function(e,t,n){var r=this.cache(t)||this.cache(t,this.engine.compile(e,t));r(t).done(function(e){n(null,e)},function(e){n(e)})}}),exports.less=new Transformer({name:"less",engines:["less"],outputFormat:"css",sudoSync:"The less file FILENAME could not be rendered syncronously.  This is usually because the file contains `@import url` statements.",async:function(e,t,n){var r=this;if(r.cache(t))return n(null,r.cache(t));t.filename&&(t.paths=t.paths||[dirname(t.filename)]),t.compress!==!0&&t.compress!==!1&&(t.compress=t.cache||!1),t.sudoSync&&(t.syncImport=!0);var i=new this.engine.Parser(t);i.parse(e,function(e,i){try{if(e)throw e;var s=i.toCSS(t);r.cache(t,s),n(null,s)}catch(o){if(o.constructor.name==="LessError"&&typeof o=="object"){o.filename=o.filename||'"Unkown Source"';var e=new Error(r.engine.formatError(o,t).replace(/^[^:]+:/,""),o.filename,o.line);e.name=o.type,o=e}return n(o)}})}}),exports.styl=exports.stylus=new Transformer({name:"stylus",engines:["stylus"],outputFormat:"css",sudoSync:!0,async:function(e,t,n){var r=this;if(r.cache(t))return n(null,r.cache(t));t.filename&&(t.paths=t.paths||[dirname(t.filename)]),t.compress!==!0&&t.compress!==!1&&(t.compress=t.cache||!1),this.engine.render(e,t,function(e,i){if(e)return n(e);r.cache(t,i),n(null,i)})}}),exports.sass=new Transformer({name:"sass",engines:["sass"],outputFormat:"css",sync:function(e,t){try{return this.cache(t)||this.cache(t,this.engine.render(e))}catch(n){throw t.filename&&(n.message+=" in "+t.filename),n}}}),exports.md=exports.markdown=new Transformer({name:"markdown",engines:["marked","supermarked","markdown-js","markdown"],outputFormat:"html",sync:function(e,t){var n=t;return this.engineName==="markdown"&&(n=t.dialect),this.cache(t)||this.cache(t,this.engine.parse(e,n))}}),exports.coffee=exports["coffee-script"]=exports.coffeescript=exports.coffeeScript=new Transformer({name:"coffee-script",engines:["coffee-script"],outputFormat:"js",sync:function(e,t){return this.cache(t)||this.cache(t,this.engine.compile(e,t))}}),exports.cson=new Transformer({name:"cson",engines:["cson"],outputFormat:"json",sync:function(e,t){return global.Narcissus&&delete global.Narcissus,this.cache(t)||this.cache(t,JSON.stringify(this.engine.parseSync(e)))}}),exports.cdata=new Transformer({name:"cdata",engines:["."],outputFormat:"xml",sync:function(e,t){var n=e.replace(/\]\]>/g,"]]]]><![CDATA[>");return this.cache(t)||this.cache(t,"<![CDATA["+n+"]]>")}}),exports["cdata-js"]=new Transformer({name:"cdata-js",engines:["."],outputFormat:"xml",sync:function(e,t){var n=e.replace(/\]\]>/g,"]]]]><![CDATA[>");return this.cache(t)||this.cache(t,"//<![CDATA[\n"+n+"\n//]]>")}}),exports["cdata-css"]=new Transformer({name:"cdata-css",engines:["."],outputFormat:"xml",sync:function(e,t){var n=e.replace(/\]\]>/g,"]]]]><![CDATA[>");return this.cache(t)||this.cache(t,"/*<![CDATA[*/\n"+n+"\n/*]]>*/")}}),exports.verbatim=new Transformer({name:"verbatim",engines:["."],outputFormat:"xml",sync:function(e,t){return this.cache(t)||this.cache(t,e)}}),exports.component=exports["component-js"]=new Transformer({name:"component-js",engines:["component-builder"],outputFormat:"js",async:function(e,t,n){if(this.cache(t))return this.cache(t);var r=this,i=new this.engine(dirname(t.filename));t.development&&i.development(),(t.sourceURLs===!0||t.sourceURLs!==!1&&t.development)&&i.addSourceURLs();var s=require("path");i.paths=(t.paths||["components"]).map(function(e){return s.resolve(e)===e?e:s.join(dirname(t.filename),e)}),i.build(function(e,i){return e?n(e):n(null,r.cache(t,i.require+i.js))})}}),exports["component-css"]=new Transformer({name:"component-css",engines:["component-builder"],outputFormat:"css",async:function(e,t,n){if(this.cache(t))return this.cache(t);var r=this,i=new this.engine(dirname(t.filename));t.development&&i.development(),(t.sourceURLs===!0||t.sourceURLs!==!1&&t.development)&&i.addSourceURLs();var s=require("path");i.paths=(t.paths||["components"]).map(function(e){return s.resolve(e)===e?e:s.join(dirname(t.filename),e)}),i.build(function(e,i){return e?n(e):n(null,r.cache(t,i.css))})}}),exports.html2jade=new Transformer({name:"html2jade",engines:["html2jade"],outputFormat:"jade",async:function(e,t,n){return this.cache(t)||this.cache(t,this.engine.convertHtml(e,t,n))}}),exports.highlight=new Transformer({name:"highlight",engines:["highlight.js"],outputFormat:"xml",sync:function(e,t,n){if(this.cache(t))return this.cache(t);if(t.lang)try{return this.cache(t,this.engine.highlight(t.lang,e).value)}catch(r){}if(t.auto||!t.lang)try{return this.cache(t,this.engine.highlightAuto(e).value)}catch(r){}return this.cache(t,e)}}),exports.css=new Transformer({name:"css",engines:["."],outputFormat:"css",sync:function(e,t){return this.cache(t)||this.cache(t,e)}}),exports.js=new Transformer({name:"js",engines:["."],outputFormat:"js",sync:function(e,t){return this.cache(t)||this.cache(t,e)}});