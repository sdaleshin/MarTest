function Promise(e){function n(e){resolve(t,e)}function r(e){reject(t,e)}if(!(this instanceof Promise))return e?new Promise(e):defer();if(typeof e!="function")throw new TypeError("fn is not a function");var t={isResolved:!1,isSettled:!1,isFulfilled:!1,value:null,waiting:[],running:!1};this.then=function(n,r){return then(t,n,r)},n.fulfill=deprecate(n,"resolver.fulfill(x)","resolve(x)"),n.reject=deprecate(r,"resolver.reject","reject(x)");try{e(n,r)}catch(i){r(i)}}function resolve(e,t){if(e.isResolved)return;isPromise(t)?assimilate(e,t):settle(e,!0,t)}function reject(e,t){if(e.isResolved)return;settle(e,!1,t)}function then(e,t,n){return new Promise(function(r,i){function s(s,o){var u=e.isFulfilled?t:n;if(typeof u=="function"){function a(){var t;try{t=u(e.value)}catch(n){return i(n),s(!0)}r(t),s(!0)}o?a():nextTick(a)}else e.isFulfilled?(r(e.value),s(o)):(i(e.value),s(o))}e.waiting.push(s),e.isSettled&&!e.running&&processQueue(e)})}function processQueue(e){function t(n){e.waiting.length?(e.running=!0,e.waiting.shift()(t,n)):e.running=!1}t(!1)}function settle(e,t,n){if(e.isSettled)return;e.isResolved=e.isSettled=!0,e.value=n,e.isFulfilled=t,processQueue(e)}function assimilate(e,t){try{e.isResolved=!0,t.then(function(t){isPromise(t)?assimilate(e,t):settle(e,!0,t)},function(t){settle(e,!1,t)})}catch(n){settle(e,!1,n)}}function deprecate(e,t,n){return function(){var r=new Error(t+" is deprecated use "+n);typeof console!="undefined"&&console&&typeof console.warn=="function"?(console.warn(t+" is deprecated use "+n),r.stack&&console.warn(r.stack)):nextTick(function(){throw r}),e.apply(this,arguments)}}function defer(){var e=new Error("promise.defer() is deprecated");typeof console!="undefined"&&console&&typeof console.warn=="function"?(console.warn("promise.defer() is deprecated"),e.stack&&console.warn(e.stack)):nextTick(function(){throw e});var t,n=new Promise(function(e){t=e});return{resolver:t,promise:n}}var isPromise=require("is-promise"),nextTick;typeof setImediate=="function"?nextTick=setImediate:typeof process=="object"&&process&&process.nextTick?nextTick=process.nextTick:nextTick=function(e){setTimeout(e,0)};var extensions=[];module.exports=Promise,Promise.use=function(e){extensions.push(e)};