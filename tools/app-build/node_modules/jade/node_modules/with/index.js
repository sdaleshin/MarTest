function addWith(e,t,n,r){r=r||["reservedVars","ecmaIdentifiers","nonstandard","node"],n=n||[],n=n.concat(detect(e));var i=detect("(function () {"+t+"}())").filter(function(e){for(var t=0;t<r.length;t++)if(e in globalVars[r[t]])return!1;return n.indexOf(e)===-1});if(i.length===0)return t;var s="",o="locals";if(/^[a-zA-Z0-9$_]+$/.test(e))o=e;else{while(i.indexOf(o)!=-1||n.indexOf(o)!=-1)o+="_";s=o+" = ("+e+"),"}return"var "+s+i.map(function(e){return e+" = "+o+"."+e}).join(",")+";"+t}function detect(e){var t=uglify.parse(e.toString());t.figure_out_scope();var n=t.globals.map(function(e,t){return t});return n}var uglify=require("uglify-js"),globalVars=require("./vars");module.exports=addWith;