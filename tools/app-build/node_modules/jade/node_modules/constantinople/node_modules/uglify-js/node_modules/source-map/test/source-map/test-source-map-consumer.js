/*
 * Copyright 2011 Mozilla Foundation and contributors
 * Licensed under the New BSD license. See LICENSE or:
 * http://opensource.org/licenses/BSD-3-Clause
 */

define(["require","exports","module","../../lib/source-map/source-map-consumer","../../lib/source-map/source-map-generator"],function(e,t,n){var r=e("../../lib/source-map/source-map-consumer").SourceMapConsumer,i=e("../../lib/source-map/source-map-generator").SourceMapGenerator;t["test that we can instantiate with a string or an objects"]=function(e,t){e.doesNotThrow(function(){var e=new r(t.testMap)}),e.doesNotThrow(function(){var e=new r(JSON.stringify(t.testMap))})},t["test that the `sources` field has the original sources"]=function(e,t){var n=new r(t.testMap),i=n.sources;e.equal(i[0],"/the/root/one.js"),e.equal(i[1],"/the/root/two.js"),e.equal(i.length,2)},t["test that the source root is reflected in a mapping's source field"]=function(e,t){var n=new r(t.testMap),i;i=n.originalPositionFor({line:2,column:1}),e.equal(i.source,"/the/root/two.js"),i=n.originalPositionFor({line:1,column:1}),e.equal(i.source,"/the/root/one.js")},t["test mapping tokens back exactly"]=function(e,t){var n=new r(t.testMap);t.assertMapping(1,1,"/the/root/one.js",1,1,null,n,e),t.assertMapping(1,5,"/the/root/one.js",1,5,null,n,e),t.assertMapping(1,9,"/the/root/one.js",1,11,null,n,e),t.assertMapping(1,18,"/the/root/one.js",1,21,"bar",n,e),t.assertMapping(1,21,"/the/root/one.js",2,3,null,n,e),t.assertMapping(1,28,"/the/root/one.js",2,10,"baz",n,e),t.assertMapping(1,32,"/the/root/one.js",2,14,"bar",n,e),t.assertMapping(2,1,"/the/root/two.js",1,1,null,n,e),t.assertMapping(2,5,"/the/root/two.js",1,5,null,n,e),t.assertMapping(2,9,"/the/root/two.js",1,11,null,n,e),t.assertMapping(2,18,"/the/root/two.js",1,21,"n",n,e),t.assertMapping(2,21,"/the/root/two.js",2,3,null,n,e),t.assertMapping(2,28,"/the/root/two.js",2,10,"n",n,e)},t["test mapping tokens fuzzy"]=function(e,t){var n=new r(t.testMap);t.assertMapping(1,20,"/the/root/one.js",1,21,"bar",n,e,!0),t.assertMapping(1,30,"/the/root/one.js",2,10,"baz",n,e,!0),t.assertMapping(2,12,"/the/root/two.js",1,11,null,n,e,!0),t.assertMapping(1,18,"/the/root/one.js",1,22,"bar",n,e,null,!0),t.assertMapping(1,28,"/the/root/one.js",2,13,"baz",n,e,null,!0),t.assertMapping(2,9,"/the/root/two.js",1,16,null,n,e,null,!0)},t["test creating source map consumers with )]}' prefix"]=function(e,t){e.doesNotThrow(function(){var e=new r(")]}'"+JSON.stringify(t.testMap))})},t["test eachMapping"]=function(e,t){var n=new r(t.testMap),i=-Infinity,s=-Infinity;n.eachMapping(function(n){e.ok(n.generatedLine>=i),n.source&&e.equal(n.source.indexOf(t.testMap.sourceRoot),0),n.generatedLine===i?(e.ok(n.generatedColumn>=s),s=n.generatedColumn):(i=n.generatedLine,s=-Infinity)})},t["test iterating over mappings in a different order"]=function(e,t){var n=new r(t.testMap),i=-Infinity,s=-Infinity,o="";n.eachMapping(function(t){e.ok(t.source>=o),t.source===o?(e.ok(t.originalLine>=i),t.originalLine===i?(e.ok(t.originalColumn>=s),s=t.originalColumn):(i=t.originalLine,s=-Infinity)):(o=t.source,i=-Infinity,s=-Infinity)},null,r.ORIGINAL_ORDER)},t["test that we can set the context for `this` in eachMapping"]=function(e,t){var n=new r(t.testMap),i={};n.eachMapping(function(){e.equal(this,i)},i)},t["test that the `sourcesContent` field has the original sources"]=function(e,t){var n=new r(t.testMapWithSourcesContent),i=n.sourcesContent;e.equal(i[0]," ONE.foo = function (bar) {\n   return baz(bar);\n };"),e.equal(i[1]," TWO.inc = function (n) {\n   return n + 1;\n };"),e.equal(i.length,2)},t["test that we can get the original sources for the sources"]=function(e,t){var n=new r(t.testMapWithSourcesContent),i=n.sources;e.equal(n.sourceContentFor(i[0])," ONE.foo = function (bar) {\n   return baz(bar);\n };"),e.equal(n.sourceContentFor(i[1])," TWO.inc = function (n) {\n   return n + 1;\n };"),e.equal(n.sourceContentFor("one.js")," ONE.foo = function (bar) {\n   return baz(bar);\n };"),e.equal(n.sourceContentFor("two.js")," TWO.inc = function (n) {\n   return n + 1;\n };"),e.throws(function(){n.sourceContentFor("")},Error),e.throws(function(){n.sourceContentFor("/the/root/three.js")},Error),e.throws(function(){n.sourceContentFor("three.js")},Error)},t["test sourceRoot + generatedPositionFor"]=function(e,t){var n=new i({sourceRoot:"foo/bar",file:"baz.js"});n.addMapping({original:{line:1,column:1},generated:{line:2,column:2},source:"bang.coffee"}),n.addMapping({original:{line:5,column:5},generated:{line:6,column:6},source:"bang.coffee"}),n=new r(n.toString());var s=n.generatedPositionFor({line:1,column:1,source:"bang.coffee"});e.equal(s.line,2),e.equal(s.column,2);var s=n.generatedPositionFor({line:1,column:1,source:"foo/bar/bang.coffee"});e.equal(s.line,2),e.equal(s.column,2)},t["test sourceRoot + originalPositionFor"]=function(e,t){var n=new i({sourceRoot:"foo/bar",file:"baz.js"});n.addMapping({original:{line:1,column:1},generated:{line:2,column:2},source:"bang.coffee"}),n=new r(n.toString());var s=n.originalPositionFor({line:2,column:2});e.equal(s.source,"foo/bar/bang.coffee"),e.equal(s.line,1),e.equal(s.column,1)},t["test github issue #56"]=function(e,t){var n=new i({sourceRoot:"http://",file:"www.example.com/foo.js"});n.addMapping({original:{line:1,column:1},generated:{line:2,column:2},source:"www.example.com/original.js"}),n=new r(n.toString());var s=n.sources;e.equal(s.length,1),e.equal(s[0],"http://www.example.com/original.js")},t["test github issue #43"]=function(e,t){var n=new i({sourceRoot:"http://example.com",file:"foo.js"});n.addMapping({original:{line:1,column:1},generated:{line:2,column:2},source:"http://cdn.example.com/original.js"}),n=new r(n.toString());var s=n.sources;e.equal(s.length,1,"Should only be one source."),e.equal(s[0],"http://cdn.example.com/original.js","Should not be joined with the sourceRoot.")},t["test absolute path, but same host sources"]=function(e,t){var n=new i({sourceRoot:"http://example.com/foo/bar",file:"foo.js"});n.addMapping({original:{line:1,column:1},generated:{line:2,column:2},source:"/original.js"}),n=new r(n.toString());var s=n.sources;e.equal(s.length,1,"Should only be one source."),e.equal(s[0],"http://example.com/original.js","Source should be relative the host of the source root.")},t["test github issue #64"]=function(e,t){var n=new r({version:3,file:"foo.js",sourceRoot:"http://example.com/",sources:["/a"],names:[],mappings:"AACA",sourcesContent:["foo"]});e.equal(n.sourceContentFor("a"),"foo"),e.equal(n.sourceContentFor("/a"),"foo")},t["test bug 885597"]=function(e,t){var n=new r({version:3,file:"foo.js",sourceRoot:"file:///Users/AlGore/Invented/The/Internet/",sources:["/a"],names:[],mappings:"AACA",sourcesContent:["foo"]}),i=n.sources[0];e.equal(n.sourceContentFor(i),"foo")},t["test github issue #72, duplicate sources"]=function(e,t){var n=new r({version:3,file:"foo.js",sources:["source1.js","source1.js","source3.js"],names:[],mappings:";EAAC;;IAEE;;MEEE",sourceRoot:"http://example.com"}),i=n.originalPositionFor({line:2,column:2});e.equal(i.source,"http://example.com/source1.js"),e.equal(i.line,1),e.equal(i.column,1);var i=n.originalPositionFor({line:4,column:4});e.equal(i.source,"http://example.com/source1.js"),e.equal(i.line,3),e.equal(i.column,3);var i=n.originalPositionFor({line:6,column:6});e.equal(i.source,"http://example.com/source3.js"),e.equal(i.line,5),e.equal(i.column,5)},t["test github issue #72, duplicate names"]=function(e,t){var n=new r({version:3,file:"foo.js",sources:["source.js"],names:["name1","name1","name3"],mappings:";EAACA;;IAEEA;;MAEEE",sourceRoot:"http://example.com"}),i=n.originalPositionFor({line:2,column:2});e.equal(i.name,"name1"),e.equal(i.line,1),e.equal(i.column,1);var i=n.originalPositionFor({line:4,column:4});e.equal(i.name,"name1"),e.equal(i.line,3),e.equal(i.column,3);var i=n.originalPositionFor({line:6,column:6});e.equal(i.name,"name3"),e.equal(i.line,5),e.equal(i.column,5)},t["test SourceMapConsumer.fromSourceMap"]=function(e,t){var n=new i({sourceRoot:"http://example.com/",file:"foo.js"});n.addMapping({original:{line:1,column:1},generated:{line:2,column:2},source:"bar.js"}),n.addMapping({original:{line:2,column:2},generated:{line:4,column:4},source:"baz.js",name:"dirtMcGirt"}),n.setSourceContent("baz.js","baz.js content");var s=r.fromSourceMap(n);e.equal(s.file,"foo.js"),e.equal(s.sourceRoot,"http://example.com/"),e.equal(s.sources.length,2),e.equal(s.sources[0],"http://example.com/bar.js"),e.equal(s.sources[1],"http://example.com/baz.js"),e.equal(s.sourceContentFor("baz.js"),"baz.js content");var o=s.originalPositionFor({line:2,column:2});e.equal(o.line,1),e.equal(o.column,1),e.equal(o.source,"http://example.com/bar.js"),e.equal(o.name,null),o=s.generatedPositionFor({line:1,column:1,source:"http://example.com/bar.js"}),e.equal(o.line,2),e.equal(o.column,2),o=s.originalPositionFor({line:4,column:4}),e.equal(o.line,2),e.equal(o.column,2),e.equal(o.source,"http://example.com/baz.js"),e.equal(o.name,"dirtMcGirt"),o=s.generatedPositionFor({line:2,column:2,source:"http://example.com/baz.js"}),e.equal(o.line,4),e.equal(o.column,4)}});