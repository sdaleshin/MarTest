/***********************************************************************

  A JavaScript tokenizer / parser / beautifier / compressor.
  https://github.com/mishoo/UglifyJS2

  -------------------------------- (C) ---------------------------------

                           Author: Mihai Bazon
                         <mihai.bazon@gmail.com>
                       http://mihai.bazon.net/blog

  Distributed under the BSD license:

    Copyright 2012 (c) Mihai Bazon <mihai.bazon@gmail.com>

    Redistribution and use in source and binary forms, with or without
    modification, are permitted provided that the following conditions
    are met:

        * Redistributions of source code must retain the above
          copyright notice, this list of conditions and the following
          disclaimer.

        * Redistributions in binary form must reproduce the above
          copyright notice, this list of conditions and the following
          disclaimer in the documentation and/or other materials
          provided with the distribution.

    THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDER “AS IS” AND ANY
    EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
    IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
    PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER BE
    LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY,
    OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
    PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
    PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
    THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR
    TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF
    THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
    SUCH DAMAGE.

 ***********************************************************************/

function Compressor(e,t){if(!(this instanceof Compressor))return new Compressor(e,t);TreeTransformer.call(this,this.before,this.after),this.options=defaults(e,{sequences:!t,properties:!t,dead_code:!t,drop_debugger:!t,unsafe:!1,unsafe_comps:!1,conditionals:!t,comparisons:!t,evaluate:!t,booleans:!t,loops:!t,unused:!t,hoist_funs:!t,hoist_vars:!1,if_return:!t,join_vars:!t,cascade:!t,side_effects:!t,pure_getters:!1,pure_funcs:null,negate_iife:!t,screw_ie8:!1,drop_console:!1,warnings:!0,global_defs:{}},!0)}Compressor.prototype=new TreeTransformer,merge(Compressor.prototype,{option:function(e){return this.options[e]},warn:function(){this.options.warnings&&AST_Node.warn.apply(AST_Node,arguments)},before:function(e,t,n){if(e._squeezed)return e;var r=!1;return e instanceof AST_Scope&&(e=e.hoist_declarations(this),r=!0),t(e,this),e=e.optimize(this),r&&e instanceof AST_Scope&&(e.drop_unused(this),t(e,this)),e._squeezed=!0,e}}),function(){function e(e,t){e.DEFMETHOD("optimize",function(e){var n=this;if(n._optimized)return n;var r=t(n,e);return r._optimized=!0,r===n?r:r.transform(e)})}function t(e,t,n){return n||(n={}),t&&(n.start||(n.start=t.start),n.end||(n.end=t.end)),new e(n)}function n(e,n,r){if(n instanceof AST_Node)return n.transform(e);switch(typeof n){case"string":return t(AST_String,r,{value:n}).optimize(e);case"number":return t(isNaN(n)?AST_NaN:AST_Number,r,{value:n}).optimize(e);case"boolean":return t(n?AST_True:AST_False,r).optimize(e);case"undefined":return t(AST_Undefined,r).optimize(e);default:if(n===null)return t(AST_Null,r).optimize(e);if(n instanceof RegExp)return t(AST_RegExp,r).optimize(e);throw new Error(string_template("Can't handle constant of type: {type}",{type:typeof n}))}}function r(e){if(e===null)return[];if(e instanceof AST_BlockStatement)return e.body;if(e instanceof AST_EmptyStatement)return[];if(e instanceof AST_Statement)return[e];throw new Error("Can't convert thing to statement array")}function i(e){return e===null?!0:e instanceof AST_EmptyStatement?!0:e instanceof AST_BlockStatement?e.body.length==0:!1}function s(e){return e instanceof AST_Switch?e:e instanceof AST_For||e instanceof AST_ForIn||e instanceof AST_DWLoop?e.body instanceof AST_BlockStatement?e.body:e:e}function o(e,n){function o(e){var t=[];return e.reduce(function(e,n){return n instanceof AST_BlockStatement?(i=!0,e.push.apply(e,o(n.body))):n instanceof AST_EmptyStatement?i=!0:n instanceof AST_Directive?t.indexOf(n.value)<0?(e.push(n),t.push(n.value)):i=!0:e.push(n),e},[])}function a(e,n){var o=n.self(),u=o instanceof AST_Lambda,a=[];e:for(var l=e.length;--l>=0;){var c=e[l];switch(!0){case u&&c instanceof AST_Return&&!c.value&&a.length==0:i=!0;continue e;case c instanceof AST_If:if(c.body instanceof AST_Return){if((u&&a.length==0||a[0]instanceof AST_Return&&!a[0].value)&&!c.body.value&&!c.alternative){i=!0;var h=t(AST_SimpleStatement,c.condition,{body:c.condition});a.unshift(h);continue e}if(a[0]instanceof AST_Return&&c.body.value&&a[0].value&&!c.alternative){i=!0,c=c.clone(),c.alternative=a[0],a[0]=c.transform(n);continue e}if((a.length==0||a[0]instanceof AST_Return)&&c.body.value&&!c.alternative&&u){i=!0,c=c.clone(),c.alternative=a[0]||t(AST_Return,c,{value:t(AST_Undefined,c)}),a[0]=c.transform(n);continue e}if(!c.body.value&&u){i=!0,c=c.clone(),c.condition=c.condition.negate(n),c.body=t(AST_BlockStatement,c,{body:r(c.alternative).concat(a)}),c.alternative=null,a=[c.transform(n)];continue e}if(a.length==1&&u&&a[0]instanceof AST_SimpleStatement&&(!c.alternative||c.alternative instanceof AST_SimpleStatement)){i=!0,a.push(t(AST_Return,a[0],{value:t(AST_Undefined,a[0])}).transform(n)),a=r(c.alternative).concat(a),a.unshift(c);continue e}}var p=f(c.body),d=p instanceof AST_LoopControl?n.loopcontrol_target(p.label):null;if(p&&(p instanceof AST_Return&&!p.value&&u||p instanceof AST_Continue&&o===s(d)||p instanceof AST_Break&&d instanceof AST_BlockStatement&&o===d)){p.label&&remove(p.label.thedef.references,p),i=!0;var v=r(c.body).slice(0,-1);c=c.clone(),c.condition=c.condition.negate(n),c.body=t(AST_BlockStatement,c,{body:a}),c.alternative=t(AST_BlockStatement,c,{body:v}),a=[c.transform(n)];continue e}var p=f(c.alternative),d=p instanceof AST_LoopControl?n.loopcontrol_target(p.label):null;if(p&&(p instanceof AST_Return&&!p.value&&u||p instanceof AST_Continue&&o===s(d)||p instanceof AST_Break&&d instanceof AST_BlockStatement&&o===d)){p.label&&remove(p.label.thedef.references,p),i=!0,c=c.clone(),c.body=t(AST_BlockStatement,c.body,{body:r(c.body).concat(a)}),c.alternative=t(AST_BlockStatement,c.alternative,{body:r(c.alternative).slice(0,-1)}),a=[c.transform(n)];continue e}a.unshift(c);break;default:a.unshift(c)}}return a}function l(e,t){var n=!1,r=e.length,o=t.self();return e=e.reduce(function(e,r){if(n)u(t,r,e);else{if(r instanceof AST_LoopControl){var i=t.loopcontrol_target(r.label);r instanceof AST_Break&&i instanceof AST_BlockStatement&&s(i)===o||r instanceof AST_Continue&&s(i)===o?r.label&&remove(r.label.thedef.references,r):e.push(r)}else e.push(r);f(r)&&(n=!0)}return e},[]),i=e.length!=r,e}function c(e,n){function o(){r=AST_Seq.from_array(r),r&&s.push(t(AST_SimpleStatement,r,{body:r})),r=[]}if(e.length<2)return e;var r=[],s=[];return e.forEach(function(e){e instanceof AST_SimpleStatement?r.push(e.body):(o(),s.push(e))}),o(),s=h(s,n),i=s.length!=e.length,s}function h(e,n){function r(e){i.pop();var t=s.body;return t instanceof AST_Seq?t.add(e):t=AST_Seq.cons(t,e),t.transform(n)}var i=[],s=null;return e.forEach(function(e){if(s)if(e instanceof AST_For){var n={};try{s.body.walk(new TreeWalker(function(e){if(e instanceof AST_Binary&&e.operator=="in")throw n})),!e.init||e.init instanceof AST_Definitions?e.init||(e.init=s.body,i.pop()):e.init=r(e.init)}catch(o){if(o!==n)throw o}}else e instanceof AST_If?e.condition=r(e.condition):e instanceof AST_With?e.expression=r(e.expression):e instanceof AST_Exit&&e.value?e.value=r(e.value):e instanceof AST_Exit?e.value=r(t(AST_Undefined,e)):e instanceof AST_Switch&&(e.expression=r(e.expression));i.push(e),s=e instanceof AST_SimpleStatement?e:null}),i}function p(e,t){var n=null;return e.reduce(function(e,t){return t instanceof AST_Definitions&&n&&n.TYPE==t.TYPE?(n.definitions=n.definitions.concat(t.definitions),i=!0):t instanceof AST_For&&n instanceof AST_Definitions&&(!t.init||t.init.TYPE==n.TYPE)?(i=!0,e.pop(),t.init?t.init.definitions=n.definitions.concat(t.init.definitions):t.init=n,e.push(t),n=t):(n=t,e.push(t)),e},[])}function d(e,n){e.forEach(function(e){e instanceof AST_SimpleStatement&&(e.body=function n(e){return e.transform(new TreeTransformer(function(e){if(e instanceof AST_Call&&e.expression instanceof AST_Function)return t(AST_UnaryPrefix,e,{operator:"!",expression:e});if(e instanceof AST_Call)e.expression=n(e.expression);else if(e instanceof AST_Seq)e.car=n(e.car);else if(e instanceof AST_Conditional){var r=n(e.condition);if(r!==e.condition){e.condition=r;var i=e.consequent;e.consequent=e.alternative,e.alternative=i}}return e}))}(e.body))})}var i;do i=!1,e=o(e),n.option("dead_code")&&(e=l(e,n)),n.option("if_return")&&(e=a(e,n)),n.option("sequences")&&(e=c(e,n)),n.option("join_vars")&&(e=p(e,n));while(i);return n.option("negate_iife")&&d(e,n),e}function u(e,t,n){e.warn("Dropping unreachable code [{file}:{line},{col}]",t.start),t.walk(new TreeWalker(function(t){if(t instanceof AST_Definitions)return e.warn("Declarations in unreachable code! [{file}:{line},{col}]",t.start),t.remove_initializers(),n.push(t),!0;if(t instanceof AST_Defun)return n.push(t),!0;if(t instanceof AST_Scope)return!0}))}function a(e,t){return e.print_to_string().length>t.print_to_string().length?t:e}function f(e){return e&&e.aborts()}function l(e,n){function i(i){i=r(i),e.body instanceof AST_BlockStatement?(e.body=e.body.clone(),e.body.body=i.concat(e.body.body.slice(1)),e.body=e.body.transform(n)):e.body=t(AST_BlockStatement,e.body,{body:i}).transform(n),l(e,n)}var s=e.body instanceof AST_BlockStatement?e.body.body[0]:e.body;s instanceof AST_If&&(s.body instanceof AST_Break&&n.loopcontrol_target(s.body.label)===e?(e.condition?e.condition=t(AST_Binary,e.condition,{left:e.condition,operator:"&&",right:s.condition.negate(n)}):e.condition=s.condition.negate(n),i(s.alternative)):s.alternative instanceof AST_Break&&n.loopcontrol_target(s.alternative.label)===e&&(e.condition?e.condition=t(AST_Binary,e.condition,{left:e.condition,operator:"&&",right:s.condition}):e.condition=s.condition,i(s.body)))}function c(e,t){var n=t.option("pure_getters");t.options.pure_getters=!1;var r=e.has_side_effects(t);return t.options.pure_getters=n,r}function d(e,n){return n.option("booleans")&&n.in_boolean_context()?t(AST_True,e):e}e(AST_Node,function(e,t){return e}),AST_Node.DEFMETHOD("equivalent_to",function(e){return this.print_to_string()==e.print_to_string()}),function(e){var t=["!","delete"],n=["in","instanceof","==","!=","===","!==","<","<=",">=",">"];e(AST_Node,function(){return!1}),e(AST_UnaryPrefix,function(){return member(this.operator,t)}),e(AST_Binary,function(){return member(this.operator,n)||(this.operator=="&&"||this.operator=="||")&&this.left.is_boolean()&&this.right.is_boolean()}),e(AST_Conditional,function(){return this.consequent.is_boolean()&&this.alternative.is_boolean()}),e(AST_Assign,function(){return this.operator=="="&&this.right.is_boolean()}),e(AST_Seq,function(){return this.cdr.is_boolean()}),e(AST_True,function(){return!0}),e(AST_False,function(){return!0})}(function(e,t){e.DEFMETHOD("is_boolean",t)}),function(e){e(AST_Node,function(){return!1}),e(AST_String,function(){return!0}),e(AST_UnaryPrefix,function(){return this.operator=="typeof"}),e(AST_Binary,function(e){return this.operator=="+"&&(this.left.is_string(e)||this.right.is_string(e))}),e(AST_Assign,function(e){return(this.operator=="="||this.operator=="+=")&&this.right.is_string(e)}),e(AST_Seq,function(e){return this.cdr.is_string(e)}),e(AST_Conditional,function(e){return this.consequent.is_string(e)&&this.alternative.is_string(e)}),e(AST_Call,function(e){return e.option("unsafe")&&this.expression instanceof AST_SymbolRef&&this.expression.name=="String"&&this.expression.undeclared()})}(function(e,t){e.DEFMETHOD("is_string",t)}),function(e){function t(e,t){if(!t)throw new Error("Compressor must be passed");return e._eval(t)}AST_Node.DEFMETHOD("evaluate",function(t){if(!t.option("evaluate"))return[this];try{var r=this._eval(t);return[a(n(t,r,this),this),r]}catch(i){if(i!==e)throw i;return[this]}}),e(AST_Statement,function(){throw new Error(string_template("Cannot evaluate a statement [{file}:{line},{col}]",this.start))}),e(AST_Function,function(){throw e}),e(AST_Node,function(){throw e}),e(AST_Constant,function(){return this.getValue()}),e(AST_UnaryPrefix,function(n){var r=this.expression;switch(this.operator){case"!":return!t(r,n);case"typeof":if(r instanceof AST_Function)return typeof function(){};r=t(r,n);if(r instanceof RegExp)throw e;return typeof r;case"void":return void t(r,n);case"~":return~t(r,n);case"-":r=t(r,n);if(r===0)throw e;return-r;case"+":return+t(r,n)}throw e}),e(AST_Binary,function(n){var r=this.left,i=this.right;switch(this.operator){case"&&":return t(r,n)&&t(i,n);case"||":return t(r,n)||t(i,n);case"|":return t(r,n)|t(i,n);case"&":return t(r,n)&t(i,n);case"^":return t(r,n)^t(i,n);case"+":return t(r,n)+t(i,n);case"*":return t(r,n)*t(i,n);case"/":return t(r,n)/t(i,n);case"%":return t(r,n)%t(i,n);case"-":return t(r,n)-t(i,n);case"<<":return t(r,n)<<t(i,n);case">>":return t(r,n)>>t(i,n);case">>>":return t(r,n)>>>t(i,n);case"==":return t(r,n)==t(i,n);case"===":return t(r,n)===t(i,n);case"!=":return t(r,n)!=t(i,n);case"!==":return t(r,n)!==t(i,n);case"<":return t(r,n)<t(i,n);case"<=":return t(r,n)<=t(i,n);case">":return t(r,n)>t(i,n);case">=":return t(r,n)>=t(i,n);case"in":return t(r,n)in t(i,n);case"instanceof":return t(r,n)instanceof t(i,n)}throw e}),e(AST_Conditional,function(e){return t(this.condition,e)?t(this.consequent,e):t(this.alternative,e)}),e(AST_SymbolRef,function(n){var r=this.definition();if(r&&r.constant&&r.init)return t(r.init,n);throw e})}(function(e,t){e.DEFMETHOD("_eval",t)}),function(e){function n(e){return t(AST_UnaryPrefix,e,{operator:"!",expression:e})}e(AST_Node,function(){return n(this)}),e(AST_Statement,function(){throw new Error("Cannot negate a statement")}),e(AST_Function,function(){return n(this)}),e(AST_UnaryPrefix,function(){return this.operator=="!"?this.expression:n(this)}),e(AST_Seq,function(e){var t=this.clone();return t.cdr=t.cdr.negate(e),t}),e(AST_Conditional,function(e){var t=this.clone();return t.consequent=t.consequent.negate(e),t.alternative=t.alternative.negate(e),a(n(this),t)}),e(AST_Binary,function(e){var t=this.clone(),r=this.operator;if(e.option("unsafe_comps"))switch(r){case"<=":return t.operator=">",t;case"<":return t.operator=">=",t;case">=":return t.operator="<",t;case">":return t.operator="<=",t}switch(r){case"==":return t.operator="!=",t;case"!=":return t.operator="==",t;case"===":return t.operator="!==",t;case"!==":return t.operator="===",t;case"&&":return t.operator="||",t.left=t.left.negate(e),t.right=t.right.negate(e),a(n(this),t);case"||":return t.operator="&&",t.left=t.left.negate(e),t.right=t.right.negate(e),a(n(this),t)}return n(this)})}(function(e,t){e.DEFMETHOD("negate",function(e){return t.call(this,e)})}),function(e){e(AST_Node,function(e){return!0}),e(AST_EmptyStatement,function(e){return!1}),e(AST_Constant,function(e){return!1}),e(AST_This,function(e){return!1}),e(AST_Call,function(e){var t=e.option("pure_funcs");return t?t.indexOf(this.expression.print_to_string())<0:!0}),e(AST_Block,function(e){for(var t=this.body.length;--t>=0;)if(this.body[t].has_side_effects(e))return!0;return!1}),e(AST_SimpleStatement,function(e){return this.body.has_side_effects(e)}),e(AST_Defun,function(e){return!0}),e(AST_Function,function(e){return!1}),e(AST_Binary,function(e){return this.left.has_side_effects(e)||this.right.has_side_effects(e)}),e(AST_Assign,function(e){return!0}),e(AST_Conditional,function(e){return this.condition.has_side_effects(e)||this.consequent.has_side_effects(e)||this.alternative.has_side_effects(e)}),e(AST_Unary,function(e){return this.operator=="delete"||this.operator=="++"||this.operator=="--"||this.expression.has_side_effects(e)}),e(AST_SymbolRef,function(e){return!1}),e(AST_Object,function(e){for(var t=this.properties.length;--t>=0;)if(this.properties[t].has_side_effects(e))return!0;return!1}),e(AST_ObjectProperty,function(e){return this.value.has_side_effects(e)}),e(AST_Array,function(e){for(var t=this.elements.length;--t>=0;)if(this.elements[t].has_side_effects(e))return!0;return!1}),e(AST_Dot,function(e){return e.option("pure_getters")?this.expression.has_side_effects(e):!0}),e(AST_Sub,function(e){return e.option("pure_getters")?this.expression.has_side_effects(e)||this.property.has_side_effects(e):!0}),e(AST_PropAccess,function(e){return!e.option("pure_getters")}),e(AST_Seq,function(e){return this.car.has_side_effects(e)||this.cdr.has_side_effects(e)})}(function(e,t){e.DEFMETHOD("has_side_effects",t)}),function(e){function t(){var e=this.body.length;return e>0&&f(this.body[e-1])}e(AST_Statement,function(){return null}),e(AST_Jump,function(){return this}),e(AST_BlockStatement,t),e(AST_SwitchBranch,t),e(AST_If,function(){return this.alternative&&f(this.body)&&f(this.alternative)})}(function(e,t){e.DEFMETHOD("aborts",t)}),e(AST_Directive,function(e,n){return e.scope.has_directive(e.value)!==e.scope?t(AST_EmptyStatement,e):e}),e(AST_Debugger,function(e,n){return n.option("drop_debugger")?t(AST_EmptyStatement,e):e}),e(AST_LabeledStatement,function(e,n){return e.body instanceof AST_Break&&n.loopcontrol_target(e.body.label)===e.body?t(AST_EmptyStatement,e):e.label.references.length==0?e.body:e}),e(AST_Block,function(e,t){return e.body=o(e.body,t),e}),e(AST_BlockStatement,function(e,n){e.body=o(e.body,n);switch(e.body.length){case 1:return e.body[0];case 0:return t(AST_EmptyStatement,e)}return e}),AST_Scope.DEFMETHOD("drop_unused",function(e){var n=this;if(e.option("unused")&&!(n instanceof AST_Toplevel)&&!n.uses_eval){var r=[],i=new Dictionary,s=this,o=new TreeWalker(function(t,u){if(t!==n){if(t instanceof AST_Defun)return i.add(t.name.name,t),!0;if(t instanceof AST_Definitions&&s===n)return t.definitions.forEach(function(t){t.value&&(i.add(t.name.name,t.value),t.value.has_side_effects(e)&&t.value.walk(o))}),!0;if(t instanceof AST_SymbolRef)return push_uniq(r,t.definition()),!0;if(t instanceof AST_Scope){var a=s;return s=t,u(),s=a,!0}}});n.walk(o);for(var u=0;u<r.length;++u)r[u].orig.forEach(function(e){var t=i.get(e.name);t&&t.forEach(function(e){var t=new TreeWalker(function(e){e instanceof AST_SymbolRef&&push_uniq(r,e.definition())});e.walk(t)})});var a=new TreeTransformer(function(s,o,u){if(s instanceof AST_Lambda&&!(s instanceof AST_Accessor))for(var f=s.argnames,l=f.length;--l>=0;){var c=f[l];if(!c.unreferenced())break;f.pop(),e.warn("Dropping unused function argument {name} [{file}:{line},{col}]",{name:c.name,file:c.start.file,line:c.start.line,col:c.start.col})}if(s instanceof AST_Defun&&s!==n)return member(s.name.definition(),r)?s:(e.warn("Dropping unused function {name} [{file}:{line},{col}]",{name:s.name.name,file:s.name.start.file,line:s.name.start.line,col:s.name.start.col}),t(AST_EmptyStatement,s));if(s instanceof AST_Definitions&&!(a.parent()instanceof AST_ForIn)){var h=s.definitions.filter(function(t){if(member(t.name.definition(),r))return!0;var n={name:t.name.name,file:t.name.start.file,line:t.name.start.line,col:t.name.start.col};return t.value&&t.value.has_side_effects(e)?(t._unused_side_effects=!0,e.warn("Side effects in initialization of unused variable {name} [{file}:{line},{col}]",n),!0):(e.warn("Dropping unused variable {name} [{file}:{line},{col}]",n),!1)});h=mergeSort(h,function(e,t){return!e.value&&t.value?-1:!t.value&&e.value?1:0});var p=[];for(var l=0;l<h.length;){var d=h[l];d._unused_side_effects?(p.push(d.value),h.splice(l,1)):(p.length>0&&(p.push(d.value),d.value=AST_Seq.from_array(p),p=[]),++l)}return p.length>0?p=t(AST_BlockStatement,s,{body:[t(AST_SimpleStatement,s,{body:AST_Seq.from_array(p)})]}):p=null,h.length==0&&!p?t(AST_EmptyStatement,s):h.length==0?p:(s.definitions=h,p&&(p.body.unshift(s),s=p),s)}if(s instanceof AST_For){o(s,this);if(s.init instanceof AST_BlockStatement){var v=s.init.body.slice(0,-1);return s.init=s.init.body.slice(-1)[0].body,v.push(s),u?MAP.splice(v):t(AST_BlockStatement,s,{body:v})}}if(s instanceof AST_Scope&&s!==n)return s});n.transform(a)}}),AST_Scope.DEFMETHOD("hoist_declarations",function(e){var n=e.option("hoist_funs"),r=e.option("hoist_vars"),i=this;if(n||r){var s=[],o=[],u=new Dictionary,a=0,f=0;i.walk(new TreeWalker(function(e){if(e instanceof AST_Scope&&e!==i)return!0;if(e instanceof AST_Var)return++f,!0})),r=r&&f>1;var l=new TreeTransformer(function(f){if(f!==i){if(f instanceof AST_Directive)return s.push(f),t(AST_EmptyStatement,f);if(f instanceof AST_Defun&&n)return o.push(f),t(AST_EmptyStatement,f);if(f instanceof AST_Var&&r){f.definitions.forEach(function(e){u.set(e.name.name,e),++a});var c=f.to_assignments(),h=l.parent();return h instanceof AST_ForIn&&h.init===f?c==null?f.definitions[0].name:c:h instanceof AST_For&&h.init===f?c:c?t(AST_SimpleStatement,f,{body:c}):t(AST_EmptyStatement,f)}if(f instanceof AST_Scope)return f}});i=i.transform(l);if(a>0){var c=[];u.each(function(e,t){i instanceof AST_Lambda&&find_if(function(t){return t.name==e.name.name},i.argnames)?u.del(t):(e=e.clone(),e.value=null,c.push(e),u.set(t,e))});if(c.length>0){for(var h=0;h<i.body.length;){if(i.body[h]instanceof AST_SimpleStatement){var p=i.body[h].body,d,v;if(p instanceof AST_Assign&&p.operator=="="&&(d=p.left)instanceof AST_Symbol&&u.has(d.name)){var m=u.get(d.name);if(m.value)break;m.value=p.right,remove(c,m),c.push(m),i.body.splice(h,1);continue}if(p instanceof AST_Seq&&(v=p.car)instanceof AST_Assign&&v.operator=="="&&(d=v.left)instanceof AST_Symbol&&u.has(d.name)){var m=u.get(d.name);if(m.value)break;m.value=v.right,remove(c,m),c.push(m),i.body[h].body=p.cdr;continue}}if(i.body[h]instanceof AST_EmptyStatement){i.body.splice(h,1);continue}if(i.body[h]instanceof AST_BlockStatement){var g=[h,1].concat(i.body[h].body);i.body.splice.apply(i.body,g);continue}break}c=t(AST_Var,i,{definitions:c}),o.push(c)}}i.body=s.concat(o,i.body)}return i}),e(AST_SimpleStatement,function(e,n){return n.option("side_effects")&&!e.body.has_side_effects(n)?(n.warn("Dropping side-effect-free statement [{file}:{line},{col}]",e.start),t(AST_EmptyStatement,e)):e}),e(AST_DWLoop,function(e,n){var r=e.condition.evaluate(n);e.condition=r[0];if(!n.option("loops"))return e;if(r.length>1){if(r[1])return t(AST_For,e,{body:e.body});if(e instanceof AST_While&&n.option("dead_code")){var i=[];return u(n,e.body,i),t(AST_BlockStatement,e,{body:i})}}return e}),e(AST_While,function(e,n){return n.option("loops")?(e=AST_DWLoop.prototype.optimize.call(e,n),e instanceof AST_While&&(l(e,n),e=t(AST_For,e,e).transform(n)),e):e}),e(AST_For,function(e,n){var r=e.condition;r&&(r=r.evaluate(n),e.condition=r[0]);if(!n.option("loops"))return e;if(r&&r.length>1&&!r[1]&&n.option("dead_code")){var i=[];return e.init instanceof AST_Statement?i.push(e.init):e.init&&i.push(t(AST_SimpleStatement,e.init,{body:e.init})),u(n,e.body,i),t(AST_BlockStatement,e,{body:i})}return l(e,n),e}),e(AST_If,function(e,n){if(!n.option("conditionals"))return e;var r=e.condition.evaluate(n);e.condition=r[0];if(r.length>1)if(r[1]){n.warn("Condition always true [{file}:{line},{col}]",e.condition.start);if(n.option("dead_code")){var s=[];return e.alternative&&u(n,e.alternative,s),s.push(e.body),t(AST_BlockStatement,e,{body:s}).transform(n)}}else{n.warn("Condition always false [{file}:{line},{col}]",e.condition.start);if(n.option("dead_code")){var s=[];return u(n,e.body,s),e.alternative&&s.push(e.alternative),t(AST_BlockStatement,e,{body:s}).transform(n)}}i(e.alternative)&&(e.alternative=null);var o=e.condition.negate(n),l=a(e.condition,o)===o;if(e.alternative&&l){l=!1,e.condition=o;var c=e.body;e.body=e.alternative||t(AST_EmptyStatement),e.alternative=c}if(i(e.body)&&i(e.alternative))return t(AST_SimpleStatement,e.condition,{body:e.condition}).transform(n);if(e.body instanceof AST_SimpleStatement&&e.alternative instanceof AST_SimpleStatement)return t(AST_SimpleStatement,e,{body:t(AST_Conditional,e,{condition:e.condition,consequent:e.body.body,alternative:e.alternative.body})}).transform(n);if(i(e.alternative)&&e.body instanceof AST_SimpleStatement)return l?t(AST_SimpleStatement,e,{body:t(AST_Binary,e,{operator:"||",left:o,right:e.body.body})}).transform(n):t(AST_SimpleStatement,e,{body:t(AST_Binary,e,{operator:"&&",left:e.condition,right:e.body.body})}).transform(n);if(e.body instanceof AST_EmptyStatement&&e.alternative&&e.alternative instanceof AST_SimpleStatement)return t(AST_SimpleStatement,e,{body:t(AST_Binary,e,{operator:"||",left:e.condition,right:e.alternative.body})}).transform(n);if(e.body instanceof AST_Exit&&e.alternative instanceof AST_Exit&&e.body.TYPE==e.alternative.TYPE)return t(e.body.CTOR,e,{value:t(AST_Conditional,e,{condition:e.condition,consequent:e.body.value||t(AST_Undefined,e.body).optimize(n),alternative:e.alternative.value||t(AST_Undefined,e.alternative).optimize(n)})}).transform(n);e.body instanceof AST_If&&!e.body.alternative&&!e.alternative&&(e.condition=t(AST_Binary,e.condition,{operator:"&&",left:e.condition,right:e.body.condition}).transform(n),e.body=e.body.body);if(f(e.body)&&e.alternative){var h=e.alternative;return e.alternative=null,t(AST_BlockStatement,e,{body:[e,h]}).transform(n)}if(f(e.alternative)){var p=e.body;return e.body=e.alternative,e.condition=l?o:e.condition.negate(n),e.alternative=null,t(AST_BlockStatement,e,{body:[e,p]}).transform(n)}return e}),e(AST_Switch,function(e,n){if(e.body.length==0&&n.option("conditionals"))return t(AST_SimpleStatement,e,{body:e.expression}).transform(n);for(;;){var r=e.body[e.body.length-1];if(r){var i=r.body[r.body.length-1];i instanceof AST_Break&&s(n.loopcontrol_target(i.label))===e&&r.body.pop();if(r instanceof AST_Default&&r.body.length==0){e.body.pop();continue}}break}var o=e.expression.evaluate(n);e:if(o.length==2)try{e.expression=o[0];if(!n.option("dead_code"))break e;var u=o[1],a=!1,l=!1,c=!1,h=!1,p=!1,d=new TreeTransformer(function(r,i,s){if(r instanceof AST_Lambda||r instanceof AST_SimpleStatement)return r;if(r instanceof AST_Switch&&r===e)return r=r.clone(),i(r,this),p?r:t(AST_BlockStatement,r,{body:r.body.reduce(function(e,t){return e.concat(t.body)},[])}).transform(n);if(r instanceof AST_If||r instanceof AST_Try){var o=a;return a=!l,i(r,this),a=o,r}if(r instanceof AST_StatementWithBody||r instanceof AST_Switch){var o=l;return l=!0,i(r,this),l=o,r}if(r instanceof AST_Break&&this.loopcontrol_target(r.label)===e)return a?(p=!0,r):l?r:(h=!0,s?MAP.skip:t(AST_EmptyStatement,r));if(r instanceof AST_SwitchBranch&&this.parent()===e){if(h)return MAP.skip;if(r instanceof AST_Case){var d=r.expression.evaluate(n);if(d.length<2)throw e;return d[1]===u||c?(c=!0,f(r)&&(h=!0),i(r,this),r):MAP.skip}return i(r,this),r}});d.stack=n.stack.slice(),e=e.transform(d)}catch(v){if(v!==e)throw v}return e}),e(AST_Case,function(e,t){return e.body=o(e.body,t),e}),e(AST_Try,function(e,t){return e.body=o(e.body,t),e}),AST_Definitions.DEFMETHOD("remove_initializers",function(){this.definitions.forEach(function(e){e.value=null})}),AST_Definitions.DEFMETHOD("to_assignments",function(){var e=this.definitions.reduce(function(e,n){if(n.value){var r=t(AST_SymbolRef,n.name,n.name);e.push(t(AST_Assign,n,{operator:"=",left:r,right:n.value}))}return e},[]);return e.length==0?null:AST_Seq.from_array(e)}),e(AST_Definitions,function(e,n){return e.definitions.length==0?t(AST_EmptyStatement,e):e}),e(AST_Function,function(e,t){return e=AST_Lambda.prototype.optimize.call(e,t),t.option("unused")&&e.name&&e.name.unreferenced()&&(e.name=null),e}),e(AST_Call,function(e,r){if(r.option("unsafe")){var i=e.expression;if(i instanceof AST_SymbolRef&&i.undeclared())switch(i.name){case"Array":if(e.args.length!=1)return t(AST_Array,e,{elements:e.args}).transform(r);break;case"Object":if(e.args.length==0)return t(AST_Object,e,{properties:[]});break;case"String":if(e.args.length==0)return t(AST_String,e,{value:""});if(e.args.length<=1)return t(AST_Binary,e,{left:e.args[0],operator:"+",right:t(AST_String,e,{value:""})}).transform(r);break;case"Number":if(e.args.length==0)return t(AST_Number,e,{value:0});if(e.args.length==1)return t(AST_UnaryPrefix,e,{expression:e.args[0],operator:"+"}).transform(r);case"Boolean":if(e.args.length==0)return t(AST_False,e);if(e.args.length==1)return t(AST_UnaryPrefix,e,{expression:t(AST_UnaryPrefix,null,{expression:e.args[0],operator:"!"}),operator:"!"}).transform(r);break;case"Function":if(all(e.args,function(e){return e instanceof AST_String}))try{var s="(function("+e.args.slice(0,-1).map(function(e){return e.value}).join(",")+"){"+e.args[e.args.length-1].value+"})()",o=parse(s);o.figure_out_scope({screw_ie8:r.option("screw_ie8")});var u=new Compressor(r.options);o=o.transform(u),o.figure_out_scope({screw_ie8:r.option("screw_ie8")}),o.mangle_names();var f;try{o.walk(new TreeWalker(function(e){if(e instanceof AST_Lambda)throw f=e,o}))}catch(l){if(l!==o)throw l}var c=f.argnames.map(function(n,r){return t(AST_String,e.args[r],{value:n.print_to_string()})}),s=OutputStream();return AST_BlockStatement.prototype._codegen.call(f,f,s),s=s.toString().replace(/^\{|\}$/g,""),c.push(t(AST_String,e.args[e.args.length-1],{value:s})),e.args=c,e}catch(l){if(!(l instanceof JS_Parse_Error))throw console.log(l),l;r.warn("Error parsing code passed to new Function [{file}:{line},{col}]",e.args[e.args.length-1].start),r.warn(l.toString())}}else{if(i instanceof AST_Dot&&i.property=="toString"&&e.args.length==0)return t(AST_Binary,e,{left:t(AST_String,e,{value:""}),operator:"+",right:i.expression}).transform(r);if(i instanceof AST_Dot&&i.expression instanceof AST_Array&&i.property=="join")e:{var h=e.args.length==0?",":e.args[0].evaluate(r)[1];if(h==null)break e;var p=i.expression.elements.reduce(function(e,t){t=t.evaluate(r);if(e.length==0||t.length==1)e.push(t);else{var i=e[e.length-1];if(i.length==2){var s=""+i[1]+h+t[1];e[e.length-1]=[n(r,s,i[0]),s]}else e.push(t)}return e},[]);if(p.length==0)return t(AST_String,e,{value:""});if(p.length==1)return p[0][0];if(h==""){var d;return p[0][0]instanceof AST_String||p[1][0]instanceof AST_String?d=p.shift()[0]:d=t(AST_String,e,{value:""}),p.reduce(function(e,n){return t(AST_Binary,n[0],{operator:"+",left:e,right:n[0]})},d).transform(r)}var v=e.clone();return v.expression=v.expression.clone(),v.expression.expression=v.expression.expression.clone(),v.expression.expression.elements=p.map(function(e){return e[0]}),a(e,v)}}}return r.option("side_effects")&&e.expression instanceof AST_Function&&e.args.length==0&&!AST_Block.prototype.has_side_effects.call(e.expression,r)?t(AST_Undefined,e).transform(r):r.option("drop_console")&&e.expression instanceof AST_PropAccess&&e.expression.expression instanceof AST_SymbolRef&&e.expression.expression.name=="console"&&e.expression.expression.undeclared()?t(AST_Undefined,e).transform(r):e.evaluate(r)[0]}),e(AST_New,function(e,n){if(n.option("unsafe")){var r=e.expression;if(r instanceof AST_SymbolRef&&r.undeclared())switch(r.name){case"Object":case"RegExp":case"Function":case"Error":case"Array":return t(AST_Call,e,e).transform(n)}}return e}),e(AST_Seq,function(e,t){if(!t.option("side_effects"))return e;if(!e.car.has_side_effects(t)){var n;if(!(e.cdr instanceof AST_SymbolRef&&e.cdr.name=="eval"&&e.cdr.undeclared()&&(n=t.parent())instanceof AST_Call&&n.expression===e))return e.cdr}if(t.option("cascade")){if(e.car instanceof AST_Assign&&!e.car.left.has_side_effects(t)){if(e.car.left.equivalent_to(e.cdr))return e.car;if(e.cdr instanceof AST_Call&&e.cdr.expression.equivalent_to(e.car.left))return e.cdr.expression=e.car,e.cdr}if(!e.car.has_side_effects(t)&&!e.cdr.has_side_effects(t)&&e.car.equivalent_to(e.cdr))return e.car}return e}),AST_Unary.DEFMETHOD("lift_sequences",function(e){if(e.option("sequences")&&this.expression instanceof AST_Seq){var t=this.expression,n=t.to_array();return this.expression=n.pop(),n.push(this),t=AST_Seq.from_array(n).transform(e),t}return this}),e(AST_UnaryPostfix,function(e,t){return e.lift_sequences(t)}),e(AST_UnaryPrefix,function(e,n){e=e.lift_sequences(n);var r=e.expression;if(n.option("booleans")&&n.in_boolean_context()){switch(e.operator){case"!":if(r instanceof AST_UnaryPrefix&&r.operator=="!")return r.expression;break;case"typeof":return n.warn("Boolean expression always true [{file}:{line},{col}]",e.start),t(AST_True,e)}r instanceof AST_Binary&&e.operator=="!"&&(e=a(e,r.negate(n)))}return e.evaluate(n)[0]}),AST_Binary.DEFMETHOD("lift_sequences",function(e){if(e.option("sequences")){if(this.left instanceof AST_Seq){var t=this.left,n=t.to_array();return this.left=n.pop(),n.push(this),t=AST_Seq.from_array(n).transform(e),t}if(this.right instanceof AST_Seq&&this instanceof AST_Assign&&!c(this.left,e)){var t=this.right,n=t.to_array();return this.right=n.pop(),n.push(this),t=AST_Seq.from_array(n).transform(e),t}}return this});var h=makePredicate("== === != !== * & | ^");e(AST_Binary,function(e,n){var r=n.has_directive("use asm")?noop:function(t,r){if(r||!e.left.has_side_effects(n)&&!e.right.has_side_effects(n)){t&&(e.operator=t);var i=e.left;e.left=e.right,e.right=i}};if(h(e.operator)){e.right instanceof AST_Constant&&!(e.left instanceof AST_Constant)&&(e.left instanceof AST_Binary&&PRECEDENCE[e.left.operator]>=PRECEDENCE[e.operator]||r(null,!0));if(/^[!=]==?$/.test(e.operator)){if(e.left instanceof AST_SymbolRef&&e.right instanceof AST_Conditional){if(e.right.consequent instanceof AST_SymbolRef&&e.right.consequent.definition()===e.left.definition()){if(/^==/.test(e.operator))return e.right.condition;if(/^!=/.test(e.operator))return e.right.condition.negate(n)}if(e.right.alternative instanceof AST_SymbolRef&&e.right.alternative.definition()===e.left.definition()){if(/^==/.test(e.operator))return e.right.condition.negate(n);if(/^!=/.test(e.operator))return e.right.condition}}if(e.right instanceof AST_SymbolRef&&e.left instanceof AST_Conditional){if(e.left.consequent instanceof AST_SymbolRef&&e.left.consequent.definition()===e.right.definition()){if(/^==/.test(e.operator))return e.left.condition;if(/^!=/.test(e.operator))return e.left.condition.negate(n)}if(e.left.alternative instanceof AST_SymbolRef&&e.left.alternative.definition()===e.right.definition()){if(/^==/.test(e.operator))return e.left.condition.negate(n);if(/^!=/.test(e.operator))return e.left.condition}}}}e=e.lift_sequences(n);if(n.option("comparisons"))switch(e.operator){case"===":case"!==":if(e.left.is_string(n)&&e.right.is_string(n)||e.left.is_boolean()&&e.right.is_boolean())e.operator=e.operator.substr(0,2);case"==":case"!=":e.left instanceof AST_String&&e.left.value=="undefined"&&e.right instanceof AST_UnaryPrefix&&e.right.operator=="typeof"&&n.option("unsafe")&&(!(e.right.expression instanceof AST_SymbolRef)||!e.right.expression.undeclared())&&(e.right=e.right.expression,e.left=t(AST_Undefined,e.left).optimize(n),e.operator.length==2&&(e.operator+="="))}if(n.option("booleans")&&n.in_boolean_context())switch(e.operator){case"&&":var i=e.left.evaluate(n),s=e.right.evaluate(n);if(i.length>1&&!i[1]||s.length>1&&!s[1])return n.warn("Boolean && always false [{file}:{line},{col}]",e.start),t(AST_False,e);if(i.length>1&&i[1])return s[0];if(s.length>1&&s[1])return i[0];break;case"||":var i=e.left.evaluate(n),s=e.right.evaluate(n);if(i.length>1&&i[1]||s.length>1&&s[1])return n.warn("Boolean || always true [{file}:{line},{col}]",e.start),t(AST_True,e);if(i.length>1&&!i[1])return s[0];if(s.length>1&&!s[1])return i[0];break;case"+":var i=e.left.evaluate(n),s=e.right.evaluate(n);if(i.length>1&&i[0]instanceof AST_String&&i[1]||s.length>1&&s[0]instanceof AST_String&&s[1])return n.warn("+ in boolean context always true [{file}:{line},{col}]",e.start),t(AST_True,e)}if(n.option("comparisons")){if(!(n.parent()instanceof AST_Binary)||n.parent()instanceof AST_Assign){var o=t(AST_UnaryPrefix,e,{operator:"!",expression:e.negate(n)});e=a(e,o)}switch(e.operator){case"<":r(">");break;case"<=":r(">=")}}return e.operator=="+"&&e.right instanceof AST_String&&e.right.getValue()===""&&e.left instanceof AST_Binary&&e.left.operator=="+"&&e.left.is_string(n)?e.left:(n.option("evaluate")&&e.operator=="+"&&(e.left instanceof AST_Constant&&e.right instanceof AST_Binary&&e.right.operator=="+"&&e.right.left instanceof AST_Constant&&e.right.is_string(n)&&(e=t(AST_Binary,e,{operator:"+",left:t(AST_String,null,{value:""+e.left.getValue()+e.right.left.getValue(),start:e.left.start,end:e.right.left.end}),right:e.right.right})),e.right instanceof AST_Constant&&e.left instanceof AST_Binary&&e.left.operator=="+"&&e.left.right instanceof AST_Constant&&e.left.is_string(n)&&(e=t(AST_Binary,e,{operator:"+",left:e.left.left,right:t(AST_String,null,{value:""+e.left.right.getValue()+e.right.getValue(),start:e.left.right.start,end:e.right.end})})),e.left instanceof AST_Binary&&e.left.operator=="+"&&e.left.is_string(n)&&e.left.right instanceof AST_Constant&&e.right instanceof AST_Binary&&e.right.operator=="+"&&e.right.left instanceof AST_Constant&&e.right.is_string(n)&&(e=t(AST_Binary,e,{operator:"+",left:t(AST_Binary,e.left,{operator:"+",left:e.left.left,right:t(AST_String,null,{value:""+e.left.right.getValue()+e.right.left.getValue(),start:e.left.right.start,end:e.right.left.end})}),right:e.right.right}))),e.right instanceof AST_Binary&&e.right.operator==e.operator&&(e.operator=="*"||e.operator=="&&"||e.operator=="||")?(e.left=t(AST_Binary,e.left,{operator:e.operator,left:e.left,right:e.right.left}),e.right=e.right.right,e.transform(n)):e.evaluate(n)[0])}),e(AST_SymbolRef,function(e,r){if(e.undeclared()){var i=r.option("global_defs");if(i&&i.hasOwnProperty(e.name))return n(r,i[e.name],e);switch(e.name){case"undefined":return t(AST_Undefined,e);case"NaN":return t(AST_NaN,e);case"Infinity":return t(AST_Infinity,e)}}return e}),e(AST_Undefined,function(e,n){if(n.option("unsafe")){var r=n.find_parent(AST_Scope),i=r.find_variable("undefined");if(i){var s=t(AST_SymbolRef,e,{name:"undefined",scope:r,thedef:i});return s.reference(),s}}return e});var p=["+","-","/","*","%",">>","<<",">>>","|","^","&"];e(AST_Assign,function(e,t){return e=e.lift_sequences(t),e.operator=="="&&e.left instanceof AST_SymbolRef&&e.right instanceof AST_Binary&&e.right.left instanceof AST_SymbolRef&&e.right.left.name==e.left.name&&member(e.right.operator,p)&&(e.operator=e.right.operator+"=",e.right=e.right.right),e}),e(AST_Conditional,function(e,n){if(!n.option("conditionals"))return e;if(e.condition instanceof AST_Seq){var r=e.condition.car;return e.condition=e.condition.cdr,AST_Seq.cons(r,e)}var i=e.condition.evaluate(n);if(i.length>1)return i[1]?(n.warn("Condition always true [{file}:{line},{col}]",e.start),e.consequent):(n.warn("Condition always false [{file}:{line},{col}]",e.start),e.alternative);var s=i[0].negate(n);a(i[0],s)===s&&(e=t(AST_Conditional,e,{condition:s,consequent:e.alternative,alternative:e.consequent}));var o=e.consequent,u=e.alternative;return o instanceof AST_Assign&&u instanceof AST_Assign&&o.operator==u.operator&&o.left.equivalent_to(u.left)&&(e=t(AST_Assign,e,{operator:o.operator,left:o.left,right:t(AST_Conditional,e,{condition:e.condition,consequent:o.right,alternative:u.right})})),e}),e(AST_Boolean,function(e,n){if(n.option("booleans")){var r=n.parent();return r instanceof AST_Binary&&(r.operator=="=="||r.operator=="!=")?(n.warn("Non-strict equality against boolean: {operator} {value} [{file}:{line},{col}]",{operator:r.operator,value:e.value,file:r.start.file,line:r.start.line,col:r.start.col}),t(AST_Number,e,{value:+e.value})):t(AST_UnaryPrefix,e,{operator:"!",expression:t(AST_Number,e,{value:1-e.value})})}return e}),e(AST_Sub,function(e,n){var r=e.property;if(r instanceof AST_String&&n.option("properties")){r=r.getValue();if(RESERVED_WORDS(r)?n.option("screw_ie8"):is_identifier_string(r))return t(AST_Dot,e,{expression:e.expression,property:r})}return e}),e(AST_Array,d),e(AST_Object,d),e(AST_RegExp,d)}();