/*!
 * Jade
 * Copyright(c) 2010 TJ Holowaychuk <tj@vision-media.ca>
 * MIT Licensed
 */

function parse(e,t){try{var n=new(t.parser||Parser)(e,t.filename,t),r=new(t.compiler||Compiler)(n.parse(),t),i=r.compile();t.debug&&console.error("\nCompiled Function:\n\n[90m%s[0m",i.replace(/^/gm,"  "));var s=t.globals&&Array.isArray(t.globals)?t.globals:[];return s.push("jade"),s.push("jade_mixins"),s.push("jade_debug"),s.push("buf"),"var buf = [];\nvar jade_mixins = {};\n"+(t.self?"var self = locals || {};\n"+i:addWith("locals || {}",i,s))+";"+'return buf.join("");'}catch(o){n=n.context(),runtime.rethrow(o,n.filename,n.lexer.lineno,n.input)}}var Parser=require("./parser"),Lexer=require("./lexer"),Compiler=require("./compiler"),runtime=require("./runtime"),addWith=require("with"),fs=require("fs");exports.selfClosing=require("./self-closing"),exports.doctypes=require("./doctypes"),exports.filters=require("./filters"),exports.utils=require("./utils"),exports.Compiler=Compiler,exports.Parser=Parser,exports.Lexer=Lexer,exports.nodes=require("./nodes"),exports.runtime=runtime,exports.cache={},exports.compile=function(e,t){var t=t||{},n=t.filename?JSON.stringify(t.filename):"undefined",r;e=String(e),t.compileDebug!==!1?r=["var jade_debug = [{ lineno: 1, filename: "+n+" }];","try {",parse(e,t),"} catch (err) {","  jade.rethrow(err, jade_debug[0].filename, jade_debug[0].lineno"+(t.compileDebug===!0?","+JSON.stringify(e):"")+");","}"].join("\n"):r=parse(e,t),r=new Function("locals, jade",r);var i=function(e){return r(e,Object.create(runtime))};return t.client&&(i.toString=function(){var n=new Error("The `client` option is deprecated, use `jade.compileClient`");return console.error(n.stack||n.message),exports.compileClient(e,t)}),i},exports.compileClient=function(e,t){var t=t||{},n=t.filename?JSON.stringify(t.filename):"undefined",r;return e=String(e),t.compileDebug?(t.compileDebug=!0,r=["var jade_debug = [{ lineno: 1, filename: "+n+" }];","try {",parse(e,t),"} catch (err) {","  jade.rethrow(err, jade_debug[0].filename, jade_debug[0].lineno, "+JSON.stringify(e)+");","}"].join("\n")):(t.compileDebug=!1,r=parse(e,t)),"function template(locals) {\n"+r+"\n}"},exports.render=function(e,t,n){"function"==typeof t&&(n=t,t=undefined);if(typeof n=="function"){var r;try{r=exports.render(e,t)}catch(i){return n(i)}return n(null,r)}t=t||{};if(t.cache&&!t.filename)throw new Error('the "filename" option is required for caching');var s=t.filename,o=t.cache?exports.cache[s]||(exports.cache[s]=exports.compile(e,t)):exports.compile(e,t);return o(t)},exports.renderFile=function(e,t,n){"function"==typeof t&&(n=t,t=undefined);if(typeof n=="function"){var r;try{r=exports.renderFile(e,t)}catch(i){return n(i)}return n(null,r)}t=t||{};var s=e+":string";t.filename=e;var o=t.cache?exports.cache[s]||(exports.cache[s]=fs.readFileSync(e,"utf8")):fs.readFileSync(e,"utf8");return exports.render(o,t)},exports.compileFileClient=function(e,t){t=t||{};var n=e+":string";t.filename=e;var r=t.cache?exports.cache[n]||(exports.cache[n]=fs.readFileSync(e,"utf8")):fs.readFileSync(e,"utf8");return exports.compileClient(r,t)},exports.__express=exports.renderFile;