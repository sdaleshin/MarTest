function parse(e){return parseInheritance(parseConditionals(e))}function parseInheritance(e){return e.replace(/^ *(\w+)\.prototype\.__proto__ * = *(\w+)\.prototype *;?/gm,function(e,t,n){return t+".prototype = new "+n+";\n"+t+".prototype.constructor = "+t+";\n"})}function parseConditionals(e){var t=e.split("\n"),n=t.length,r=!0,i=!1,s=[],o,u;for(var a=0;a<n;++a)o=t[a],/^ *\/\/ *if *(node|browser)/gm.exec(o)?(u=RegExp.$1,r=i="browser"==u):/^ *\/\/ *end/.test(o)?(r=!0,i=!1):i?s.push(o.replace(/^( *)\/\//,"$1")):r&&s.push(o);return s.join("\n")}function compile(){var e="";e+="ejs = (function(){\n",e+="\n// CommonJS require()\n\n",e+=browser.require+"\n\n",e+="require.modules = {};\n\n",e+="require.resolve = "+browser.resolve+";\n\n",e+="require.register = "+browser.register+";\n\n",e+="require.relative = "+browser.relative+";\n\n",args.forEach(function(t){var n=files[t];t=t.replace("lib/",""),e+='\nrequire.register("'+t+'", function(module, exports, require){\n',e+=n,e+="\n}); // module: "+t+"\n"}),e+='\n return require("ejs");\n})();',fs.writeFile("ejs.js",e,function(e){if(e)throw e;console.log("  [90m create : [0m[36m%s[0m","ejs.js"),console.log()})}var fs=require("fs"),args=process.argv.slice(2),pending=args.length,files={};console.log(""),args.forEach(function(e){var t=e.replace("lib/","");fs.readFile(e,"utf8",function(t,n){if(t)throw t;console.log("  [90mcompile : [0m[36m%s[0m",e),files[e]=parse(n),--pending||compile()})});var browser={require:function e(t){if("fs"==t)return{};if("path"==t)return{};var n=e.resolve(t),r=e.modules[n];if(!r)throw new Error('failed to require "'+t+'"');return r.exports||(r.exports={},r.call(r.exports,r,r.exports,e.relative(n))),r.exports},resolve:function(e){var t=e,n=e+".js",r=e+"/index.js";return require.modules[n]&&n||require.modules[r]&&r||t},relative:function(e){return function(t){if("."!=t.substr(0,1))return require(t);var n=e.split("/"),r=t.split("/");n.pop();for(var i=0;i<r.length;i++){var s=r[i];".."==s?n.pop():"."!=s&&n.push(s)}return require(n.join("/"))}},register:function(e,t){require.modules[e]=t}};