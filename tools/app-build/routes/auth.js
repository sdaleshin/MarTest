module.exports=function(e,t){var n=require("passport-local").Strategy,r=t.passport,i=t.models,s=i.User;r.serializeUser(function(e,t){t(null,e.id)}),r.deserializeUser(function(e,t){s.findById(e,function(e,n){t(e,n)})}),r.use(new n({usernameField:"email",passwordField:"password"},function(e,t,n){s.findOne({Email:e},function(e,t){return e?n(e):t?n(null,t):n(null,!1,{message:"Incorrect username."})})})),e.post("/login",function(e,t,n){r.authenticate("local",function(r,i,s){if(r)return n(r);if(!i)return t.redirect("/login");e.logIn(i,function(e){return e?n(e):t.redirect("/users/"+i.username)})})(e,t,n)})};