module.exports=function(e,t){var n=require("fs"),r=t.models,i=t.db,s=require("base64-js"),o=r.User;e.get("/api/users",function(e,t){var n=e.query.skip,r=e.query.take,i=e.query.sort,s=e.query.filter;return o.find().select("Name Email Age").sort(i).skip(n).limit(r).exec(function(e,n){t.send(n)})}),e.post("/api/upload/:id",function(e,t){return n.readFile(e.files.file.path,function(n,r){return console.log("err: "+n),console.log("data: "+r.length),o.findById(e.params.id,function(e,n){n.Avatar.data=s.fromByteArray(r),n.Avatar.contentType="image/png",n.save(function(e){t.send(n)})})}),t.send({result:"ok"})}),e.post("/api/users",function(e,t){var n;return n=new o({text:e.body.text,done:e.body.done,order:e.body.order}),n.save(function(e){}),t.send(n)}),e.get("/api/users/:id",function(e,t){return o.find({_id:e.params.id}).select("Name Email Age").exec(function(e,n){n.length==1?t.send(n[0]):t.json({err:"not found"})})}),e.put("/api/users/:id",function(e,t){return o.findById(e.params.id,function(n,r){r.Age=e.body.Age,r.Name=e.body.Name,r.Email=e.body.Email,r.save(function(e){t.send(r)})})}),e.delete("/api/users/:id",function(e,t){return o.findById(e.params.id,function(e,t){return t.remove(function(e){})})})};