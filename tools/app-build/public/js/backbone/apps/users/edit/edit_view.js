define(["app","tpl!apps/users/edit/templates/edit-layout.ejs","tpl!apps/users/edit/templates/edit-item.ejs","file_upload_image"],function(e,t,n){e.module("UserApp.Edit",function(e,r,i,s,o,u){e.Layout=s.Layout.extend({template:t,regions:{panelRegion:"#panel-region"}}),e.User=s.ItemView.extend({template:n,bindings:{".age":"Age",".email":"Email",".name":"Name"},ui:{btnSave:".save",btnCancel:".cancel"},triggers:{"click @ui.btnSave":"btnSave:clicked","click @ui.btnCancel":"btnCancel:clicked"},onRender:function(){this.stickit();var e="/api/upload/"+this.model.id,t=o("<button/>").addClass("btn btn-primary").prop("disabled",!0).text("Processing...").on("click",function(){var e=o(this),t=e.data();e.off("click").text("Abort").on("click",function(){e.remove(),t.abort()}),t.submit().always(function(){e.remove()})});this.$("#fileupload").fileupload({url:e,dataType:"json",autoUpload:!0,acceptFileTypes:/(\.|\/)(gif|jpe?g|png)$/i,maxFileSize:5e6,disableImageResize:/Android(?!.*Chrome)|Opera/.test(window.navigator.userAgent),previewMaxWidth:227,previewMaxHeight:180,previewCrop:!0}).on("fileuploadadd",function(e,t){t.context=o("<div/>").appendTo("#files")}).on("fileuploadprocessalways",function(e,t){var n=t.index,r=t.files[n],i=o(t.context.children()[n]);r.preview&&o(".avatar").html(r.preview),r.error&&i.append("<br>").append(o('<span class="text-danger"/>').text(r.error)),n+1===t.files.length&&t.context.find("button").text("Upload").prop("disabled",!!t.files.error)})}})})});